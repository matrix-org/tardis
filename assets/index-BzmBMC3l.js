var qn=Object.defineProperty;var Hn=(e,t,n)=>t in e?qn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var T=(e,t,n)=>Hn(e,typeof t!="symbol"?t+"":t,n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))u(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const s of i.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&u(s)}).observe(document,{childList:!0,subtree:!0});function n(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function u(r){if(r.ep)return;r.ep=!0;const i=n(r);fetch(r.href,i)}})();class rn{constructor(){T(this,"stateAtEvent");T(this,"eventCache");this.stateAtEvent=new Vn,this.eventCache=new Wn}}class Vn{constructor(){T(this,"state");this.state={}}setState(t,n){this.state[t]=n,console.log(`StateAtEvent ${t} is`,n)}getStateAsEventIds(t){return this.state[t]?new Set(Object.values(this.state[t])):new Set}getState(t){return this.state[t]?JSON.parse(JSON.stringify(this.state[t])):{}}}class Wn{constructor(){T(this,"cache");this.cache=new Map}store(t){this.cache.set(t.event_id,t)}get(t){return this.cache.get(t)}}class Un{constructor(t){T(this,"index");T(this,"eventIdOrdering");T(this,"currentEventId");this.scenario=t,this.index=t.events.length-1,this.eventIdOrdering=t.events.map(n=>n.event_id),this.currentEventId=this.eventIdOrdering[this.index]}next(){this.index++,this.index>=this.eventIdOrdering.length&&(this.index=this.eventIdOrdering.length-1),this.currentEventId=this.eventIdOrdering[this.index]}previous(){this.index--,this.index<0&&(this.index=0),this.currentEventId=this.eventIdOrdering[this.index]}goTo(t){for(let n=0;n<this.eventIdOrdering.length;n++)if(this.eventIdOrdering[n]===t){this.index=n,this.currentEventId=this.eventIdOrdering[this.index];break}}current(){return this.currentEventId}eventsUpToCurrent(){const t=[];for(let n=0;n<=this.index;n++)t.push(this.eventIdOrdering[n]);return t}async resolve(t,n){for(const u of this.eventsUpToCurrent())await this.resolveEvent(u,t,n)}async resolveEvent(t,n,u){if(n.stateAtEvent.getStateAsEventIds(t).size>0)return;const r=n.eventCache.get(t),i=[];for(const a of r.prev_events){const o=n.stateAtEvent.getState(a);Object.keys(o).length===0&&console.error(`WARN: we do not know the state at ${a} yet, so the state calculation for ${t} may be wrong!`),i.push(o)}console.log("performing state resolution for prev_events:",r.prev_events);const s=await u(r.room_id,this.scenario.roomVersion,i,r);n.stateAtEvent.setState(t,s)}}class jn{constructor(t,n){T(this,"highlightedEventId");T(this,"positionListener");T(this,"jsonListener");this.container=t,this.template=n}clear(){this.container.innerHTML=""}onEventClick(t){this.positionListener=t}onEventJsonClick(t){this.jsonListener=t}onCellClick(t){this.onClick(t,this.positionListener)}onJsonClick(t){this.onClick(t,this.jsonListener)}onClick(t,n){var i;const u=(i=t.target)==null?void 0:i.parentElement;if(!u)return;const r=u.getAttribute("id");r&&n&&n(r)}appendEvent(t,n){const u=this.template.content.firstElementChild.cloneNode(!0);u.setAttribute("id",n.event_id);const r=u.getElementsByClassName("eventlistrowprefix")[0];r.textContent=String(t),u.addEventListener("click",this.onCellClick.bind(this)),u.getElementsByClassName("eventlistrowjson")[0].addEventListener("click",this.onJsonClick.bind(this)),u.getElementsByClassName("eventlistrowbody")[0].textContent=sn(n),u.getElementsByClassName("eventlistroweventid")[0].textContent=n.event_id.substr(0,5),n.state_key!=null&&(u.style.fontWeight="600"),this.container.appendChild(u)}highlight(t){if(this.highlightedEventId){const n=document.getElementById(this.highlightedEventId);n&&(n.style.backgroundColor="")}document.getElementById(t).style.backgroundColor="#6f8ea9",this.highlightedEventId=t}}function sn(e){var u;let t="",n="";if(e.state_key!=null)switch(e.type){case"m.room.create":t=`by ${e.content.creator}`;break;case"m.room.member":t=`${e.state_key}=${e.content.membership}`;break;case"m.room.join_rules":t=`(${e.content.join_rule})`;break;case"m.room.history_visibility":t=`(${e.content.history_visibility})`;break;case"m.room.name":t=`(${e.content.name})`;break;case"m.room.topic":t=`(${e.content.topic})`;break;default:e.state_key!==""&&(t=e.state_key)}else switch(e.type){case"m.reaction":n=(u=e.content["m.relates_to"])==null?void 0:u.key;break;case"m.room.message":n=e.content.body;break}return`${e.type} ${t}${n}`}var zn={value:()=>{}};function on(){for(var e=0,t=arguments.length,n={},u;e<t;++e){if(!(u=arguments[e]+"")||u in n||/[\s.]/.test(u))throw new Error("illegal type: "+u);n[u]=[]}return new Ie(n)}function Ie(e){this._=e}function Xn(e,t){return e.trim().split(/^|\s+/).map(function(n){var u="",r=n.indexOf(".");if(r>=0&&(u=n.slice(r+1),n=n.slice(0,r)),n&&!t.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:u}})}Ie.prototype=on.prototype={constructor:Ie,on:function(e,t){var n=this._,u=Xn(e+"",n),r,i=-1,s=u.length;if(arguments.length<2){for(;++i<s;)if((r=(e=u[i]).type)&&(r=Yn(n[r],e.name)))return r;return}if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++i<s;)if(r=(e=u[i]).type)n[r]=Ot(n[r],e.name,t);else if(t==null)for(r in n)n[r]=Ot(n[r],e.name,null);return this},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new Ie(e)},call:function(e,t){if((r=arguments.length-2)>0)for(var n=new Array(r),u=0,r,i;u<r;++u)n[u]=arguments[u+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(i=this._[e],u=0,r=i.length;u<r;++u)i[u].value.apply(t,n)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var u=this._[e],r=0,i=u.length;r<i;++r)u[r].value.apply(t,n)}};function Yn(e,t){for(var n=0,u=e.length,r;n<u;++n)if((r=e[n]).name===t)return r.value}function Ot(e,t,n){for(var u=0,r=e.length;u<r;++u)if(e[u].name===t){e[u]=zn,e=e.slice(0,u).concat(e.slice(u+1));break}return n!=null&&e.push({name:t,value:n}),e}var nt="http://www.w3.org/1999/xhtml";const Mt={svg:"http://www.w3.org/2000/svg",xhtml:nt,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function He(e){var t=e+="",n=t.indexOf(":");return n>=0&&(t=e.slice(0,n))!=="xmlns"&&(e=e.slice(n+1)),Mt.hasOwnProperty(t)?{space:Mt[t],local:e}:e}function Kn(e){return function(){var t=this.ownerDocument,n=this.namespaceURI;return n===nt&&t.documentElement.namespaceURI===nt?t.createElement(e):t.createElementNS(n,e)}}function Zn(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function an(e){var t=He(e);return(t.local?Zn:Kn)(t)}function Qn(){}function At(e){return e==null?Qn:function(){return this.querySelector(e)}}function eu(e){typeof e!="function"&&(e=At(e));for(var t=this._groups,n=t.length,u=new Array(n),r=0;r<n;++r)for(var i=t[r],s=i.length,a=u[r]=new Array(s),o,c,l=0;l<s;++l)(o=i[l])&&(c=e.call(o,o.__data__,l,i))&&("__data__"in o&&(c.__data__=o.__data__),a[l]=c);return new P(u,this._parents)}function Ct(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function tu(){return[]}function cn(e){return e==null?tu:function(){return this.querySelectorAll(e)}}function nu(e){return function(){var t=e.apply(this,arguments);return t==null?[]:Ct(t)}}function uu(e){typeof e=="function"?e=nu(e):e=cn(e);for(var t=this._groups,n=t.length,u=[],r=[],i=0;i<n;++i)for(var s=t[i],a=s.length,o,c=0;c<a;++c)(o=s[c])&&(u.push(e.call(o,o.__data__,c,s)),r.push(o));return new P(u,r)}function ln(e){return function(){return this.matches(e)}}function fn(e){return function(t){return t.matches(e)}}var ru=Array.prototype.find;function iu(e){return function(){return ru.call(this.children,e)}}function su(){return this.firstElementChild}function ou(e){return this.select(e==null?su:iu(typeof e=="function"?e:fn(e)))}var au=Array.prototype.filter;function cu(){return this.children}function lu(e){return function(){return au.call(this.children,e)}}function fu(e){return this.selectAll(e==null?cu:lu(typeof e=="function"?e:fn(e)))}function Du(e){typeof e!="function"&&(e=ln(e));for(var t=this._groups,n=t.length,u=new Array(n),r=0;r<n;++r)for(var i=t[r],s=i.length,a=u[r]=[],o,c=0;c<s;++c)(o=i[c])&&e.call(o,o.__data__,c,i)&&a.push(o);return new P(u,this._parents)}function Dn(e){return new Array(e.length)}function hu(){return new P(this._enter||this._groups.map(Dn),this._parents)}function Le(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}Le.prototype={constructor:Le,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};function du(e){return function(){return e}}function Eu(e,t,n,u,r,i){for(var s=0,a,o=t.length,c=i.length;s<c;++s)(a=t[s])?(a.__data__=i[s],u[s]=a):n[s]=new Le(e,i[s]);for(;s<o;++s)(a=t[s])&&(r[s]=a)}function Au(e,t,n,u,r,i,s){var a,o,c=new Map,l=t.length,h=i.length,d=new Array(l),A;for(a=0;a<l;++a)(o=t[a])&&(d[a]=A=s.call(o,o.__data__,a,t)+"",c.has(A)?r[a]=o:c.set(A,o));for(a=0;a<h;++a)A=s.call(e,i[a],a,i)+"",(o=c.get(A))?(u[a]=o,o.__data__=i[a],c.delete(A)):n[a]=new Le(e,i[a]);for(a=0;a<l;++a)(o=t[a])&&c.get(d[a])===o&&(r[a]=o)}function Cu(e){return e.__data__}function pu(e,t){if(!arguments.length)return Array.from(this,Cu);var n=t?Au:Eu,u=this._parents,r=this._groups;typeof e!="function"&&(e=du(e));for(var i=r.length,s=new Array(i),a=new Array(i),o=new Array(i),c=0;c<i;++c){var l=u[c],h=r[c],d=h.length,A=Ct(e.call(l,l&&l.__data__,c,u)),b=A.length,_=a[c]=new Array(b),w=s[c]=new Array(b),E=o[c]=new Array(d);n(l,h,_,w,E,A,t);for(var v=0,p=0,$,L;v<b;++v)if($=_[v]){for(v>=p&&(p=v+1);!(L=w[p])&&++p<b;);$._next=L||null}}return s=new P(s,u),s._enter=a,s._exit=o,s}function vu(){return new P(this._exit||this._groups.map(Dn),this._parents)}function _u(e,t,n){var u=this.enter(),r=this,i=this.exit();return u=typeof e=="function"?e(u):u.append(e+""),t!=null&&(r=t(r)),n==null?i.remove():n(i),u&&r?u.merge(r).order():r}function Fu(e){if(!(e instanceof P))throw new Error("invalid merge");for(var t=this._groups,n=e._groups,u=t.length,r=n.length,i=Math.min(u,r),s=new Array(u),a=0;a<i;++a)for(var o=t[a],c=n[a],l=o.length,h=s[a]=new Array(l),d,A=0;A<l;++A)(d=o[A]||c[A])&&(h[A]=d);for(;a<u;++a)s[a]=t[a];return new P(s,this._parents)}function gu(){for(var e=this._groups,t=-1,n=e.length;++t<n;)for(var u=e[t],r=u.length-1,i=u[r],s;--r>=0;)(s=u[r])&&(i&&s.compareDocumentPosition(i)^4&&i.parentNode.insertBefore(s,i),i=s);return this}function mu(e){e||(e=yu);function t(h,d){return h&&d?e(h.__data__,d.__data__):!h-!d}for(var n=this._groups,u=n.length,r=new Array(u),i=0;i<u;++i){for(var s=n[i],a=s.length,o=r[i]=new Array(a),c,l=0;l<a;++l)(c=s[l])&&(o[l]=c);o.sort(t)}return new P(r,this._parents).order()}function yu(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function Bu(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this}function wu(){return Array.from(this)}function xu(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var u=e[t],r=0,i=u.length;r<i;++r){var s=u[r];if(s)return s}return null}function bu(){let e=0;for(const t of this)++e;return e}function $u(){return!this.node()}function Su(e){for(var t=this._groups,n=0,u=t.length;n<u;++n)for(var r=t[n],i=0,s=r.length,a;i<s;++i)(a=r[i])&&e.call(a,a.__data__,i,r);return this}function ku(e){return function(){this.removeAttribute(e)}}function Iu(e){return function(){this.removeAttributeNS(e.space,e.local)}}function Nu(e,t){return function(){this.setAttribute(e,t)}}function Ru(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function Tu(e,t){return function(){var n=t.apply(this,arguments);n==null?this.removeAttribute(e):this.setAttribute(e,n)}}function Lu(e,t){return function(){var n=t.apply(this,arguments);n==null?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}}function Ou(e,t){var n=He(e);if(arguments.length<2){var u=this.node();return n.local?u.getAttributeNS(n.space,n.local):u.getAttribute(n)}return this.each((t==null?n.local?Iu:ku:typeof t=="function"?n.local?Lu:Tu:n.local?Ru:Nu)(n,t))}function hn(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function Mu(e){return function(){this.style.removeProperty(e)}}function Pu(e,t,n){return function(){this.style.setProperty(e,t,n)}}function Ju(e,t,n){return function(){var u=t.apply(this,arguments);u==null?this.style.removeProperty(e):this.style.setProperty(e,u,n)}}function Gu(e,t,n){return arguments.length>1?this.each((t==null?Mu:typeof t=="function"?Ju:Pu)(e,t,n??"")):De(this.node(),e)}function De(e,t){return e.style.getPropertyValue(t)||hn(e).getComputedStyle(e,null).getPropertyValue(t)}function qu(e){return function(){delete this[e]}}function Hu(e,t){return function(){this[e]=t}}function Vu(e,t){return function(){var n=t.apply(this,arguments);n==null?delete this[e]:this[e]=n}}function Wu(e,t){return arguments.length>1?this.each((t==null?qu:typeof t=="function"?Vu:Hu)(e,t)):this.node()[e]}function dn(e){return e.trim().split(/^|\s+/)}function pt(e){return e.classList||new En(e)}function En(e){this._node=e,this._names=dn(e.getAttribute("class")||"")}En.prototype={add:function(e){var t=this._names.indexOf(e);t<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};function An(e,t){for(var n=pt(e),u=-1,r=t.length;++u<r;)n.add(t[u])}function Cn(e,t){for(var n=pt(e),u=-1,r=t.length;++u<r;)n.remove(t[u])}function Uu(e){return function(){An(this,e)}}function ju(e){return function(){Cn(this,e)}}function zu(e,t){return function(){(t.apply(this,arguments)?An:Cn)(this,e)}}function Xu(e,t){var n=dn(e+"");if(arguments.length<2){for(var u=pt(this.node()),r=-1,i=n.length;++r<i;)if(!u.contains(n[r]))return!1;return!0}return this.each((typeof t=="function"?zu:t?Uu:ju)(n,t))}function Yu(){this.textContent=""}function Ku(e){return function(){this.textContent=e}}function Zu(e){return function(){var t=e.apply(this,arguments);this.textContent=t??""}}function Qu(e){return arguments.length?this.each(e==null?Yu:(typeof e=="function"?Zu:Ku)(e)):this.node().textContent}function er(){this.innerHTML=""}function tr(e){return function(){this.innerHTML=e}}function nr(e){return function(){var t=e.apply(this,arguments);this.innerHTML=t??""}}function ur(e){return arguments.length?this.each(e==null?er:(typeof e=="function"?nr:tr)(e)):this.node().innerHTML}function rr(){this.nextSibling&&this.parentNode.appendChild(this)}function ir(){return this.each(rr)}function sr(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function or(){return this.each(sr)}function ar(e){var t=typeof e=="function"?e:an(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})}function cr(){return null}function lr(e,t){var n=typeof e=="function"?e:an(e),u=t==null?cr:typeof t=="function"?t:At(t);return this.select(function(){return this.insertBefore(n.apply(this,arguments),u.apply(this,arguments)||null)})}function fr(){var e=this.parentNode;e&&e.removeChild(this)}function Dr(){return this.each(fr)}function hr(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function dr(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function Er(e){return this.select(e?dr:hr)}function Ar(e){return arguments.length?this.property("__data__",e):this.node().__data__}function Cr(e){return function(t){e.call(this,t,this.__data__)}}function pr(e){return e.trim().split(/^|\s+/).map(function(t){var n="",u=t.indexOf(".");return u>=0&&(n=t.slice(u+1),t=t.slice(0,u)),{type:t,name:n}})}function vr(e){return function(){var t=this.__on;if(t){for(var n=0,u=-1,r=t.length,i;n<r;++n)i=t[n],(!e.type||i.type===e.type)&&i.name===e.name?this.removeEventListener(i.type,i.listener,i.options):t[++u]=i;++u?t.length=u:delete this.__on}}}function _r(e,t,n){return function(){var u=this.__on,r,i=Cr(t);if(u){for(var s=0,a=u.length;s<a;++s)if((r=u[s]).type===e.type&&r.name===e.name){this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=i,r.options=n),r.value=t;return}}this.addEventListener(e.type,i,n),r={type:e.type,name:e.name,value:t,listener:i,options:n},u?u.push(r):this.__on=[r]}}function Fr(e,t,n){var u=pr(e+""),r,i=u.length,s;if(arguments.length<2){var a=this.node().__on;if(a){for(var o=0,c=a.length,l;o<c;++o)for(r=0,l=a[o];r<i;++r)if((s=u[r]).type===l.type&&s.name===l.name)return l.value}return}for(a=t?_r:vr,r=0;r<i;++r)this.each(a(u[r],t,n));return this}function pn(e,t,n){var u=hn(e),r=u.CustomEvent;typeof r=="function"?r=new r(t,n):(r=u.document.createEvent("Event"),n?(r.initEvent(t,n.bubbles,n.cancelable),r.detail=n.detail):r.initEvent(t,!1,!1)),e.dispatchEvent(r)}function gr(e,t){return function(){return pn(this,e,t)}}function mr(e,t){return function(){return pn(this,e,t.apply(this,arguments))}}function yr(e,t){return this.each((typeof t=="function"?mr:gr)(e,t))}function*Br(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var u=e[t],r=0,i=u.length,s;r<i;++r)(s=u[r])&&(yield s)}var vt=[null];function P(e,t){this._groups=e,this._parents=t}function Be(){return new P([[document.documentElement]],vt)}function wr(){return this}P.prototype=Be.prototype={constructor:P,select:eu,selectAll:uu,selectChild:ou,selectChildren:fu,filter:Du,data:pu,enter:hu,exit:vu,join:_u,merge:Fu,selection:wr,order:gu,sort:mu,call:Bu,nodes:wu,node:xu,size:bu,empty:$u,each:Su,attr:Ou,style:Gu,property:Wu,classed:Xu,text:Qu,html:ur,raise:ir,lower:or,append:ar,insert:lr,remove:Dr,clone:Er,datum:Ar,on:Fr,dispatch:yr,[Symbol.iterator]:Br};function W(e){return typeof e=="string"?new P([[document.querySelector(e)]],[document.documentElement]):new P([[e]],vt)}function te(e){return typeof e=="string"?new P([document.querySelectorAll(e)],[document.documentElement]):new P([e==null?[]:Ct(e)],vt)}function _t(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function vn(e,t){var n=Object.create(e.prototype);for(var u in t)n[u]=t[u];return n}function we(){}var Fe=.7,Oe=1/Fe,fe="\\s*([+-]?\\d+)\\s*",ge="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",j="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",xr=/^#([0-9a-f]{3,8})$/,br=new RegExp("^rgb\\("+[fe,fe,fe]+"\\)$"),$r=new RegExp("^rgb\\("+[j,j,j]+"\\)$"),Sr=new RegExp("^rgba\\("+[fe,fe,fe,ge]+"\\)$"),kr=new RegExp("^rgba\\("+[j,j,j,ge]+"\\)$"),Ir=new RegExp("^hsl\\("+[ge,j,j]+"\\)$"),Nr=new RegExp("^hsla\\("+[ge,j,j,ge]+"\\)$"),Pt={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};_t(we,me,{copy:function(e){return Object.assign(new this.constructor,this,e)},displayable:function(){return this.rgb().displayable()},hex:Jt,formatHex:Jt,formatHsl:Rr,formatRgb:Gt,toString:Gt});function Jt(){return this.rgb().formatHex()}function Rr(){return _n(this).formatHsl()}function Gt(){return this.rgb().formatRgb()}function me(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=xr.exec(e))?(n=t[1].length,t=parseInt(t[1],16),n===6?qt(t):n===3?new q(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):n===8?be(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):n===4?be(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=br.exec(e))?new q(t[1],t[2],t[3],1):(t=$r.exec(e))?new q(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=Sr.exec(e))?be(t[1],t[2],t[3],t[4]):(t=kr.exec(e))?be(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=Ir.exec(e))?Wt(t[1],t[2]/100,t[3]/100,1):(t=Nr.exec(e))?Wt(t[1],t[2]/100,t[3]/100,t[4]):Pt.hasOwnProperty(e)?qt(Pt[e]):e==="transparent"?new q(NaN,NaN,NaN,0):null}function qt(e){return new q(e>>16&255,e>>8&255,e&255,1)}function be(e,t,n,u){return u<=0&&(e=t=n=NaN),new q(e,t,n,u)}function Tr(e){return e instanceof we||(e=me(e)),e?(e=e.rgb(),new q(e.r,e.g,e.b,e.opacity)):new q}function ut(e,t,n,u){return arguments.length===1?Tr(e):new q(e,t,n,u??1)}function q(e,t,n,u){this.r=+e,this.g=+t,this.b=+n,this.opacity=+u}_t(q,ut,vn(we,{brighter:function(e){return e=e==null?Oe:Math.pow(Oe,e),new q(this.r*e,this.g*e,this.b*e,this.opacity)},darker:function(e){return e=e==null?Fe:Math.pow(Fe,e),new q(this.r*e,this.g*e,this.b*e,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Ht,formatHex:Ht,formatRgb:Vt,toString:Vt}));function Ht(){return"#"+Ye(this.r)+Ye(this.g)+Ye(this.b)}function Vt(){var e=this.opacity;return e=isNaN(e)?1:Math.max(0,Math.min(1,e)),(e===1?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(e===1?")":", "+e+")")}function Ye(e){return e=Math.max(0,Math.min(255,Math.round(e)||0)),(e<16?"0":"")+e.toString(16)}function Wt(e,t,n,u){return u<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new U(e,t,n,u)}function _n(e){if(e instanceof U)return new U(e.h,e.s,e.l,e.opacity);if(e instanceof we||(e=me(e)),!e)return new U;if(e instanceof U)return e;e=e.rgb();var t=e.r/255,n=e.g/255,u=e.b/255,r=Math.min(t,n,u),i=Math.max(t,n,u),s=NaN,a=i-r,o=(i+r)/2;return a?(t===i?s=(n-u)/a+(n<u)*6:n===i?s=(u-t)/a+2:s=(t-n)/a+4,a/=o<.5?i+r:2-i-r,s*=60):a=o>0&&o<1?0:s,new U(s,a,o,e.opacity)}function Lr(e,t,n,u){return arguments.length===1?_n(e):new U(e,t,n,u??1)}function U(e,t,n,u){this.h=+e,this.s=+t,this.l=+n,this.opacity=+u}_t(U,Lr,vn(we,{brighter:function(e){return e=e==null?Oe:Math.pow(Oe,e),new U(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=e==null?Fe:Math.pow(Fe,e),new U(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,u=n+(n<.5?n:1-n)*t,r=2*n-u;return new q(Ke(e>=240?e-240:e+120,r,u),Ke(e,r,u),Ke(e<120?e+240:e-120,r,u),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var e=this.opacity;return e=isNaN(e)?1:Math.max(0,Math.min(1,e)),(e===1?"hsl(":"hsla(")+(this.h||0)+", "+(this.s||0)*100+"%, "+(this.l||0)*100+"%"+(e===1?")":", "+e+")")}}));function Ke(e,t,n){return(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)*255}const Fn=e=>()=>e;function Or(e,t){return function(n){return e+n*t}}function Mr(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(u){return Math.pow(e+u*t,n)}}function Pr(e){return(e=+e)==1?gn:function(t,n){return n-t?Mr(t,n,e):Fn(isNaN(t)?n:t)}}function gn(e,t){var n=t-e;return n?Or(e,n):Fn(isNaN(e)?t:e)}const Ut=function e(t){var n=Pr(t);function u(r,i){var s=n((r=ut(r)).r,(i=ut(i)).r),a=n(r.g,i.g),o=n(r.b,i.b),c=gn(r.opacity,i.opacity);return function(l){return r.r=s(l),r.g=a(l),r.b=o(l),r.opacity=c(l),r+""}}return u.gamma=e,u}(1);function ne(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}var rt=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Ze=new RegExp(rt.source,"g");function Jr(e){return function(){return e}}function Gr(e){return function(t){return e(t)+""}}function qr(e,t){var n=rt.lastIndex=Ze.lastIndex=0,u,r,i,s=-1,a=[],o=[];for(e=e+"",t=t+"";(u=rt.exec(e))&&(r=Ze.exec(t));)(i=r.index)>n&&(i=t.slice(n,i),a[s]?a[s]+=i:a[++s]=i),(u=u[0])===(r=r[0])?a[s]?a[s]+=r:a[++s]=r:(a[++s]=null,o.push({i:s,x:ne(u,r)})),n=Ze.lastIndex;return n<t.length&&(i=t.slice(n),a[s]?a[s]+=i:a[++s]=i),a.length<2?o[0]?Gr(o[0].x):Jr(t):(t=o.length,function(c){for(var l=0,h;l<t;++l)a[(h=o[l]).i]=h.x(c);return a.join("")})}var jt=180/Math.PI,it={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function mn(e,t,n,u,r,i){var s,a,o;return(s=Math.sqrt(e*e+t*t))&&(e/=s,t/=s),(o=e*n+t*u)&&(n-=e*o,u-=t*o),(a=Math.sqrt(n*n+u*u))&&(n/=a,u/=a,o/=a),e*u<t*n&&(e=-e,t=-t,o=-o,s=-s),{translateX:r,translateY:i,rotate:Math.atan2(t,e)*jt,skewX:Math.atan(o)*jt,scaleX:s,scaleY:a}}var $e;function Hr(e){const t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?it:mn(t.a,t.b,t.c,t.d,t.e,t.f)}function Vr(e){return e==null||($e||($e=document.createElementNS("http://www.w3.org/2000/svg","g")),$e.setAttribute("transform",e),!(e=$e.transform.baseVal.consolidate()))?it:(e=e.matrix,mn(e.a,e.b,e.c,e.d,e.e,e.f))}function yn(e,t,n,u){function r(c){return c.length?c.pop()+" ":""}function i(c,l,h,d,A,b){if(c!==h||l!==d){var _=A.push("translate(",null,t,null,n);b.push({i:_-4,x:ne(c,h)},{i:_-2,x:ne(l,d)})}else(h||d)&&A.push("translate("+h+t+d+n)}function s(c,l,h,d){c!==l?(c-l>180?l+=360:l-c>180&&(c+=360),d.push({i:h.push(r(h)+"rotate(",null,u)-2,x:ne(c,l)})):l&&h.push(r(h)+"rotate("+l+u)}function a(c,l,h,d){c!==l?d.push({i:h.push(r(h)+"skewX(",null,u)-2,x:ne(c,l)}):l&&h.push(r(h)+"skewX("+l+u)}function o(c,l,h,d,A,b){if(c!==h||l!==d){var _=A.push(r(A)+"scale(",null,",",null,")");b.push({i:_-4,x:ne(c,h)},{i:_-2,x:ne(l,d)})}else(h!==1||d!==1)&&A.push(r(A)+"scale("+h+","+d+")")}return function(c,l){var h=[],d=[];return c=e(c),l=e(l),i(c.translateX,c.translateY,l.translateX,l.translateY,h,d),s(c.rotate,l.rotate,h,d),a(c.skewX,l.skewX,h,d),o(c.scaleX,c.scaleY,l.scaleX,l.scaleY,h,d),c=l=null,function(A){for(var b=-1,_=d.length,w;++b<_;)h[(w=d[b]).i]=w.x(A);return h.join("")}}}var Wr=yn(Hr,"px, ","px)","deg)"),Ur=yn(Vr,", ",")",")"),he=0,Ae=0,Ee=0,Bn=1e3,Me,Ce,Pe=0,le=0,Ve=0,ye=typeof performance=="object"&&performance.now?performance:Date,wn=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function Ft(){return le||(wn(jr),le=ye.now()+Ve)}function jr(){le=0}function Je(){this._call=this._time=this._next=null}Je.prototype=xn.prototype={constructor:Je,restart:function(e,t,n){if(typeof e!="function")throw new TypeError("callback is not a function");n=(n==null?Ft():+n)+(t==null?0:+t),!this._next&&Ce!==this&&(Ce?Ce._next=this:Me=this,Ce=this),this._call=e,this._time=n,st()},stop:function(){this._call&&(this._call=null,this._time=1/0,st())}};function xn(e,t,n){var u=new Je;return u.restart(e,t,n),u}function zr(){Ft(),++he;for(var e=Me,t;e;)(t=le-e._time)>=0&&e._call.call(null,t),e=e._next;--he}function zt(){le=(Pe=ye.now())+Ve,he=Ae=0;try{zr()}finally{he=0,Yr(),le=0}}function Xr(){var e=ye.now(),t=e-Pe;t>Bn&&(Ve-=t,Pe=e)}function Yr(){for(var e,t=Me,n,u=1/0;t;)t._call?(u>t._time&&(u=t._time),e=t,t=t._next):(n=t._next,t._next=null,t=e?e._next=n:Me=n);Ce=e,st(u)}function st(e){if(!he){Ae&&(Ae=clearTimeout(Ae));var t=e-le;t>24?(e<1/0&&(Ae=setTimeout(zt,e-ye.now()-Ve)),Ee&&(Ee=clearInterval(Ee))):(Ee||(Pe=ye.now(),Ee=setInterval(Xr,Bn)),he=1,wn(zt))}}function Xt(e,t,n){var u=new Je;return t=t==null?0:+t,u.restart(r=>{u.stop(),e(r+t)},t,n),u}var Kr=on("start","end","cancel","interrupt"),Zr=[],bn=0,Yt=1,ot=2,Ne=3,Kt=4,at=5,Re=6;function We(e,t,n,u,r,i){var s=e.__transition;if(!s)e.__transition={};else if(n in s)return;Qr(e,n,{name:t,index:u,group:r,on:Kr,tween:Zr,time:i.time,delay:i.delay,duration:i.duration,ease:i.ease,timer:null,state:bn})}function gt(e,t){var n=V(e,t);if(n.state>bn)throw new Error("too late; already scheduled");return n}function z(e,t){var n=V(e,t);if(n.state>Ne)throw new Error("too late; already running");return n}function V(e,t){var n=e.__transition;if(!n||!(n=n[t]))throw new Error("transition not found");return n}function Qr(e,t,n){var u=e.__transition,r;u[t]=n,n.timer=xn(i,0,n.time);function i(c){n.state=Yt,n.timer.restart(s,n.delay,n.time),n.delay<=c&&s(c-n.delay)}function s(c){var l,h,d,A;if(n.state!==Yt)return o();for(l in u)if(A=u[l],A.name===n.name){if(A.state===Ne)return Xt(s);A.state===Kt?(A.state=Re,A.timer.stop(),A.on.call("interrupt",e,e.__data__,A.index,A.group),delete u[l]):+l<t&&(A.state=Re,A.timer.stop(),A.on.call("cancel",e,e.__data__,A.index,A.group),delete u[l])}if(Xt(function(){n.state===Ne&&(n.state=Kt,n.timer.restart(a,n.delay,n.time),a(c))}),n.state=ot,n.on.call("start",e,e.__data__,n.index,n.group),n.state===ot){for(n.state=Ne,r=new Array(d=n.tween.length),l=0,h=-1;l<d;++l)(A=n.tween[l].value.call(e,e.__data__,n.index,n.group))&&(r[++h]=A);r.length=h+1}}function a(c){for(var l=c<n.duration?n.ease.call(null,c/n.duration):(n.timer.restart(o),n.state=at,1),h=-1,d=r.length;++h<d;)r[h].call(e,l);n.state===at&&(n.on.call("end",e,e.__data__,n.index,n.group),o())}function o(){n.state=Re,n.timer.stop(),delete u[t];for(var c in u)return;delete e.__transition}}function ei(e,t){var n=e.__transition,u,r,i=!0,s;if(n){t=t==null?null:t+"";for(s in n){if((u=n[s]).name!==t){i=!1;continue}r=u.state>ot&&u.state<at,u.state=Re,u.timer.stop(),u.on.call(r?"interrupt":"cancel",e,e.__data__,u.index,u.group),delete n[s]}i&&delete e.__transition}}function ti(e){return this.each(function(){ei(this,e)})}function ni(e,t){var n,u;return function(){var r=z(this,e),i=r.tween;if(i!==n){u=n=i;for(var s=0,a=u.length;s<a;++s)if(u[s].name===t){u=u.slice(),u.splice(s,1);break}}r.tween=u}}function ui(e,t,n){var u,r;if(typeof n!="function")throw new Error;return function(){var i=z(this,e),s=i.tween;if(s!==u){r=(u=s).slice();for(var a={name:t,value:n},o=0,c=r.length;o<c;++o)if(r[o].name===t){r[o]=a;break}o===c&&r.push(a)}i.tween=r}}function ri(e,t){var n=this._id;if(e+="",arguments.length<2){for(var u=V(this.node(),n).tween,r=0,i=u.length,s;r<i;++r)if((s=u[r]).name===e)return s.value;return null}return this.each((t==null?ni:ui)(n,e,t))}function mt(e,t,n){var u=e._id;return e.each(function(){var r=z(this,u);(r.value||(r.value={}))[t]=n.apply(this,arguments)}),function(r){return V(r,u).value[t]}}function $n(e,t){var n;return(typeof t=="number"?ne:t instanceof me?Ut:(n=me(t))?(t=n,Ut):qr)(e,t)}function ii(e){return function(){this.removeAttribute(e)}}function si(e){return function(){this.removeAttributeNS(e.space,e.local)}}function oi(e,t,n){var u,r=n+"",i;return function(){var s=this.getAttribute(e);return s===r?null:s===u?i:i=t(u=s,n)}}function ai(e,t,n){var u,r=n+"",i;return function(){var s=this.getAttributeNS(e.space,e.local);return s===r?null:s===u?i:i=t(u=s,n)}}function ci(e,t,n){var u,r,i;return function(){var s,a=n(this),o;return a==null?void this.removeAttribute(e):(s=this.getAttribute(e),o=a+"",s===o?null:s===u&&o===r?i:(r=o,i=t(u=s,a)))}}function li(e,t,n){var u,r,i;return function(){var s,a=n(this),o;return a==null?void this.removeAttributeNS(e.space,e.local):(s=this.getAttributeNS(e.space,e.local),o=a+"",s===o?null:s===u&&o===r?i:(r=o,i=t(u=s,a)))}}function fi(e,t){var n=He(e),u=n==="transform"?Ur:$n;return this.attrTween(e,typeof t=="function"?(n.local?li:ci)(n,u,mt(this,"attr."+e,t)):t==null?(n.local?si:ii)(n):(n.local?ai:oi)(n,u,t))}function Di(e,t){return function(n){this.setAttribute(e,t.call(this,n))}}function hi(e,t){return function(n){this.setAttributeNS(e.space,e.local,t.call(this,n))}}function di(e,t){var n,u;function r(){var i=t.apply(this,arguments);return i!==u&&(n=(u=i)&&hi(e,i)),n}return r._value=t,r}function Ei(e,t){var n,u;function r(){var i=t.apply(this,arguments);return i!==u&&(n=(u=i)&&Di(e,i)),n}return r._value=t,r}function Ai(e,t){var n="attr."+e;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(t==null)return this.tween(n,null);if(typeof t!="function")throw new Error;var u=He(e);return this.tween(n,(u.local?di:Ei)(u,t))}function Ci(e,t){return function(){gt(this,e).delay=+t.apply(this,arguments)}}function pi(e,t){return t=+t,function(){gt(this,e).delay=t}}function vi(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?Ci:pi)(t,e)):V(this.node(),t).delay}function _i(e,t){return function(){z(this,e).duration=+t.apply(this,arguments)}}function Fi(e,t){return t=+t,function(){z(this,e).duration=t}}function gi(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?_i:Fi)(t,e)):V(this.node(),t).duration}function mi(e,t){if(typeof t!="function")throw new Error;return function(){z(this,e).ease=t}}function yi(e){var t=this._id;return arguments.length?this.each(mi(t,e)):V(this.node(),t).ease}function Bi(e,t){return function(){var n=t.apply(this,arguments);if(typeof n!="function")throw new Error;z(this,e).ease=n}}function wi(e){if(typeof e!="function")throw new Error;return this.each(Bi(this._id,e))}function xi(e){typeof e!="function"&&(e=ln(e));for(var t=this._groups,n=t.length,u=new Array(n),r=0;r<n;++r)for(var i=t[r],s=i.length,a=u[r]=[],o,c=0;c<s;++c)(o=i[c])&&e.call(o,o.__data__,c,i)&&a.push(o);return new ee(u,this._parents,this._name,this._id)}function bi(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,n=e._groups,u=t.length,r=n.length,i=Math.min(u,r),s=new Array(u),a=0;a<i;++a)for(var o=t[a],c=n[a],l=o.length,h=s[a]=new Array(l),d,A=0;A<l;++A)(d=o[A]||c[A])&&(h[A]=d);for(;a<u;++a)s[a]=t[a];return new ee(s,this._parents,this._name,this._id)}function $i(e){return(e+"").trim().split(/^|\s+/).every(function(t){var n=t.indexOf(".");return n>=0&&(t=t.slice(0,n)),!t||t==="start"})}function Si(e,t,n){var u,r,i=$i(t)?gt:z;return function(){var s=i(this,e),a=s.on;a!==u&&(r=(u=a).copy()).on(t,n),s.on=r}}function ki(e,t){var n=this._id;return arguments.length<2?V(this.node(),n).on.on(e):this.each(Si(n,e,t))}function Ii(e){return function(){var t=this.parentNode;for(var n in this.__transition)if(+n!==e)return;t&&t.removeChild(this)}}function Ni(){return this.on("end.remove",Ii(this._id))}function Ri(e){var t=this._name,n=this._id;typeof e!="function"&&(e=At(e));for(var u=this._groups,r=u.length,i=new Array(r),s=0;s<r;++s)for(var a=u[s],o=a.length,c=i[s]=new Array(o),l,h,d=0;d<o;++d)(l=a[d])&&(h=e.call(l,l.__data__,d,a))&&("__data__"in l&&(h.__data__=l.__data__),c[d]=h,We(c[d],t,n,d,c,V(l,n)));return new ee(i,this._parents,t,n)}function Ti(e){var t=this._name,n=this._id;typeof e!="function"&&(e=cn(e));for(var u=this._groups,r=u.length,i=[],s=[],a=0;a<r;++a)for(var o=u[a],c=o.length,l,h=0;h<c;++h)if(l=o[h]){for(var d=e.call(l,l.__data__,h,o),A,b=V(l,n),_=0,w=d.length;_<w;++_)(A=d[_])&&We(A,t,n,_,d,b);i.push(d),s.push(l)}return new ee(i,s,t,n)}var Li=Be.prototype.constructor;function Oi(){return new Li(this._groups,this._parents)}function Mi(e,t){var n,u,r;return function(){var i=De(this,e),s=(this.style.removeProperty(e),De(this,e));return i===s?null:i===n&&s===u?r:r=t(n=i,u=s)}}function Sn(e){return function(){this.style.removeProperty(e)}}function Pi(e,t,n){var u,r=n+"",i;return function(){var s=De(this,e);return s===r?null:s===u?i:i=t(u=s,n)}}function Ji(e,t,n){var u,r,i;return function(){var s=De(this,e),a=n(this),o=a+"";return a==null&&(o=a=(this.style.removeProperty(e),De(this,e))),s===o?null:s===u&&o===r?i:(r=o,i=t(u=s,a))}}function Gi(e,t){var n,u,r,i="style."+t,s="end."+i,a;return function(){var o=z(this,e),c=o.on,l=o.value[i]==null?a||(a=Sn(t)):void 0;(c!==n||r!==l)&&(u=(n=c).copy()).on(s,r=l),o.on=u}}function qi(e,t,n){var u=(e+="")=="transform"?Wr:$n;return t==null?this.styleTween(e,Mi(e,u)).on("end.style."+e,Sn(e)):typeof t=="function"?this.styleTween(e,Ji(e,u,mt(this,"style."+e,t))).each(Gi(this._id,e)):this.styleTween(e,Pi(e,u,t),n).on("end.style."+e,null)}function Hi(e,t,n){return function(u){this.style.setProperty(e,t.call(this,u),n)}}function Vi(e,t,n){var u,r;function i(){var s=t.apply(this,arguments);return s!==r&&(u=(r=s)&&Hi(e,s,n)),u}return i._value=t,i}function Wi(e,t,n){var u="style."+(e+="");if(arguments.length<2)return(u=this.tween(u))&&u._value;if(t==null)return this.tween(u,null);if(typeof t!="function")throw new Error;return this.tween(u,Vi(e,t,n??""))}function Ui(e){return function(){this.textContent=e}}function ji(e){return function(){var t=e(this);this.textContent=t??""}}function zi(e){return this.tween("text",typeof e=="function"?ji(mt(this,"text",e)):Ui(e==null?"":e+""))}function Xi(e){return function(t){this.textContent=e.call(this,t)}}function Yi(e){var t,n;function u(){var r=e.apply(this,arguments);return r!==n&&(t=(n=r)&&Xi(r)),t}return u._value=e,u}function Ki(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(e==null)return this.tween(t,null);if(typeof e!="function")throw new Error;return this.tween(t,Yi(e))}function Zi(){for(var e=this._name,t=this._id,n=kn(),u=this._groups,r=u.length,i=0;i<r;++i)for(var s=u[i],a=s.length,o,c=0;c<a;++c)if(o=s[c]){var l=V(o,t);We(o,e,n,c,s,{time:l.time+l.delay+l.duration,delay:0,duration:l.duration,ease:l.ease})}return new ee(u,this._parents,e,n)}function Qi(){var e,t,n=this,u=n._id,r=n.size();return new Promise(function(i,s){var a={value:s},o={value:function(){--r===0&&i()}};n.each(function(){var c=z(this,u),l=c.on;l!==e&&(t=(e=l).copy(),t._.cancel.push(a),t._.interrupt.push(a),t._.end.push(o)),c.on=t}),r===0&&i()})}var es=0;function ee(e,t,n,u){this._groups=e,this._parents=t,this._name=n,this._id=u}function kn(){return++es}var se=Be.prototype;ee.prototype={constructor:ee,select:Ri,selectAll:Ti,filter:xi,merge:bi,selection:Oi,transition:Zi,call:se.call,nodes:se.nodes,node:se.node,size:se.size,empty:se.empty,each:se.each,on:ki,attr:fi,attrTween:Ai,style:qi,styleTween:Wi,text:zi,textTween:Ki,remove:Ni,tween:ri,delay:vi,duration:gi,ease:yi,easeVarying:wi,end:Qi,[Symbol.iterator]:se[Symbol.iterator]};function ts(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}var ns={time:null,delay:0,duration:250,ease:ts};function us(e,t){for(var n;!(n=e.__transition)||!(n=n[t]);)if(!(e=e.parentNode))throw new Error(`transition ${t} not found`);return n}function rs(e){var t,n;e instanceof ee?(t=e._id,e=e._name):(t=kn(),(n=ns).time=Ft(),e=e==null?null:e+"");for(var u=this._groups,r=u.length,i=0;i<r;++i)for(var s=u[i],a=s.length,o,c=0;c<a;++c)(o=s[c])&&We(o,e,t,c,s,n||us(o,t));return new ee(u,this._parents,e,t)}Be.prototype.interrupt=ti;Be.prototype.transition=rs;const ct=Math.PI,lt=2*ct,ce=1e-6,is=lt-ce;function ft(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function Te(){return new ft}ft.prototype=Te.prototype={constructor:ft,moveTo:function(e,t){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+t)},closePath:function(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(e,t){this._+="L"+(this._x1=+e)+","+(this._y1=+t)},quadraticCurveTo:function(e,t,n,u){this._+="Q"+ +e+","+ +t+","+(this._x1=+n)+","+(this._y1=+u)},bezierCurveTo:function(e,t,n,u,r,i){this._+="C"+ +e+","+ +t+","+ +n+","+ +u+","+(this._x1=+r)+","+(this._y1=+i)},arcTo:function(e,t,n,u,r){e=+e,t=+t,n=+n,u=+u,r=+r;var i=this._x1,s=this._y1,a=n-e,o=u-t,c=i-e,l=s-t,h=c*c+l*l;if(r<0)throw new Error("negative radius: "+r);if(this._x1===null)this._+="M"+(this._x1=e)+","+(this._y1=t);else if(h>ce)if(!(Math.abs(l*a-o*c)>ce)||!r)this._+="L"+(this._x1=e)+","+(this._y1=t);else{var d=n-i,A=u-s,b=a*a+o*o,_=d*d+A*A,w=Math.sqrt(b),E=Math.sqrt(h),v=r*Math.tan((ct-Math.acos((b+h-_)/(2*w*E)))/2),p=v/E,$=v/w;Math.abs(p-1)>ce&&(this._+="L"+(e+p*c)+","+(t+p*l)),this._+="A"+r+","+r+",0,0,"+ +(l*d>c*A)+","+(this._x1=e+$*a)+","+(this._y1=t+$*o)}},arc:function(e,t,n,u,r,i){e=+e,t=+t,n=+n,i=!!i;var s=n*Math.cos(u),a=n*Math.sin(u),o=e+s,c=t+a,l=1^i,h=i?u-r:r-u;if(n<0)throw new Error("negative radius: "+n);this._x1===null?this._+="M"+o+","+c:(Math.abs(this._x1-o)>ce||Math.abs(this._y1-c)>ce)&&(this._+="L"+o+","+c),n&&(h<0&&(h=h%lt+lt),h>is?this._+="A"+n+","+n+",0,1,"+l+","+(e-s)+","+(t-a)+"A"+n+","+n+",0,1,"+l+","+(this._x1=o)+","+(this._y1=c):h>ce&&(this._+="A"+n+","+n+",0,"+ +(h>=ct)+","+l+","+(this._x1=e+n*Math.cos(r))+","+(this._y1=t+n*Math.sin(r))))},rect:function(e,t,n,u){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+t)+"h"+ +n+"v"+ +u+"h"+-n+"Z"},toString:function(){return this._}};function pe(e,t,n){this.k=e,this.x=t,this.y=n}pe.prototype={constructor:pe,scale:function(e){return e===1?this:new pe(this.k*e,this.x,this.y)},translate:function(e,t){return e===0&t===0?this:new pe(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};pe.prototype;const ss=(e,t)=>{var i,s,a;const n=e.event_id;if((s=(i=t==null?void 0:t.annotations)==null?void 0:i.events)!=null&&s[n])return`${(a=t==null?void 0:t.annotations)==null?void 0:a.events[n]}`;const u=sn(e),r=e._collapse?`+${e._collapse} more`:"";return`${u} ${r}`},os=(e,t,n)=>{var St,kt,It,Nt,Rt,Tt,Lt;t=JSON.parse(JSON.stringify(t));const u=t,r=new Map;for(let D=0;D<u.length;D++)u[D].streamPosition=D,r.set(u[D].event_id,u[D]);for(const D of u.slice()){D.prev_events=D.prev_events.sort((C,g)=>{var B,N;return(((B=r.get(C))==null?void 0:B.streamPosition)||0)-(((N=r.get(g))==null?void 0:N.streamPosition)||0)}),D.auth_events=D.auth_events.sort((C,g)=>{var B,N;return(((B=r.get(g))==null?void 0:B.streamPosition)||0)-(((N=r.get(C))==null?void 0:N.streamPosition)||0)});for(const C of D.prev_events){if(!r.get(C)){const B={event_id:C,type:"dangling",prev_events:[],next_events:[],content:{},sender:"dangling",auth_events:[],room_id:"",origin_server_ts:0};r.set(C,B);const N=u.findIndex(m=>m.event_id===D.event_id);console.log("inserting placeholder prev_event at ",N),u.splice(N,0,B)}const g=r.get(C);g.next_events||(g.next_events=[]),g.next_events.push(D.event_id)}}const i=[],s=[];function a(D=null){{const C=D==null?0:D+1;if(C>=i.length)return C;for(let g=C;g<i.length;g++)if(!i[g])return g;return i.length}}u[0].x=0;for(let D=0;D<u.length;D++){const C=u[D];C.y=D;let g=!1;for(const N of C.prev_events){const m=r.get(N);i.findIndex(R=>R===m.event_id)!==-1&&(C.x=m.x,g=!0);break}if(!g&&(C.x=a(),C.prev_events&&r.get(C.prev_events[0]))){const N=r.get(C.prev_events[0]).y;for(;s[C.x]!==void 0&&N<s[C.x];)C.x=a(C.x)}let B=!1;if(C.next_events){for(const N of C.next_events)if(r.get(N).prev_events[0]===C.event_id){B=!0;break}}B?i[C.x]=C.event_id:(delete i[C.x],s[C.x]=D)}const o=[];function c(D,C){let g=0;for(let B=D;B<=C;B++)g=u[B].x>g?u[B].x:g;for(g++;o[g]!==void 0;)g++;return g}for(let D=u.length-1;D>=0;D--){const C=u[D];if(C.auth_events){for(const g of C.auth_events){const B=r.get(g);if(!B.authLane){const N=c(B.y,D);B.authLane=N,o[N]=g,B.authLaneStart=o.findIndex(m=>m!==void 0)-1}}C.authLane&&delete o[C.authLane]}}let l=0,h=0;const d=[];u[0].laneWidth=0;for(let D=1;D<u.length;D++){const C=u[D-1],g=u[D];for(C.authLane>l&&(l=C.authLane,h=C.authLaneStart);d.length>0&&D>((St=d.at(-1))==null?void 0:St.y);)d.pop();C.next_events&&d.push({x:r.get(C.next_events.at(-1)).x,y:r.get(C.next_events.at(-1)).y}),d.sort((B,N)=>B.x-N.x),g.laneWidth=(kt=d.at(-1))==null?void 0:kt.x,g.laneWidth%2&&(g.x-=.5,g.laneWidth-=.5)}const A={top:20,right:20,bottom:30,left:230};let b=(Rt=(Nt=(It=n.scenario)==null?void 0:It.annotations)==null?void 0:Nt.titles)==null?void 0:Rt[n.currentEventId];b||(b=((Lt=(Tt=n.scenario)==null?void 0:Tt.annotations)==null?void 0:Lt.title)||"");const _=b.split(`
`),w=20,E=40,v=25,p=5,$=2,L=3,X=1,Bt=3,wt="#f00",On="#0a0",xt="#00f",Mn="#f88",Pn="#88f",je="#888";W(e).html(null);const Jn=i.length*E+1e3,ze=u.length*v,bt=W(e).append("svg").attr("width",Jn+A.left+A.right).attr("height",ze+A.top+A.bottom+w*_.length).append("g").attr("transform",`translate(${[A.left,A.top]})`),ie=bt.selectAll("g").data(u).enter().append("g").attr("class",D=>`node-${D.event_id.slice(1,5)}`).on("mouseover",function(D,C){W(this).attr("fill",On).attr("font-weight","bold"),te(`.child-${C.event_id.slice(1,5)}`).raise().attr("stroke",xt).attr("stroke-width",L),te(`.parent-${C.event_id.slice(1,5)}`).raise().attr("stroke",wt).attr("stroke-width",L),te(`.authchild-${C.event_id.slice(1,5)}`).raise().attr("stroke",Pn).attr("stroke-width",Bt),te(`.authparent-${C.event_id.slice(1,5)}`).raise().attr("stroke",Mn).attr("stroke-width",Bt);for(const B of C.next_events||[])W(`.node-${B.slice(1,5)}`).attr("fill",xt);for(const B of C.prev_events)W(`.node-${B.slice(1,5)}`).attr("fill",wt)}).on("mouseout",function(D,C){W(this).attr("fill",null).attr("font-weight",null);for(const g of C.next_events||[])W(`.node-${g.slice(1,5)}`).attr("fill",null);for(const g of C.prev_events)W(`.node-${g.slice(1,5)}`).attr("fill",null);te(`.child-${C.event_id.slice(1,5)}`).attr("stroke","black").attr("stroke-width",$),te(`.parent-${C.event_id.slice(1,5)}`).attr("stroke","black").attr("stroke-width",$),te(`.authchild-${C.event_id.slice(1,5)}`).attr("stroke",je).attr("stroke-width",X),te(`.authparent-${C.event_id.slice(1,5)}`).attr("stroke",je).attr("stroke-width",X)});ie.append("circle").attr("cx",D=>D.x*E).attr("cy",D=>D.y*v).attr("r",p).style("fill",D=>{var C;return(C=n.stateAtEvent)!=null&&C.has(D.event_id)?"#43ff00":D.state_key!=null?"#4300ff":"#111111"}).style("fill-opacity","0.5").style("stroke",D=>{var C;return(C=n.stateAtEvent)!=null&&C.has(D.event_id)?"#43ff00":D.state_key!=null?"#4300ff":"#111111"}),ie.append("path").attr("d",D=>{const C=Te();if(D.next_events)for(const g of D.next_events){const B=r.get(g);C.moveTo(D.x*E,D.y*v+p),C.arcTo(D.x*E,(D.y+.5)*v,B.x*E,(D.y+.5)*v,p),C.arcTo(B.x*E,(D.y+.5)*v,B.x*E,B.y*v-p,p),C.lineTo(B.x*E,B.y*v-p)}return C}).attr("stroke","white").attr("stroke-width",$+2).attr("fill","none"),ie.each((D,C,g)=>{const B=W(g[C]);if(D.next_events)for(const N of D.next_events){const m=r.get(N);if(!m)continue;const R=Te();let G=0;R.moveTo(D.x*E,D.y*v+p+0),R.arcTo(D.x*E,(D.y+.5)*v,m.x*E,(D.y+.5)*v,p),R.arcTo(m.x*E,(D.y+.5)*v,m.x*E,m.y*v-p,p),R.lineTo(m.x*E+G,m.y*v-p),R.moveTo(D.x*E-p/3,D.y*v+p+p/2),R.lineTo(D.x*E,D.y*v+p),R.lineTo(D.x*E+p/3,D.y*v+p+p/2),R.lineTo(D.x*E-p/3,D.y*v+p+p/2),R.lineTo(D.x*E,D.y*v+p),B.append("path").attr("d",R.toString()).attr("class",de=>`child-${de.event_id.slice(1,5)} parent-${m==null?void 0:m.event_id.slice(1,5)}`).attr("stroke","black").attr("stroke-width",$).attr("fill","none")}});const xe=E/2;n.showAuthChain&&ie.each((D,C,g)=>{const B=W(g[C]);if(D.auth_events)for(const N of D.auth_events){const m=r.get(N);if(!m)continue;const R=Te(),G=0,Y=0,de=m.authLaneStart*E+(m.authLane-m.authLaneStart)*xe;R.moveTo(D.x*E+p+Y,D.y*v+G),R.arcTo(de,D.y*v+G,de,m.y*v+G,p*2),R.arcTo(de,m.y*v+G,m.x*E+p+Y,m.y*v+G,p*2),R.lineTo(m.x*E+p+Y,m.y*v+G),R.moveTo(m.x*E+Y+p+p/2,m.y*v+G+p/3),R.lineTo(m.x*E+Y+p,m.y*v+G),R.lineTo(m.x*E+Y+p+p/2,m.y*v+G-p/3),R.lineTo(m.x*E+Y+p+p/2,m.y*v+G+p/3),R.lineTo(m.x*E+Y+p,m.y*v+G),B.append("path").attr("d",R.toString()).attr("class",Xe=>`authchild-${m.event_id.slice(1,5)} authparent-${Xe==null?void 0:Xe.event_id.slice(1,5)}`).attr("stroke",je).attr("stroke-width",1).attr("fill","none")}});const $t=D=>n.showAuthChain?h*E+(l-h)*xe:D.laneWidth*E;ie.append("text").text(D=>D.event_id.substr(0,5)).attr("x",D=>$t(D)+xe).attr("y",D=>D.y*v+4),ie.append("text").text(D=>ss(D,n.scenario)).attr("class",D=>"node-text").attr("x",D=>$t(D)+xe+70).attr("y",D=>D.y*v+4),ie.append("text").text(D=>D.origin_server_ts?new Date(D.origin_server_ts).toLocaleString():"").attr("x",-A.left).attr("y",D=>D.y*v+4);const Gn=bt.append("text").attr("class","node-text").attr("x",-A.left).attr("y",ze);for(let D=0;D<_.length;D++)Gn.append("tspan").attr("x",-A.left).attr("y",ze+D*w).text(_[D])},In={calculate_event_ids:!0,on_load_at_start:!0,events:[{type:"m.room.create",state_key:"",sender:"@creator:tardis",auth_events:[],prev_events:[],content:{creator:"@creator:tardis"},event_id:"$CREATE"},{type:"m.room.member",state_key:"@creator:tardis",sender:"@creator:tardis",auth_events:["$CREATE"],prev_events:["$CREATE"],content:{membership:"join"},event_id:"$JOIN"},{type:"m.room.message",sender:"@creator:tardis",auth_events:["$CREATE","$JOIN"],prev_events:["$JOIN"],content:{body:"A wild fork appears!"},event_id:"$FORK1"},{type:"m.room.message",sender:"@creator:tardis",auth_events:["$CREATE","$JOIN"],prev_events:["$JOIN"],content:{body:"Another wild fork appears!"},event_id:"$FORK2"},{type:"m.room.message",sender:"@creator:tardis",auth_events:["$CREATE","$JOIN"],prev_events:["$FORK1","$FORK2"],content:{body:"Merged!"},event_id:"$MERGE"},{type:"m.room.message",sender:"@creator:tardis",auth_events:["$CREATE","$JOIN"],prev_events:["$MERGE"],content:{body:"This event has precalculated state"},event_id:"$PRESTATE"},{type:"m.room.name",state_key:"",sender:"@creator:tardis",auth_events:["$CREATE","$JOIN"],prev_events:["$PRESTATE"],content:{name:"State events are blue, messages are grey"},event_id:"$MSG"},{type:"m.room.message",sender:"@creator:tardis",auth_events:["$CREATE","$JOIN"],prev_events:["$MSG"],content:{body:"Boring long chains..."},event_id:"$MSG2"},{type:"m.room.message",sender:"@creator:tardis",auth_events:["$CREATE","$JOIN"],prev_events:["$MSG2"],content:{body:"...can be collapsed..."},event_id:"$MSG3"},{type:"m.room.message",sender:"@creator:tardis",auth_events:["$CREATE","$JOIN"],prev_events:["$MSG3"],content:{body:"...by checking the collapse checkbox."},event_id:"$MSG4"}],room_id:"!quickstart:tardis",room_version:"10",tardis_version:1,annotations:{title:["Welcome to TARDIS! Press the  button to continue."].join(`
`),titles:{$FORK1:"State events are highlighted in blue. Messages are highlighted in grey.",$FORK2:"The DAG can fork, which indicates some events were sent at the same time.",$MERGE:"The DAG can merge, which merges state from each fork together. This is state resolution.",$PRESTATE:"Green events indicate the state at this event. Message events will never be green.",$MSG:"Check the 'Auth Chain' box to show the `auth_events` for each event.",$MSG2:"Press the 'Resolve State' button to calculate which events are part of the current room state.",$MSG3:["As state resolution is iterative, it will resolve state for all earlier events as well.","Click on an earlier event in the list to jump to that event."].join(`
`),$MSG4:["Now load a file or use one of the pre-loaded files to experiment with state resolution in Matrix!"].join(`
`)},events:{$MSG:"Blue nodes like this one are state events.",$MSG2:"Boring long chains...",$MSG3:"...can be collapsed...",$MSG4:"...by checking the collapse checkbox.",$PRESTATE:"This event has pre-calculated state (in green) after this event"}},precalculated_state_after:{$PRESTATE:["$CREATE","$JOIN"]}},as={calculate_event_ids:!0,on_load_at_start:!0,events:[{type:"m.room.create",state_key:"",sender:"@alice:tardis",auth_events:[],prev_events:[],content:{creator:"@alice:tardis"},event_id:"$CREATE"},{type:"m.room.member",state_key:"@alice:tardis",sender:"@alice:tardis",auth_events:["$CREATE"],prev_events:["$CREATE"],content:{membership:"join"},event_id:"$ALICE"},{type:"m.room.power_levels",state_key:"",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE"],prev_events:["$ALICE"],content:{users:{"@alice:tardis":100},events:{"m.room.name":50},users_default:50},event_id:"$PL"},{type:"m.room.join_rules",state_key:"",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE","$PL"],prev_events:["$PL"],content:{join_rule:"public"},event_id:"$JR"},{type:"m.room.member",state_key:"@bob:tardis",sender:"@bob:tardis",auth_events:["$CREATE","$JR","$PL"],prev_events:["$JR"],content:{membership:"join"},event_id:"$BOB"},{type:"m.room.name",state_key:"",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE","$PL"],prev_events:["$BOB"],content:{name:"Alice Room"},event_id:"$ALICE_NAME"},{type:"m.room.name",state_key:"",sender:"@bob:tardis",auth_events:["$CREATE","$BOB","$PL"],prev_events:["$BOB"],content:{name:"Bob Room"},event_id:"$BOB_NAME"},{type:"m.room.message",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE","$PL"],prev_events:["$ALICE_NAME","$BOB_NAME"],content:{body:"Bob wins."},event_id:"$MERGE1"},{type:"m.room.name",state_key:"",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE","$PL"],prev_events:["$MERGE1"],content:{name:"Alice Room 2"},origin_server_ts:1704067281337,event_id:"$ALICE_NAME2"},{type:"m.room.name",state_key:"",sender:"@bob:tardis",auth_events:["$CREATE","$BOB","$PL"],prev_events:["$MERGE1"],content:{name:"Bob Room 2"},origin_server_ts:1704067281337,event_id:"$BOB_NAME2"},{type:"m.room.message",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE","$PL"],prev_events:["$ALICE_NAME2","$BOB_NAME2"],content:{body:"Alice wins."},event_id:"$MERGE2"},{type:"m.room.name",state_key:"",sender:"@bob:tardis",auth_events:["$CREATE","$BOB","$PL"],prev_events:["$MERGE2"],content:{name:"Bob Room 3"},origin_server_ts:1704077300300,event_id:"$BOB_NAME3"},{type:"m.room.power_levels",state_key:"",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE"],prev_events:["$MERGE2"],content:{users:{"@alice:tardis":100},events:{"m.room.name":50},users_default:50},event_id:"$PL2"},{type:"m.room.name",state_key:"",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE","$PL2"],prev_events:["$PL2"],content:{name:"Alice Room 3"},origin_server_ts:1704077299300,event_id:"$ALICE_NAME3"},{type:"m.room.message",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE","$PL2"],prev_events:["$ALICE_NAME3","$BOB_NAME3"],content:{body:"Alice wins."},event_id:"$MERGE3"}],room_id:"!mainline-fork:tardis",room_version:"10",tardis_version:1,annotations:{title:"The winner follows this priority: Mainline depth THEN origin_server_ts THEN event ID",titles:{$ALICE:["Mainline Ordering:","The conflicting state events in this example are all room name changes and hence do not restrict anyone's permissions.","This makes it easier to explain. All of the merges in this example are due to 'mainline ordering'."].join(`
`),$MERGE1:["Bob wins because his event has a higher origin_server_ts. Both events have the same mainline depth."].join(`
`),$MERGE2:["Both events have the same timestamp. Alice wins with a higher event ID (A < Z < a < z)."].join(`
`),$MERGE3:["Bob's event has a higher timestamp but Alice wins because her event happened AFTER a change to the power levels.","This gives her event a higher 'mainline position' which is considered before the timestamp or event ID."].join(`
`)},events:{}}},cs={calculate_event_ids:!0,on_load_at_start:!0,events:[{type:"m.room.create",state_key:"",sender:"@alice:tardis",auth_events:[],prev_events:[],content:{creator:"@alice:tardis"},event_id:"$CREATE"},{type:"m.room.member",state_key:"@alice:tardis",sender:"@alice:tardis",auth_events:["$CREATE"],prev_events:["$CREATE"],content:{membership:"join"},event_id:"$ALICE"},{type:"m.room.power_levels",state_key:"",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE"],prev_events:["$ALICE"],content:{users:{"@alice:tardis":100},events:{"m.room.join_rules":50},users_default:50},event_id:"$PL"},{type:"m.room.join_rules",state_key:"",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE","$PL"],prev_events:["$PL"],content:{join_rule:"public"},event_id:"$JR"},{type:"m.room.member",state_key:"@bob:tardis",sender:"@bob:tardis",auth_events:["$CREATE","$JR","$PL"],prev_events:["$JR"],content:{membership:"join"},event_id:"$BOB"},{type:"m.room.member",state_key:"@charlie:tardis",sender:"@charlie:tardis",auth_events:["$CREATE","$JR","$PL"],prev_events:["$BOB"],content:{membership:"join"},event_id:"$CHARLIE"},{type:"m.room.join_rules",state_key:"",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE","$PL"],prev_events:["$CHARLIE"],content:{join_rule:"invite"},event_id:"$ALICE_JR"},{type:"m.room.join_rules",state_key:"",sender:"@bob:tardis",auth_events:["$CREATE","$BOB","$PL"],prev_events:["$CHARLIE"],content:{join_rule:"knock"},event_id:"$BOB_JR"},{type:"m.room.message",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE","$PL"],prev_events:["$ALICE_JR","$BOB_JR"],content:{body:"Bob wins."},event_id:"$MERGE1"},{type:"m.room.join_rules",state_key:"",sender:"@bob:tardis",auth_events:["$CREATE","$BOB","$PL"],prev_events:["$MERGE1"],content:{join_rule:"knock"},event_id:"$BOB_JR2"},{type:"m.room.join_rules",state_key:"",sender:"@charlie:tardis",auth_events:["$CREATE","$CHARLIE","$PL"],prev_events:["$MERGE1"],content:{join_rule:"public"},event_id:"$CHARLIE_JR"},{type:"m.room.message",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE","$PL"],prev_events:["$BOB_JR2","$CHARLIE_JR"],content:{body:"Charlie wins."},event_id:"$MERGE2"},{type:"m.room.join_rules",state_key:"",sender:"@bob:tardis",auth_events:["$CREATE","$BOB","$PL"],prev_events:["$MERGE2"],content:{join_rule:"knock"},origin_server_ts:1704077299001,event_id:"$BOB_JR3"},{type:"m.room.join_rules",state_key:"",sender:"@charlie:tardis",auth_events:["$CREATE","$CHARLIE","$PL"],prev_events:["$MERGE2"],content:{join_rule:"invite"},origin_server_ts:1704077299001,event_id:"$CHARLIE_JR2"},{type:"m.room.message",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE","$PL"],prev_events:["$CHARLIE_JR2","$BOB_JR3"],content:{body:"Bob wins."},event_id:"$MERGE3"}],room_id:"!power-ordering:tardis",room_version:"10",tardis_version:1,annotations:{title:"The winner follows this priority: Sender Power Level THEN origin_server_ts THEN event ID",titles:{$PL:"Join rules can be modified by ANYONE",$ALICE:["Reverse Topological Power Ordering:","The conflicting state events in this example potentially restrict permissions because they are join rules.","All of the merges in this example are due to this ordering."].join(`
`),$MERGE1:["Bob's 'knock' wins because he has a lower PL (50 vs 100).","This seems undesirable at first, but this can be worded another way: Alice's 'invite' is APPLIED FIRST, and then Bob's.","This order ensures if Alice revokes Bob's permissions, Alice wins."].join(`
`),$MERGE2:["Both Bob and Charlie have the same PL (50). Charlie's 'public' wins because his event has a higher origin_server_ts"].join(`
`),$MERGE3:["Both events have the same timestamp. Bob's 'knock' wins because his event ID is greater than Charlie's (A < Z < a < z)"].join(`
`)},events:{}}};var ls=/[\u1680\u2000-\u200A\u202F\u205F\u3000]/,fs=/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08BD\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312E\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FEA\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC03-\uDC37\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDF00-\uDF19]|\uD806[\uDCA0-\uDCDF\uDCFF\uDE00\uDE0B-\uDE32\uDE3A\uDE50\uDE5C-\uDE83\uDE86-\uDE89\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD46]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50\uDF93-\uDF9F\uDFE0\uDFE1]|\uD821[\uDC00-\uDFEC]|\uD822[\uDC00-\uDEF2]|\uD82C[\uDC00-\uDD1E\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]/,Ds=/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05F0-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u082D\u0840-\u085B\u0860-\u086A\u08A0-\u08B4\u08B6-\u08BD\u08D4-\u08E1\u08E3-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u09FC\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0AF9-\u0AFF\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58-\u0C5A\u0C60-\u0C63\u0C66-\u0C6F\u0C80-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D00-\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D54-\u0D57\u0D5F-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1877\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19D9\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1C80-\u1C88\u1CD0-\u1CD2\u1CD4-\u1CF9\u1D00-\u1DF9\u1DFB-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u2E2F\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099\u309A\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312E\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FEA\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA827\uA840-\uA873\uA880-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD\uA900-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDDFD\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF7A\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00-\uDE03\uDE05\uDE06\uDE0C-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE38-\uDE3A\uDE3F\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE6\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC00-\uDC46\uDC66-\uDC6F\uDC7F-\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD00-\uDD34\uDD36-\uDD3F\uDD50-\uDD73\uDD76\uDD80-\uDDC4\uDDCA-\uDDCC\uDDD0-\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE37\uDE3E\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEEA\uDEF0-\uDEF9\uDF00-\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3C-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF50\uDF57\uDF5D-\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC00-\uDC4A\uDC50-\uDC59\uDC80-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDB5\uDDB8-\uDDC0\uDDD8-\uDDDD\uDE00-\uDE40\uDE44\uDE50-\uDE59\uDE80-\uDEB7\uDEC0-\uDEC9\uDF00-\uDF19\uDF1D-\uDF2B\uDF30-\uDF39]|\uD806[\uDCA0-\uDCE9\uDCFF\uDE00-\uDE3E\uDE47\uDE50-\uDE83\uDE86-\uDE99\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC36\uDC38-\uDC40\uDC50-\uDC59\uDC72-\uDC8F\uDC92-\uDCA7\uDCA9-\uDCB6\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD36\uDD3A\uDD3C\uDD3D\uDD3F-\uDD47\uDD50-\uDD59]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50-\uDF7E\uDF8F-\uDF9F\uDFE0\uDFE1]|\uD821[\uDC00-\uDFEC]|\uD822[\uDC00-\uDEF2]|\uD82C[\uDC00-\uDD1E\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9D\uDC9E]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD838[\uDC00-\uDC06\uDC08-\uDC18\uDC1B-\uDC21\uDC23\uDC24\uDC26-\uDC2A]|\uD83A[\uDC00-\uDCC4\uDCD0-\uDCD6\uDD00-\uDD4A\uDD50-\uDD59]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uDB40[\uDD00-\uDDEF]/,Qe={Space_Separator:ls,ID_Start:fs,ID_Continue:Ds},O={isSpaceSeparator(e){return typeof e=="string"&&Qe.Space_Separator.test(e)},isIdStartChar(e){return typeof e=="string"&&(e>="a"&&e<="z"||e>="A"&&e<="Z"||e==="$"||e==="_"||Qe.ID_Start.test(e))},isIdContinueChar(e){return typeof e=="string"&&(e>="a"&&e<="z"||e>="A"&&e<="Z"||e>="0"&&e<="9"||e==="$"||e==="_"||e===""||e===""||Qe.ID_Continue.test(e))},isDigit(e){return typeof e=="string"&&/[0-9]/.test(e)},isHexDigit(e){return typeof e=="string"&&/[0-9A-Fa-f]/.test(e)}};let Dt,J,Z,Ge,re,H,M,yt,_e;var hs=function(t,n){Dt=String(t),J="start",Z=[],Ge=0,re=1,H=0,M=void 0,yt=void 0,_e=void 0;do M=ds(),Cs[J]();while(M.type!=="eof");return typeof n=="function"?ht({"":_e},"",n):_e};function ht(e,t,n){const u=e[t];if(u!=null&&typeof u=="object")if(Array.isArray(u))for(let r=0;r<u.length;r++){const i=String(r),s=ht(u,i,n);s===void 0?delete u[i]:Object.defineProperty(u,i,{value:s,writable:!0,enumerable:!0,configurable:!0})}else for(const r in u){const i=ht(u,r,n);i===void 0?delete u[r]:Object.defineProperty(u,r,{value:i,writable:!0,enumerable:!0,configurable:!0})}return n.call(e,t,u)}let y,F,ve,K,x;function ds(){for(y="default",F="",ve=!1,K=1;;){x=Q();const e=Nn[y]();if(e)return e}}function Q(){if(Dt[Ge])return String.fromCodePoint(Dt.codePointAt(Ge))}function f(){const e=Q();return e===`
`?(re++,H=0):e?H+=e.length:H++,e&&(Ge+=e.length),e}const Nn={default(){switch(x){case"	":case"\v":case"\f":case" ":case"":case"\uFEFF":case`
`:case"\r":case"\u2028":case"\u2029":f();return;case"/":f(),y="comment";return;case void 0:return f(),k("eof")}if(O.isSpaceSeparator(x)){f();return}return Nn[J]()},comment(){switch(x){case"*":f(),y="multiLineComment";return;case"/":f(),y="singleLineComment";return}throw I(f())},multiLineComment(){switch(x){case"*":f(),y="multiLineCommentAsterisk";return;case void 0:throw I(f())}f()},multiLineCommentAsterisk(){switch(x){case"*":f();return;case"/":f(),y="default";return;case void 0:throw I(f())}f(),y="multiLineComment"},singleLineComment(){switch(x){case`
`:case"\r":case"\u2028":case"\u2029":f(),y="default";return;case void 0:return f(),k("eof")}f()},value(){switch(x){case"{":case"[":return k("punctuator",f());case"n":return f(),oe("ull"),k("null",null);case"t":return f(),oe("rue"),k("boolean",!0);case"f":return f(),oe("alse"),k("boolean",!1);case"-":case"+":f()==="-"&&(K=-1),y="sign";return;case".":F=f(),y="decimalPointLeading";return;case"0":F=f(),y="zero";return;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":F=f(),y="decimalInteger";return;case"I":return f(),oe("nfinity"),k("numeric",1/0);case"N":return f(),oe("aN"),k("numeric",NaN);case'"':case"'":ve=f()==='"',F="",y="string";return}throw I(f())},identifierNameStartEscape(){if(x!=="u")throw I(f());f();const e=dt();switch(e){case"$":case"_":break;default:if(!O.isIdStartChar(e))throw Zt();break}F+=e,y="identifierName"},identifierName(){switch(x){case"$":case"_":case"":case"":F+=f();return;case"\\":f(),y="identifierNameEscape";return}if(O.isIdContinueChar(x)){F+=f();return}return k("identifier",F)},identifierNameEscape(){if(x!=="u")throw I(f());f();const e=dt();switch(e){case"$":case"_":case"":case"":break;default:if(!O.isIdContinueChar(e))throw Zt();break}F+=e,y="identifierName"},sign(){switch(x){case".":F=f(),y="decimalPointLeading";return;case"0":F=f(),y="zero";return;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":F=f(),y="decimalInteger";return;case"I":return f(),oe("nfinity"),k("numeric",K*(1/0));case"N":return f(),oe("aN"),k("numeric",NaN)}throw I(f())},zero(){switch(x){case".":F+=f(),y="decimalPoint";return;case"e":case"E":F+=f(),y="decimalExponent";return;case"x":case"X":F+=f(),y="hexadecimal";return}return k("numeric",K*0)},decimalInteger(){switch(x){case".":F+=f(),y="decimalPoint";return;case"e":case"E":F+=f(),y="decimalExponent";return}if(O.isDigit(x)){F+=f();return}return k("numeric",K*Number(F))},decimalPointLeading(){if(O.isDigit(x)){F+=f(),y="decimalFraction";return}throw I(f())},decimalPoint(){switch(x){case"e":case"E":F+=f(),y="decimalExponent";return}if(O.isDigit(x)){F+=f(),y="decimalFraction";return}return k("numeric",K*Number(F))},decimalFraction(){switch(x){case"e":case"E":F+=f(),y="decimalExponent";return}if(O.isDigit(x)){F+=f();return}return k("numeric",K*Number(F))},decimalExponent(){switch(x){case"+":case"-":F+=f(),y="decimalExponentSign";return}if(O.isDigit(x)){F+=f(),y="decimalExponentInteger";return}throw I(f())},decimalExponentSign(){if(O.isDigit(x)){F+=f(),y="decimalExponentInteger";return}throw I(f())},decimalExponentInteger(){if(O.isDigit(x)){F+=f();return}return k("numeric",K*Number(F))},hexadecimal(){if(O.isHexDigit(x)){F+=f(),y="hexadecimalInteger";return}throw I(f())},hexadecimalInteger(){if(O.isHexDigit(x)){F+=f();return}return k("numeric",K*Number(F))},string(){switch(x){case"\\":f(),F+=Es();return;case'"':if(ve)return f(),k("string",F);F+=f();return;case"'":if(!ve)return f(),k("string",F);F+=f();return;case`
`:case"\r":throw I(f());case"\u2028":case"\u2029":ps(x);break;case void 0:throw I(f())}F+=f()},start(){switch(x){case"{":case"[":return k("punctuator",f())}y="value"},beforePropertyName(){switch(x){case"$":case"_":F=f(),y="identifierName";return;case"\\":f(),y="identifierNameStartEscape";return;case"}":return k("punctuator",f());case'"':case"'":ve=f()==='"',y="string";return}if(O.isIdStartChar(x)){F+=f(),y="identifierName";return}throw I(f())},afterPropertyName(){if(x===":")return k("punctuator",f());throw I(f())},beforePropertyValue(){y="value"},afterPropertyValue(){switch(x){case",":case"}":return k("punctuator",f())}throw I(f())},beforeArrayValue(){if(x==="]")return k("punctuator",f());y="value"},afterArrayValue(){switch(x){case",":case"]":return k("punctuator",f())}throw I(f())},end(){throw I(f())}};function k(e,t){return{type:e,value:t,line:re,column:H}}function oe(e){for(const t of e){if(Q()!==t)throw I(f());f()}}function Es(){switch(Q()){case"b":return f(),"\b";case"f":return f(),"\f";case"n":return f(),`
`;case"r":return f(),"\r";case"t":return f(),"	";case"v":return f(),"\v";case"0":if(f(),O.isDigit(Q()))throw I(f());return"\0";case"x":return f(),As();case"u":return f(),dt();case`
`:case"\u2028":case"\u2029":return f(),"";case"\r":return f(),Q()===`
`&&f(),"";case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":throw I(f());case void 0:throw I(f())}return f()}function As(){let e="",t=Q();if(!O.isHexDigit(t)||(e+=f(),t=Q(),!O.isHexDigit(t)))throw I(f());return e+=f(),String.fromCodePoint(parseInt(e,16))}function dt(){let e="",t=4;for(;t-- >0;){const n=Q();if(!O.isHexDigit(n))throw I(f());e+=f()}return String.fromCodePoint(parseInt(e,16))}const Cs={start(){if(M.type==="eof")throw ae();et()},beforePropertyName(){switch(M.type){case"identifier":case"string":yt=M.value,J="afterPropertyName";return;case"punctuator":Se();return;case"eof":throw ae()}},afterPropertyName(){if(M.type==="eof")throw ae();J="beforePropertyValue"},beforePropertyValue(){if(M.type==="eof")throw ae();et()},beforeArrayValue(){if(M.type==="eof")throw ae();if(M.type==="punctuator"&&M.value==="]"){Se();return}et()},afterPropertyValue(){if(M.type==="eof")throw ae();switch(M.value){case",":J="beforePropertyName";return;case"}":Se()}},afterArrayValue(){if(M.type==="eof")throw ae();switch(M.value){case",":J="beforeArrayValue";return;case"]":Se()}},end(){}};function et(){let e;switch(M.type){case"punctuator":switch(M.value){case"{":e={};break;case"[":e=[];break}break;case"null":case"boolean":case"numeric":case"string":e=M.value;break}if(_e===void 0)_e=e;else{const t=Z[Z.length-1];Array.isArray(t)?t.push(e):Object.defineProperty(t,yt,{value:e,writable:!0,enumerable:!0,configurable:!0})}if(e!==null&&typeof e=="object")Z.push(e),Array.isArray(e)?J="beforeArrayValue":J="beforePropertyName";else{const t=Z[Z.length-1];t==null?J="end":Array.isArray(t)?J="afterArrayValue":J="afterPropertyValue"}}function Se(){Z.pop();const e=Z[Z.length-1];e==null?J="end":Array.isArray(e)?J="afterArrayValue":J="afterPropertyValue"}function I(e){return qe(e===void 0?`JSON5: invalid end of input at ${re}:${H}`:`JSON5: invalid character '${Rn(e)}' at ${re}:${H}`)}function ae(){return qe(`JSON5: invalid end of input at ${re}:${H}`)}function Zt(){return H-=5,qe(`JSON5: invalid identifier character at ${re}:${H}`)}function ps(e){console.warn(`JSON5: '${Rn(e)}' in strings is not valid ECMAScript; consider escaping`)}function Rn(e){const t={"'":"\\'",'"':'\\"',"\\":"\\\\","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t","\v":"\\v","\0":"\\0","\u2028":"\\u2028","\u2029":"\\u2029"};if(t[e])return t[e];if(e<" "){const n=e.charCodeAt(0).toString(16);return"\\x"+("00"+n).substring(n.length)}return e}function qe(e){const t=new SyntaxError(e);return t.lineNumber=re,t.columnNumber=H,t}var vs=function(t,n,u){const r=[];let i="",s,a,o="",c;if(n!=null&&typeof n=="object"&&!Array.isArray(n)&&(u=n.space,c=n.quote,n=n.replacer),typeof n=="function")a=n;else if(Array.isArray(n)){s=[];for(const _ of n){let w;typeof _=="string"?w=_:(typeof _=="number"||_ instanceof String||_ instanceof Number)&&(w=String(_)),w!==void 0&&s.indexOf(w)<0&&s.push(w)}}return u instanceof Number?u=Number(u):u instanceof String&&(u=String(u)),typeof u=="number"?u>0&&(u=Math.min(10,Math.floor(u)),o="          ".substr(0,u)):typeof u=="string"&&(o=u.substr(0,10)),l("",{"":t});function l(_,w){let E=w[_];switch(E!=null&&(typeof E.toJSON5=="function"?E=E.toJSON5(_):typeof E.toJSON=="function"&&(E=E.toJSON(_))),a&&(E=a.call(w,_,E)),E instanceof Number?E=Number(E):E instanceof String?E=String(E):E instanceof Boolean&&(E=E.valueOf()),E){case null:return"null";case!0:return"true";case!1:return"false"}if(typeof E=="string")return h(E);if(typeof E=="number")return String(E);if(typeof E=="object")return Array.isArray(E)?b(E):d(E)}function h(_){const w={"'":.1,'"':.2},E={"'":"\\'",'"':'\\"',"\\":"\\\\","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t","\v":"\\v","\0":"\\0","\u2028":"\\u2028","\u2029":"\\u2029"};let v="";for(let $=0;$<_.length;$++){const L=_[$];switch(L){case"'":case'"':w[L]++,v+=L;continue;case"\0":if(O.isDigit(_[$+1])){v+="\\x00";continue}}if(E[L]){v+=E[L];continue}if(L<" "){let X=L.charCodeAt(0).toString(16);v+="\\x"+("00"+X).substring(X.length);continue}v+=L}const p=c||Object.keys(w).reduce(($,L)=>w[$]<w[L]?$:L);return v=v.replace(new RegExp(p,"g"),E[p]),p+v+p}function d(_){if(r.indexOf(_)>=0)throw TypeError("Converting circular structure to JSON5");r.push(_);let w=i;i=i+o;let E=s||Object.keys(_),v=[];for(const $ of E){const L=l($,_);if(L!==void 0){let X=A($)+":";o!==""&&(X+=" "),X+=L,v.push(X)}}let p;if(v.length===0)p="{}";else{let $;if(o==="")$=v.join(","),p="{"+$+"}";else{let L=`,
`+i;$=v.join(L),p=`{
`+i+$+`,
`+w+"}"}}return r.pop(),i=w,p}function A(_){if(_.length===0)return h(_);const w=String.fromCodePoint(_.codePointAt(0));if(!O.isIdStartChar(w))return h(_);for(let E=w.length;E<_.length;E++)if(!O.isIdContinueChar(String.fromCodePoint(_.codePointAt(E))))return h(_);return _}function b(_){if(r.indexOf(_)>=0)throw TypeError("Converting circular structure to JSON5");r.push(_);let w=i;i=i+o;let E=[];for(let p=0;p<_.length;p++){const $=l(String(p),_);E.push($!==void 0?$:"null")}let v;if(E.length===0)v="[]";else if(o==="")v="["+E.join(",")+"]";else{let p=`,
`+i,$=E.join(p);v=`[
`+i+$+`,
`+w+"]"}return r.pop(),i=w,v}};const _s={parse:hs,stringify:vs};var Fs=_s;const Qt="10";async function gs(e){const t=await new Promise((u,r)=>{const i=new FileReader;i.onload=s=>{if(!s.target||!s.target.result)return;if(e.name.endsWith(".json5")){const o=Fs.parse(s.target.result);o.on_load_at_start==null&&(o.on_load_at_start=!1),o.calculate_event_ids==null&&(o.calculate_event_ids=!1),o.room_version==null&&(o.room_version=Qt),u(o);return}const a=s.target.result.split(`
`).filter(o=>o.trim().length>0).map(o=>JSON.parse(o));u(a)},i.readAsText(e)});let n;return Array.isArray(t)?n={tardis_version:1,room_version:Qt,room_id:t[0].room_id,calculate_event_ids:!1,on_load_at_start:!1,events:t}:n=t,Tn(n)}function Tn(e){var r,i,s,a;const t={events:[],roomVersion:e.room_version,annotations:e.annotations,precalculatedStateAfter:e.precalculated_state_after,onLoadAtStart:e.on_load_at_start},n=new Map;let u=new Date(2024,0,1).getTime();for(const o of e.events){if(!o)throw new Error("missing event");if(!o.event_id)throw new Error(`event is missing 'event_id', got ${JSON.stringify(o)}`);if(!o.type)throw new Error(`event is missing 'type' field, got ${JSON.stringify(o)}`);if(o.origin_server_ts?u=o.origin_server_ts+1e3:(o.origin_server_ts=u,u+=1e3),!o.room_id&&e.room_id&&(o.room_id=e.room_id),e.calculate_event_ids){const c=o.event_id;for(const h of["prev_events","auth_events"]){const d=[];for(const A of o[h]){const b=n.get(A);b?d.push(b):d.push(A)}o[h]=d}const l=globalThis.gmslEventIDForEvent(JSON.stringify(o),e.room_version);n.set(c,l),o.event_id=l,(i=(r=t.annotations)==null?void 0:r.events)!=null&&i[c]&&(t.annotations.events[l]=t.annotations.events[c]),(a=(s=t.annotations)==null?void 0:s.titles)!=null&&a[c]&&(t.annotations.titles[l]=t.annotations.titles[c])}t.events.push(o)}if(t.precalculatedStateAfter)for(const o in t.precalculatedStateAfter){const c=n.get(o);if(!c){console.error(`precalculated_state_after references ${o} but this does not exist in the events array. Skipping.`);continue}const l=[];for(const h of t.precalculatedStateAfter[o]){const d=n.get(h);d?l.push(d):console.error(`precalculated_state_after for ${o} references ${h} but this does not exist in the events array. Skipping.`)}t.precalculatedStateAfter[c]=l,delete t.precalculatedStateAfter[o]}return console.log(t),t}class ms{constructor(t,n){T(this,"inflightRequests");this.sender=t,this.getEvent=n,this.inflightRequests=new Map}onGetEventRequest(t){const n=this.getEvent(t);return n||console.error(`WS: asked for event ${t.event_id} but didn't find it.`),n}onResolveStateResponse(t,n){const u=this.inflightRequests.get(t);if(!u){console.error(`onResolveStateResponse: no request id for response! id=${t}`);return}n.error&&console.error(t,n.error),u(n),this.inflightRequests.delete(t)}async resolveState(t,n,u,r){console.log("resolveState",u,r);const i=globalThis.crypto.randomUUID();return new Promise((a,o)=>{this.inflightRequests.set(i,c=>{if(!c.result){console.error("State resolved to the empty set"),a({state:{}});return}if(c.error&&c.error!==""){o(c.error);return}a({state:c.result})}),this.sender.sendResolveState(i,{state:u,room_id:t,room_version:n,event:r})})}}class ys{constructor(){T(this,"ws");T(this,"receiver")}async sendResolveState(t,n){this.sendWs({id:t,type:"resolve_state",data:n})}async connect(t,n){return this.receiver=n,this.ws=new WebSocket(t),new Promise(u=>{this.ws.addEventListener("open",()=>{console.log("WS open"),u()}),this.ws.addEventListener("error",this.onWsError.bind(this)),this.ws.addEventListener("close",this.onWsClose.bind(this)),this.ws.addEventListener("message",this.onWsMessage.bind(this))})}close(){this.ws.close()}sendWs(t){console.log("send",t),this.ws.send(JSON.stringify(t))}onWsClose(t){}onWsError(t){}onWsMessage(t){const n=JSON.parse(t.data);switch(console.log("recv",n),n.type){case"get_event":{const u=n.data,r=this.receiver.onGetEventRequest(u);u.event=r,n.data=u,this.sendWs(n);break}case"resolve_state":{const u=n.data;this.receiver.onResolveStateResponse(n.id,u);break}}}}const en={"Quick Start":In,"Mainline Ordering":as,"Reverse Topological Power Ordering":cs},ue=new jn(document.getElementById("eventlist"),document.getElementById("eventlisttemplate"));class Ln{constructor(t){T(this,"cache");T(this,"createEventId");T(this,"showAuthChain");T(this,"showOutliers");T(this,"collapse");T(this,"shimUrl");T(this,"debugger");T(this,"renderEvents");T(this,"scenario");this.cache=t,this.createEventId=null,this.showAuthChain=!1,this.showOutliers=!1,this.collapse=!1,this.renderEvents={}}setShimUrl(t){this.shimUrl=t,console.log("setShimUrl",t)}async loadFile(t){const n=await gs(t);this.loadScenario(n)}loadScenario(t){for(const n of t.events)this.cache.eventCache.store(n),n.type==="m.room.create"&&n.state_key===""&&(this.createEventId=n.event_id);if(t.precalculatedStateAfter)for(const n in t.precalculatedStateAfter){const u={};for(const r of t.precalculatedStateAfter[n]){const i=this.cache.eventCache.get(r);if(!i||i.state_key==null){console.log(`precalculated_state_after for ${n} includes ${r} but it isn't a state event we know about. Skipping.`);continue}u[JSON.stringify([i.type,i.state_key])]=i.event_id}this.cache.stateAtEvent.setState(n,u)}this.scenario=t,this.debugger=new Un(t),t.onLoadAtStart&&t.events.length>=2&&this.debugger.goTo(t.events[1].event_id),ue.clear(),t.events.forEach((n,u)=>{ue.appendEvent(u,n)}),ue.highlight(this.debugger.current()),ue.onEventClick(n=>{this.debugger.goTo(n),this.refresh(),ue.highlight(S.debugger.current())}),ue.onEventJsonClick(n=>{document.getElementById("eventdetails").textContent=JSON.stringify(this.cache.eventCache.get(n),null,2),document.getElementById("infocontainer").style.display="block"}),this.refresh()}setShowAuthChain(t){this.showAuthChain=t}setShowOutliers(t){this.showOutliers=t}setCollapse(t){this.collapse=t}async refresh(){let t=Object.create(null);for(const u of this.debugger.eventsUpToCurrent())t[u]=this.cache.eventCache.get(u);this.collapse&&(t=this.collapsifier(t));const n=[];for(const u in t)n.push(t[u]);os(document.getElementById("svgcontainer"),n,{currentEventId:this.debugger.current(),scenario:this.scenario,stateAtEvent:this.cache.stateAtEvent.getStateAsEventIds(this.debugger.current()),showAuthChain:this.showAuthChain})}findForwardExtremities(t){const n=new Set;for(const u in t)n.add(u);for(const u in t){const r=t[u];for(const i of r.prev_events)n.delete(i);for(const i of r.auth_events)n.delete(i)}return n}collapsifier(t){const n=JSON.parse(JSON.stringify(t)),u=this.findForwardExtremities(n),r=new Set;for(const c of u)r.add(c);const i=Object.create(null);for(const c in n){const l=n[c];for(const h of l.prev_events){const d=i[h]||0;i[h]=d+1}l.prev_events.length!==1&&r.add(l.event_id)}for(const c in i)i[c]>1&&r.add(c);const s=new Set;for(const c in n){if(r.has(c)){s.add(c);continue}const l=n[c];if(r.has(l.prev_events[0])){s.add(c);continue}for(const h of r){const d=n[h];if(!d)continue;let A=!1;for(const b of d.prev_events)if(b===c){s.add(c),A=!0;break}if(A)break}}const a=[],o=new Set;for(const c of u)a.push({id:c,from:c});for(;a.length>0;){const c=a.pop();if(!c)break;const l=c.id,h=n[l];if(o.has(l)||(o.add(l),!h))continue;for(const b of h.prev_events)a.push({id:b,from:c.id});if(s.has(l))continue;delete n[l];const d=n[c.from],A=[h.prev_events[0]];for(const b in d.prev_events)s.has(b)&&A.push(b);d.prev_events=A,d._collapse=d._collapse||0,d._collapse+=1,n[c.from]=d;for(const b of a)b.from===l&&(b.from=d.event_id)}return console.log("collapsifier complete"),n}}const Ue=document.getElementById("shimurl");let S=new Ln(new rn);S.setShimUrl(Ue.value);const Et=new ys,tn=new ms(Et,e=>S.cache.eventCache.get(e.event_id));document.getElementById("showauthevents").addEventListener("change",e=>{S.setShowAuthChain(e.target.checked),S.refresh()});document.getElementById("showauthevents").checked=S.showAuthChain;document.getElementById("showoutliers").addEventListener("change",e=>{S.setShowOutliers(e.target.checked),S.refresh()});document.getElementById("showoutliers").checked=S.showOutliers;document.getElementById("collapse").addEventListener("change",e=>{S.setCollapse(e.target.checked),S.refresh()});document.getElementById("collapse").checked=S.collapse;document.getElementById("jsonfile").addEventListener("change",async e=>{const t=document.getElementById("jsonfile").files;t&&(S=new Ln(new rn),S.setShimUrl(Ue.value),await S.loadFile(t[0]))},!1);document.getElementById("closeinfocontainer").addEventListener("click",e=>{document.getElementById("infocontainer").style.display="none"});document.getElementById("infocontainer").style.display="none";document.getElementById("stepfwd").addEventListener("click",async e=>{S.debugger.next(),S.refresh(),ue.highlight(S.debugger.current())});document.getElementById("stepbwd").addEventListener("click",async e=>{S.debugger.previous(),S.refresh(),ue.highlight(S.debugger.current())});Ue.addEventListener("change",e=>{const t=e.target.value;S.setShimUrl(t),globalThis.localStorage.setItem("shim_url",t)});const tt=globalThis.localStorage.getItem("shim_url");tt&&(console.log("setting shim url from local storage"),Ue.value=tt,S.setShimUrl(tt));const nn=document.getElementById("loader"),Bs=document.getElementById("loader-status"),ke=e=>{Bs.innerText=e};document.getElementById("resolve").addEventListener("click",async e=>{if(!S.shimUrl)return console.error("you need to set a shim url to resolve state!"),{};nn.style.display="block",ke(`Connecting to ${S.shimUrl}`);try{await Et.connect(S.shimUrl,tn),await S.debugger.resolve(S.cache,async(t,n,u,r)=>{try{return ke(`Resolving state at event ${r.event_id}`),(await tn.resolveState(t,n,u,r)).state}catch(i){throw console.error("failed to resolve state:",i),ke(`Failed to resolve state at event ${r.event_id} : ${i}`),i}}),ke("")}catch(t){console.error("resolving state failed: ",t)}finally{Et.close()}nn.style.display="none",S.refresh()});const un=new Go;WebAssembly.instantiateStreaming(fetch("gmsl.wasm"),un.importObject).then(e=>{globalThis.wasm=e.instance,un.run(globalThis.wasm);const t=u=>{const r=Tn(u);S.loadScenario(r)},n=document.getElementById("file-select");n&&(n.innerHTML="",Object.keys(en).forEach((u,r)=>{n[r]=new Option(u)}),n.addEventListener("change",u=>{var i;const r=en[(i=u==null?void 0:u.target)==null?void 0:i.value];t(r)})),t(In)});
