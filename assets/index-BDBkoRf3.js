var Gn=Object.defineProperty;var qn=(e,t,n)=>t in e?Gn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var N=(e,t,n)=>qn(e,typeof t!="symbol"?t+"":t,n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))u(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const s of i.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&u(s)}).observe(document,{childList:!0,subtree:!0});function n(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function u(r){if(r.ep)return;r.ep=!0;const i=n(r);fetch(r.href,i)}})();function Hn(e){const t=[1,2,3,4,5,6,7,8,9,10,15,20,50,Number.POSITIVE_INFINITY],n=new Map(t.map(o=>[o,0])),u=new Map(t.map(o=>[o,0]));let r=0;const i=new Set,s=new Set;for(const o of e.events){if(i.add(o.event_id),o.prev_auth_events===void 0){console.error(`printAuthDagAnalysis: event ${o.event_id} has no prev_auth_events. Bailing.`);return}if(o.prev_auth_events.length>r&&(r=o.prev_auth_events.length),o.prev_auth_events.length===0)continue;for(const D of o.prev_auth_events)s.add(D);let l=o.prev_auth_events.length;o.prev_auth_events.length>10&&(o.prev_auth_events.length<=15?l=15:o.prev_auth_events.length<=20?l=20:o.prev_auth_events.length<=50?l=50:l=Number.POSITIVE_INFINITY),u.set(l,(u.get(l)||0)+1);for(const D of t){if(D>l)break;n.set(D,(n.get(D)||0)+1)}}const a=["Auth DAG Analysis:",`Max prev_auth_events: ${r}`,"Histogram:"];u.forEach((o,l)=>{a.push(`${l} ${o}`)}),a.push("CDF:"),n.forEach((o,l)=>{a.push(`${l} ${o}`)});const c=s.isSubsetOf(i);a.push(`Connected: ${c}`),console.log(a.join(`
`))}function Vn(e){const t=JSON.stringify(e),n=new TextEncoder().encode(t);return Wn(n)}function jn(e){const t=Un(e),n=new TextDecoder().decode(t);return JSON.parse(n)}function Un(e){const t=e.replace(/\-/g,"+").replace(/_/g,"/"),n=atob(t);return Uint8Array.from(n,(u,r)=>u.codePointAt(0))}function Wn(e){const t=String.fromCodePoint(...e);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}class rn{constructor(){N(this,"stateAtEvent");N(this,"eventCache");this.stateAtEvent=new zn,this.eventCache=new Xn}}class zn{constructor(){N(this,"state");this.state={}}setState(t,n){this.state[t]=n,console.log(`StateAtEvent ${t} is`,n)}getStateAsEventIds(t){return this.state[t]?new Set(Object.values(this.state[t])):new Set}getState(t){return this.state[t]?JSON.parse(JSON.stringify(this.state[t])):{}}getInverseStateForEventIds(t){const n={};for(const u of t){const r=this.getStateAsEventIds(u);for(const i of r){const s=n[i]||new Set;s.add(u),n[i]=s}}return n}}class Xn{constructor(){N(this,"cache");this.cache=new Map}store(t){this.cache.set(t.event_id,t)}get(t){return this.cache.get(t)}}class Yn{constructor(t){N(this,"index");N(this,"eventIdOrdering");N(this,"currentEventId");this.scenario=t,this.index=t.events.length-1,this.eventIdOrdering=t.events.map(n=>n.event_id),this.currentEventId=this.eventIdOrdering[this.index]}next(){this.index++,this.index>=this.eventIdOrdering.length&&(this.index=this.eventIdOrdering.length-1),this.currentEventId=this.eventIdOrdering[this.index]}previous(){this.index--,this.index<0&&(this.index=0),this.currentEventId=this.eventIdOrdering[this.index]}goTo(t){for(let n=0;n<this.eventIdOrdering.length;n++)if(this.eventIdOrdering[n]===t){this.index=n,this.currentEventId=this.eventIdOrdering[this.index];break}}current(){return this.currentEventId}eventsUpToCurrent(){const t=[];for(let n=0;n<=this.index;n++)t.push(this.eventIdOrdering[n]);return t}async resolve(t,n){for(const u of this.eventsUpToCurrent())await this.resolveEvent(u,t,n)}async resolveEvent(t,n,u){if(n.stateAtEvent.getStateAsEventIds(t).size>0)return;const r=n.eventCache.get(t),i=[];for(const a of r.prev_events){const c=n.stateAtEvent.getState(a);Object.keys(c).length===0&&console.error(`WARN: we do not know the state at ${a} yet, so the state calculation for ${t} may be wrong!`),i.push(c)}console.log("performing state resolution for prev_events:",r.prev_events);const s=await u(r.room_id,this.scenario.roomVersion,i,r);n.stateAtEvent.setState(t,s)}}class Kn{constructor(t,n){N(this,"highlightedEventId");N(this,"positionListener");N(this,"jsonListener");this.container=t,this.template=n}clear(){this.container.innerHTML=""}onEventClick(t){this.positionListener=t}onEventJsonClick(t){this.jsonListener=t}onCellClick(t){this.onClick(t,this.positionListener)}onJsonClick(t){this.onClick(t,this.jsonListener)}onClick(t,n){var i;const u=(i=t.target)==null?void 0:i.parentElement;if(!u)return;const r=u.getAttribute("id");r&&n&&n(r)}appendEvent(t,n){const u=this.template.content.firstElementChild.cloneNode(!0);u.setAttribute("id",n.event_id);const r=u.getElementsByClassName("eventlistrowprefix")[0];r.textContent=String(t),u.addEventListener("click",this.onCellClick.bind(this)),u.getElementsByClassName("eventlistrowjson")[0].addEventListener("click",this.onJsonClick.bind(this)),u.getElementsByClassName("eventlistrowbody")[0].textContent=sn(n),u.getElementsByClassName("eventlistroweventid")[0].textContent=n.event_id.substr(0,5),n.state_key!=null&&(u.style.fontWeight="600"),this.container.appendChild(u)}highlight(t){if(this.highlightedEventId){const n=document.getElementById(this.highlightedEventId);n&&(n.style.backgroundColor="")}document.getElementById(t).style.backgroundColor="#6f8ea9",this.highlightedEventId=t}}function sn(e){var u;let t="",n="";if(e.state_key!=null)switch(e.type){case"m.room.create":t=`by ${e.content.creator}`;break;case"m.room.member":t=`${e.state_key}=${e.content.membership}`;break;case"m.room.join_rules":t=`(${e.content.join_rule})`;break;case"m.room.history_visibility":t=`(${e.content.history_visibility})`;break;case"m.room.name":t=`(${e.content.name})`;break;case"m.room.topic":t=`(${e.content.topic})`;break;default:e.state_key!==""&&(t=e.state_key)}else switch(e.type){case"m.reaction":n=(u=e.content["m.relates_to"])==null?void 0:u.key;break;case"m.room.message":n=e.content.body;break}return`${e.type} ${t}${n}`}var Zn={value:()=>{}};function on(){for(var e=0,t=arguments.length,n={},u;e<t;++e){if(!(u=arguments[e]+"")||u in n||/[\s.]/.test(u))throw new Error("illegal type: "+u);n[u]=[]}return new Ne(n)}function Ne(e){this._=e}function Qn(e,t){return e.trim().split(/^|\s+/).map(function(n){var u="",r=n.indexOf(".");if(r>=0&&(u=n.slice(r+1),n=n.slice(0,r)),n&&!t.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:u}})}Ne.prototype=on.prototype={constructor:Ne,on:function(e,t){var n=this._,u=Qn(e+"",n),r,i=-1,s=u.length;if(arguments.length<2){for(;++i<s;)if((r=(e=u[i]).type)&&(r=eu(n[r],e.name)))return r;return}if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++i<s;)if(r=(e=u[i]).type)n[r]=Tt(n[r],e.name,t);else if(t==null)for(r in n)n[r]=Tt(n[r],e.name,null);return this},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new Ne(e)},call:function(e,t){if((r=arguments.length-2)>0)for(var n=new Array(r),u=0,r,i;u<r;++u)n[u]=arguments[u+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(i=this._[e],u=0,r=i.length;u<r;++u)i[u].value.apply(t,n)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var u=this._[e],r=0,i=u.length;r<i;++r)u[r].value.apply(t,n)}};function eu(e,t){for(var n=0,u=e.length,r;n<u;++n)if((r=e[n]).name===t)return r.value}function Tt(e,t,n){for(var u=0,r=e.length;u<r;++u)if(e[u].name===t){e[u]=Zn,e=e.slice(0,u).concat(e.slice(u+1));break}return n!=null&&e.push({name:t,value:n}),e}var rt="http://www.w3.org/1999/xhtml";const Lt={svg:"http://www.w3.org/2000/svg",xhtml:rt,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Ve(e){var t=e+="",n=t.indexOf(":");return n>=0&&(t=e.slice(0,n))!=="xmlns"&&(e=e.slice(n+1)),Lt.hasOwnProperty(t)?{space:Lt[t],local:e}:e}function tu(e){return function(){var t=this.ownerDocument,n=this.namespaceURI;return n===rt&&t.documentElement.namespaceURI===rt?t.createElement(e):t.createElementNS(n,e)}}function nu(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function an(e){var t=Ve(e);return(t.local?nu:tu)(t)}function uu(){}function Ct(e){return e==null?uu:function(){return this.querySelector(e)}}function ru(e){typeof e!="function"&&(e=Ct(e));for(var t=this._groups,n=t.length,u=new Array(n),r=0;r<n;++r)for(var i=t[r],s=i.length,a=u[r]=new Array(s),c,o,l=0;l<s;++l)(c=i[l])&&(o=e.call(c,c.__data__,l,i))&&("__data__"in c&&(o.__data__=c.__data__),a[l]=o);return new P(u,this._parents)}function pt(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function iu(){return[]}function cn(e){return e==null?iu:function(){return this.querySelectorAll(e)}}function su(e){return function(){var t=e.apply(this,arguments);return t==null?[]:pt(t)}}function ou(e){typeof e=="function"?e=su(e):e=cn(e);for(var t=this._groups,n=t.length,u=[],r=[],i=0;i<n;++i)for(var s=t[i],a=s.length,c,o=0;o<a;++o)(c=s[o])&&(u.push(e.call(c,c.__data__,o,s)),r.push(c));return new P(u,r)}function ln(e){return function(){return this.matches(e)}}function hn(e){return function(t){return t.matches(e)}}var au=Array.prototype.find;function cu(e){return function(){return au.call(this.children,e)}}function lu(){return this.firstElementChild}function hu(e){return this.select(e==null?lu:cu(typeof e=="function"?e:hn(e)))}var fu=Array.prototype.filter;function Du(){return this.children}function du(e){return function(){return fu.call(this.children,e)}}function Eu(e){return this.selectAll(e==null?Du:du(typeof e=="function"?e:hn(e)))}function Au(e){typeof e!="function"&&(e=ln(e));for(var t=this._groups,n=t.length,u=new Array(n),r=0;r<n;++r)for(var i=t[r],s=i.length,a=u[r]=[],c,o=0;o<s;++o)(c=i[o])&&e.call(c,c.__data__,o,i)&&a.push(c);return new P(u,this._parents)}function fn(e){return new Array(e.length)}function vu(){return new P(this._enter||this._groups.map(fn),this._parents)}function Oe(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}Oe.prototype={constructor:Oe,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};function Cu(e){return function(){return e}}function pu(e,t,n,u,r,i){for(var s=0,a,c=t.length,o=i.length;s<o;++s)(a=t[s])?(a.__data__=i[s],u[s]=a):n[s]=new Oe(e,i[s]);for(;s<c;++s)(a=t[s])&&(r[s]=a)}function _u(e,t,n,u,r,i,s){var a,c,o=new Map,l=t.length,D=i.length,d=new Array(l),A;for(a=0;a<l;++a)(c=t[a])&&(d[a]=A=s.call(c,c.__data__,a,t)+"",o.has(A)?r[a]=c:o.set(A,c));for(a=0;a<D;++a)A=s.call(e,i[a],a,i)+"",(c=o.get(A))?(u[a]=c,c.__data__=i[a],o.delete(A)):n[a]=new Oe(e,i[a]);for(a=0;a<l;++a)(c=t[a])&&o.get(d[a])===c&&(r[a]=c)}function gu(e){return e.__data__}function Fu(e,t){if(!arguments.length)return Array.from(this,gu);var n=t?_u:pu,u=this._parents,r=this._groups;typeof e!="function"&&(e=Cu(e));for(var i=r.length,s=new Array(i),a=new Array(i),c=new Array(i),o=0;o<i;++o){var l=u[o],D=r[o],d=D.length,A=pt(e.call(l,l&&l.__data__,o,u)),B=A.length,_=a[o]=new Array(B),x=s[o]=new Array(B),g=c[o]=new Array(d);n(l,D,_,x,g,A,t);for(var p=0,C=0,v,L;p<B;++p)if(v=_[p]){for(p>=C&&(C=p+1);!(L=x[C])&&++C<B;);v._next=L||null}}return s=new P(s,u),s._enter=a,s._exit=c,s}function mu(){return new P(this._exit||this._groups.map(fn),this._parents)}function yu(e,t,n){var u=this.enter(),r=this,i=this.exit();return u=typeof e=="function"?e(u):u.append(e+""),t!=null&&(r=t(r)),n==null?i.remove():n(i),u&&r?u.merge(r).order():r}function wu(e){if(!(e instanceof P))throw new Error("invalid merge");for(var t=this._groups,n=e._groups,u=t.length,r=n.length,i=Math.min(u,r),s=new Array(u),a=0;a<i;++a)for(var c=t[a],o=n[a],l=c.length,D=s[a]=new Array(l),d,A=0;A<l;++A)(d=c[A]||o[A])&&(D[A]=d);for(;a<u;++a)s[a]=t[a];return new P(s,this._parents)}function Bu(){for(var e=this._groups,t=-1,n=e.length;++t<n;)for(var u=e[t],r=u.length-1,i=u[r],s;--r>=0;)(s=u[r])&&(i&&s.compareDocumentPosition(i)^4&&i.parentNode.insertBefore(s,i),i=s);return this}function xu(e){e||(e=bu);function t(D,d){return D&&d?e(D.__data__,d.__data__):!D-!d}for(var n=this._groups,u=n.length,r=new Array(u),i=0;i<u;++i){for(var s=n[i],a=s.length,c=r[i]=new Array(a),o,l=0;l<a;++l)(o=s[l])&&(c[l]=o);c.sort(t)}return new P(r,this._parents).order()}function bu(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function $u(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this}function Su(){return Array.from(this)}function ku(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var u=e[t],r=0,i=u.length;r<i;++r){var s=u[r];if(s)return s}return null}function Iu(){let e=0;for(const t of this)++e;return e}function Nu(){return!this.node()}function Ru(e){for(var t=this._groups,n=0,u=t.length;n<u;++n)for(var r=t[n],i=0,s=r.length,a;i<s;++i)(a=r[i])&&e.call(a,a.__data__,i,r);return this}function Tu(e){return function(){this.removeAttribute(e)}}function Lu(e){return function(){this.removeAttributeNS(e.space,e.local)}}function Ou(e,t){return function(){this.setAttribute(e,t)}}function Mu(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function Pu(e,t){return function(){var n=t.apply(this,arguments);n==null?this.removeAttribute(e):this.setAttribute(e,n)}}function Ju(e,t){return function(){var n=t.apply(this,arguments);n==null?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}}function Gu(e,t){var n=Ve(e);if(arguments.length<2){var u=this.node();return n.local?u.getAttributeNS(n.space,n.local):u.getAttribute(n)}return this.each((t==null?n.local?Lu:Tu:typeof t=="function"?n.local?Ju:Pu:n.local?Mu:Ou)(n,t))}function Dn(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function qu(e){return function(){this.style.removeProperty(e)}}function Hu(e,t,n){return function(){this.style.setProperty(e,t,n)}}function Vu(e,t,n){return function(){var u=t.apply(this,arguments);u==null?this.style.removeProperty(e):this.style.setProperty(e,u,n)}}function ju(e,t,n){return arguments.length>1?this.each((t==null?qu:typeof t=="function"?Vu:Hu)(e,t,n??"")):de(this.node(),e)}function de(e,t){return e.style.getPropertyValue(t)||Dn(e).getComputedStyle(e,null).getPropertyValue(t)}function Uu(e){return function(){delete this[e]}}function Wu(e,t){return function(){this[e]=t}}function zu(e,t){return function(){var n=t.apply(this,arguments);n==null?delete this[e]:this[e]=n}}function Xu(e,t){return arguments.length>1?this.each((t==null?Uu:typeof t=="function"?zu:Wu)(e,t)):this.node()[e]}function dn(e){return e.trim().split(/^|\s+/)}function _t(e){return e.classList||new En(e)}function En(e){this._node=e,this._names=dn(e.getAttribute("class")||"")}En.prototype={add:function(e){var t=this._names.indexOf(e);t<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};function An(e,t){for(var n=_t(e),u=-1,r=t.length;++u<r;)n.add(t[u])}function vn(e,t){for(var n=_t(e),u=-1,r=t.length;++u<r;)n.remove(t[u])}function Yu(e){return function(){An(this,e)}}function Ku(e){return function(){vn(this,e)}}function Zu(e,t){return function(){(t.apply(this,arguments)?An:vn)(this,e)}}function Qu(e,t){var n=dn(e+"");if(arguments.length<2){for(var u=_t(this.node()),r=-1,i=n.length;++r<i;)if(!u.contains(n[r]))return!1;return!0}return this.each((typeof t=="function"?Zu:t?Yu:Ku)(n,t))}function er(){this.textContent=""}function tr(e){return function(){this.textContent=e}}function nr(e){return function(){var t=e.apply(this,arguments);this.textContent=t??""}}function ur(e){return arguments.length?this.each(e==null?er:(typeof e=="function"?nr:tr)(e)):this.node().textContent}function rr(){this.innerHTML=""}function ir(e){return function(){this.innerHTML=e}}function sr(e){return function(){var t=e.apply(this,arguments);this.innerHTML=t??""}}function or(e){return arguments.length?this.each(e==null?rr:(typeof e=="function"?sr:ir)(e)):this.node().innerHTML}function ar(){this.nextSibling&&this.parentNode.appendChild(this)}function cr(){return this.each(ar)}function lr(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function hr(){return this.each(lr)}function fr(e){var t=typeof e=="function"?e:an(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})}function Dr(){return null}function dr(e,t){var n=typeof e=="function"?e:an(e),u=t==null?Dr:typeof t=="function"?t:Ct(t);return this.select(function(){return this.insertBefore(n.apply(this,arguments),u.apply(this,arguments)||null)})}function Er(){var e=this.parentNode;e&&e.removeChild(this)}function Ar(){return this.each(Er)}function vr(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function Cr(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function pr(e){return this.select(e?Cr:vr)}function _r(e){return arguments.length?this.property("__data__",e):this.node().__data__}function gr(e){return function(t){e.call(this,t,this.__data__)}}function Fr(e){return e.trim().split(/^|\s+/).map(function(t){var n="",u=t.indexOf(".");return u>=0&&(n=t.slice(u+1),t=t.slice(0,u)),{type:t,name:n}})}function mr(e){return function(){var t=this.__on;if(t){for(var n=0,u=-1,r=t.length,i;n<r;++n)i=t[n],(!e.type||i.type===e.type)&&i.name===e.name?this.removeEventListener(i.type,i.listener,i.options):t[++u]=i;++u?t.length=u:delete this.__on}}}function yr(e,t,n){return function(){var u=this.__on,r,i=gr(t);if(u){for(var s=0,a=u.length;s<a;++s)if((r=u[s]).type===e.type&&r.name===e.name){this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=i,r.options=n),r.value=t;return}}this.addEventListener(e.type,i,n),r={type:e.type,name:e.name,value:t,listener:i,options:n},u?u.push(r):this.__on=[r]}}function wr(e,t,n){var u=Fr(e+""),r,i=u.length,s;if(arguments.length<2){var a=this.node().__on;if(a){for(var c=0,o=a.length,l;c<o;++c)for(r=0,l=a[c];r<i;++r)if((s=u[r]).type===l.type&&s.name===l.name)return l.value}return}for(a=t?yr:mr,r=0;r<i;++r)this.each(a(u[r],t,n));return this}function Cn(e,t,n){var u=Dn(e),r=u.CustomEvent;typeof r=="function"?r=new r(t,n):(r=u.document.createEvent("Event"),n?(r.initEvent(t,n.bubbles,n.cancelable),r.detail=n.detail):r.initEvent(t,!1,!1)),e.dispatchEvent(r)}function Br(e,t){return function(){return Cn(this,e,t)}}function xr(e,t){return function(){return Cn(this,e,t.apply(this,arguments))}}function br(e,t){return this.each((typeof t=="function"?xr:Br)(e,t))}function*$r(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var u=e[t],r=0,i=u.length,s;r<i;++r)(s=u[r])&&(yield s)}var gt=[null];function P(e,t){this._groups=e,this._parents=t}function be(){return new P([[document.documentElement]],gt)}function Sr(){return this}P.prototype=be.prototype={constructor:P,select:ru,selectAll:ou,selectChild:hu,selectChildren:Eu,filter:Au,data:Fu,enter:vu,exit:mu,join:yu,merge:wu,selection:Sr,order:Bu,sort:xu,call:$u,nodes:Su,node:ku,size:Iu,empty:Nu,each:Ru,attr:Gu,style:ju,property:Xu,classed:Qu,text:ur,html:or,raise:cr,lower:hr,append:fr,insert:dr,remove:Ar,clone:pr,datum:_r,on:wr,dispatch:br,[Symbol.iterator]:$r};function fe(e){return typeof e=="string"?new P([[document.querySelector(e)]],[document.documentElement]):new P([[e]],gt)}function kr(e){return typeof e=="string"?new P([document.querySelectorAll(e)],[document.documentElement]):new P([e==null?[]:pt(e)],gt)}function Ft(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function pn(e,t){var n=Object.create(e.prototype);for(var u in t)n[u]=t[u];return n}function $e(){}var ye=.7,Me=1/ye,De="\\s*([+-]?\\d+)\\s*",we="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",z="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Ir=/^#([0-9a-f]{3,8})$/,Nr=new RegExp("^rgb\\("+[De,De,De]+"\\)$"),Rr=new RegExp("^rgb\\("+[z,z,z]+"\\)$"),Tr=new RegExp("^rgba\\("+[De,De,De,we]+"\\)$"),Lr=new RegExp("^rgba\\("+[z,z,z,we]+"\\)$"),Or=new RegExp("^hsl\\("+[we,z,z]+"\\)$"),Mr=new RegExp("^hsla\\("+[we,z,z,we]+"\\)$"),Ot={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Ft($e,Be,{copy:function(e){return Object.assign(new this.constructor,this,e)},displayable:function(){return this.rgb().displayable()},hex:Mt,formatHex:Mt,formatHsl:Pr,formatRgb:Pt,toString:Pt});function Mt(){return this.rgb().formatHex()}function Pr(){return _n(this).formatHsl()}function Pt(){return this.rgb().formatRgb()}function Be(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=Ir.exec(e))?(n=t[1].length,t=parseInt(t[1],16),n===6?Jt(t):n===3?new G(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):n===8?Se(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):n===4?Se(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=Nr.exec(e))?new G(t[1],t[2],t[3],1):(t=Rr.exec(e))?new G(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=Tr.exec(e))?Se(t[1],t[2],t[3],t[4]):(t=Lr.exec(e))?Se(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=Or.exec(e))?Ht(t[1],t[2]/100,t[3]/100,1):(t=Mr.exec(e))?Ht(t[1],t[2]/100,t[3]/100,t[4]):Ot.hasOwnProperty(e)?Jt(Ot[e]):e==="transparent"?new G(NaN,NaN,NaN,0):null}function Jt(e){return new G(e>>16&255,e>>8&255,e&255,1)}function Se(e,t,n,u){return u<=0&&(e=t=n=NaN),new G(e,t,n,u)}function Jr(e){return e instanceof $e||(e=Be(e)),e?(e=e.rgb(),new G(e.r,e.g,e.b,e.opacity)):new G}function it(e,t,n,u){return arguments.length===1?Jr(e):new G(e,t,n,u??1)}function G(e,t,n,u){this.r=+e,this.g=+t,this.b=+n,this.opacity=+u}Ft(G,it,pn($e,{brighter:function(e){return e=e==null?Me:Math.pow(Me,e),new G(this.r*e,this.g*e,this.b*e,this.opacity)},darker:function(e){return e=e==null?ye:Math.pow(ye,e),new G(this.r*e,this.g*e,this.b*e,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Gt,formatHex:Gt,formatRgb:qt,toString:qt}));function Gt(){return"#"+Ke(this.r)+Ke(this.g)+Ke(this.b)}function qt(){var e=this.opacity;return e=isNaN(e)?1:Math.max(0,Math.min(1,e)),(e===1?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(e===1?")":", "+e+")")}function Ke(e){return e=Math.max(0,Math.min(255,Math.round(e)||0)),(e<16?"0":"")+e.toString(16)}function Ht(e,t,n,u){return u<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new W(e,t,n,u)}function _n(e){if(e instanceof W)return new W(e.h,e.s,e.l,e.opacity);if(e instanceof $e||(e=Be(e)),!e)return new W;if(e instanceof W)return e;e=e.rgb();var t=e.r/255,n=e.g/255,u=e.b/255,r=Math.min(t,n,u),i=Math.max(t,n,u),s=NaN,a=i-r,c=(i+r)/2;return a?(t===i?s=(n-u)/a+(n<u)*6:n===i?s=(u-t)/a+2:s=(t-n)/a+4,a/=c<.5?i+r:2-i-r,s*=60):a=c>0&&c<1?0:s,new W(s,a,c,e.opacity)}function Gr(e,t,n,u){return arguments.length===1?_n(e):new W(e,t,n,u??1)}function W(e,t,n,u){this.h=+e,this.s=+t,this.l=+n,this.opacity=+u}Ft(W,Gr,pn($e,{brighter:function(e){return e=e==null?Me:Math.pow(Me,e),new W(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=e==null?ye:Math.pow(ye,e),new W(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,u=n+(n<.5?n:1-n)*t,r=2*n-u;return new G(Ze(e>=240?e-240:e+120,r,u),Ze(e,r,u),Ze(e<120?e+240:e-120,r,u),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var e=this.opacity;return e=isNaN(e)?1:Math.max(0,Math.min(1,e)),(e===1?"hsl(":"hsla(")+(this.h||0)+", "+(this.s||0)*100+"%, "+(this.l||0)*100+"%"+(e===1?")":", "+e+")")}}));function Ze(e,t,n){return(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)*255}const gn=e=>()=>e;function qr(e,t){return function(n){return e+n*t}}function Hr(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(u){return Math.pow(e+u*t,n)}}function Vr(e){return(e=+e)==1?Fn:function(t,n){return n-t?Hr(t,n,e):gn(isNaN(t)?n:t)}}function Fn(e,t){var n=t-e;return n?qr(e,n):gn(isNaN(e)?t:e)}const Vt=function e(t){var n=Vr(t);function u(r,i){var s=n((r=it(r)).r,(i=it(i)).r),a=n(r.g,i.g),c=n(r.b,i.b),o=Fn(r.opacity,i.opacity);return function(l){return r.r=s(l),r.g=a(l),r.b=c(l),r.opacity=o(l),r+""}}return u.gamma=e,u}(1);function ne(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}var st=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Qe=new RegExp(st.source,"g");function jr(e){return function(){return e}}function Ur(e){return function(t){return e(t)+""}}function Wr(e,t){var n=st.lastIndex=Qe.lastIndex=0,u,r,i,s=-1,a=[],c=[];for(e=e+"",t=t+"";(u=st.exec(e))&&(r=Qe.exec(t));)(i=r.index)>n&&(i=t.slice(n,i),a[s]?a[s]+=i:a[++s]=i),(u=u[0])===(r=r[0])?a[s]?a[s]+=r:a[++s]=r:(a[++s]=null,c.push({i:s,x:ne(u,r)})),n=Qe.lastIndex;return n<t.length&&(i=t.slice(n),a[s]?a[s]+=i:a[++s]=i),a.length<2?c[0]?Ur(c[0].x):jr(t):(t=c.length,function(o){for(var l=0,D;l<t;++l)a[(D=c[l]).i]=D.x(o);return a.join("")})}var jt=180/Math.PI,ot={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function mn(e,t,n,u,r,i){var s,a,c;return(s=Math.sqrt(e*e+t*t))&&(e/=s,t/=s),(c=e*n+t*u)&&(n-=e*c,u-=t*c),(a=Math.sqrt(n*n+u*u))&&(n/=a,u/=a,c/=a),e*u<t*n&&(e=-e,t=-t,c=-c,s=-s),{translateX:r,translateY:i,rotate:Math.atan2(t,e)*jt,skewX:Math.atan(c)*jt,scaleX:s,scaleY:a}}var ke;function zr(e){const t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?ot:mn(t.a,t.b,t.c,t.d,t.e,t.f)}function Xr(e){return e==null||(ke||(ke=document.createElementNS("http://www.w3.org/2000/svg","g")),ke.setAttribute("transform",e),!(e=ke.transform.baseVal.consolidate()))?ot:(e=e.matrix,mn(e.a,e.b,e.c,e.d,e.e,e.f))}function yn(e,t,n,u){function r(o){return o.length?o.pop()+" ":""}function i(o,l,D,d,A,B){if(o!==D||l!==d){var _=A.push("translate(",null,t,null,n);B.push({i:_-4,x:ne(o,D)},{i:_-2,x:ne(l,d)})}else(D||d)&&A.push("translate("+D+t+d+n)}function s(o,l,D,d){o!==l?(o-l>180?l+=360:l-o>180&&(o+=360),d.push({i:D.push(r(D)+"rotate(",null,u)-2,x:ne(o,l)})):l&&D.push(r(D)+"rotate("+l+u)}function a(o,l,D,d){o!==l?d.push({i:D.push(r(D)+"skewX(",null,u)-2,x:ne(o,l)}):l&&D.push(r(D)+"skewX("+l+u)}function c(o,l,D,d,A,B){if(o!==D||l!==d){var _=A.push(r(A)+"scale(",null,",",null,")");B.push({i:_-4,x:ne(o,D)},{i:_-2,x:ne(l,d)})}else(D!==1||d!==1)&&A.push(r(A)+"scale("+D+","+d+")")}return function(o,l){var D=[],d=[];return o=e(o),l=e(l),i(o.translateX,o.translateY,l.translateX,l.translateY,D,d),s(o.rotate,l.rotate,D,d),a(o.skewX,l.skewX,D,d),c(o.scaleX,o.scaleY,l.scaleX,l.scaleY,D,d),o=l=null,function(A){for(var B=-1,_=d.length,x;++B<_;)D[(x=d[B]).i]=x.x(A);return D.join("")}}}var Yr=yn(zr,"px, ","px)","deg)"),Kr=yn(Xr,", ",")",")"),Ee=0,pe=0,Ce=0,wn=1e3,Pe,_e,Je=0,he=0,je=0,xe=typeof performance=="object"&&performance.now?performance:Date,Bn=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function mt(){return he||(Bn(Zr),he=xe.now()+je)}function Zr(){he=0}function Ge(){this._call=this._time=this._next=null}Ge.prototype=xn.prototype={constructor:Ge,restart:function(e,t,n){if(typeof e!="function")throw new TypeError("callback is not a function");n=(n==null?mt():+n)+(t==null?0:+t),!this._next&&_e!==this&&(_e?_e._next=this:Pe=this,_e=this),this._call=e,this._time=n,at()},stop:function(){this._call&&(this._call=null,this._time=1/0,at())}};function xn(e,t,n){var u=new Ge;return u.restart(e,t,n),u}function Qr(){mt(),++Ee;for(var e=Pe,t;e;)(t=he-e._time)>=0&&e._call.call(null,t),e=e._next;--Ee}function Ut(){he=(Je=xe.now())+je,Ee=pe=0;try{Qr()}finally{Ee=0,ti(),he=0}}function ei(){var e=xe.now(),t=e-Je;t>wn&&(je-=t,Je=e)}function ti(){for(var e,t=Pe,n,u=1/0;t;)t._call?(u>t._time&&(u=t._time),e=t,t=t._next):(n=t._next,t._next=null,t=e?e._next=n:Pe=n);_e=e,at(u)}function at(e){if(!Ee){pe&&(pe=clearTimeout(pe));var t=e-he;t>24?(e<1/0&&(pe=setTimeout(Ut,e-xe.now()-je)),Ce&&(Ce=clearInterval(Ce))):(Ce||(Je=xe.now(),Ce=setInterval(ei,wn)),Ee=1,Bn(Ut))}}function Wt(e,t,n){var u=new Ge;return t=t==null?0:+t,u.restart(r=>{u.stop(),e(r+t)},t,n),u}var ni=on("start","end","cancel","interrupt"),ui=[],bn=0,zt=1,ct=2,Re=3,Xt=4,lt=5,Te=6;function Ue(e,t,n,u,r,i){var s=e.__transition;if(!s)e.__transition={};else if(n in s)return;ri(e,n,{name:t,index:u,group:r,on:ni,tween:ui,time:i.time,delay:i.delay,duration:i.duration,ease:i.ease,timer:null,state:bn})}function yt(e,t){var n=U(e,t);if(n.state>bn)throw new Error("too late; already scheduled");return n}function X(e,t){var n=U(e,t);if(n.state>Re)throw new Error("too late; already running");return n}function U(e,t){var n=e.__transition;if(!n||!(n=n[t]))throw new Error("transition not found");return n}function ri(e,t,n){var u=e.__transition,r;u[t]=n,n.timer=xn(i,0,n.time);function i(o){n.state=zt,n.timer.restart(s,n.delay,n.time),n.delay<=o&&s(o-n.delay)}function s(o){var l,D,d,A;if(n.state!==zt)return c();for(l in u)if(A=u[l],A.name===n.name){if(A.state===Re)return Wt(s);A.state===Xt?(A.state=Te,A.timer.stop(),A.on.call("interrupt",e,e.__data__,A.index,A.group),delete u[l]):+l<t&&(A.state=Te,A.timer.stop(),A.on.call("cancel",e,e.__data__,A.index,A.group),delete u[l])}if(Wt(function(){n.state===Re&&(n.state=Xt,n.timer.restart(a,n.delay,n.time),a(o))}),n.state=ct,n.on.call("start",e,e.__data__,n.index,n.group),n.state===ct){for(n.state=Re,r=new Array(d=n.tween.length),l=0,D=-1;l<d;++l)(A=n.tween[l].value.call(e,e.__data__,n.index,n.group))&&(r[++D]=A);r.length=D+1}}function a(o){for(var l=o<n.duration?n.ease.call(null,o/n.duration):(n.timer.restart(c),n.state=lt,1),D=-1,d=r.length;++D<d;)r[D].call(e,l);n.state===lt&&(n.on.call("end",e,e.__data__,n.index,n.group),c())}function c(){n.state=Te,n.timer.stop(),delete u[t];for(var o in u)return;delete e.__transition}}function ii(e,t){var n=e.__transition,u,r,i=!0,s;if(n){t=t==null?null:t+"";for(s in n){if((u=n[s]).name!==t){i=!1;continue}r=u.state>ct&&u.state<lt,u.state=Te,u.timer.stop(),u.on.call(r?"interrupt":"cancel",e,e.__data__,u.index,u.group),delete n[s]}i&&delete e.__transition}}function si(e){return this.each(function(){ii(this,e)})}function oi(e,t){var n,u;return function(){var r=X(this,e),i=r.tween;if(i!==n){u=n=i;for(var s=0,a=u.length;s<a;++s)if(u[s].name===t){u=u.slice(),u.splice(s,1);break}}r.tween=u}}function ai(e,t,n){var u,r;if(typeof n!="function")throw new Error;return function(){var i=X(this,e),s=i.tween;if(s!==u){r=(u=s).slice();for(var a={name:t,value:n},c=0,o=r.length;c<o;++c)if(r[c].name===t){r[c]=a;break}c===o&&r.push(a)}i.tween=r}}function ci(e,t){var n=this._id;if(e+="",arguments.length<2){for(var u=U(this.node(),n).tween,r=0,i=u.length,s;r<i;++r)if((s=u[r]).name===e)return s.value;return null}return this.each((t==null?oi:ai)(n,e,t))}function wt(e,t,n){var u=e._id;return e.each(function(){var r=X(this,u);(r.value||(r.value={}))[t]=n.apply(this,arguments)}),function(r){return U(r,u).value[t]}}function $n(e,t){var n;return(typeof t=="number"?ne:t instanceof Be?Vt:(n=Be(t))?(t=n,Vt):Wr)(e,t)}function li(e){return function(){this.removeAttribute(e)}}function hi(e){return function(){this.removeAttributeNS(e.space,e.local)}}function fi(e,t,n){var u,r=n+"",i;return function(){var s=this.getAttribute(e);return s===r?null:s===u?i:i=t(u=s,n)}}function Di(e,t,n){var u,r=n+"",i;return function(){var s=this.getAttributeNS(e.space,e.local);return s===r?null:s===u?i:i=t(u=s,n)}}function di(e,t,n){var u,r,i;return function(){var s,a=n(this),c;return a==null?void this.removeAttribute(e):(s=this.getAttribute(e),c=a+"",s===c?null:s===u&&c===r?i:(r=c,i=t(u=s,a)))}}function Ei(e,t,n){var u,r,i;return function(){var s,a=n(this),c;return a==null?void this.removeAttributeNS(e.space,e.local):(s=this.getAttributeNS(e.space,e.local),c=a+"",s===c?null:s===u&&c===r?i:(r=c,i=t(u=s,a)))}}function Ai(e,t){var n=Ve(e),u=n==="transform"?Kr:$n;return this.attrTween(e,typeof t=="function"?(n.local?Ei:di)(n,u,wt(this,"attr."+e,t)):t==null?(n.local?hi:li)(n):(n.local?Di:fi)(n,u,t))}function vi(e,t){return function(n){this.setAttribute(e,t.call(this,n))}}function Ci(e,t){return function(n){this.setAttributeNS(e.space,e.local,t.call(this,n))}}function pi(e,t){var n,u;function r(){var i=t.apply(this,arguments);return i!==u&&(n=(u=i)&&Ci(e,i)),n}return r._value=t,r}function _i(e,t){var n,u;function r(){var i=t.apply(this,arguments);return i!==u&&(n=(u=i)&&vi(e,i)),n}return r._value=t,r}function gi(e,t){var n="attr."+e;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(t==null)return this.tween(n,null);if(typeof t!="function")throw new Error;var u=Ve(e);return this.tween(n,(u.local?pi:_i)(u,t))}function Fi(e,t){return function(){yt(this,e).delay=+t.apply(this,arguments)}}function mi(e,t){return t=+t,function(){yt(this,e).delay=t}}function yi(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?Fi:mi)(t,e)):U(this.node(),t).delay}function wi(e,t){return function(){X(this,e).duration=+t.apply(this,arguments)}}function Bi(e,t){return t=+t,function(){X(this,e).duration=t}}function xi(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?wi:Bi)(t,e)):U(this.node(),t).duration}function bi(e,t){if(typeof t!="function")throw new Error;return function(){X(this,e).ease=t}}function $i(e){var t=this._id;return arguments.length?this.each(bi(t,e)):U(this.node(),t).ease}function Si(e,t){return function(){var n=t.apply(this,arguments);if(typeof n!="function")throw new Error;X(this,e).ease=n}}function ki(e){if(typeof e!="function")throw new Error;return this.each(Si(this._id,e))}function Ii(e){typeof e!="function"&&(e=ln(e));for(var t=this._groups,n=t.length,u=new Array(n),r=0;r<n;++r)for(var i=t[r],s=i.length,a=u[r]=[],c,o=0;o<s;++o)(c=i[o])&&e.call(c,c.__data__,o,i)&&a.push(c);return new Q(u,this._parents,this._name,this._id)}function Ni(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,n=e._groups,u=t.length,r=n.length,i=Math.min(u,r),s=new Array(u),a=0;a<i;++a)for(var c=t[a],o=n[a],l=c.length,D=s[a]=new Array(l),d,A=0;A<l;++A)(d=c[A]||o[A])&&(D[A]=d);for(;a<u;++a)s[a]=t[a];return new Q(s,this._parents,this._name,this._id)}function Ri(e){return(e+"").trim().split(/^|\s+/).every(function(t){var n=t.indexOf(".");return n>=0&&(t=t.slice(0,n)),!t||t==="start"})}function Ti(e,t,n){var u,r,i=Ri(t)?yt:X;return function(){var s=i(this,e),a=s.on;a!==u&&(r=(u=a).copy()).on(t,n),s.on=r}}function Li(e,t){var n=this._id;return arguments.length<2?U(this.node(),n).on.on(e):this.each(Ti(n,e,t))}function Oi(e){return function(){var t=this.parentNode;for(var n in this.__transition)if(+n!==e)return;t&&t.removeChild(this)}}function Mi(){return this.on("end.remove",Oi(this._id))}function Pi(e){var t=this._name,n=this._id;typeof e!="function"&&(e=Ct(e));for(var u=this._groups,r=u.length,i=new Array(r),s=0;s<r;++s)for(var a=u[s],c=a.length,o=i[s]=new Array(c),l,D,d=0;d<c;++d)(l=a[d])&&(D=e.call(l,l.__data__,d,a))&&("__data__"in l&&(D.__data__=l.__data__),o[d]=D,Ue(o[d],t,n,d,o,U(l,n)));return new Q(i,this._parents,t,n)}function Ji(e){var t=this._name,n=this._id;typeof e!="function"&&(e=cn(e));for(var u=this._groups,r=u.length,i=[],s=[],a=0;a<r;++a)for(var c=u[a],o=c.length,l,D=0;D<o;++D)if(l=c[D]){for(var d=e.call(l,l.__data__,D,c),A,B=U(l,n),_=0,x=d.length;_<x;++_)(A=d[_])&&Ue(A,t,n,_,d,B);i.push(d),s.push(l)}return new Q(i,s,t,n)}var Gi=be.prototype.constructor;function qi(){return new Gi(this._groups,this._parents)}function Hi(e,t){var n,u,r;return function(){var i=de(this,e),s=(this.style.removeProperty(e),de(this,e));return i===s?null:i===n&&s===u?r:r=t(n=i,u=s)}}function Sn(e){return function(){this.style.removeProperty(e)}}function Vi(e,t,n){var u,r=n+"",i;return function(){var s=de(this,e);return s===r?null:s===u?i:i=t(u=s,n)}}function ji(e,t,n){var u,r,i;return function(){var s=de(this,e),a=n(this),c=a+"";return a==null&&(c=a=(this.style.removeProperty(e),de(this,e))),s===c?null:s===u&&c===r?i:(r=c,i=t(u=s,a))}}function Ui(e,t){var n,u,r,i="style."+t,s="end."+i,a;return function(){var c=X(this,e),o=c.on,l=c.value[i]==null?a||(a=Sn(t)):void 0;(o!==n||r!==l)&&(u=(n=o).copy()).on(s,r=l),c.on=u}}function Wi(e,t,n){var u=(e+="")=="transform"?Yr:$n;return t==null?this.styleTween(e,Hi(e,u)).on("end.style."+e,Sn(e)):typeof t=="function"?this.styleTween(e,ji(e,u,wt(this,"style."+e,t))).each(Ui(this._id,e)):this.styleTween(e,Vi(e,u,t),n).on("end.style."+e,null)}function zi(e,t,n){return function(u){this.style.setProperty(e,t.call(this,u),n)}}function Xi(e,t,n){var u,r;function i(){var s=t.apply(this,arguments);return s!==r&&(u=(r=s)&&zi(e,s,n)),u}return i._value=t,i}function Yi(e,t,n){var u="style."+(e+="");if(arguments.length<2)return(u=this.tween(u))&&u._value;if(t==null)return this.tween(u,null);if(typeof t!="function")throw new Error;return this.tween(u,Xi(e,t,n??""))}function Ki(e){return function(){this.textContent=e}}function Zi(e){return function(){var t=e(this);this.textContent=t??""}}function Qi(e){return this.tween("text",typeof e=="function"?Zi(wt(this,"text",e)):Ki(e==null?"":e+""))}function es(e){return function(t){this.textContent=e.call(this,t)}}function ts(e){var t,n;function u(){var r=e.apply(this,arguments);return r!==n&&(t=(n=r)&&es(r)),t}return u._value=e,u}function ns(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(e==null)return this.tween(t,null);if(typeof e!="function")throw new Error;return this.tween(t,ts(e))}function us(){for(var e=this._name,t=this._id,n=kn(),u=this._groups,r=u.length,i=0;i<r;++i)for(var s=u[i],a=s.length,c,o=0;o<a;++o)if(c=s[o]){var l=U(c,t);Ue(c,e,n,o,s,{time:l.time+l.delay+l.duration,delay:0,duration:l.duration,ease:l.ease})}return new Q(u,this._parents,e,n)}function rs(){var e,t,n=this,u=n._id,r=n.size();return new Promise(function(i,s){var a={value:s},c={value:function(){--r===0&&i()}};n.each(function(){var o=X(this,u),l=o.on;l!==e&&(t=(e=l).copy(),t._.cancel.push(a),t._.interrupt.push(a),t._.end.push(c)),o.on=t}),r===0&&i()})}var is=0;function Q(e,t,n,u){this._groups=e,this._parents=t,this._name=n,this._id=u}function kn(){return++is}var se=be.prototype;Q.prototype={constructor:Q,select:Pi,selectAll:Ji,filter:Ii,merge:Ni,selection:qi,transition:us,call:se.call,nodes:se.nodes,node:se.node,size:se.size,empty:se.empty,each:se.each,on:Li,attr:Ai,attrTween:gi,style:Wi,styleTween:Yi,text:Qi,textTween:ns,remove:Mi,tween:ci,delay:yi,duration:xi,ease:$i,easeVarying:ki,end:rs,[Symbol.iterator]:se[Symbol.iterator]};function ss(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}var os={time:null,delay:0,duration:250,ease:ss};function as(e,t){for(var n;!(n=e.__transition)||!(n=n[t]);)if(!(e=e.parentNode))throw new Error(`transition ${t} not found`);return n}function cs(e){var t,n;e instanceof Q?(t=e._id,e=e._name):(t=kn(),(n=os).time=mt(),e=e==null?null:e+"");for(var u=this._groups,r=u.length,i=0;i<r;++i)for(var s=u[i],a=s.length,c,o=0;o<a;++o)(c=s[o])&&Ue(c,e,t,o,s,n||as(c,t));return new Q(u,this._parents,e,t)}be.prototype.interrupt=si;be.prototype.transition=cs;const ht=Math.PI,ft=2*ht,ce=1e-6,ls=ft-ce;function Dt(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function Le(){return new Dt}Dt.prototype=Le.prototype={constructor:Dt,moveTo:function(e,t){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+t)},closePath:function(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(e,t){this._+="L"+(this._x1=+e)+","+(this._y1=+t)},quadraticCurveTo:function(e,t,n,u){this._+="Q"+ +e+","+ +t+","+(this._x1=+n)+","+(this._y1=+u)},bezierCurveTo:function(e,t,n,u,r,i){this._+="C"+ +e+","+ +t+","+ +n+","+ +u+","+(this._x1=+r)+","+(this._y1=+i)},arcTo:function(e,t,n,u,r){e=+e,t=+t,n=+n,u=+u,r=+r;var i=this._x1,s=this._y1,a=n-e,c=u-t,o=i-e,l=s-t,D=o*o+l*l;if(r<0)throw new Error("negative radius: "+r);if(this._x1===null)this._+="M"+(this._x1=e)+","+(this._y1=t);else if(D>ce)if(!(Math.abs(l*a-c*o)>ce)||!r)this._+="L"+(this._x1=e)+","+(this._y1=t);else{var d=n-i,A=u-s,B=a*a+c*c,_=d*d+A*A,x=Math.sqrt(B),g=Math.sqrt(D),p=r*Math.tan((ht-Math.acos((B+D-_)/(2*x*g)))/2),C=p/g,v=p/x;Math.abs(C-1)>ce&&(this._+="L"+(e+C*o)+","+(t+C*l)),this._+="A"+r+","+r+",0,0,"+ +(l*d>o*A)+","+(this._x1=e+v*a)+","+(this._y1=t+v*c)}},arc:function(e,t,n,u,r,i){e=+e,t=+t,n=+n,i=!!i;var s=n*Math.cos(u),a=n*Math.sin(u),c=e+s,o=t+a,l=1^i,D=i?u-r:r-u;if(n<0)throw new Error("negative radius: "+n);this._x1===null?this._+="M"+c+","+o:(Math.abs(this._x1-c)>ce||Math.abs(this._y1-o)>ce)&&(this._+="L"+c+","+o),n&&(D<0&&(D=D%ft+ft),D>ls?this._+="A"+n+","+n+",0,1,"+l+","+(e-s)+","+(t-a)+"A"+n+","+n+",0,1,"+l+","+(this._x1=c)+","+(this._y1=o):D>ce&&(this._+="A"+n+","+n+",0,"+ +(D>=ht)+","+l+","+(this._x1=e+n*Math.cos(r))+","+(this._y1=t+n*Math.sin(r))))},rect:function(e,t,n,u){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+t)+"h"+ +n+"v"+ +u+"h"+-n+"Z"},toString:function(){return this._}};function ge(e,t,n){this.k=e,this.x=t,this.y=n}ge.prototype={constructor:ge,scale:function(e){return e===1?this:new ge(this.k*e,this.x,this.y)},translate:function(e,t){return e===0&t===0?this:new ge(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};ge.prototype;const et=["#E69F00","#56B4E9","#009E73","#F0E442","#0072B2","#D55E00","#CC79A7"],hs=(e,t)=>{var i,s,a;const n=e.event_id;if((s=(i=t==null?void 0:t.annotations)==null?void 0:i.events)!=null&&s[n])return`${(a=t==null?void 0:t.annotations)==null?void 0:a.events[n]}`;const u=sn(e),r=e._collapse?`+${e._collapse} more`:"";return`${u} ${r}`},fs=(e,t,n)=>{var bt,$t,St,kt,It,Nt,Rt;t=JSON.parse(JSON.stringify(t));let u=null;for(const h of t)if(h.event_id===n.currentEventId){u=h;break}const r=t,i=new Map;for(let h=0;h<r.length;h++)r[h].streamPosition=h,i.set(r[h].event_id,r[h]);for(const h of r.slice()){h.prev_events=h.prev_events.sort((E,F)=>{var b,k;return(((b=i.get(E))==null?void 0:b.streamPosition)||0)-(((k=i.get(F))==null?void 0:k.streamPosition)||0)}),h.auth_events=(h.auth_events||[]).sort((E,F)=>{var b,k;return(((b=i.get(F))==null?void 0:b.streamPosition)||0)-(((k=i.get(E))==null?void 0:k.streamPosition)||0)});for(const E of h.prev_events){if(!i.get(E)){const b={event_id:E,type:"dangling",prev_events:[],next_events:[],content:{},sender:"dangling",auth_events:[],room_id:"",origin_server_ts:0};i.set(E,b);const k=r.findIndex(I=>I.event_id===h.event_id);console.log("inserting placeholder prev_event at ",k),r.splice(k,0,b)}const F=i.get(E);F.next_events||(F.next_events=[]),F.next_events.push(h.event_id)}}const s=[],a=[];function c(h=null){{const E=h==null?0:h+1;if(E>=s.length)return E;for(let F=E;F<s.length;F++)if(!s[F])return F;return s.length}}r[0].x=0;for(let h=0;h<r.length;h++){const E=r[h];E.y=h;let F=!1;for(const k of E.prev_events){const I=i.get(k);s.findIndex($=>$===I.event_id)!==-1&&(E.x=I.x,F=!0);break}if(!F&&(E.x=c(),E.prev_events&&i.get(E.prev_events[0]))){const k=i.get(E.prev_events[0]).y;for(;a[E.x]!==void 0&&k<a[E.x];)E.x=c(E.x)}let b=!1;if(E.next_events){for(const k of E.next_events)if(i.get(k).prev_events[0]===E.event_id){b=!0;break}}b?s[E.x]=E.event_id:(delete s[E.x],a[E.x]=h)}const o=[];function l(h,E){let F=0;for(let b=h;b<=E;b++)F=r[b].x>F?r[b].x:F;for(F++;o[F]!==void 0;)F++;return F}for(let h=r.length-1;h>=0;h--){const E=r[h],F=n.showAuthChain?E.auth_events:n.showAuthDAG?E.prev_auth_events:void 0;if(F){if(n.showAuthDAG){const b=k=>{k.authed_list||(k.authed_list=[]),k.authed_list.push(E.event_id);for(const I of k.prev_auth_events)b(i.get(I))};b(E)}E.auth_list=[];for(const b of F){E.auth_list.push(b);const k=i.get(b);if(!k.authLane){const I=l(k.y,h);k.authLane=I,o[I]=b,k.authLaneStart=o.findIndex($=>$!==void 0)-1}}E.authLane&&delete o[E.authLane]}}let D=0,d=0;const A=[];r[0].laneWidth=0;for(let h=1;h<r.length;h++){const E=r[h-1],F=r[h];for(E.authLane>D&&(D=E.authLane,d=E.authLaneStart);A.length>0&&h>((bt=A.at(-1))==null?void 0:bt.y);)A.pop();E.next_events&&A.push({x:i.get(E.next_events.at(-1)).x,y:i.get(E.next_events.at(-1)).y}),A.sort((b,k)=>b.x-k.x),F.laneWidth=($t=A.at(-1))==null?void 0:$t.x,F.laneWidth%2&&(F.x-=.5,F.laneWidth-=.5)}const B={top:20,right:20,bottom:30,left:230};let _=(It=(kt=(St=n.scenario)==null?void 0:St.annotations)==null?void 0:kt.titles)==null?void 0:It[n.currentEventId];_||(_=((Rt=(Nt=n.scenario)==null?void 0:Nt.annotations)==null?void 0:Rt.title)||"");const x=_.split(`
`),g=20,p=40,C=25,v=5,L=2,ee=3,Ln="#0a0",On="#888";fe(e).html(null);const Mn=s.length*p+1140,ze=r.length*C,xt=fe(e).append("svg").attr("width",Mn+B.left+B.right).attr("height",ze+B.top+B.bottom+g*x.length).append("g").attr("transform",`translate(${[B.left,B.top]})`),te=xt.selectAll("g").data(r).enter().append("g").attr("class",h=>`node-${h.event_id.slice(1,5)}`).on("mouseover",function(h,E){fe(this).attr("fill",Ln).attr("font-weight","bold")}).on("mouseout",function(h,E){fe(this).attr("fill",null).attr("font-weight",null)});te.append("circle").attr("cx",h=>h.x*p).attr("cy",h=>h.y*C).attr("r",v).style("fill",h=>{var E;return(E=n.stateAtEvent)!=null&&E.has(h.event_id)?"#43ff00":h.state_key!=null?"#4300ff":"#111111"}).style("fill-opacity","0.5").style("stroke",h=>{var E;return(E=n.stateAtEvent)!=null&&E.has(h.event_id)?"#43ff00":h.state_key!=null?"#4300ff":"#111111"}),te.append("path").attr("d",h=>{const E=Le();if(h.next_events)for(const F of h.next_events){const b=i.get(F);E.moveTo(h.x*p,h.y*C+v),E.arcTo(h.x*p,(h.y+.5)*C,b.x*p,(h.y+.5)*C,v),E.arcTo(b.x*p,(h.y+.5)*C,b.x*p,b.y*C-v,v),E.lineTo(b.x*p,b.y*C-v)}return E}).attr("stroke","white").attr("stroke-width",L+2).attr("fill","none"),te.each((h,E,F)=>{const b=fe(F[E]);if(h.next_events)for(const k of h.next_events){const I=i.get(k);if(!I)continue;const $=Le();let q=0;$.moveTo(h.x*p,h.y*C+v+0),$.arcTo(h.x*p,(h.y+.5)*C,I.x*p,(h.y+.5)*C,v),$.arcTo(I.x*p,(h.y+.5)*C,I.x*p,I.y*C-v,v),$.lineTo(I.x*p+q,I.y*C-v),$.moveTo(h.x*p-v/3,h.y*C+v+v/2),$.lineTo(h.x*p,h.y*C+v),$.lineTo(h.x*p+v/3,h.y*C+v+v/2),$.lineTo(h.x*p-v/3,h.y*C+v+v/2),$.lineTo(h.x*p,h.y*C+v),b.append("path").attr("d",$.toString()).attr("class",V=>`child-${V.event_id.slice(1,5)} parent-${I==null?void 0:I.event_id.slice(1,5)} edge-${V.event_id.slice(1,5)}-${I==null?void 0:I.event_id.slice(1,5)}`).attr("stroke","black").attr("stroke-width",L).attr("fill","none")}});const Ae=p/2;(n.showAuthChain||n.showAuthDAG)&&te.each((h,E,F)=>{const b=fe(F[E]),k=n.showAuthChain?h.auth_events:h.prev_auth_events;if(k)for(const I of k){const $=i.get(I);if(!$)continue;const q=Le(),H=0,V=0,Ye=$.authLaneStart*p+($.authLane-$.authLaneStart)*Ae;q.moveTo(h.x*p+v+V,h.y*C+H),q.arcTo(Ye,h.y*C+H,Ye,$.y*C+H,v*2),q.arcTo(Ye,$.y*C+H,$.x*p+v+V,$.y*C+H,v*2),q.lineTo($.x*p+v+V,$.y*C+H),q.moveTo($.x*p+V+v+v/2,$.y*C+H+v/3),q.lineTo($.x*p+V+v,$.y*C+H),q.lineTo($.x*p+V+v+v/2,$.y*C+H-v/3),q.lineTo($.x*p+V+v+v/2,$.y*C+H+v/3),q.lineTo($.x*p+V+v,$.y*C+H);const Jn=ve=>n.showAuthChain?`authchild-${$.event_id.slice(1,5)} authparent-${ve==null?void 0:ve.event_id.slice(1,5)}`:`${ve.authed_list.map(ie=>`authparent-${ie==null?void 0:ie.slice(1,5)}`).join(" ")} ${ve.auth_list.map(ie=>`authchild-${ie==null?void 0:ie.slice(1,5)}`).join(" ")}`;b.append("path").attr("d",q.toString()).attr("class",Jn).attr("stroke",On).attr("stroke-width",1).attr("fill","none")}});const Xe=h=>n.showAuthChain||n.showAuthDAG?d*p+(D-d)*Ae:(h.laneWidth??0)*p;if(te.append("text").text(h=>h.event_id.substr(0,5)).attr("x",h=>Xe(h)+Ae).attr("y",h=>h.y*C+4),n.showStateSets&&u&&n.inverseStateSets){for(let E=0;E<et.length;E++)te.append("circle").attr("cx",F=>Xe(F)+Ae+60+E*5).attr("cy",F=>F.y*C).attr("r",v).style("fill",F=>et[E]).style("fill-opacity",F=>E>=u.prev_events.length?"0":(n.inverseStateSets[F.event_id]||new Set).has(u.prev_events[E])?"1":"0");const h=u.event_id;console.log("currentEvent",u);for(let E=0;E<u.prev_events.length;E++){const F=u.prev_events[E];console.log(`.edge-${F.slice(1,5)}-${h.slice(1,5)}`),kr(`.edge-${F.slice(1,5)}-${h.slice(1,5)}`).raise().attr("stroke",et[E]||"#fff").attr("stroke-width",ee)}}te.append("text").text(h=>hs(h,n.scenario)).attr("class",h=>"node-text").attr("x",h=>Xe(h)+Ae+100).attr("y",h=>h.y*C+4),te.append("text").text(h=>h.origin_server_ts?new Date(h.origin_server_ts).toLocaleString(void 0,{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"}):"").attr("x",-230).attr("y",h=>h.y*C+4);const Pn=xt.append("text").attr("class","node-text").attr("x",-230).attr("y",ze);for(let h=0;h<x.length;h++)Pn.append("tspan").attr("x",-230).attr("y",ze+h*g).text(x[h])},In={calculate_event_ids:!0,on_load_at_start:!0,events:[{type:"m.room.create",state_key:"",sender:"@creator:tardis",auth_events:[],prev_events:[],content:{creator:"@creator:tardis"},event_id:"$CREATE"},{type:"m.room.member",state_key:"@creator:tardis",sender:"@creator:tardis",auth_events:["$CREATE"],prev_events:["$CREATE"],content:{membership:"join"},event_id:"$JOIN"},{type:"m.room.message",sender:"@creator:tardis",auth_events:["$CREATE","$JOIN"],prev_events:["$JOIN"],content:{body:"A wild fork appears!"},event_id:"$FORK1"},{type:"m.room.message",sender:"@creator:tardis",auth_events:["$CREATE","$JOIN"],prev_events:["$JOIN"],content:{body:"Another wild fork appears!"},event_id:"$FORK2"},{type:"m.room.message",sender:"@creator:tardis",auth_events:["$CREATE","$JOIN"],prev_events:["$FORK1","$FORK2"],content:{body:"Merged!"},event_id:"$MERGE"},{type:"m.room.message",sender:"@creator:tardis",auth_events:["$CREATE","$JOIN"],prev_events:["$MERGE"],content:{body:"This event has precalculated state"},event_id:"$PRESTATE"},{type:"m.room.name",state_key:"",sender:"@creator:tardis",auth_events:["$CREATE","$JOIN"],prev_events:["$PRESTATE"],content:{name:"State events are blue, messages are grey"},event_id:"$MSG"},{type:"m.room.message",sender:"@creator:tardis",auth_events:["$CREATE","$JOIN"],prev_events:["$MSG"],content:{body:"Boring long chains..."},event_id:"$MSG2"},{type:"m.room.message",sender:"@creator:tardis",auth_events:["$CREATE","$JOIN"],prev_events:["$MSG2"],content:{body:"...can be collapsed..."},event_id:"$MSG3"},{type:"m.room.message",sender:"@creator:tardis",auth_events:["$CREATE","$JOIN"],prev_events:["$MSG3"],content:{body:"...by checking the collapse checkbox."},event_id:"$MSG4"}],room_id:"!quickstart:tardis",room_version:"10",tardis_version:1,annotations:{title:["Welcome to TARDIS! Press the → button to continue."].join(`
`),titles:{$FORK1:"State events are highlighted in blue. Messages are highlighted in grey.",$FORK2:"The DAG can fork, which indicates some events were sent at the same time.",$MERGE:"The DAG can merge, which merges state from each fork together. This is state resolution.",$PRESTATE:"Green events indicate the state at this event. Message events will never be green.",$MSG:"Check the 'Auth Chain' box to show the `auth_events` for each event.",$MSG2:"Press the 'Resolve State' button to calculate which events are part of the current room state.",$MSG3:["As state resolution is iterative, it will resolve state for all earlier events as well.","Click on an earlier event in the list to jump to that event."].join(`
`),$MSG4:["Now load a file or use one of the pre-loaded files to experiment with state resolution in Matrix!"].join(`
`)},events:{$MSG:"Blue nodes like this one are state events.",$MSG2:"Boring long chains...",$MSG3:"...can be collapsed...",$MSG4:"...by checking the collapse checkbox.",$PRESTATE:"This event has pre-calculated state (in green) after this event"}},precalculated_state_after:{$PRESTATE:["$CREATE","$JOIN"]}},Ds={calculate_event_ids:!0,on_load_at_start:!0,events:[{type:"m.room.create",state_key:"",sender:"@alice:tardis",auth_events:[],prev_events:[],content:{creator:"@alice:tardis"},event_id:"$CREATE"},{type:"m.room.member",state_key:"@alice:tardis",sender:"@alice:tardis",auth_events:["$CREATE"],prev_events:["$CREATE"],content:{membership:"join"},event_id:"$ALICE"},{type:"m.room.power_levels",state_key:"",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE"],prev_events:["$ALICE"],content:{users:{"@alice:tardis":100},events:{"m.room.name":50},users_default:50},event_id:"$PL"},{type:"m.room.join_rules",state_key:"",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE","$PL"],prev_events:["$PL"],content:{join_rule:"public"},event_id:"$JR"},{type:"m.room.member",state_key:"@bob:tardis",sender:"@bob:tardis",auth_events:["$CREATE","$JR","$PL"],prev_events:["$JR"],content:{membership:"join"},event_id:"$BOB"},{type:"m.room.name",state_key:"",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE","$PL"],prev_events:["$BOB"],content:{name:"Alice Room"},event_id:"$ALICE_NAME"},{type:"m.room.name",state_key:"",sender:"@bob:tardis",auth_events:["$CREATE","$BOB","$PL"],prev_events:["$BOB"],content:{name:"Bob Room"},event_id:"$BOB_NAME"},{type:"m.room.message",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE","$PL"],prev_events:["$ALICE_NAME","$BOB_NAME"],content:{body:"Bob wins."},event_id:"$MERGE1"},{type:"m.room.name",state_key:"",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE","$PL"],prev_events:["$MERGE1"],content:{name:"Alice Room 2"},origin_server_ts:1704067281337,event_id:"$ALICE_NAME2"},{type:"m.room.name",state_key:"",sender:"@bob:tardis",auth_events:["$CREATE","$BOB","$PL"],prev_events:["$MERGE1"],content:{name:"Bob Room 2"},origin_server_ts:1704067281337,event_id:"$BOB_NAME2"},{type:"m.room.message",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE","$PL"],prev_events:["$ALICE_NAME2","$BOB_NAME2"],content:{body:"Alice wins."},event_id:"$MERGE2"},{type:"m.room.name",state_key:"",sender:"@bob:tardis",auth_events:["$CREATE","$BOB","$PL"],prev_events:["$MERGE2"],content:{name:"Bob Room 3"},origin_server_ts:1704077300300,event_id:"$BOB_NAME3"},{type:"m.room.power_levels",state_key:"",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE"],prev_events:["$MERGE2"],content:{users:{"@alice:tardis":100},events:{"m.room.name":50},users_default:50},event_id:"$PL2"},{type:"m.room.name",state_key:"",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE","$PL2"],prev_events:["$PL2"],content:{name:"Alice Room 3"},origin_server_ts:1704077299300,event_id:"$ALICE_NAME3"},{type:"m.room.message",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE","$PL2"],prev_events:["$ALICE_NAME3","$BOB_NAME3"],content:{body:"Alice wins."},event_id:"$MERGE3"}],room_id:"!mainline-fork:tardis",room_version:"10",tardis_version:1,annotations:{title:"The winner follows this priority: Mainline depth THEN origin_server_ts THEN event ID",titles:{$ALICE:["Mainline Ordering:","The conflicting state events in this example are all room name changes and hence do not restrict anyone's permissions.","This makes it easier to explain. All of the merges in this example are due to 'mainline ordering'."].join(`
`),$MERGE1:["Bob wins because his event has a higher origin_server_ts. Both events have the same mainline depth."].join(`
`),$MERGE2:["Both events have the same timestamp. Alice wins with a higher event ID (A < Z < a < z)."].join(`
`),$MERGE3:["Bob's event has a higher timestamp but Alice wins because her event happened AFTER a change to the power levels.","This gives her event a higher 'mainline position' which is considered before the timestamp or event ID."].join(`
`)},events:{}}},ds={calculate_event_ids:!0,on_load_at_start:!0,events:[{type:"m.room.create",state_key:"",sender:"@alice:tardis",auth_events:[],prev_events:[],content:{creator:"@alice:tardis"},event_id:"$CREATE"},{type:"m.room.member",state_key:"@alice:tardis",sender:"@alice:tardis",auth_events:["$CREATE"],prev_events:["$CREATE"],content:{membership:"join"},event_id:"$ALICE"},{type:"m.room.power_levels",state_key:"",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE"],prev_events:["$ALICE"],content:{users:{"@alice:tardis":100},events:{"m.room.join_rules":50},users_default:50},event_id:"$PL"},{type:"m.room.join_rules",state_key:"",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE","$PL"],prev_events:["$PL"],content:{join_rule:"public"},event_id:"$JR"},{type:"m.room.member",state_key:"@bob:tardis",sender:"@bob:tardis",auth_events:["$CREATE","$JR","$PL"],prev_events:["$JR"],content:{membership:"join"},event_id:"$BOB"},{type:"m.room.member",state_key:"@charlie:tardis",sender:"@charlie:tardis",auth_events:["$CREATE","$JR","$PL"],prev_events:["$BOB"],content:{membership:"join"},event_id:"$CHARLIE"},{type:"m.room.join_rules",state_key:"",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE","$PL"],prev_events:["$CHARLIE"],content:{join_rule:"invite"},event_id:"$ALICE_JR"},{type:"m.room.join_rules",state_key:"",sender:"@bob:tardis",auth_events:["$CREATE","$BOB","$PL"],prev_events:["$CHARLIE"],content:{join_rule:"knock"},event_id:"$BOB_JR"},{type:"m.room.message",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE","$PL"],prev_events:["$ALICE_JR","$BOB_JR"],content:{body:"Bob wins."},event_id:"$MERGE1"},{type:"m.room.join_rules",state_key:"",sender:"@bob:tardis",auth_events:["$CREATE","$BOB","$PL"],prev_events:["$MERGE1"],content:{join_rule:"knock"},event_id:"$BOB_JR2"},{type:"m.room.join_rules",state_key:"",sender:"@charlie:tardis",auth_events:["$CREATE","$CHARLIE","$PL"],prev_events:["$MERGE1"],content:{join_rule:"public"},event_id:"$CHARLIE_JR"},{type:"m.room.message",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE","$PL"],prev_events:["$BOB_JR2","$CHARLIE_JR"],content:{body:"Charlie wins."},event_id:"$MERGE2"},{type:"m.room.join_rules",state_key:"",sender:"@bob:tardis",auth_events:["$CREATE","$BOB","$PL"],prev_events:["$MERGE2"],content:{join_rule:"knock"},origin_server_ts:1704077299001,event_id:"$BOB_JR3"},{type:"m.room.join_rules",state_key:"",sender:"@charlie:tardis",auth_events:["$CREATE","$CHARLIE","$PL"],prev_events:["$MERGE2"],content:{join_rule:"invite"},origin_server_ts:1704077299001,event_id:"$CHARLIE_JR2"},{type:"m.room.message",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE","$PL"],prev_events:["$CHARLIE_JR2","$BOB_JR3"],content:{body:"Bob wins."},event_id:"$MERGE3"}],room_id:"!power-ordering:tardis",room_version:"10",tardis_version:1,annotations:{title:"The winner follows this priority: Sender Power Level THEN origin_server_ts THEN event ID",titles:{$PL:"Join rules can be modified by ANYONE",$ALICE:["Reverse Topological Power Ordering:","The conflicting state events in this example potentially restrict permissions because they are join rules.","All of the merges in this example are due to this ordering."].join(`
`),$MERGE1:["Bob's 'knock' wins because he has a lower PL (50 vs 100).","This seems undesirable at first, but this can be worded another way: Alice's 'invite' is APPLIED FIRST, and then Bob's.","This order ensures if Alice revokes Bob's permissions, Alice wins."].join(`
`),$MERGE2:["Both Bob and Charlie have the same PL (50). Charlie's 'public' wins because his event has a higher origin_server_ts"].join(`
`),$MERGE3:["Both events have the same timestamp. Bob's 'knock' wins because his event ID is greater than Charlie's (A < Z < a < z)"].join(`
`)},events:{}}};var Es=/[\u1680\u2000-\u200A\u202F\u205F\u3000]/,As=/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08BD\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312E\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FEA\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC03-\uDC37\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDF00-\uDF19]|\uD806[\uDCA0-\uDCDF\uDCFF\uDE00\uDE0B-\uDE32\uDE3A\uDE50\uDE5C-\uDE83\uDE86-\uDE89\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD46]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50\uDF93-\uDF9F\uDFE0\uDFE1]|\uD821[\uDC00-\uDFEC]|\uD822[\uDC00-\uDEF2]|\uD82C[\uDC00-\uDD1E\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]/,vs=/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05F0-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u082D\u0840-\u085B\u0860-\u086A\u08A0-\u08B4\u08B6-\u08BD\u08D4-\u08E1\u08E3-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u09FC\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0AF9-\u0AFF\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58-\u0C5A\u0C60-\u0C63\u0C66-\u0C6F\u0C80-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D00-\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D54-\u0D57\u0D5F-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1877\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19D9\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1C80-\u1C88\u1CD0-\u1CD2\u1CD4-\u1CF9\u1D00-\u1DF9\u1DFB-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u2E2F\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099\u309A\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312E\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FEA\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA827\uA840-\uA873\uA880-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD\uA900-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDDFD\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF7A\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00-\uDE03\uDE05\uDE06\uDE0C-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE38-\uDE3A\uDE3F\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE6\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC00-\uDC46\uDC66-\uDC6F\uDC7F-\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD00-\uDD34\uDD36-\uDD3F\uDD50-\uDD73\uDD76\uDD80-\uDDC4\uDDCA-\uDDCC\uDDD0-\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE37\uDE3E\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEEA\uDEF0-\uDEF9\uDF00-\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3C-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF50\uDF57\uDF5D-\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC00-\uDC4A\uDC50-\uDC59\uDC80-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDB5\uDDB8-\uDDC0\uDDD8-\uDDDD\uDE00-\uDE40\uDE44\uDE50-\uDE59\uDE80-\uDEB7\uDEC0-\uDEC9\uDF00-\uDF19\uDF1D-\uDF2B\uDF30-\uDF39]|\uD806[\uDCA0-\uDCE9\uDCFF\uDE00-\uDE3E\uDE47\uDE50-\uDE83\uDE86-\uDE99\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC36\uDC38-\uDC40\uDC50-\uDC59\uDC72-\uDC8F\uDC92-\uDCA7\uDCA9-\uDCB6\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD36\uDD3A\uDD3C\uDD3D\uDD3F-\uDD47\uDD50-\uDD59]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50-\uDF7E\uDF8F-\uDF9F\uDFE0\uDFE1]|\uD821[\uDC00-\uDFEC]|\uD822[\uDC00-\uDEF2]|\uD82C[\uDC00-\uDD1E\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9D\uDC9E]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD838[\uDC00-\uDC06\uDC08-\uDC18\uDC1B-\uDC21\uDC23\uDC24\uDC26-\uDC2A]|\uD83A[\uDC00-\uDCC4\uDCD0-\uDCD6\uDD00-\uDD4A\uDD50-\uDD59]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uDB40[\uDD00-\uDDEF]/,tt={Space_Separator:Es,ID_Start:As,ID_Continue:vs},O={isSpaceSeparator(e){return typeof e=="string"&&tt.Space_Separator.test(e)},isIdStartChar(e){return typeof e=="string"&&(e>="a"&&e<="z"||e>="A"&&e<="Z"||e==="$"||e==="_"||tt.ID_Start.test(e))},isIdContinueChar(e){return typeof e=="string"&&(e>="a"&&e<="z"||e>="A"&&e<="Z"||e>="0"&&e<="9"||e==="$"||e==="_"||e==="‌"||e==="‍"||tt.ID_Continue.test(e))},isDigit(e){return typeof e=="string"&&/[0-9]/.test(e)},isHexDigit(e){return typeof e=="string"&&/[0-9A-Fa-f]/.test(e)}};let dt,J,K,qe,re,j,M,Bt,me;var Cs=function(t,n){dt=String(t),J="start",K=[],qe=0,re=1,j=0,M=void 0,Bt=void 0,me=void 0;do M=ps(),Fs[J]();while(M.type!=="eof");return typeof n=="function"?Et({"":me},"",n):me};function Et(e,t,n){const u=e[t];if(u!=null&&typeof u=="object")if(Array.isArray(u))for(let r=0;r<u.length;r++){const i=String(r),s=Et(u,i,n);s===void 0?delete u[i]:Object.defineProperty(u,i,{value:s,writable:!0,enumerable:!0,configurable:!0})}else for(const r in u){const i=Et(u,r,n);i===void 0?delete u[r]:Object.defineProperty(u,r,{value:i,writable:!0,enumerable:!0,configurable:!0})}return n.call(e,t,u)}let w,m,Fe,Y,S;function ps(){for(w="default",m="",Fe=!1,Y=1;;){S=Z();const e=Nn[w]();if(e)return e}}function Z(){if(dt[qe])return String.fromCodePoint(dt.codePointAt(qe))}function f(){const e=Z();return e===`
`?(re++,j=0):e?j+=e.length:j++,e&&(qe+=e.length),e}const Nn={default(){switch(S){case"	":case"\v":case"\f":case" ":case" ":case"\uFEFF":case`
`:case"\r":case"\u2028":case"\u2029":f();return;case"/":f(),w="comment";return;case void 0:return f(),R("eof")}if(O.isSpaceSeparator(S)){f();return}return Nn[J]()},comment(){switch(S){case"*":f(),w="multiLineComment";return;case"/":f(),w="singleLineComment";return}throw T(f())},multiLineComment(){switch(S){case"*":f(),w="multiLineCommentAsterisk";return;case void 0:throw T(f())}f()},multiLineCommentAsterisk(){switch(S){case"*":f();return;case"/":f(),w="default";return;case void 0:throw T(f())}f(),w="multiLineComment"},singleLineComment(){switch(S){case`
`:case"\r":case"\u2028":case"\u2029":f(),w="default";return;case void 0:return f(),R("eof")}f()},value(){switch(S){case"{":case"[":return R("punctuator",f());case"n":return f(),oe("ull"),R("null",null);case"t":return f(),oe("rue"),R("boolean",!0);case"f":return f(),oe("alse"),R("boolean",!1);case"-":case"+":f()==="-"&&(Y=-1),w="sign";return;case".":m=f(),w="decimalPointLeading";return;case"0":m=f(),w="zero";return;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":m=f(),w="decimalInteger";return;case"I":return f(),oe("nfinity"),R("numeric",1/0);case"N":return f(),oe("aN"),R("numeric",NaN);case'"':case"'":Fe=f()==='"',m="",w="string";return}throw T(f())},identifierNameStartEscape(){if(S!=="u")throw T(f());f();const e=At();switch(e){case"$":case"_":break;default:if(!O.isIdStartChar(e))throw Yt();break}m+=e,w="identifierName"},identifierName(){switch(S){case"$":case"_":case"‌":case"‍":m+=f();return;case"\\":f(),w="identifierNameEscape";return}if(O.isIdContinueChar(S)){m+=f();return}return R("identifier",m)},identifierNameEscape(){if(S!=="u")throw T(f());f();const e=At();switch(e){case"$":case"_":case"‌":case"‍":break;default:if(!O.isIdContinueChar(e))throw Yt();break}m+=e,w="identifierName"},sign(){switch(S){case".":m=f(),w="decimalPointLeading";return;case"0":m=f(),w="zero";return;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":m=f(),w="decimalInteger";return;case"I":return f(),oe("nfinity"),R("numeric",Y*(1/0));case"N":return f(),oe("aN"),R("numeric",NaN)}throw T(f())},zero(){switch(S){case".":m+=f(),w="decimalPoint";return;case"e":case"E":m+=f(),w="decimalExponent";return;case"x":case"X":m+=f(),w="hexadecimal";return}return R("numeric",Y*0)},decimalInteger(){switch(S){case".":m+=f(),w="decimalPoint";return;case"e":case"E":m+=f(),w="decimalExponent";return}if(O.isDigit(S)){m+=f();return}return R("numeric",Y*Number(m))},decimalPointLeading(){if(O.isDigit(S)){m+=f(),w="decimalFraction";return}throw T(f())},decimalPoint(){switch(S){case"e":case"E":m+=f(),w="decimalExponent";return}if(O.isDigit(S)){m+=f(),w="decimalFraction";return}return R("numeric",Y*Number(m))},decimalFraction(){switch(S){case"e":case"E":m+=f(),w="decimalExponent";return}if(O.isDigit(S)){m+=f();return}return R("numeric",Y*Number(m))},decimalExponent(){switch(S){case"+":case"-":m+=f(),w="decimalExponentSign";return}if(O.isDigit(S)){m+=f(),w="decimalExponentInteger";return}throw T(f())},decimalExponentSign(){if(O.isDigit(S)){m+=f(),w="decimalExponentInteger";return}throw T(f())},decimalExponentInteger(){if(O.isDigit(S)){m+=f();return}return R("numeric",Y*Number(m))},hexadecimal(){if(O.isHexDigit(S)){m+=f(),w="hexadecimalInteger";return}throw T(f())},hexadecimalInteger(){if(O.isHexDigit(S)){m+=f();return}return R("numeric",Y*Number(m))},string(){switch(S){case"\\":f(),m+=_s();return;case'"':if(Fe)return f(),R("string",m);m+=f();return;case"'":if(!Fe)return f(),R("string",m);m+=f();return;case`
`:case"\r":throw T(f());case"\u2028":case"\u2029":ms(S);break;case void 0:throw T(f())}m+=f()},start(){switch(S){case"{":case"[":return R("punctuator",f())}w="value"},beforePropertyName(){switch(S){case"$":case"_":m=f(),w="identifierName";return;case"\\":f(),w="identifierNameStartEscape";return;case"}":return R("punctuator",f());case'"':case"'":Fe=f()==='"',w="string";return}if(O.isIdStartChar(S)){m+=f(),w="identifierName";return}throw T(f())},afterPropertyName(){if(S===":")return R("punctuator",f());throw T(f())},beforePropertyValue(){w="value"},afterPropertyValue(){switch(S){case",":case"}":return R("punctuator",f())}throw T(f())},beforeArrayValue(){if(S==="]")return R("punctuator",f());w="value"},afterArrayValue(){switch(S){case",":case"]":return R("punctuator",f())}throw T(f())},end(){throw T(f())}};function R(e,t){return{type:e,value:t,line:re,column:j}}function oe(e){for(const t of e){if(Z()!==t)throw T(f());f()}}function _s(){switch(Z()){case"b":return f(),"\b";case"f":return f(),"\f";case"n":return f(),`
`;case"r":return f(),"\r";case"t":return f(),"	";case"v":return f(),"\v";case"0":if(f(),O.isDigit(Z()))throw T(f());return"\0";case"x":return f(),gs();case"u":return f(),At();case`
`:case"\u2028":case"\u2029":return f(),"";case"\r":return f(),Z()===`
`&&f(),"";case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":throw T(f());case void 0:throw T(f())}return f()}function gs(){let e="",t=Z();if(!O.isHexDigit(t)||(e+=f(),t=Z(),!O.isHexDigit(t)))throw T(f());return e+=f(),String.fromCodePoint(parseInt(e,16))}function At(){let e="",t=4;for(;t-- >0;){const n=Z();if(!O.isHexDigit(n))throw T(f());e+=f()}return String.fromCodePoint(parseInt(e,16))}const Fs={start(){if(M.type==="eof")throw ae();nt()},beforePropertyName(){switch(M.type){case"identifier":case"string":Bt=M.value,J="afterPropertyName";return;case"punctuator":Ie();return;case"eof":throw ae()}},afterPropertyName(){if(M.type==="eof")throw ae();J="beforePropertyValue"},beforePropertyValue(){if(M.type==="eof")throw ae();nt()},beforeArrayValue(){if(M.type==="eof")throw ae();if(M.type==="punctuator"&&M.value==="]"){Ie();return}nt()},afterPropertyValue(){if(M.type==="eof")throw ae();switch(M.value){case",":J="beforePropertyName";return;case"}":Ie()}},afterArrayValue(){if(M.type==="eof")throw ae();switch(M.value){case",":J="beforeArrayValue";return;case"]":Ie()}},end(){}};function nt(){let e;switch(M.type){case"punctuator":switch(M.value){case"{":e={};break;case"[":e=[];break}break;case"null":case"boolean":case"numeric":case"string":e=M.value;break}if(me===void 0)me=e;else{const t=K[K.length-1];Array.isArray(t)?t.push(e):Object.defineProperty(t,Bt,{value:e,writable:!0,enumerable:!0,configurable:!0})}if(e!==null&&typeof e=="object")K.push(e),Array.isArray(e)?J="beforeArrayValue":J="beforePropertyName";else{const t=K[K.length-1];t==null?J="end":Array.isArray(t)?J="afterArrayValue":J="afterPropertyValue"}}function Ie(){K.pop();const e=K[K.length-1];e==null?J="end":Array.isArray(e)?J="afterArrayValue":J="afterPropertyValue"}function T(e){return He(e===void 0?`JSON5: invalid end of input at ${re}:${j}`:`JSON5: invalid character '${Rn(e)}' at ${re}:${j}`)}function ae(){return He(`JSON5: invalid end of input at ${re}:${j}`)}function Yt(){return j-=5,He(`JSON5: invalid identifier character at ${re}:${j}`)}function ms(e){console.warn(`JSON5: '${Rn(e)}' in strings is not valid ECMAScript; consider escaping`)}function Rn(e){const t={"'":"\\'",'"':'\\"',"\\":"\\\\","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t","\v":"\\v","\0":"\\0","\u2028":"\\u2028","\u2029":"\\u2029"};if(t[e])return t[e];if(e<" "){const n=e.charCodeAt(0).toString(16);return"\\x"+("00"+n).substring(n.length)}return e}function He(e){const t=new SyntaxError(e);return t.lineNumber=re,t.columnNumber=j,t}var ys=function(t,n,u){const r=[];let i="",s,a,c="",o;if(n!=null&&typeof n=="object"&&!Array.isArray(n)&&(u=n.space,o=n.quote,n=n.replacer),typeof n=="function")a=n;else if(Array.isArray(n)){s=[];for(const _ of n){let x;typeof _=="string"?x=_:(typeof _=="number"||_ instanceof String||_ instanceof Number)&&(x=String(_)),x!==void 0&&s.indexOf(x)<0&&s.push(x)}}return u instanceof Number?u=Number(u):u instanceof String&&(u=String(u)),typeof u=="number"?u>0&&(u=Math.min(10,Math.floor(u)),c="          ".substr(0,u)):typeof u=="string"&&(c=u.substr(0,10)),l("",{"":t});function l(_,x){let g=x[_];switch(g!=null&&(typeof g.toJSON5=="function"?g=g.toJSON5(_):typeof g.toJSON=="function"&&(g=g.toJSON(_))),a&&(g=a.call(x,_,g)),g instanceof Number?g=Number(g):g instanceof String?g=String(g):g instanceof Boolean&&(g=g.valueOf()),g){case null:return"null";case!0:return"true";case!1:return"false"}if(typeof g=="string")return D(g);if(typeof g=="number")return String(g);if(typeof g=="object")return Array.isArray(g)?B(g):d(g)}function D(_){const x={"'":.1,'"':.2},g={"'":"\\'",'"':'\\"',"\\":"\\\\","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t","\v":"\\v","\0":"\\0","\u2028":"\\u2028","\u2029":"\\u2029"};let p="";for(let v=0;v<_.length;v++){const L=_[v];switch(L){case"'":case'"':x[L]++,p+=L;continue;case"\0":if(O.isDigit(_[v+1])){p+="\\x00";continue}}if(g[L]){p+=g[L];continue}if(L<" "){let ee=L.charCodeAt(0).toString(16);p+="\\x"+("00"+ee).substring(ee.length);continue}p+=L}const C=o||Object.keys(x).reduce((v,L)=>x[v]<x[L]?v:L);return p=p.replace(new RegExp(C,"g"),g[C]),C+p+C}function d(_){if(r.indexOf(_)>=0)throw TypeError("Converting circular structure to JSON5");r.push(_);let x=i;i=i+c;let g=s||Object.keys(_),p=[];for(const v of g){const L=l(v,_);if(L!==void 0){let ee=A(v)+":";c!==""&&(ee+=" "),ee+=L,p.push(ee)}}let C;if(p.length===0)C="{}";else{let v;if(c==="")v=p.join(","),C="{"+v+"}";else{let L=`,
`+i;v=p.join(L),C=`{
`+i+v+`,
`+x+"}"}}return r.pop(),i=x,C}function A(_){if(_.length===0)return D(_);const x=String.fromCodePoint(_.codePointAt(0));if(!O.isIdStartChar(x))return D(_);for(let g=x.length;g<_.length;g++)if(!O.isIdContinueChar(String.fromCodePoint(_.codePointAt(g))))return D(_);return _}function B(_){if(r.indexOf(_)>=0)throw TypeError("Converting circular structure to JSON5");r.push(_);let x=i;i=i+c;let g=[];for(let C=0;C<_.length;C++){const v=l(String(C),_);g.push(v!==void 0?v:"null")}let p;if(g.length===0)p="[]";else if(c==="")p="["+g.join(",")+"]";else{let C=`,
`+i,v=g.join(C);p=`[
`+i+v+`,
`+x+"]"}return r.pop(),i=x,p}};const ws={parse:Cs,stringify:ys};var Bs=ws;const Kt="10";async function xs(e){const t=await new Promise((u,r)=>{const i=new FileReader;i.onload=s=>{if(!s.target||!s.target.result)return;if(e.name.endsWith(".json5")){const o=Bs.parse(s.target.result);o.on_load_at_start==null&&(o.on_load_at_start=!1),o.calculate_event_ids==null&&(o.calculate_event_ids=!1),o.room_version==null&&(o.room_version=Kt),u(o);return}const a=s.target.result;if(a.startsWith("[")){const o=JSON.parse(a);u(o);return}const c=a.split(`
`).filter(o=>o.trim().length>0).map(o=>JSON.parse(o));u(c)},i.readAsText(e)});let n;return Array.isArray(t)?n={tardis_version:1,room_version:Kt,room_id:t[0].room_id,calculate_event_ids:!1,on_load_at_start:!1,events:t}:n=t,n}function bs(e){var r,i,s,a;const t={events:[],roomVersion:e.room_version,annotations:e.annotations,precalculatedStateAfter:e.precalculated_state_after,onLoadAtStart:e.on_load_at_start},n=new Map;let u=new Date(2024,0,1).getTime();for(const c of e.events){if(!c)throw new Error("missing event");if(!c.event_id)throw new Error(`event is missing 'event_id', got ${JSON.stringify(c)}`);if(!c.type)throw new Error(`event is missing 'type' field, got ${JSON.stringify(c)}`);if(c.origin_server_ts?u=c.origin_server_ts+1e3:(c.origin_server_ts=u,u+=1e3),!c.room_id&&e.room_id&&(c.room_id=e.room_id),e.calculate_event_ids){const o=c.event_id;for(const D of["prev_events","auth_events"]){const d=[];for(const A of c[D]){const B=n.get(A);B?d.push(B):d.push(A)}c[D]=d}const l=globalThis.gmslEventIDForEvent(JSON.stringify(c),e.room_version);n.set(o,l),c.event_id=l,(i=(r=t.annotations)==null?void 0:r.events)!=null&&i[o]&&(t.annotations.events[l]=t.annotations.events[o]),(a=(s=t.annotations)==null?void 0:s.titles)!=null&&a[o]&&(t.annotations.titles[l]=t.annotations.titles[o])}t.events.push(c)}if(t.precalculatedStateAfter)for(const c in t.precalculatedStateAfter){const o=n.get(c);if(!o){console.error(`precalculated_state_after references ${c} but this does not exist in the events array. Skipping.`);continue}const l=[];for(const D of t.precalculatedStateAfter[c]){const d=n.get(D);d?l.push(d):console.error(`precalculated_state_after for ${c} references ${D} but this does not exist in the events array. Skipping.`)}t.precalculatedStateAfter[o]=l,delete t.precalculatedStateAfter[c]}return console.log(t),t}class $s{constructor(t,n){N(this,"inflightRequests");this.sender=t,this.getEvent=n,this.inflightRequests=new Map}onGetEventRequest(t){const n=this.getEvent(t);return n||console.error(`WS: asked for event ${t.event_id} but didn't find it.`),n}onResolveStateResponse(t,n){const u=this.inflightRequests.get(t);if(!u){console.error(`onResolveStateResponse: no request id for response! id=${t}`);return}n.error&&console.error(t,n.error),u(n),this.inflightRequests.delete(t)}async resolveState(t,n,u,r){console.log("resolveState",u,r);const i=globalThis.crypto.randomUUID();return new Promise((a,c)=>{this.inflightRequests.set(i,o=>{if(!o.result){console.error("State resolved to the empty set"),a({state:{}});return}if(o.error&&o.error!==""){c(o.error);return}a({state:o.result})}),this.sender.sendResolveState(i,{state:u,room_id:t,room_version:n,event:r})})}}class Ss{constructor(){N(this,"ws");N(this,"receiver")}async sendResolveState(t,n){this.sendWs({id:t,type:"resolve_state",data:n})}async connect(t,n){return this.receiver=n,this.ws=new WebSocket(t),new Promise(u=>{this.ws.addEventListener("open",()=>{console.log("WS open"),u()}),this.ws.addEventListener("error",this.onWsError.bind(this)),this.ws.addEventListener("close",this.onWsClose.bind(this)),this.ws.addEventListener("message",this.onWsMessage.bind(this))})}close(){this.ws.close()}sendWs(t){console.log("send",t),this.ws.send(JSON.stringify(t))}onWsClose(t){}onWsError(t){}onWsMessage(t){const n=JSON.parse(t.data);switch(console.log("recv",n),n.type){case"get_event":{const u=n.data,r=this.receiver.onGetEventRequest(u);u.event=r,n.data=u,this.sendWs(n);break}case"resolve_state":{const u=n.data;this.receiver.onResolveStateResponse(n.id,u);break}}}}const Zt={"Quick Start":In,"Mainline Ordering":Ds,"Reverse Topological Power Ordering":ds},ue=new Kn(document.getElementById("eventlist"),document.getElementById("eventlisttemplate"));class Tn{constructor(t){N(this,"cache");N(this,"createEventId");N(this,"showAuthChain");N(this,"showAuthDAG");N(this,"showOutliers");N(this,"showStateSets");N(this,"collapse");N(this,"shimUrl");N(this,"debugger");N(this,"renderEvents");N(this,"scenario");N(this,"scenarioFile");this.cache=t,this.createEventId=null,this.showAuthChain=!1,this.showAuthDAG=!1,this.showOutliers=!1,this.showStateSets=!1,this.collapse=!1,this.renderEvents={},this.scenarioFile=null}setShimUrl(t){this.shimUrl=t,console.log("setShimUrl",t)}async loadFile(t){const n=await xs(t);this.loadScenarioFile(n)}loadScenarioFile(t){this.scenarioFile=JSON.parse(JSON.stringify(t));const n=bs(t);for(const r of n.events)this.cache.eventCache.store(r),r.type==="m.room.create"&&r.state_key===""&&(this.createEventId=r.event_id);if(n.precalculatedStateAfter)for(const r in n.precalculatedStateAfter){const i={};for(const s of n.precalculatedStateAfter[r]){const a=this.cache.eventCache.get(s);if(!a||a.state_key==null){console.log(`precalculated_state_after for ${r} includes ${s} but it isn't a state event we know about. Skipping.`);continue}i[JSON.stringify([a.type,a.state_key])]=a.event_id}this.cache.stateAtEvent.setState(r,i)}this.scenario=n,this.debugger=new Yn(n),n.onLoadAtStart&&n.events.length>=2&&this.debugger.goTo(n.events[1].event_id),ue.clear();let u=!1;n.events.forEach((r,i)=>{ue.appendEvent(i,r),r.prev_auth_events&&r.prev_auth_events.length>0&&(u=!0)}),ue.highlight(this.debugger.current()),ue.onEventClick(r=>{this.debugger.goTo(r),this.refresh(),ue.highlight(y.debugger.current())}),ue.onEventJsonClick(r=>{document.getElementById("eventdetails").textContent=JSON.stringify(this.cache.eventCache.get(r),null,2),document.getElementById("infocontainer").style.display="block"}),u&&Hn(n),this.refresh()}setShowAuthChain(t){this.showAuthChain=t}setShowAuthDAG(t){this.showAuthDAG=t}setShowOutliers(t){this.showOutliers=t}setShowStateSets(t){this.showStateSets=t}setCollapse(t){this.collapse=t}async refresh(){let t=Object.create(null);for(const i of this.debugger.eventsUpToCurrent())t[i]=this.cache.eventCache.get(i);this.collapse&&(t=this.collapsifier(t));const n=[];for(const i in t)n.push(t[i]);let u={};const r=this.cache.eventCache.get(this.debugger.current());r&&(u=this.cache.stateAtEvent.getInverseStateForEventIds(new Set(r.prev_events))),fs(document.getElementById("svgcontainer"),n,{currentEventId:this.debugger.current(),scenario:this.scenario,stateAtEvent:this.cache.stateAtEvent.getStateAsEventIds(this.debugger.current()),inverseStateSets:u,showAuthChain:this.showAuthChain,showAuthDAG:this.showAuthDAG,showStateSets:this.showStateSets})}findForwardExtremities(t){const n=new Set;for(const u in t)n.add(u);for(const u in t){const r=t[u];for(const i of r.prev_events)n.delete(i);for(const i of r.auth_events)n.delete(i)}return n}collapsifier(t){const n=JSON.parse(JSON.stringify(t)),u=this.findForwardExtremities(n),r=new Set;for(const o of u)r.add(o);const i=Object.create(null);for(const o in n){const l=n[o];for(const D of l.prev_events){const d=i[D]||0;i[D]=d+1}l.prev_events.length!==1&&r.add(l.event_id)}for(const o in i)i[o]>1&&r.add(o);const s=new Set;for(const o in n){if(r.has(o)){s.add(o);continue}const l=n[o];if(r.has(l.prev_events[0])){s.add(o);continue}for(const D of r){const d=n[D];if(!d)continue;let A=!1;for(const B of d.prev_events)if(B===o){s.add(o),A=!0;break}if(A)break}}const a=[],c=new Set;for(const o of u)a.push({id:o,from:o});for(;a.length>0;){const o=a.pop();if(!o)break;const l=o.id,D=n[l];if(c.has(l)||(c.add(l),!D))continue;for(const B of D.prev_events)a.push({id:B,from:o.id});if(s.has(l))continue;delete n[l];const d=n[o.from],A=[D.prev_events[0]];for(const B in d.prev_events)s.has(B)&&A.push(B);d.prev_events=A,d._collapse=d._collapse||0,d._collapse+=1,n[o.from]=d;for(const B of a)B.from===l&&(B.from=d.event_id)}return console.log("collapsifier complete"),n}}const We=document.getElementById("shimurl");let y=new Tn(new rn);y.setShimUrl(We.value);const vt=new Ss,Qt=new $s(vt,e=>y.cache.eventCache.get(e.event_id));document.getElementById("showauthevents").addEventListener("change",e=>{y.setShowAuthChain(e.target.checked),e.target.checked&&y.setShowAuthDAG(!1),y.refresh(),document.getElementById("showauthevents").checked=y.showAuthChain,document.getElementById("showauthdag").checked=y.showAuthDAG});document.getElementById("showauthdag").addEventListener("change",e=>{y.setShowAuthDAG(e.target.checked),e.target.checked&&y.setShowAuthChain(!1),y.refresh(),document.getElementById("showauthevents").checked=y.showAuthChain,document.getElementById("showauthdag").checked=y.showAuthDAG});document.getElementById("showstatesets").addEventListener("change",e=>{y.setShowStateSets(e.target.checked),y.refresh()});document.getElementById("showoutliers").addEventListener("change",e=>{y.setShowOutliers(e.target.checked),y.refresh()});document.getElementById("showoutliers").checked=y.showOutliers;document.getElementById("collapse").addEventListener("change",e=>{y.setCollapse(e.target.checked),y.refresh()});document.getElementById("collapse").checked=y.collapse;document.getElementById("jsonfile").addEventListener("change",async e=>{const t=document.getElementById("jsonfile").files;t&&(y=new Tn(new rn),y.setShimUrl(We.value),await y.loadFile(t[0]))},!1);document.getElementById("closeinfocontainer").addEventListener("click",e=>{document.getElementById("infocontainer").style.display="none"});document.getElementById("infocontainer").style.display="none";document.getElementById("stepfwd").addEventListener("click",async e=>{y.debugger.next(),y.refresh(),ue.highlight(y.debugger.current())});document.getElementById("stepbwd").addEventListener("click",async e=>{y.debugger.previous(),y.refresh(),ue.highlight(y.debugger.current())});We.addEventListener("change",e=>{const t=e.target.value;y.setShimUrl(t),globalThis.localStorage.setItem("shim_url",t)});const ut=globalThis.localStorage.getItem("shim_url");ut&&(console.log("setting shim url from local storage"),We.value=ut,y.setShimUrl(ut));const en=document.getElementById("loader"),ks=document.getElementById("loader-status"),le=e=>{ks.innerText=e};document.getElementById("resolve").addEventListener("click",async e=>{if(!y.shimUrl)return console.error("you need to set a shim url to resolve state!"),{};en.style.display="block",le(`Connecting to ${y.shimUrl}`);try{await vt.connect(y.shimUrl,Qt),await y.debugger.resolve(y.cache,async(t,n,u,r)=>{try{return le(`Resolving state at event ${r.event_id}`),(await Qt.resolveState(t,n,u,r)).state}catch(i){throw console.error("failed to resolve state:",i),le(`Failed to resolve state at event ${r.event_id} : ${i}`),i}}),le("")}catch(t){console.error("resolving state failed: ",t)}finally{vt.close()}en.style.display="none",y.refresh()});var nn;(nn=document.getElementById("share"))==null||nn.addEventListener("click",async e=>{try{if(!y.scenarioFile)throw new Error("no loaded file");const t=Vn(y.scenarioFile),n=window.location.href.split("#")[0];await navigator.clipboard.writeText(`${n}#${t}`),le("Share link copied to clipboard")}catch(t){le(`Unable to copy to clipboard: ${t}`)}});var un;(un=document.getElementById("save"))==null||un.addEventListener("click",async e=>{if(!y.scenarioFile){le("No loaded scenario");return}const t=new Blob([JSON.stringify(y.scenarioFile,null,4)],{type:"text/plain"}),n=URL.createObjectURL(t),u=document.createElement("a");u.href=n,u.download="scenario.json5",document.body.appendChild(u),u.click(),document.body.removeChild(u),URL.revokeObjectURL(n)});const tn=new Go;WebAssembly.instantiateStreaming(fetch("gmsl.wasm"),tn.importObject).then(e=>{globalThis.wasm=e.instance,tn.run(globalThis.wasm);const t=u=>{y.loadScenarioFile(u)},n=document.getElementById("file-select");if(n&&(n.innerHTML="",Object.keys(Zt).forEach((u,r)=>{n[r]=new Option(u)}),n.addEventListener("change",u=>{var i;const r=Zt[(i=u==null?void 0:u.target)==null?void 0:i.value];t(r)})),globalThis.location.hash.length>1)try{const u=jn(globalThis.location.hash.substring(1));t(u);return}catch(u){console.error("failed to read fragment: ",u)}t(In)});
