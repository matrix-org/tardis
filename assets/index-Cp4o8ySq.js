(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const u of r)if(u.type==="childList")for(const s of u.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&i(s)}).observe(document,{childList:!0,subtree:!0});function n(r){const u={};return r.integrity&&(u.integrity=r.integrity),r.referrerPolicy&&(u.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?u.credentials="include":r.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function i(r){if(r.ep)return;r.ep=!0;const u=n(r);fetch(r.href,u)}})();var ur={value:()=>{}};function an(){for(var t=0,e=arguments.length,n={},i;t<e;++t){if(!(i=arguments[t]+"")||i in n||/[\s.]/.test(i))throw new Error("illegal type: "+i);n[i]=[]}return new fe(n)}function fe(t){this._=t}function sr(t,e){return t.trim().split(/^|\s+/).map(function(n){var i="",r=n.indexOf(".");if(r>=0&&(i=n.slice(r+1),n=n.slice(0,r)),n&&!e.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:i}})}fe.prototype=an.prototype={constructor:fe,on:function(t,e){var n=this._,i=sr(t+"",n),r,u=-1,s=i.length;if(arguments.length<2){for(;++u<s;)if((r=(t=i[u]).type)&&(r=or(n[r],t.name)))return r;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++u<s;)if(r=(t=i[u]).type)n[r]=Fn(n[r],t.name,e);else if(e==null)for(r in n)n[r]=Fn(n[r],t.name,null);return this},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new fe(t)},call:function(t,e){if((r=arguments.length-2)>0)for(var n=new Array(r),i=0,r,u;i<r;++i)n[i]=arguments[i+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(u=this._[t],i=0,r=u.length;i<r;++i)u[i].value.apply(e,n)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var i=this._[t],r=0,u=i.length;r<u;++r)i[r].value.apply(e,n)}};function or(t,e){for(var n=0,i=t.length,r;n<i;++n)if((r=t[n]).name===e)return r.value}function Fn(t,e,n){for(var i=0,r=t.length;i<r;++i)if(t[i].name===e){t[i]=ur,t=t.slice(0,i).concat(t.slice(i+1));break}return n!=null&&t.push({name:e,value:n}),t}var qe="http://www.w3.org/1999/xhtml";const bn={svg:"http://www.w3.org/2000/svg",xhtml:qe,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function be(t){var e=t+="",n=e.indexOf(":");return n>=0&&(e=t.slice(0,n))!=="xmlns"&&(t=t.slice(n+1)),bn.hasOwnProperty(e)?{space:bn[e],local:t}:t}function ar(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===qe&&e.documentElement.namespaceURI===qe?e.createElement(t):e.createElementNS(n,t)}}function lr(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function hi(t){var e=be(t);return(e.local?lr:ar)(e)}function hr(){}function ln(t){return t==null?hr:function(){return this.querySelector(t)}}function cr(t){typeof t!="function"&&(t=ln(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var u=e[r],s=u.length,o=i[r]=new Array(s),a,h,l=0;l<s;++l)(a=u[l])&&(h=t.call(a,a.__data__,l,u))&&("__data__"in a&&(h.__data__=a.__data__),o[l]=h);return new rt(i,this._parents)}function ci(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function fr(){return[]}function fi(t){return t==null?fr:function(){return this.querySelectorAll(t)}}function dr(t){return function(){var e=t.apply(this,arguments);return e==null?[]:ci(e)}}function pr(t){typeof t=="function"?t=dr(t):t=fi(t);for(var e=this._groups,n=e.length,i=[],r=[],u=0;u<n;++u)for(var s=e[u],o=s.length,a,h=0;h<o;++h)(a=s[h])&&(i.push(t.call(a,a.__data__,h,s)),r.push(a));return new rt(i,r)}function di(t){return function(){return this.matches(t)}}function pi(t){return function(e){return e.matches(t)}}var Dr=Array.prototype.find;function vr(t){return function(){return Dr.call(this.children,t)}}function gr(){return this.firstElementChild}function mr(t){return this.select(t==null?gr:vr(typeof t=="function"?t:pi(t)))}var yr=Array.prototype.filter;function Cr(){return this.children}function Er(t){return function(){return yr.call(this.children,t)}}function _r(t){return this.selectAll(t==null?Cr:Er(typeof t=="function"?t:pi(t)))}function Ar(t){typeof t!="function"&&(t=di(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var u=e[r],s=u.length,o=i[r]=[],a,h=0;h<s;++h)(a=u[h])&&t.call(a,a.__data__,h,u)&&o.push(a);return new rt(i,this._parents)}function Di(t){return new Array(t.length)}function wr(){return new rt(this._enter||this._groups.map(Di),this._parents)}function ye(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}ye.prototype={constructor:ye,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function xr(t){return function(){return t}}function Fr(t,e,n,i,r,u){for(var s=0,o,a=e.length,h=u.length;s<h;++s)(o=e[s])?(o.__data__=u[s],i[s]=o):n[s]=new ye(t,u[s]);for(;s<a;++s)(o=e[s])&&(r[s]=o)}function br(t,e,n,i,r,u,s){var o,a,h=new Map,l=e.length,c=u.length,f=new Array(l),d;for(o=0;o<l;++o)(a=e[o])&&(f[o]=d=s.call(a,a.__data__,o,e)+"",h.has(d)?r[o]=a:h.set(d,a));for(o=0;o<c;++o)d=s.call(t,u[o],o,u)+"",(a=h.get(d))?(i[o]=a,a.__data__=u[o],h.delete(d)):n[o]=new ye(t,u[o]);for(o=0;o<l;++o)(a=e[o])&&h.get(f[o])===a&&(r[o]=a)}function Br(t){return t.__data__}function Ir(t,e){if(!arguments.length)return Array.from(this,Br);var n=e?br:Fr,i=this._parents,r=this._groups;typeof t!="function"&&(t=xr(t));for(var u=r.length,s=new Array(u),o=new Array(u),a=new Array(u),h=0;h<u;++h){var l=i[h],c=r[h],f=c.length,d=ci(t.call(l,l&&l.__data__,h,i)),m=d.length,p=o[h]=new Array(m),y=s[h]=new Array(m),v=a[h]=new Array(f);n(l,c,p,y,v,d,e);for(var b=0,A=0,E,_;b<m;++b)if(E=p[b]){for(b>=A&&(A=b+1);!(_=y[A])&&++A<m;);E._next=_||null}}return s=new rt(s,i),s._enter=o,s._exit=a,s}function Sr(){return new rt(this._exit||this._groups.map(Di),this._parents)}function Mr(t,e,n){var i=this.enter(),r=this,u=this.exit();return i=typeof t=="function"?t(i):i.append(t+""),e!=null&&(r=e(r)),n==null?u.remove():n(u),i&&r?i.merge(r).order():r}function Nr(t){if(!(t instanceof rt))throw new Error("invalid merge");for(var e=this._groups,n=t._groups,i=e.length,r=n.length,u=Math.min(i,r),s=new Array(i),o=0;o<u;++o)for(var a=e[o],h=n[o],l=a.length,c=s[o]=new Array(l),f,d=0;d<l;++d)(f=a[d]||h[d])&&(c[d]=f);for(;o<i;++o)s[o]=e[o];return new rt(s,this._parents)}function $r(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var i=t[e],r=i.length-1,u=i[r],s;--r>=0;)(s=i[r])&&(u&&s.compareDocumentPosition(u)^4&&u.parentNode.insertBefore(s,u),u=s);return this}function Tr(t){t||(t=Or);function e(c,f){return c&&f?t(c.__data__,f.__data__):!c-!f}for(var n=this._groups,i=n.length,r=new Array(i),u=0;u<i;++u){for(var s=n[u],o=s.length,a=r[u]=new Array(o),h,l=0;l<o;++l)(h=s[l])&&(a[l]=h);a.sort(e)}return new rt(r,this._parents).order()}function Or(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function kr(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this}function Rr(){return Array.from(this)}function Vr(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var i=t[e],r=0,u=i.length;r<u;++r){var s=i[r];if(s)return s}return null}function zr(){let t=0;for(const e of this)++t;return t}function Pr(){return!this.node()}function Lr(t){for(var e=this._groups,n=0,i=e.length;n<i;++n)for(var r=e[n],u=0,s=r.length,o;u<s;++u)(o=r[u])&&t.call(o,o.__data__,u,r);return this}function qr(t){return function(){this.removeAttribute(t)}}function jr(t){return function(){this.removeAttributeNS(t.space,t.local)}}function Jr(t,e){return function(){this.setAttribute(t,e)}}function Ur(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function Gr(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttribute(t):this.setAttribute(t,n)}}function Hr(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}function Xr(t,e){var n=be(t);if(arguments.length<2){var i=this.node();return n.local?i.getAttributeNS(n.space,n.local):i.getAttribute(n)}return this.each((e==null?n.local?jr:qr:typeof e=="function"?n.local?Hr:Gr:n.local?Ur:Jr)(n,e))}function vi(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function Wr(t){return function(){this.style.removeProperty(t)}}function Yr(t,e,n){return function(){this.style.setProperty(t,e,n)}}function Kr(t,e,n){return function(){var i=e.apply(this,arguments);i==null?this.style.removeProperty(t):this.style.setProperty(t,i,n)}}function Zr(t,e,n){return arguments.length>1?this.each((e==null?Wr:typeof e=="function"?Kr:Yr)(t,e,n??"")):qt(this.node(),t)}function qt(t,e){return t.style.getPropertyValue(e)||vi(t).getComputedStyle(t,null).getPropertyValue(e)}function Qr(t){return function(){delete this[t]}}function tu(t,e){return function(){this[t]=e}}function eu(t,e){return function(){var n=e.apply(this,arguments);n==null?delete this[t]:this[t]=n}}function nu(t,e){return arguments.length>1?this.each((e==null?Qr:typeof e=="function"?eu:tu)(t,e)):this.node()[t]}function gi(t){return t.trim().split(/^|\s+/)}function hn(t){return t.classList||new mi(t)}function mi(t){this._node=t,this._names=gi(t.getAttribute("class")||"")}mi.prototype={add:function(t){var e=this._names.indexOf(t);e<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function yi(t,e){for(var n=hn(t),i=-1,r=e.length;++i<r;)n.add(e[i])}function Ci(t,e){for(var n=hn(t),i=-1,r=e.length;++i<r;)n.remove(e[i])}function iu(t){return function(){yi(this,t)}}function ru(t){return function(){Ci(this,t)}}function uu(t,e){return function(){(e.apply(this,arguments)?yi:Ci)(this,t)}}function su(t,e){var n=gi(t+"");if(arguments.length<2){for(var i=hn(this.node()),r=-1,u=n.length;++r<u;)if(!i.contains(n[r]))return!1;return!0}return this.each((typeof e=="function"?uu:e?iu:ru)(n,e))}function ou(){this.textContent=""}function au(t){return function(){this.textContent=t}}function lu(t){return function(){var e=t.apply(this,arguments);this.textContent=e??""}}function hu(t){return arguments.length?this.each(t==null?ou:(typeof t=="function"?lu:au)(t)):this.node().textContent}function cu(){this.innerHTML=""}function fu(t){return function(){this.innerHTML=t}}function du(t){return function(){var e=t.apply(this,arguments);this.innerHTML=e??""}}function pu(t){return arguments.length?this.each(t==null?cu:(typeof t=="function"?du:fu)(t)):this.node().innerHTML}function Du(){this.nextSibling&&this.parentNode.appendChild(this)}function vu(){return this.each(Du)}function gu(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function mu(){return this.each(gu)}function yu(t){var e=typeof t=="function"?t:hi(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function Cu(){return null}function Eu(t,e){var n=typeof t=="function"?t:hi(t),i=e==null?Cu:typeof e=="function"?e:ln(e);return this.select(function(){return this.insertBefore(n.apply(this,arguments),i.apply(this,arguments)||null)})}function _u(){var t=this.parentNode;t&&t.removeChild(this)}function Au(){return this.each(_u)}function wu(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function xu(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function Fu(t){return this.select(t?xu:wu)}function bu(t){return arguments.length?this.property("__data__",t):this.node().__data__}function Bu(t){return function(e){t.call(this,e,this.__data__)}}function Iu(t){return t.trim().split(/^|\s+/).map(function(e){var n="",i=e.indexOf(".");return i>=0&&(n=e.slice(i+1),e=e.slice(0,i)),{type:e,name:n}})}function Su(t){return function(){var e=this.__on;if(e){for(var n=0,i=-1,r=e.length,u;n<r;++n)u=e[n],(!t.type||u.type===t.type)&&u.name===t.name?this.removeEventListener(u.type,u.listener,u.options):e[++i]=u;++i?e.length=i:delete this.__on}}}function Mu(t,e,n){return function(){var i=this.__on,r,u=Bu(e);if(i){for(var s=0,o=i.length;s<o;++s)if((r=i[s]).type===t.type&&r.name===t.name){this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=u,r.options=n),r.value=e;return}}this.addEventListener(t.type,u,n),r={type:t.type,name:t.name,value:e,listener:u,options:n},i?i.push(r):this.__on=[r]}}function Nu(t,e,n){var i=Iu(t+""),r,u=i.length,s;if(arguments.length<2){var o=this.node().__on;if(o){for(var a=0,h=o.length,l;a<h;++a)for(r=0,l=o[a];r<u;++r)if((s=i[r]).type===l.type&&s.name===l.name)return l.value}return}for(o=e?Mu:Su,r=0;r<u;++r)this.each(o(i[r],e,n));return this}function Ei(t,e,n){var i=vi(t),r=i.CustomEvent;typeof r=="function"?r=new r(e,n):(r=i.document.createEvent("Event"),n?(r.initEvent(e,n.bubbles,n.cancelable),r.detail=n.detail):r.initEvent(e,!1,!1)),t.dispatchEvent(r)}function $u(t,e){return function(){return Ei(this,t,e)}}function Tu(t,e){return function(){return Ei(this,t,e.apply(this,arguments))}}function Ou(t,e){return this.each((typeof e=="function"?Tu:$u)(t,e))}function*ku(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var i=t[e],r=0,u=i.length,s;r<u;++r)(s=i[r])&&(yield s)}var _i=[null];function rt(t,e){this._groups=t,this._parents=e}function ue(){return new rt([[document.documentElement]],_i)}function Ru(){return this}rt.prototype=ue.prototype={constructor:rt,select:cr,selectAll:pr,selectChild:mr,selectChildren:_r,filter:Ar,data:Ir,enter:wr,exit:Sr,join:Mr,merge:Nr,selection:Ru,order:$r,sort:Tr,call:kr,nodes:Rr,node:Vr,size:zr,empty:Pr,each:Lr,attr:Xr,style:Zr,property:nu,classed:su,text:hu,html:pu,raise:vu,lower:mu,append:yu,insert:Eu,remove:Au,clone:Fu,datum:bu,on:Nu,dispatch:Ou,[Symbol.iterator]:ku};function yt(t){return typeof t=="string"?new rt([[document.querySelector(t)]],[document.documentElement]):new rt([[t]],_i)}function Vu(t){let e;for(;e=t.sourceEvent;)t=e;return t}function St(t,e){if(t=Vu(t),e===void 0&&(e=t.currentTarget),e){var n=e.ownerSVGElement||e;if(n.createSVGPoint){var i=n.createSVGPoint();return i.x=t.clientX,i.y=t.clientY,i=i.matrixTransform(e.getScreenCTM().inverse()),[i.x,i.y]}if(e.getBoundingClientRect){var r=e.getBoundingClientRect();return[t.clientX-r.left-e.clientLeft,t.clientY-r.top-e.clientTop]}}return[t.pageX,t.pageY]}function je(t){t.preventDefault(),t.stopImmediatePropagation()}function zu(t){var e=t.document.documentElement,n=yt(t).on("dragstart.drag",je,!0);"onselectstart"in e?n.on("selectstart.drag",je,!0):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}function Pu(t,e){var n=t.document.documentElement,i=yt(t).on("dragstart.drag",null);e&&(i.on("click.drag",je,!0),setTimeout(function(){i.on("click.drag",null)},0)),"onselectstart"in n?i.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}function Be(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function cn(t,e){var n=Object.create(t.prototype);for(var i in e)n[i]=e[i];return n}function Ut(){}var kt=.7,jt=1/kt,Pt="\\s*([+-]?\\d+)\\s*",ee="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",pt="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Lu=/^#([0-9a-f]{3,8})$/,qu=new RegExp("^rgb\\("+[Pt,Pt,Pt]+"\\)$"),ju=new RegExp("^rgb\\("+[pt,pt,pt]+"\\)$"),Ju=new RegExp("^rgba\\("+[Pt,Pt,Pt,ee]+"\\)$"),Uu=new RegExp("^rgba\\("+[pt,pt,pt,ee]+"\\)$"),Gu=new RegExp("^hsl\\("+[ee,pt,pt]+"\\)$"),Hu=new RegExp("^hsla\\("+[ee,pt,pt,ee]+"\\)$"),Bn={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Be(Ut,ne,{copy:function(t){return Object.assign(new this.constructor,this,t)},displayable:function(){return this.rgb().displayable()},hex:In,formatHex:In,formatHsl:Xu,formatRgb:Sn,toString:Sn});function In(){return this.rgb().formatHex()}function Xu(){return wi(this).formatHsl()}function Sn(){return this.rgb().formatRgb()}function ne(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=Lu.exec(t))?(n=e[1].length,e=parseInt(e[1],16),n===6?Mn(e):n===3?new nt(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):n===8?se(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):n===4?se(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=qu.exec(t))?new nt(e[1],e[2],e[3],1):(e=ju.exec(t))?new nt(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=Ju.exec(t))?se(e[1],e[2],e[3],e[4]):(e=Uu.exec(t))?se(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=Gu.exec(t))?Tn(e[1],e[2]/100,e[3]/100,1):(e=Hu.exec(t))?Tn(e[1],e[2]/100,e[3]/100,e[4]):Bn.hasOwnProperty(t)?Mn(Bn[t]):t==="transparent"?new nt(NaN,NaN,NaN,0):null}function Mn(t){return new nt(t>>16&255,t>>8&255,t&255,1)}function se(t,e,n,i){return i<=0&&(t=e=n=NaN),new nt(t,e,n,i)}function Ai(t){return t instanceof Ut||(t=ne(t)),t?(t=t.rgb(),new nt(t.r,t.g,t.b,t.opacity)):new nt}function Je(t,e,n,i){return arguments.length===1?Ai(t):new nt(t,e,n,i??1)}function nt(t,e,n,i){this.r=+t,this.g=+e,this.b=+n,this.opacity=+i}Be(nt,Je,cn(Ut,{brighter:function(t){return t=t==null?jt:Math.pow(jt,t),new nt(this.r*t,this.g*t,this.b*t,this.opacity)},darker:function(t){return t=t==null?kt:Math.pow(kt,t),new nt(this.r*t,this.g*t,this.b*t,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Nn,formatHex:Nn,formatRgb:$n,toString:$n}));function Nn(){return"#"+Ne(this.r)+Ne(this.g)+Ne(this.b)}function $n(){var t=this.opacity;return t=isNaN(t)?1:Math.max(0,Math.min(1,t)),(t===1?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(t===1?")":", "+t+")")}function Ne(t){return t=Math.max(0,Math.min(255,Math.round(t)||0)),(t<16?"0":"")+t.toString(16)}function Tn(t,e,n,i){return i<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new dt(t,e,n,i)}function wi(t){if(t instanceof dt)return new dt(t.h,t.s,t.l,t.opacity);if(t instanceof Ut||(t=ne(t)),!t)return new dt;if(t instanceof dt)return t;t=t.rgb();var e=t.r/255,n=t.g/255,i=t.b/255,r=Math.min(e,n,i),u=Math.max(e,n,i),s=NaN,o=u-r,a=(u+r)/2;return o?(e===u?s=(n-i)/o+(n<i)*6:n===u?s=(i-e)/o+2:s=(e-n)/o+4,o/=a<.5?u+r:2-u-r,s*=60):o=a>0&&a<1?0:s,new dt(s,o,a,t.opacity)}function Wu(t,e,n,i){return arguments.length===1?wi(t):new dt(t,e,n,i??1)}function dt(t,e,n,i){this.h=+t,this.s=+e,this.l=+n,this.opacity=+i}Be(dt,Wu,cn(Ut,{brighter:function(t){return t=t==null?jt:Math.pow(jt,t),new dt(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=t==null?kt:Math.pow(kt,t),new dt(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,i=n+(n<.5?n:1-n)*e,r=2*n-i;return new nt($e(t>=240?t-240:t+120,r,i),$e(t,r,i),$e(t<120?t+240:t-120,r,i),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var t=this.opacity;return t=isNaN(t)?1:Math.max(0,Math.min(1,t)),(t===1?"hsl(":"hsla(")+(this.h||0)+", "+(this.s||0)*100+"%, "+(this.l||0)*100+"%"+(t===1?")":", "+t+")")}}));function $e(t,e,n){return(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)*255}const Yu=Math.PI/180,Ku=180/Math.PI;var xi=-.14861,fn=1.78277,dn=-.29227,Ie=-.90649,ie=1.97294,On=ie*Ie,kn=ie*fn,Rn=fn*dn-Ie*xi;function Zu(t){if(t instanceof Ot)return new Ot(t.h,t.s,t.l,t.opacity);t instanceof nt||(t=Ai(t));var e=t.r/255,n=t.g/255,i=t.b/255,r=(Rn*i+On*e-kn*n)/(Rn+On-kn),u=i-r,s=(ie*(n-r)-dn*u)/Ie,o=Math.sqrt(s*s+u*u)/(ie*r*(1-r)),a=o?Math.atan2(s,u)*Ku-120:NaN;return new Ot(a<0?a+360:a,o,r,t.opacity)}function Bt(t,e,n,i){return arguments.length===1?Zu(t):new Ot(t,e,n,i??1)}function Ot(t,e,n,i){this.h=+t,this.s=+e,this.l=+n,this.opacity=+i}Be(Ot,Bt,cn(Ut,{brighter:function(t){return t=t==null?jt:Math.pow(jt,t),new Ot(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=t==null?kt:Math.pow(kt,t),new Ot(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=isNaN(this.h)?0:(this.h+120)*Yu,e=+this.l,n=isNaN(this.s)?0:this.s*e*(1-e),i=Math.cos(t),r=Math.sin(t);return new nt(255*(e+n*(xi*i+fn*r)),255*(e+n*(dn*i+Ie*r)),255*(e+n*(ie*i)),this.opacity)}}));const pn=t=>()=>t;function Fi(t,e){return function(n){return t+n*e}}function Qu(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(i){return Math.pow(t+i*e,n)}}function ts(t,e){var n=e-t;return n?Fi(t,n>180||n<-180?n-360*Math.round(n/360):n):pn(isNaN(t)?e:t)}function es(t){return(t=+t)==1?Lt:function(e,n){return n-e?Qu(e,n,t):pn(isNaN(e)?n:e)}}function Lt(t,e){var n=e-t;return n?Fi(t,n):pn(isNaN(t)?e:t)}const Vn=function t(e){var n=es(e);function i(r,u){var s=n((r=Je(r)).r,(u=Je(u)).r),o=n(r.g,u.g),a=n(r.b,u.b),h=Lt(r.opacity,u.opacity);return function(l){return r.r=s(l),r.g=o(l),r.b=a(l),r.opacity=h(l),r+""}}return i.gamma=t,i}(1);function Ft(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}var Ue=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Te=new RegExp(Ue.source,"g");function ns(t){return function(){return t}}function is(t){return function(e){return t(e)+""}}function rs(t,e){var n=Ue.lastIndex=Te.lastIndex=0,i,r,u,s=-1,o=[],a=[];for(t=t+"",e=e+"";(i=Ue.exec(t))&&(r=Te.exec(e));)(u=r.index)>n&&(u=e.slice(n,u),o[s]?o[s]+=u:o[++s]=u),(i=i[0])===(r=r[0])?o[s]?o[s]+=r:o[++s]=r:(o[++s]=null,a.push({i:s,x:Ft(i,r)})),n=Te.lastIndex;return n<e.length&&(u=e.slice(n),o[s]?o[s]+=u:o[++s]=u),o.length<2?a[0]?is(a[0].x):ns(e):(e=a.length,function(h){for(var l=0,c;l<e;++l)o[(c=a[l]).i]=c.x(h);return o.join("")})}var zn=180/Math.PI,Ge={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function bi(t,e,n,i,r,u){var s,o,a;return(s=Math.sqrt(t*t+e*e))&&(t/=s,e/=s),(a=t*n+e*i)&&(n-=t*a,i-=e*a),(o=Math.sqrt(n*n+i*i))&&(n/=o,i/=o,a/=o),t*i<e*n&&(t=-t,e=-e,a=-a,s=-s),{translateX:r,translateY:u,rotate:Math.atan2(e,t)*zn,skewX:Math.atan(a)*zn,scaleX:s,scaleY:o}}var oe;function us(t){const e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?Ge:bi(e.a,e.b,e.c,e.d,e.e,e.f)}function ss(t){return t==null||(oe||(oe=document.createElementNS("http://www.w3.org/2000/svg","g")),oe.setAttribute("transform",t),!(t=oe.transform.baseVal.consolidate()))?Ge:(t=t.matrix,bi(t.a,t.b,t.c,t.d,t.e,t.f))}function Bi(t,e,n,i){function r(h){return h.length?h.pop()+" ":""}function u(h,l,c,f,d,m){if(h!==c||l!==f){var p=d.push("translate(",null,e,null,n);m.push({i:p-4,x:Ft(h,c)},{i:p-2,x:Ft(l,f)})}else(c||f)&&d.push("translate("+c+e+f+n)}function s(h,l,c,f){h!==l?(h-l>180?l+=360:l-h>180&&(h+=360),f.push({i:c.push(r(c)+"rotate(",null,i)-2,x:Ft(h,l)})):l&&c.push(r(c)+"rotate("+l+i)}function o(h,l,c,f){h!==l?f.push({i:c.push(r(c)+"skewX(",null,i)-2,x:Ft(h,l)}):l&&c.push(r(c)+"skewX("+l+i)}function a(h,l,c,f,d,m){if(h!==c||l!==f){var p=d.push(r(d)+"scale(",null,",",null,")");m.push({i:p-4,x:Ft(h,c)},{i:p-2,x:Ft(l,f)})}else(c!==1||f!==1)&&d.push(r(d)+"scale("+c+","+f+")")}return function(h,l){var c=[],f=[];return h=t(h),l=t(l),u(h.translateX,h.translateY,l.translateX,l.translateY,c,f),s(h.rotate,l.rotate,c,f),o(h.skewX,l.skewX,c,f),a(h.scaleX,h.scaleY,l.scaleX,l.scaleY,c,f),h=l=null,function(d){for(var m=-1,p=f.length,y;++m<p;)c[(y=f[m]).i]=y.x(d);return c.join("")}}}var os=Bi(us,"px, ","px)","deg)"),as=Bi(ss,", ",")",")"),ls=1e-12;function Pn(t){return((t=Math.exp(t))+1/t)/2}function hs(t){return((t=Math.exp(t))-1/t)/2}function cs(t){return((t=Math.exp(2*t))-1)/(t+1)}const fs=function t(e,n,i){function r(u,s){var o=u[0],a=u[1],h=u[2],l=s[0],c=s[1],f=s[2],d=l-o,m=c-a,p=d*d+m*m,y,v;if(p<ls)v=Math.log(f/h)/e,y=function(S){return[o+S*d,a+S*m,h*Math.exp(e*S*v)]};else{var b=Math.sqrt(p),A=(f*f-h*h+i*p)/(2*h*n*b),E=(f*f-h*h-i*p)/(2*f*n*b),_=Math.log(Math.sqrt(A*A+1)-A),w=Math.log(Math.sqrt(E*E+1)-E);v=(w-_)/e,y=function(S){var k=S*v,I=Pn(_),x=h/(n*b)*(I*cs(e*k+_)-hs(_));return[o+x*d,a+x*m,h*I/Pn(e*k+_)]}}return y.duration=v*1e3*e/Math.SQRT2,y}return r.rho=function(u){var s=Math.max(.001,+u),o=s*s,a=o*o;return t(s,o,a)},r}(Math.SQRT2,2,4);function Ii(t){return function e(n){n=+n;function i(r,u){var s=t((r=Bt(r)).h,(u=Bt(u)).h),o=Lt(r.s,u.s),a=Lt(r.l,u.l),h=Lt(r.opacity,u.opacity);return function(l){return r.h=s(l),r.s=o(l),r.l=a(Math.pow(l,n)),r.opacity=h(l),r+""}}return i.gamma=e,i}(1)}Ii(ts);var Si=Ii(Lt),Jt=0,Yt=0,Ht=0,Mi=1e3,Ce,Kt,Ee=0,Rt=0,Se=0,re=typeof performance=="object"&&performance.now?performance:Date,Ni=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function Dn(){return Rt||(Ni(ds),Rt=re.now()+Se)}function ds(){Rt=0}function _e(){this._call=this._time=this._next=null}_e.prototype=$i.prototype={constructor:_e,restart:function(t,e,n){if(typeof t!="function")throw new TypeError("callback is not a function");n=(n==null?Dn():+n)+(e==null?0:+e),!this._next&&Kt!==this&&(Kt?Kt._next=this:Ce=this,Kt=this),this._call=t,this._time=n,He()},stop:function(){this._call&&(this._call=null,this._time=1/0,He())}};function $i(t,e,n){var i=new _e;return i.restart(t,e,n),i}function ps(){Dn(),++Jt;for(var t=Ce,e;t;)(e=Rt-t._time)>=0&&t._call.call(null,e),t=t._next;--Jt}function Ln(){Rt=(Ee=re.now())+Se,Jt=Yt=0;try{ps()}finally{Jt=0,vs(),Rt=0}}function Ds(){var t=re.now(),e=t-Ee;e>Mi&&(Se-=e,Ee=t)}function vs(){for(var t,e=Ce,n,i=1/0;e;)e._call?(i>e._time&&(i=e._time),t=e,e=e._next):(n=e._next,e._next=null,e=t?t._next=n:Ce=n);Kt=t,He(i)}function He(t){if(!Jt){Yt&&(Yt=clearTimeout(Yt));var e=t-Rt;e>24?(t<1/0&&(Yt=setTimeout(Ln,t-re.now()-Se)),Ht&&(Ht=clearInterval(Ht))):(Ht||(Ee=re.now(),Ht=setInterval(Ds,Mi)),Jt=1,Ni(Ln))}}function qn(t,e,n){var i=new _e;return e=e==null?0:+e,i.restart(r=>{i.stop(),t(r+e)},e,n),i}var gs=an("start","end","cancel","interrupt"),ms=[],Ti=0,jn=1,Xe=2,de=3,Jn=4,We=5,pe=6;function Me(t,e,n,i,r,u){var s=t.__transition;if(!s)t.__transition={};else if(n in s)return;ys(t,n,{name:e,index:i,group:r,on:gs,tween:ms,time:u.time,delay:u.delay,duration:u.duration,ease:u.ease,timer:null,state:Ti})}function vn(t,e){var n=ft(t,e);if(n.state>Ti)throw new Error("too late; already scheduled");return n}function Dt(t,e){var n=ft(t,e);if(n.state>de)throw new Error("too late; already running");return n}function ft(t,e){var n=t.__transition;if(!n||!(n=n[e]))throw new Error("transition not found");return n}function ys(t,e,n){var i=t.__transition,r;i[e]=n,n.timer=$i(u,0,n.time);function u(h){n.state=jn,n.timer.restart(s,n.delay,n.time),n.delay<=h&&s(h-n.delay)}function s(h){var l,c,f,d;if(n.state!==jn)return a();for(l in i)if(d=i[l],d.name===n.name){if(d.state===de)return qn(s);d.state===Jn?(d.state=pe,d.timer.stop(),d.on.call("interrupt",t,t.__data__,d.index,d.group),delete i[l]):+l<e&&(d.state=pe,d.timer.stop(),d.on.call("cancel",t,t.__data__,d.index,d.group),delete i[l])}if(qn(function(){n.state===de&&(n.state=Jn,n.timer.restart(o,n.delay,n.time),o(h))}),n.state=Xe,n.on.call("start",t,t.__data__,n.index,n.group),n.state===Xe){for(n.state=de,r=new Array(f=n.tween.length),l=0,c=-1;l<f;++l)(d=n.tween[l].value.call(t,t.__data__,n.index,n.group))&&(r[++c]=d);r.length=c+1}}function o(h){for(var l=h<n.duration?n.ease.call(null,h/n.duration):(n.timer.restart(a),n.state=We,1),c=-1,f=r.length;++c<f;)r[c].call(t,l);n.state===We&&(n.on.call("end",t,t.__data__,n.index,n.group),a())}function a(){n.state=pe,n.timer.stop(),delete i[e];for(var h in i)return;delete t.__transition}}function De(t,e){var n=t.__transition,i,r,u=!0,s;if(n){e=e==null?null:e+"";for(s in n){if((i=n[s]).name!==e){u=!1;continue}r=i.state>Xe&&i.state<We,i.state=pe,i.timer.stop(),i.on.call(r?"interrupt":"cancel",t,t.__data__,i.index,i.group),delete n[s]}u&&delete t.__transition}}function Cs(t){return this.each(function(){De(this,t)})}function Es(t,e){var n,i;return function(){var r=Dt(this,t),u=r.tween;if(u!==n){i=n=u;for(var s=0,o=i.length;s<o;++s)if(i[s].name===e){i=i.slice(),i.splice(s,1);break}}r.tween=i}}function _s(t,e,n){var i,r;if(typeof n!="function")throw new Error;return function(){var u=Dt(this,t),s=u.tween;if(s!==i){r=(i=s).slice();for(var o={name:e,value:n},a=0,h=r.length;a<h;++a)if(r[a].name===e){r[a]=o;break}a===h&&r.push(o)}u.tween=r}}function As(t,e){var n=this._id;if(t+="",arguments.length<2){for(var i=ft(this.node(),n).tween,r=0,u=i.length,s;r<u;++r)if((s=i[r]).name===t)return s.value;return null}return this.each((e==null?Es:_s)(n,t,e))}function gn(t,e,n){var i=t._id;return t.each(function(){var r=Dt(this,i);(r.value||(r.value={}))[e]=n.apply(this,arguments)}),function(r){return ft(r,i).value[e]}}function Oi(t,e){var n;return(typeof e=="number"?Ft:e instanceof ne?Vn:(n=ne(e))?(e=n,Vn):rs)(t,e)}function ws(t){return function(){this.removeAttribute(t)}}function xs(t){return function(){this.removeAttributeNS(t.space,t.local)}}function Fs(t,e,n){var i,r=n+"",u;return function(){var s=this.getAttribute(t);return s===r?null:s===i?u:u=e(i=s,n)}}function bs(t,e,n){var i,r=n+"",u;return function(){var s=this.getAttributeNS(t.space,t.local);return s===r?null:s===i?u:u=e(i=s,n)}}function Bs(t,e,n){var i,r,u;return function(){var s,o=n(this),a;return o==null?void this.removeAttribute(t):(s=this.getAttribute(t),a=o+"",s===a?null:s===i&&a===r?u:(r=a,u=e(i=s,o)))}}function Is(t,e,n){var i,r,u;return function(){var s,o=n(this),a;return o==null?void this.removeAttributeNS(t.space,t.local):(s=this.getAttributeNS(t.space,t.local),a=o+"",s===a?null:s===i&&a===r?u:(r=a,u=e(i=s,o)))}}function Ss(t,e){var n=be(t),i=n==="transform"?as:Oi;return this.attrTween(t,typeof e=="function"?(n.local?Is:Bs)(n,i,gn(this,"attr."+t,e)):e==null?(n.local?xs:ws)(n):(n.local?bs:Fs)(n,i,e))}function Ms(t,e){return function(n){this.setAttribute(t,e.call(this,n))}}function Ns(t,e){return function(n){this.setAttributeNS(t.space,t.local,e.call(this,n))}}function $s(t,e){var n,i;function r(){var u=e.apply(this,arguments);return u!==i&&(n=(i=u)&&Ns(t,u)),n}return r._value=e,r}function Ts(t,e){var n,i;function r(){var u=e.apply(this,arguments);return u!==i&&(n=(i=u)&&Ms(t,u)),n}return r._value=e,r}function Os(t,e){var n="attr."+t;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(e==null)return this.tween(n,null);if(typeof e!="function")throw new Error;var i=be(t);return this.tween(n,(i.local?$s:Ts)(i,e))}function ks(t,e){return function(){vn(this,t).delay=+e.apply(this,arguments)}}function Rs(t,e){return e=+e,function(){vn(this,t).delay=e}}function Vs(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?ks:Rs)(e,t)):ft(this.node(),e).delay}function zs(t,e){return function(){Dt(this,t).duration=+e.apply(this,arguments)}}function Ps(t,e){return e=+e,function(){Dt(this,t).duration=e}}function Ls(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?zs:Ps)(e,t)):ft(this.node(),e).duration}function qs(t,e){if(typeof e!="function")throw new Error;return function(){Dt(this,t).ease=e}}function js(t){var e=this._id;return arguments.length?this.each(qs(e,t)):ft(this.node(),e).ease}function Js(t,e){return function(){var n=e.apply(this,arguments);if(typeof n!="function")throw new Error;Dt(this,t).ease=n}}function Us(t){if(typeof t!="function")throw new Error;return this.each(Js(this._id,t))}function Gs(t){typeof t!="function"&&(t=di(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var u=e[r],s=u.length,o=i[r]=[],a,h=0;h<s;++h)(a=u[h])&&t.call(a,a.__data__,h,u)&&o.push(a);return new At(i,this._parents,this._name,this._id)}function Hs(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,n=t._groups,i=e.length,r=n.length,u=Math.min(i,r),s=new Array(i),o=0;o<u;++o)for(var a=e[o],h=n[o],l=a.length,c=s[o]=new Array(l),f,d=0;d<l;++d)(f=a[d]||h[d])&&(c[d]=f);for(;o<i;++o)s[o]=e[o];return new At(s,this._parents,this._name,this._id)}function Xs(t){return(t+"").trim().split(/^|\s+/).every(function(e){var n=e.indexOf(".");return n>=0&&(e=e.slice(0,n)),!e||e==="start"})}function Ws(t,e,n){var i,r,u=Xs(e)?vn:Dt;return function(){var s=u(this,t),o=s.on;o!==i&&(r=(i=o).copy()).on(e,n),s.on=r}}function Ys(t,e){var n=this._id;return arguments.length<2?ft(this.node(),n).on.on(t):this.each(Ws(n,t,e))}function Ks(t){return function(){var e=this.parentNode;for(var n in this.__transition)if(+n!==t)return;e&&e.removeChild(this)}}function Zs(){return this.on("end.remove",Ks(this._id))}function Qs(t){var e=this._name,n=this._id;typeof t!="function"&&(t=ln(t));for(var i=this._groups,r=i.length,u=new Array(r),s=0;s<r;++s)for(var o=i[s],a=o.length,h=u[s]=new Array(a),l,c,f=0;f<a;++f)(l=o[f])&&(c=t.call(l,l.__data__,f,o))&&("__data__"in l&&(c.__data__=l.__data__),h[f]=c,Me(h[f],e,n,f,h,ft(l,n)));return new At(u,this._parents,e,n)}function to(t){var e=this._name,n=this._id;typeof t!="function"&&(t=fi(t));for(var i=this._groups,r=i.length,u=[],s=[],o=0;o<r;++o)for(var a=i[o],h=a.length,l,c=0;c<h;++c)if(l=a[c]){for(var f=t.call(l,l.__data__,c,a),d,m=ft(l,n),p=0,y=f.length;p<y;++p)(d=f[p])&&Me(d,e,n,p,f,m);u.push(f),s.push(l)}return new At(u,s,e,n)}var eo=ue.prototype.constructor;function no(){return new eo(this._groups,this._parents)}function io(t,e){var n,i,r;return function(){var u=qt(this,t),s=(this.style.removeProperty(t),qt(this,t));return u===s?null:u===n&&s===i?r:r=e(n=u,i=s)}}function ki(t){return function(){this.style.removeProperty(t)}}function ro(t,e,n){var i,r=n+"",u;return function(){var s=qt(this,t);return s===r?null:s===i?u:u=e(i=s,n)}}function uo(t,e,n){var i,r,u;return function(){var s=qt(this,t),o=n(this),a=o+"";return o==null&&(a=o=(this.style.removeProperty(t),qt(this,t))),s===a?null:s===i&&a===r?u:(r=a,u=e(i=s,o))}}function so(t,e){var n,i,r,u="style."+e,s="end."+u,o;return function(){var a=Dt(this,t),h=a.on,l=a.value[u]==null?o||(o=ki(e)):void 0;(h!==n||r!==l)&&(i=(n=h).copy()).on(s,r=l),a.on=i}}function oo(t,e,n){var i=(t+="")=="transform"?os:Oi;return e==null?this.styleTween(t,io(t,i)).on("end.style."+t,ki(t)):typeof e=="function"?this.styleTween(t,uo(t,i,gn(this,"style."+t,e))).each(so(this._id,t)):this.styleTween(t,ro(t,i,e),n).on("end.style."+t,null)}function ao(t,e,n){return function(i){this.style.setProperty(t,e.call(this,i),n)}}function lo(t,e,n){var i,r;function u(){var s=e.apply(this,arguments);return s!==r&&(i=(r=s)&&ao(t,s,n)),i}return u._value=e,u}function ho(t,e,n){var i="style."+(t+="");if(arguments.length<2)return(i=this.tween(i))&&i._value;if(e==null)return this.tween(i,null);if(typeof e!="function")throw new Error;return this.tween(i,lo(t,e,n??""))}function co(t){return function(){this.textContent=t}}function fo(t){return function(){var e=t(this);this.textContent=e??""}}function po(t){return this.tween("text",typeof t=="function"?fo(gn(this,"text",t)):co(t==null?"":t+""))}function Do(t){return function(e){this.textContent=t.call(this,e)}}function vo(t){var e,n;function i(){var r=t.apply(this,arguments);return r!==n&&(e=(n=r)&&Do(r)),e}return i._value=t,i}function go(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(t==null)return this.tween(e,null);if(typeof t!="function")throw new Error;return this.tween(e,vo(t))}function mo(){for(var t=this._name,e=this._id,n=Ri(),i=this._groups,r=i.length,u=0;u<r;++u)for(var s=i[u],o=s.length,a,h=0;h<o;++h)if(a=s[h]){var l=ft(a,e);Me(a,t,n,h,s,{time:l.time+l.delay+l.duration,delay:0,duration:l.duration,ease:l.ease})}return new At(i,this._parents,t,n)}function yo(){var t,e,n=this,i=n._id,r=n.size();return new Promise(function(u,s){var o={value:s},a={value:function(){--r===0&&u()}};n.each(function(){var h=Dt(this,i),l=h.on;l!==t&&(e=(t=l).copy(),e._.cancel.push(o),e._.interrupt.push(o),e._.end.push(a)),h.on=e}),r===0&&u()})}var Co=0;function At(t,e,n,i){this._groups=t,this._parents=e,this._name=n,this._id=i}function Ri(){return++Co}var Mt=ue.prototype;At.prototype={constructor:At,select:Qs,selectAll:to,filter:Gs,merge:Hs,selection:no,transition:mo,call:Mt.call,nodes:Mt.nodes,node:Mt.node,size:Mt.size,empty:Mt.empty,each:Mt.each,on:Ys,attr:Ss,attrTween:Os,style:oo,styleTween:ho,text:po,textTween:go,remove:Zs,tween:As,delay:Vs,duration:Ls,ease:js,easeVarying:Us,end:yo,[Symbol.iterator]:Mt[Symbol.iterator]};function Eo(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}var _o={time:null,delay:0,duration:250,ease:Eo};function Ao(t,e){for(var n;!(n=t.__transition)||!(n=n[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return n}function wo(t){var e,n;t instanceof At?(e=t._id,t=t._name):(e=Ri(),(n=_o).time=Dn(),t=t==null?null:t+"");for(var i=this._groups,r=i.length,u=0;u<r;++u)for(var s=i[u],o=s.length,a,h=0;h<o;++h)(a=s[h])&&Me(a,t,e,h,s,n||Ao(a,e));return new At(i,this._parents,t,e)}ue.prototype.interrupt=Cs;ue.prototype.transition=wo;const Ye=Math.PI,Ke=2*Ye,Tt=1e-6,xo=Ke-Tt;function Ze(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function Vi(){return new Ze}Ze.prototype=Vi.prototype={constructor:Ze,moveTo:function(t,e){this._+="M"+(this._x0=this._x1=+t)+","+(this._y0=this._y1=+e)},closePath:function(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(t,e){this._+="L"+(this._x1=+t)+","+(this._y1=+e)},quadraticCurveTo:function(t,e,n,i){this._+="Q"+ +t+","+ +e+","+(this._x1=+n)+","+(this._y1=+i)},bezierCurveTo:function(t,e,n,i,r,u){this._+="C"+ +t+","+ +e+","+ +n+","+ +i+","+(this._x1=+r)+","+(this._y1=+u)},arcTo:function(t,e,n,i,r){t=+t,e=+e,n=+n,i=+i,r=+r;var u=this._x1,s=this._y1,o=n-t,a=i-e,h=u-t,l=s-e,c=h*h+l*l;if(r<0)throw new Error("negative radius: "+r);if(this._x1===null)this._+="M"+(this._x1=t)+","+(this._y1=e);else if(c>Tt)if(!(Math.abs(l*o-a*h)>Tt)||!r)this._+="L"+(this._x1=t)+","+(this._y1=e);else{var f=n-u,d=i-s,m=o*o+a*a,p=f*f+d*d,y=Math.sqrt(m),v=Math.sqrt(c),b=r*Math.tan((Ye-Math.acos((m+c-p)/(2*y*v)))/2),A=b/v,E=b/y;Math.abs(A-1)>Tt&&(this._+="L"+(t+A*h)+","+(e+A*l)),this._+="A"+r+","+r+",0,0,"+ +(l*f>h*d)+","+(this._x1=t+E*o)+","+(this._y1=e+E*a)}},arc:function(t,e,n,i,r,u){t=+t,e=+e,n=+n,u=!!u;var s=n*Math.cos(i),o=n*Math.sin(i),a=t+s,h=e+o,l=1^u,c=u?i-r:r-i;if(n<0)throw new Error("negative radius: "+n);this._x1===null?this._+="M"+a+","+h:(Math.abs(this._x1-a)>Tt||Math.abs(this._y1-h)>Tt)&&(this._+="L"+a+","+h),n&&(c<0&&(c=c%Ke+Ke),c>xo?this._+="A"+n+","+n+",0,1,"+l+","+(t-s)+","+(e-o)+"A"+n+","+n+",0,1,"+l+","+(this._x1=a)+","+(this._y1=h):c>Tt&&(this._+="A"+n+","+n+",0,"+ +(c>=Ye)+","+l+","+(this._x1=t+n*Math.cos(r))+","+(this._y1=e+n*Math.sin(r))))},rect:function(t,e,n,i){this._+="M"+(this._x0=this._x1=+t)+","+(this._y0=this._y1=+e)+"h"+ +n+"v"+ +i+"h"+-n+"Z"},toString:function(){return this._}};Si(Bt(-100,.75,.35),Bt(80,1.5,.8));Si(Bt(260,.75,.35),Bt(80,1.5,.8));var ae=Bt();function Fo(t){(t<0||t>1)&&(t-=Math.floor(t));var e=Math.abs(t-.5);return ae.h=360*t-100,ae.s=1.5-1.5*e,ae.l=.8-.9*e,ae+""}function zt(t){return function(){return t}}var Un=1e-12;function bo(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function zi(t){this._context=t}zi.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;default:this._context.lineTo(t,e);break}}};function Bo(t){return new zi(t)}function Io(t){return t[0]}function So(t){return t[1]}function Mo(t,e){var n=zt(!0),i=null,r=Bo,u=null;t=typeof t=="function"?t:t===void 0?Io:zt(t),e=typeof e=="function"?e:e===void 0?So:zt(e);function s(o){var a,h=(o=bo(o)).length,l,c=!1,f;for(i==null&&(u=r(f=Vi())),a=0;a<=h;++a)!(a<h&&n(l=o[a],a,o))===c&&((c=!c)?u.lineStart():u.lineEnd()),c&&u.point(+t(l,a,o),+e(l,a,o));if(f)return u=null,f+""||null}return s.x=function(o){return arguments.length?(t=typeof o=="function"?o:zt(+o),s):t},s.y=function(o){return arguments.length?(e=typeof o=="function"?o:zt(+o),s):e},s.defined=function(o){return arguments.length?(n=typeof o=="function"?o:zt(!!o),s):n},s.curve=function(o){return arguments.length?(r=o,i!=null&&(u=r(i)),s):r},s.context=function(o){return arguments.length?(o==null?i=u=null:u=r(i=o),s):i},s}function Gn(t,e,n){t._context.bezierCurveTo(t._x1+t._k*(t._x2-t._x0),t._y1+t._k*(t._y2-t._y0),t._x2+t._k*(t._x1-e),t._y2+t._k*(t._y1-n),t._x2,t._y2)}function mn(t,e){this._context=t,this._k=(1-e)/6}mn.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:Gn(this,this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2,this._x1=t,this._y1=e;break;case 2:this._point=3;default:Gn(this,t,e);break}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};(function t(e){function n(i){return new mn(i,e)}return n.tension=function(i){return t(+i)},n})(0);function No(t,e,n){var i=t._x1,r=t._y1,u=t._x2,s=t._y2;if(t._l01_a>Un){var o=2*t._l01_2a+3*t._l01_a*t._l12_a+t._l12_2a,a=3*t._l01_a*(t._l01_a+t._l12_a);i=(i*o-t._x0*t._l12_2a+t._x2*t._l01_2a)/a,r=(r*o-t._y0*t._l12_2a+t._y2*t._l01_2a)/a}if(t._l23_a>Un){var h=2*t._l23_2a+3*t._l23_a*t._l12_a+t._l12_2a,l=3*t._l23_a*(t._l23_a+t._l12_a);u=(u*h+t._x1*t._l23_2a-e*t._l12_2a)/l,s=(s*h+t._y1*t._l23_2a-n*t._l12_2a)/l}t._context.bezierCurveTo(i,r,u,s,t._x2,t._y2)}function Pi(t,e){this._context=t,this._alpha=e}Pi.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:this.point(this._x2,this._y2);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){if(t=+t,e=+e,this._point){var n=this._x2-t,i=this._y2-e;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+i*i,this._alpha))}switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3;default:No(this,t,e);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};const $o=function t(e){function n(i){return e?new Pi(i,e):new mn(i,0)}return n.alpha=function(i){return t(+i)},n}(.5),le=t=>()=>t;function To(t,{sourceEvent:e,target:n,transform:i,dispatch:r}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:i,enumerable:!0,configurable:!0},_:{value:r}})}function Et(t,e,n){this.k=t,this.x=e,this.y=n}Et.prototype={constructor:Et,scale:function(t){return t===1?this:new Et(this.k*t,this.x,this.y)},translate:function(t,e){return t===0&e===0?this:new Et(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var yn=new Et(1,0,0);Et.prototype;function Oe(t){t.stopImmediatePropagation()}function Xt(t){t.preventDefault(),t.stopImmediatePropagation()}function Oo(t){return(!t.ctrlKey||t.type==="wheel")&&!t.button}function ko(){var t=this;return t instanceof SVGElement?(t=t.ownerSVGElement||t,t.hasAttribute("viewBox")?(t=t.viewBox.baseVal,[[t.x,t.y],[t.x+t.width,t.y+t.height]]):[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]):[[0,0],[t.clientWidth,t.clientHeight]]}function Hn(){return this.__zoom||yn}function Ro(t){return-t.deltaY*(t.deltaMode===1?.05:t.deltaMode?1:.002)*(t.ctrlKey?10:1)}function Vo(){return navigator.maxTouchPoints||"ontouchstart"in this}function zo(t,e,n){var i=t.invertX(e[0][0])-n[0][0],r=t.invertX(e[1][0])-n[1][0],u=t.invertY(e[0][1])-n[0][1],s=t.invertY(e[1][1])-n[1][1];return t.translate(r>i?(i+r)/2:Math.min(0,i)||Math.max(0,r),s>u?(u+s)/2:Math.min(0,u)||Math.max(0,s))}function Po(){var t=Oo,e=ko,n=zo,i=Ro,r=Vo,u=[0,1/0],s=[[-1/0,-1/0],[1/0,1/0]],o=250,a=fs,h=an("start","zoom","end"),l,c,f,d=500,m=150,p=0,y=10;function v(g){g.property("__zoom",Hn).on("wheel.zoom",k).on("mousedown.zoom",I).on("dblclick.zoom",x).filter(r).on("touchstart.zoom",M).on("touchmove.zoom",P).on("touchend.zoom touchcancel.zoom",G).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}v.transform=function(g,B,C,R){var T=g.selection?g.selection():g;T.property("__zoom",Hn),g!==T?_(g,B,C,R):T.interrupt().each(function(){w(this,arguments).event(R).start().zoom(null,typeof B=="function"?B.apply(this,arguments):B).end()})},v.scaleBy=function(g,B,C,R){v.scaleTo(g,function(){var T=this.__zoom.k,O=typeof B=="function"?B.apply(this,arguments):B;return T*O},C,R)},v.scaleTo=function(g,B,C,R){v.transform(g,function(){var T=e.apply(this,arguments),O=this.__zoom,N=C==null?E(T):typeof C=="function"?C.apply(this,arguments):C,L=O.invert(N),J=typeof B=="function"?B.apply(this,arguments):B;return n(A(b(O,J),N,L),T,s)},C,R)},v.translateBy=function(g,B,C,R){v.transform(g,function(){return n(this.__zoom.translate(typeof B=="function"?B.apply(this,arguments):B,typeof C=="function"?C.apply(this,arguments):C),e.apply(this,arguments),s)},null,R)},v.translateTo=function(g,B,C,R,T){v.transform(g,function(){var O=e.apply(this,arguments),N=this.__zoom,L=R==null?E(O):typeof R=="function"?R.apply(this,arguments):R;return n(yn.translate(L[0],L[1]).scale(N.k).translate(typeof B=="function"?-B.apply(this,arguments):-B,typeof C=="function"?-C.apply(this,arguments):-C),O,s)},R,T)};function b(g,B){return B=Math.max(u[0],Math.min(u[1],B)),B===g.k?g:new Et(B,g.x,g.y)}function A(g,B,C){var R=B[0]-C[0]*g.k,T=B[1]-C[1]*g.k;return R===g.x&&T===g.y?g:new Et(g.k,R,T)}function E(g){return[(+g[0][0]+ +g[1][0])/2,(+g[0][1]+ +g[1][1])/2]}function _(g,B,C,R){g.on("start.zoom",function(){w(this,arguments).event(R).start()}).on("interrupt.zoom end.zoom",function(){w(this,arguments).event(R).end()}).tween("zoom",function(){var T=this,O=arguments,N=w(T,O).event(R),L=e.apply(T,O),J=C==null?E(L):typeof C=="function"?C.apply(T,O):C,it=Math.max(L[1][0]-L[0][0],L[1][1]-L[0][1]),Q=T.__zoom,ut=typeof B=="function"?B.apply(T,O):B,ht=a(Q.invert(J).concat(it/Q.k),ut.invert(J).concat(it/ut.k));return function(st){if(st===1)st=ut;else{var lt=ht(st),D=it/lt[2];st=new Et(D,J[0]-lt[0]*D,J[1]-lt[1]*D)}N.zoom(null,st)}})}function w(g,B,C){return!C&&g.__zooming||new S(g,B)}function S(g,B){this.that=g,this.args=B,this.active=0,this.sourceEvent=null,this.extent=e.apply(g,B),this.taps=0}S.prototype={event:function(g){return g&&(this.sourceEvent=g),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(g,B){return this.mouse&&g!=="mouse"&&(this.mouse[1]=B.invert(this.mouse[0])),this.touch0&&g!=="touch"&&(this.touch0[1]=B.invert(this.touch0[0])),this.touch1&&g!=="touch"&&(this.touch1[1]=B.invert(this.touch1[0])),this.that.__zoom=B,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(g){var B=yt(this.that).datum();h.call(g,this.that,new To(g,{sourceEvent:this.sourceEvent,target:v,type:g,transform:this.that.__zoom,dispatch:h}),B)}};function k(g,...B){if(!t.apply(this,arguments))return;var C=w(this,B).event(g),R=this.__zoom,T=Math.max(u[0],Math.min(u[1],R.k*Math.pow(2,i.apply(this,arguments)))),O=St(g);if(C.wheel)(C.mouse[0][0]!==O[0]||C.mouse[0][1]!==O[1])&&(C.mouse[1]=R.invert(C.mouse[0]=O)),clearTimeout(C.wheel);else{if(R.k===T)return;C.mouse=[O,R.invert(O)],De(this),C.start()}Xt(g),C.wheel=setTimeout(N,m),C.zoom("mouse",n(A(b(R,T),C.mouse[0],C.mouse[1]),C.extent,s));function N(){C.wheel=null,C.end()}}function I(g,...B){if(f||!t.apply(this,arguments))return;var C=w(this,B,!0).event(g),R=yt(g.view).on("mousemove.zoom",J,!0).on("mouseup.zoom",it,!0),T=St(g,O),O=g.currentTarget,N=g.clientX,L=g.clientY;zu(g.view),Oe(g),C.mouse=[T,this.__zoom.invert(T)],De(this),C.start();function J(Q){if(Xt(Q),!C.moved){var ut=Q.clientX-N,ht=Q.clientY-L;C.moved=ut*ut+ht*ht>p}C.event(Q).zoom("mouse",n(A(C.that.__zoom,C.mouse[0]=St(Q,O),C.mouse[1]),C.extent,s))}function it(Q){R.on("mousemove.zoom mouseup.zoom",null),Pu(Q.view,C.moved),Xt(Q),C.event(Q).end()}}function x(g,...B){if(t.apply(this,arguments)){var C=this.__zoom,R=St(g.changedTouches?g.changedTouches[0]:g,this),T=C.invert(R),O=C.k*(g.shiftKey?.5:2),N=n(A(b(C,O),R,T),e.apply(this,B),s);Xt(g),o>0?yt(this).transition().duration(o).call(_,N,R,g):yt(this).call(v.transform,N,R,g)}}function M(g,...B){if(t.apply(this,arguments)){var C=g.touches,R=C.length,T=w(this,B,g.changedTouches.length===R).event(g),O,N,L,J;for(Oe(g),N=0;N<R;++N)L=C[N],J=St(L,this),J=[J,this.__zoom.invert(J),L.identifier],T.touch0?!T.touch1&&T.touch0[2]!==J[2]&&(T.touch1=J,T.taps=0):(T.touch0=J,O=!0,T.taps=1+!!l);l&&(l=clearTimeout(l)),O&&(T.taps<2&&(c=J[0],l=setTimeout(function(){l=null},d)),De(this),T.start())}}function P(g,...B){if(this.__zooming){var C=w(this,B).event(g),R=g.changedTouches,T=R.length,O,N,L,J;for(Xt(g),O=0;O<T;++O)N=R[O],L=St(N,this),C.touch0&&C.touch0[2]===N.identifier?C.touch0[0]=L:C.touch1&&C.touch1[2]===N.identifier&&(C.touch1[0]=L);if(N=C.that.__zoom,C.touch1){var it=C.touch0[0],Q=C.touch0[1],ut=C.touch1[0],ht=C.touch1[1],st=(st=ut[0]-it[0])*st+(st=ut[1]-it[1])*st,lt=(lt=ht[0]-Q[0])*lt+(lt=ht[1]-Q[1])*lt;N=b(N,Math.sqrt(st/lt)),L=[(it[0]+ut[0])/2,(it[1]+ut[1])/2],J=[(Q[0]+ht[0])/2,(Q[1]+ht[1])/2]}else if(C.touch0)L=C.touch0[0],J=C.touch0[1];else return;C.zoom("touch",n(A(N,L,J),C.extent,s))}}function G(g,...B){if(this.__zooming){var C=w(this,B).event(g),R=g.changedTouches,T=R.length,O,N;for(Oe(g),f&&clearTimeout(f),f=setTimeout(function(){f=null},d),O=0;O<T;++O)N=R[O],C.touch0&&C.touch0[2]===N.identifier?delete C.touch0:C.touch1&&C.touch1[2]===N.identifier&&delete C.touch1;if(C.touch1&&!C.touch0&&(C.touch0=C.touch1,delete C.touch1),C.touch0)C.touch0[1]=this.__zoom.invert(C.touch0[0]);else if(C.end(),C.taps===2&&(N=St(N,this),Math.hypot(c[0]-N[0],c[1]-N[1])<y)){var L=yt(this).on("dblclick.zoom");L&&L.apply(this,arguments)}}}return v.wheelDelta=function(g){return arguments.length?(i=typeof g=="function"?g:le(+g),v):i},v.filter=function(g){return arguments.length?(t=typeof g=="function"?g:le(!!g),v):t},v.touchable=function(g){return arguments.length?(r=typeof g=="function"?g:le(!!g),v):r},v.extent=function(g){return arguments.length?(e=typeof g=="function"?g:le([[+g[0][0],+g[0][1]],[+g[1][0],+g[1][1]]]),v):e},v.scaleExtent=function(g){return arguments.length?(u[0]=+g[0],u[1]=+g[1],v):[u[0],u[1]]},v.translateExtent=function(g){return arguments.length?(s[0][0]=+g[0][0],s[1][0]=+g[1][0],s[0][1]=+g[0][1],s[1][1]=+g[1][1],v):[[s[0][0],s[0][1]],[s[1][0],s[1][1]]]},v.constrain=function(g){return arguments.length?(n=g,v):n},v.duration=function(g){return arguments.length?(o=+g,v):o},v.interpolate=function(g){return arguments.length?(a=g,v):a},v.on=function(){var g=h.on.apply(h,arguments);return g===h?v:g},v.clickDistance=function(g){return arguments.length?(p=(g=+g)*g,v):Math.sqrt(p)},v.tapDistance=function(g){return arguments.length?(y=+g,v):y},v}class Xn{constructor(e){this.base=e}[Symbol.iterator](){return this.base[Symbol.iterator]()}concat(...e){return Z(function*(n){for(const i of n)yield*i}([this,...e.map(Z)]))}entries(){return Z(function*(e){let n=0;for(const i of e)yield[n++,i]}(this))}every(e){return!this.some((n,i)=>!e(n,i))}fill(e){return this.map(()=>e)}filter(e){return Z(function*(n){for(const[i,r]of n)e(r,i)&&(yield r)}(this.entries()))}find(e){for(const[n,i]of this.entries())if(e(i,n))return i}findIndex(e){for(const[n,i]of this.entries())if(e(i,n))return n;return-1}flatMap(e){return Z(function*(n){for(const[i,r]of n)yield*Z(e(r,i))}(this.entries()))}forEach(e){for(const[n,i]of this.entries())e(i,n)}includes(e,n=0){return this.indexOf(e,n)>=0}indexOf(e,n=0){if(n<0)throw new Error("fromIndex doesn't support negative numbers because generator length isn't known");for(const[i,r]of this.entries())if(i>=n&&r===e)return i;return-1}join(e=","){return[...this].join(e)}keys(){return Z(function*(e){let n=0;for(const i of e)yield n++}(this))}lastIndexOf(e,n=1/0){if(n<0)throw new Error("fromIndex doesn't support negative numbers because generator length isn't known");let i=-1;for(const[r,u]of this.entries())r<=n&&u===e&&(i=r);return i}get length(){return this.reduce(e=>e+1,0)}map(e){return Z(function*(n){for(const[i,r]of n)yield e(r,i)}(this.entries()))}reduce(e,n){if(n===void 0){const i=e;let r=!0,u;for(const[s,o]of this.entries())r?(u=o,r=!1):u=i(u,o,s);if(r)throw new TypeError("Reduce of empty iterable with no initial value");return u}else{const i=e;let r=n;for(const[u,s]of this.entries())r=i(r,s,u);return r}}reverse(){return Z([...this].reverse())}slice(e=0,n=1/0){return Z(function*(i){for(const[r,u]of i)if(!(r<e))if(r<n)yield u;else break}(this.entries()))}some(e){for(const[n,i]of this.entries())if(e(i,n))return!0;return!1}sort(e){return Z([...this].sort(e))}splice(e,n=0,...i){return Z(function*(r){for(const[u,s]of r)u===e&&(yield*i),(u<e||u>=e+n)&&(yield s)}(this.entries()))}values(){return this}}function Lo(t){return typeof t[Symbol.iterator]=="function"}function Z(t){return Lo(t)?new Xn(t):new Xn({[Symbol.iterator]:()=>t})}function Qe(t){if(t!==void 0)return t;throw new Error("got unexpected undefined value")}function Li(t,e){e.size<t.size&&([e,t]=[t,e]);for(const n of t)if(e.has(n))return!0;return!1}class at extends Map{getThrow(e){const n=this.get(e);if(n===void 0)throw new Error(`map doesn't contain key: ${e}`);return n}getDefault(e,n){const i=this.get(e);return i===void 0?n:i}setIfAbsent(e,n){const i=this.get(e);return i===void 0?(this.set(e,n),n):i}}class ve{constructor(e,n,i=[]){this.child=e,this.data=n,this.points=i}}class qo{constructor(e,n,i,r){this.source=e,this.target=n,this.data=i,this.points=r}}class qi{constructor(e,n){this.id=e,this.data=n,this.dataChildren=[]}iroots(){return Z([this])}roots(){return[this]}*iterChildren(){for(const{child:e}of this.dataChildren)yield e}ichildren(){return Z(this.iterChildren())}children(){return[...this.ichildren()]}*iterChildLinks(){for(const{child:e,data:n,points:i}of this.dataChildren)yield new qo(this,e,n,i)}ichildLinks(){return Z(this.iterChildLinks())}childLinks(){return[...this.ichildLinks()]}[Symbol.iterator](){return new ot([this])[Symbol.iterator]()}idescendants(e="depth"){return new ot([this]).idescendants(e)}descendants(e="depth"){return[...this.idescendants(e)]}ilinks(){return new ot([this]).ilinks()}links(){return[...this.ilinks()]}size(){return new ot([this]).size()}sum(e){return new ot([this]).sum(e),this}count(){return new ot([this]).count(),this}height(){return new ot([this]).height(),this}depth(){return new ot([this]).depth(),this}split(){return[this]}connected(){return!0}}class ot{constructor(e){this.dagRoots=e}[Symbol.iterator](){return this.idepth()}iroots(){return Z(this.dagRoots)}roots(){return this.dagRoots.slice()}*idepth(){const e=this.roots(),n=new Set;let i;for(;i=e.pop();)n.has(i.id)||(n.add(i.id),yield i,e.push(...i.ichildren()))}*ibreadth(){const e=new Set;let n=this.roots(),i=[];do{i=n.reverse(),n=[];let r;for(;r=i.pop();)e.has(r.id)||(e.add(r.id),yield r,n.push(...r.ichildren()))}while(n.length)}*ibefore(){const e=new at;for(const r of this)for(const u of r.ichildren())e.set(u.id,e.getDefault(u.id,0)+1);const n=this.roots();let i;for(;i=n.pop();){yield i;for(const r of i.ichildren()){const u=e.getThrow(r.id);u>1?e.set(r.id,u-1):n.push(r)}}}*iafter(){const e=this.roots(),n=new Set;let i;for(;i=e.pop();)n.has(i.id)||(i.ichildren().every(r=>n.has(r.id))?(n.add(i.id),yield i):(e.push(i),e.push(...i.ichildren())))}idescendants(e="depth"){if(e==="depth")return Z(this.idepth());if(e==="breadth")return Z(this.ibreadth());if(e==="before")return Z(this.ibefore());if(e==="after")return Z(this.iafter());throw new Error(`unknown iteration style: ${e}`)}descendants(e="depth"){return[...this.idescendants(e)]}ilinks(){return this.idescendants().flatMap(e=>e.ichildLinks())}links(){return[...this.ilinks()]}size(){return this.idescendants().reduce(e=>e+1,0)}sum(e){const n=new at;for(const[i,r]of this.idescendants("after").entries()){const u=e(r,i),s=new at;s.set(r.id,u);for(const o of r.ichildren()){const a=n.getThrow(o.id);for(const[h,l]of a.entries())s.set(h,l)}r.value=Z(s.entries()).map(([,o])=>o).reduce((o,a)=>o+a),n.set(r.id,s)}return this}count(){const e=new at;for(const n of this.idescendants("after"))if(n.ichildren()[Symbol.iterator]().next().done)e.set(n.id,new Set([n.id])),n.value=1;else{const i=new Set;for(const r of n.ichildren()){const u=e.getThrow(r.id);for(const s of u)i.add(s)}e.set(n.id,i),n.value=i.size}return this}height(){for(const e of this.idescendants("after"))e.value=Math.max(0,...e.ichildren().map(n=>{if(n.value===void 0)throw new Error("`after` iteration didn't iterate in after order");return n.value+1}));return this}depth(){const e=new at;for(const n of this)for(const i of n.ichildren())e.setIfAbsent(i.id,[]).push(n);for(const n of this.idescendants("before"))n.value=Math.max(0,...e.getDefault(n.id,[]).map(i=>{if(i.value===void 0)throw new Error("`before` iteration didn't iterate in before order");return i.value+1}));return this}split(){const e=new at,n=new at;for(const u of this.iroots())e.set(u.id,[]),n.set(u.id,new Set(u.idescendants().map(s=>s.id)));for(const[u,s]of this.iroots().entries()){const o=n.getThrow(s.id);for(const a of this.iroots().slice(u+1)){const h=n.getThrow(a.id);Li(o,h)&&(e.getThrow(s.id).push(a),e.getThrow(a.id).push(s))}}const i=[],r=new Set;for(const u of this.iroots())if(!r.has(u.id)){r.add(u.id);const s=[u];i.push(s);const o=e.getThrow(u.id).slice();let a;for(;a=o.pop();)r.has(a.id)||(r.add(a.id),s.push(a),o.push(...e.getThrow(a.id)))}return i.map(u=>u.length>1?new ot(u):u[0])}connected(){return this.split().length===1}}function jo(t){if(typeof t!="string")throw new Error(`id is supposed to be string but got type ${typeof t}`);if(t.indexOf("\0")>=0)throw new Error(`node id ${t} contained null character`);return t}function Jo(t){if(!t.length)throw new Error("dag contained no roots");const e=new Set,n=new Set;let i=null;function r(u){if(e.has(u.id))return[];if(n.has(u.id))return i=u.id,[u.id];{n.add(u.id);let s=[];for(const o of u.ichildren())if(s=r(o),s.length)break;return n.delete(u.id),e.add(u.id),s.length&&i!==null&&s.push(u.id),i===u.id&&(i=null),s}}for(const u of t){const s=r(u);if(s.length)throw new Error("dag contained a cycle: "+s.reverse().join(" -> "))}for(const u of new ot(t))if(new Set(u.ichildren().map(o=>o.id)).size!==u.dataChildren.length)throw new Error(`node '${u.id}' contained duplicate children`)}function ge(t,e,n){function i(o){if(!o.length)throw new Error("can't stratify empty data");const a=o.map((c,f)=>new qi(jo(t(c,f)),c)),h=new Map;a.forEach(c=>{if(h.has(c.id))throw new Error(`found a duplicate id: ${c.id}`);h.set(c.id,c)});const l=[];return a.forEach((c,f)=>{const d=n(c.data,f)||[];d.forEach(([m,p])=>{const y=h.get(m);if(!y)throw new Error(`missing id: ${m}`);return y.dataChildren.push(new ve(c,p)),y}),d.length||l.push(c)}),Jo(l),l.length>1?new ot(l):l[0]}function r(o){return o===void 0?t:ge(o,e,n)}i.id=r;function u(o){return o===void 0?n:ge(t,Uo(o),o)}i.parentData=u;function s(o){return o===void 0?e:ge(t,o,ji(o))}return i.parentIds=s,i}function ji(t){function e(n,i){return(t(n,i)||[]).map(r=>[r,void 0])}return e.wrapped=t,e}function Uo(t){function e(n,i){return(t(n,i)||[]).map(([r])=>r)}return e.wrapped=t,e}function Ho(t){try{return typeof t.id=="string"}catch{return!1}}function Xo(t){if(Ho(t))return t.id;throw new Error(`default id function expected datum to have an id field but got: ${t}`)}function Wo(t){try{const e=t.parentIds;return e===void 0||e instanceof Array&&e.every(n=>typeof n=="string")}catch{return!1}}function Wn(t){if(Wo(t))return t.parentIds;throw new Error(`default parentIds function expected datum to have a parentIds field but got: ${t}`)}function Yo(...t){if(t.length)throw Error(`got arguments to dagStratify(${t}), but constructor takes no aruguments. These were probably meant as data which should be called as dagStratify()(...)`);return ge(Xo,Wn,ji(Wn))}let Zt=1e-60,Yn,Kn;do Zt+=Zt,Yn=1+.1*Zt,Kn=1+.2*Zt;while(Yn<=1||Kn<=1);var ke=Zt;function Ko(t,e,n){let i,r;for(let u=1;u<=n;u+=1){t[u][u]=1/t[u][u],r=-t[u][u];for(let s=1;s<u;s+=1)t[s][u]*=r;if(i=u+1,n<i)break;for(let s=i;s<=n;s+=1){r=t[u][s],t[u][s]=0;for(let o=1;o<=u;o+=1)t[o][s]+=r*t[o][u]}}}var Zo=Ko;function Qo(t,e,n,i){let r,u;for(r=1;r<=n;r+=1){u=0;for(let s=1;s<r;s+=1)u+=t[s][r]*i[s];i[r]=(i[r]-u)/t[r][r]}for(let s=1;s<=n;s+=1){r=n+1-s,i[r]/=t[r][r],u=-i[r];for(let o=1;o<r;o+=1)i[o]+=u*t[o][r]}}var ta=Qo;function ea(t,e,n,i){let r,u,s;for(let o=1;o<=n;o+=1){if(i[1]=o,s=0,r=o-1,r<1){if(s=t[o][o]-s,s<=0)break;t[o][o]=Math.sqrt(s)}else{for(let a=1;a<=r;a+=1){u=t[a][o];for(let h=1;h<a;h+=1)u-=t[h][o]*t[h][a];u/=t[a][a],t[a][o]=u,s+=u*u}if(s=t[o][o]-s,s<=0)break;t[o][o]=Math.sqrt(s)}i[1]=0}}var na=ea;function ia(t,e,n,i,r,u,s,o,a,h,l,c,f,d=0,m,p,y){let v,b,A,E,_,w,S,k,I,x,M,P,G,g;const B=Math.min(i,l);let C=2*i+B*(B+5)/2+2*l+1;for(let D=1;D<=i;D+=1)p[D]=e[D];for(let D=i+1;D<=C;D+=1)p[D]=0;for(let D=1;D<=l;D+=1)f[D]=0,u[D]=0;const R=[];if(y[1]===0){if(na(t,n,i,R),R[1]!==0){y[1]=2;return}ta(t,n,i,e),Zo(t,n,i)}else{for(let D=1;D<=i;D+=1){r[D]=0;for(let $=1;$<=D;$+=1)r[D]+=t[$][D]*e[$]}for(let D=1;D<=i;D+=1){e[D]=0;for(let $=D;$<=i;$+=1)e[D]+=t[D][$]*r[$]}}s[1]=0;for(let D=1;D<=i;D+=1){r[D]=e[D],s[1]+=p[D]*r[D],p[D]=0;for(let $=D+1;$<=i;$+=1)t[$][D]=0}s[1]=-s[1]/2,y[1]=0;const T=i,O=T+i,N=O+B,L=N+B+1,J=L+B*(B+1)/2,it=J+l;for(let D=1;D<=l;D+=1){w=0;for(let $=1;$<=i;$+=1)w+=o[$][D]*o[$][D];p[it+D]=Math.sqrt(w)}E=d,m[1]=0,m[2]=0;function Q(){m[1]+=1,C=J;for(let D=1;D<=l;D+=1){C+=1,w=-a[D];for(let $=1;$<=i;$+=1)w+=o[$][D]*r[$];if(Math.abs(w)<ke&&(w=0),D>c)p[C]=w;else if(p[C]=-Math.abs(w),w>0){for(let $=1;$<=i;$+=1)o[$][D]=-o[$][D];a[D]=-a[D]}}for(let D=1;D<=E;D+=1)p[J+f[D]]=0;A=0,_=0;for(let D=1;D<=l;D+=1)p[J+D]<_*p[it+D]&&(A=D,_=p[J+D]/p[it+D]);if(A===0){for(let D=1;D<=E;D+=1)u[f[D]]=p[N+D];return 999}return 0}function ut(){for(let D=1;D<=i;D+=1){w=0;for(let $=1;$<=i;$+=1)w+=t[$][D]*o[$][A];p[D]=w}v=T;for(let D=1;D<=i;D+=1)p[v+D]=0;for(let D=E+1;D<=i;D+=1)for(let $=1;$<=i;$+=1)p[v+$]=p[v+$]+t[$][D]*p[D];P=!0;for(let D=E;D>=1;D-=1){w=p[D],C=L+D*(D+3)/2,v=C-D;for(let $=D+1;$<=E;$+=1)w-=p[C]*p[O+$],C+=$;w/=p[v],p[O+D]=w,!(f[D]<=c)&&(w<=0||(P=!1,b=D))}if(!P){S=p[N+b]/p[O+b];for(let D=1;D<=E;D+=1)f[D]<=c||p[O+D]<=0||(_=p[N+D]/p[O+D],_<S&&(S=_,b=D))}w=0;for(let D=T+1;D<=T+i;D+=1)w+=p[D]*p[D];if(Math.abs(w)<=ke){if(P)return y[1]=1,999;for(let D=1;D<=E;D+=1)p[N+D]=p[N+D]-S*p[O+D];return p[N+E+1]=p[N+E+1]+S,700}w=0;for(let D=1;D<=i;D+=1)w+=p[T+D]*o[D][A];k=-p[J+A]/w,G=!0,P||S<k&&(k=S,G=!1);for(let D=1;D<=i;D+=1)r[D]+=k*p[T+D],Math.abs(r[D])<ke&&(r[D]=0);s[1]+=k*w*(k/2+p[N+E+1]);for(let D=1;D<=E;D+=1)p[N+D]=p[N+D]-k*p[O+D];if(p[N+E+1]=p[N+E+1]+k,G){E+=1,f[E]=A,C=L+(E-1)*E/2+1;for(let D=1;D<=E-1;D+=1)p[C]=p[D],C+=1;if(E===i)p[C]=p[i];else{for(let D=i;D>=E+1;D-=1)if(p[D]!==0&&(I=Math.max(Math.abs(p[D-1]),Math.abs(p[D])),x=Math.min(Math.abs(p[D-1]),Math.abs(p[D])),p[D-1]>=0?_=Math.abs(I*Math.sqrt(1+x*x/(I*I))):_=-Math.abs(I*Math.sqrt(1+x*x/(I*I))),I=p[D-1]/_,x=p[D]/_,I!==1))if(I===0){p[D-1]=x*_;for(let $=1;$<=i;$+=1)_=t[$][D-1],t[$][D-1]=t[$][D],t[$][D]=_}else{p[D-1]=_,M=x/(1+I);for(let $=1;$<=i;$+=1)_=I*t[$][D-1]+x*t[$][D],t[$][D]=M*(t[$][D-1]+_)-t[$][D],t[$][D-1]=_}p[C]=p[E]}}else{w=-a[A];for(let D=1;D<=i;D+=1)w+=r[D]*o[D][A];if(A>c)p[J+A]=w;else if(p[J+A]=-Math.abs(w),w>0){for(let D=1;D<=i;D+=1)o[D][A]=-o[D][A];a[A]=-a[A]}return 700}return 0}function ht(){if(C=L+b*(b+1)/2+1,v=C+b,p[v]===0||(I=Math.max(Math.abs(p[v-1]),Math.abs(p[v])),x=Math.min(Math.abs(p[v-1]),Math.abs(p[v])),p[v-1]>=0?_=Math.abs(I*Math.sqrt(1+x*x/(I*I))):_=-Math.abs(I*Math.sqrt(1+x*x/(I*I))),I=p[v-1]/_,x=p[v]/_,I===1))return 798;if(I===0){for(let D=b+1;D<=E;D+=1)_=p[v-1],p[v-1]=p[v],p[v]=_,v+=D;for(let D=1;D<=i;D+=1)_=t[D][b],t[D][b]=t[D][b+1],t[D][b+1]=_}else{M=x/(1+I);for(let D=b+1;D<=E;D+=1)_=I*p[v-1]+x*p[v],p[v]=M*(p[v-1]+_)-p[v],p[v-1]=_,v+=D;for(let D=1;D<=i;D+=1)_=I*t[D][b]+x*t[D][b+1],t[D][b+1]=M*(t[D][b]+_)-t[D][b+1],t[D][b]=_}return 0}function st(){v=C-b;for(let D=1;D<=b;D+=1)p[v]=p[C],C+=1,v+=1;return p[N+b]=p[N+b+1],f[b]=f[b+1],b+=1,b<E?797:0}function lt(){return p[N+E]=p[N+E+1],p[N+E+1]=0,f[E]=0,E-=1,m[2]+=1,0}for(g=0;;){if(g=Q(),g===999)return;for(;g=ut(),g!==0;){if(g===999)return;if(g===700)if(b===E)lt();else{for(;ht(),g=st(),g===797;);lt()}}}}var ra=ia;function ua(t,e,n,i=[],r=0,u=[0,0]){const s=[],o=[],a=[],h=[],l=[],c=[];let f="";const d=t.length-1,m=n[1].length-1;if(!i)for(let v=1;v<=m;v+=1)i[v]=0;if(d!==t[1].length-1&&(f="Dmat is not symmetric!"),d!==e.length-1&&(f="Dmat and dvec are incompatible!"),d!==n.length-1&&(f="Amat and dvec are incompatible!"),m!==i.length-1&&(f="Amat and bvec are incompatible!"),(r>m||r<0)&&(f="Value of meq is invalid!"),f!=="")return{message:f};for(let v=1;v<=m;v+=1)o[v]=0,h[v]=0;const p=0,y=Math.min(d,m);for(let v=1;v<=d;v+=1)a[v]=0;s[1]=0;for(let v=1;v<=2*d+y*(y+5)/2+2*m+1;v+=1)l[v]=0;for(let v=1;v<=2;v+=1)c[v]=0;return ra(t,e,d,d,a,h,s,n,i,d,m,r,o,p,c,l,u),u[1]===1&&(f="constraints are inconsistent, no solution!"),u[1]===2&&(f="matrix D in quadratic function is not positive definite!"),{solution:a,Lagrangian:h,value:s,unconstrained_solution:e,iterations:c,iact:o,message:f}}var sa=ua,oa={solveQP:sa},aa=oa;function Ji(t,e){let[n,...i]=t,r=n.x=0;for(const u of i)r=u.x=r+e(n,u),n=u;if(r>0)for(const u of t)u.x/=r;else for(const u of t)u.x=.5}function la(t,e,n,i,r){const u=[[0]],s=[0],o=[[0]],a=[0];for(const c of t){const f=[0];f.push(...c),u.push(f)}s.push(...e),o.push(...e.map(()=>[0]));for(const c of n)for(const[f,d]of c.entries())o[f+1].push(-d);a.push(...i.map(c=>-c));const{solution:h,message:l}=aa.solveQP(u,s,o,a,r);if(l.length)throw new Error(`quadprog failed with: ${l}`);return h.shift(),h}function ha(t,e,n,i,r=0){e.pop(),t.pop(),t.forEach(s=>s.pop()),n.forEach(s=>s.pop());const u=la(t,e,n,i,r);return u.push(0),u}function ca(t){const e=new at;let n=0;for(const i of t)for(const r of i)e.set(r.id,n++);return e}function fa(t,e,n){const i=1+Math.max(...e.values()),r=[],u=[];for(const a of t){let[h,...l]=a;for(const c of l){const f=e.getThrow(h.id),d=e.getThrow(c.id),m=new Array(i).fill(0);m[f]=1,m[d]=-1,r.push(m),u.push(-n(h,c)),h=c}}const s=new Array(i).fill(0);return[new Array(i).fill(null).map(()=>new Array(i).fill(0)),s,r,u]}function Zn(t,e,n,i){t[n][n]+=i,t[n][e]-=i,t[e][n]-=i,t[e][e]+=i}function da(t,e,n,i,r){t[i][i]+=r,t[i][n]-=2*r,t[i][e]+=r,t[n][i]-=2*r,t[n][n]+=4*r,t[n][e]-=2*r,t[e][i]+=r,t[e][n]-=2*r,t[e][e]+=r}function pa(t,e,n){const i=Math.min(...n),r=Math.max(...n)-i;if(r>0)for(const u of t)for(const s of u){const o=e.getThrow(s.id);s.x=(n[o]-i)/r}else for(const u of t)for(const s of u)s.x=.5}class bt extends qi{constructor(e){super(e,void 0)}}function Da(t){const e=new at;for(const r of t.slice().reverse())for(const u of r){for(const s of u.ichildren())e.delete(s.id);e.set(u.id,u)}const n=new ot([...e.values()]).split(),i=new at;for(const[r,u]of n.entries())for(const s of u)i.set(s.id,r);return i}function va(t,e){const n=[];let i=[],r=new Set;for(const u of t){const s=new Set(u.map(o=>e.getThrow(o.id)));Li(r,s)||n.push(i=[]),i.push(u),r=s}return n}function me(t,e,n,i,r){function u(l,c,f){const d=ca(l),[m,p,y,v]=fa(l,d,c);for(const A of l)for(const E of A){const _=d.getThrow(E.id),w=E instanceof bt?e:t;for(const S of E.ichildren()){const k=d.getThrow(S.id),I=S instanceof bt?e:t,x=S instanceof bt?i:n;Zn(m,_,k,w+I);for(const M of S.ichildren()){const P=d.getThrow(M.id);da(m,_,k,P,x)}}}for(let[A,...E]of l)for(const _ of E)f.getThrow(A.id)!==f.getThrow(_.id)&&Zn(m,d.getThrow(A.id),d.getThrow(_.id),r),A=_;const b=ha(m,p,y,v);pa(l,d,b)}function s(l,c){if(t===0&&n===0)throw new Error("node vertical weight or node curve weight needs to be positive");if(e===0&&i===0)throw new Error("dummy vertical weight or dummy curve weight needs to be positive");const f=Da(l);for(const d of va(l,f))if(d.every(m=>m.length===1))for(const[m]of d)m.x=.5;else if(d.length===1){const[m]=d;Ji(m,c)}else u(d,c,f)}function o(l){if(l===void 0)return[t,e];const[c,f]=l;if(c<0||f<0)throw new Error(`weights must be non-negative, but were ${c} and ${f}`);return me(c,f,n,i,r)}s.vertical=o;function a(l){if(l===void 0)return[n,i];const[c,f]=l;if(c<0||f<0)throw new Error(`weights must be non-negative, but were ${c} and ${f}`);return me(t,e,c,f,r)}s.curve=a;function h(l){if(l===void 0)return r;if(l<=0)throw new Error(`weight must be positive, but was ${l}`);return me(t,e,n,i,l)}return s.component=h,s}function ga(...t){if(t.length)throw new Error(`got arguments to quad(${t}), but constructor takes no aruguments.`);return me(1,0,0,1,1)}/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function ma(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(n[i[r]]=t[i[r]]);return n}function Ui(t,e,n,i){this.feasible=n,this.evaluation=e,this.bounded=i,this._tableau=t}var Cn=Ui;Ui.prototype.generateSolutionSet=function(){for(var t={},e=this._tableau,n=e.varIndexByRow,i=e.variablesPerIndex,r=e.matrix,u=e.rhsColumn,s=e.height-1,o=Math.round(1/e.precision),a=1;a<=s;a+=1){var h=n[a],l=i[h];if(!(l===void 0||l.isSlack===!0)){var c=r[a][u];t[l.id]=Math.round((Number.EPSILON+c)*o)/o}}return t};function Ae(t,e,n,i,r){Cn.call(this,t,e,n,i),this.iter=r}var ya=Ae;Ae.prototype=Object.create(Cn.prototype);Ae.constructor=Ae;function vt(t){this.model=null,this.matrix=null,this.width=0,this.height=0,this.costRowIndex=0,this.rhsColumn=0,this.variablesPerIndex=[],this.unrestrictedVars=null,this.feasible=!0,this.evaluation=0,this.simplexIters=0,this.varIndexByRow=null,this.varIndexByCol=null,this.rowByVarIndex=null,this.colByVarIndex=null,this.precision=t||1e-8,this.optionalObjectives=[],this.objectivesByPriority={},this.savedState=null,this.availableIndexes=[],this.lastElementIndex=0,this.variables=null,this.nVars=0,this.bounded=!0,this.unboundedVarIndex=null,this.branchAndCutIterations=0}var j=vt;vt.prototype.solve=function(){return this.model.getNumberOfIntegerVariables()>0?this.branchAndCut():this.simplex(),this.updateVariableValues(),this.getSolution()};function tn(t,e){this.priority=t,this.reducedCosts=new Array(e);for(var n=0;n<e;n+=1)this.reducedCosts[n]=0}tn.prototype.copy=function(){var t=new tn(this.priority,this.reducedCosts.length);return t.reducedCosts=this.reducedCosts.slice(),t};vt.prototype.setOptionalObjective=function(t,e,n){var i=this.objectivesByPriority[t];if(i===void 0){var r=Math.max(this.width,e+1);i=new tn(t,r),this.objectivesByPriority[t]=i,this.optionalObjectives.push(i),this.optionalObjectives.sort(function(u,s){return u.priority-s.priority})}i.reducedCosts[e]=n};vt.prototype.initialize=function(t,e,n,i){this.variables=n,this.unrestrictedVars=i,this.width=t,this.height=e;for(var r=new Array(t),u=0;u<t;u++)r[u]=0;this.matrix=new Array(e);for(var s=0;s<e;s++)this.matrix[s]=r.slice();this.varIndexByRow=new Array(this.height),this.varIndexByCol=new Array(this.width),this.varIndexByRow[0]=-1,this.varIndexByCol[0]=-1,this.nVars=t+e-2,this.rowByVarIndex=new Array(this.nVars),this.colByVarIndex=new Array(this.nVars),this.lastElementIndex=this.nVars};vt.prototype._resetMatrix=function(){var t=this.model.variables,e=this.model.constraints,n=t.length,i=e.length,r,u,s=this.matrix[0],o=this.model.isMinimization===!0?-1:1;for(r=0;r<n;r+=1){var a=t[r],h=a.priority,l=o*a.cost;h===0?s[r+1]=l:this.setOptionalObjective(h,r+1,l),u=t[r].index,this.rowByVarIndex[u]=-1,this.colByVarIndex[u]=r+1,this.varIndexByCol[r+1]=u}for(var c=1,f=0;f<i;f+=1){var d=e[f],m=d.index;this.rowByVarIndex[m]=c,this.colByVarIndex[m]=-1,this.varIndexByRow[c]=m;var p,y,v,b=d.terms,A=b.length,E=this.matrix[c++];if(d.isUpperBound){for(p=0;p<A;p+=1)y=b[p],v=this.colByVarIndex[y.variable.index],E[v]=y.coefficient;E[0]=d.rhs}else{for(p=0;p<A;p+=1)y=b[p],v=this.colByVarIndex[y.variable.index],E[v]=-y.coefficient;E[0]=-d.rhs}}};vt.prototype.setModel=function(t){this.model=t;var e=t.nVariables+1,n=t.nConstraints+1;return this.initialize(e,n,t.variables,t.unrestrictedVariables),this._resetMatrix(),this};vt.prototype.getNewElementIndex=function(){if(this.availableIndexes.length>0)return this.availableIndexes.pop();var t=this.lastElementIndex;return this.lastElementIndex+=1,t};vt.prototype.density=function(){for(var t=0,e=this.matrix,n=0;n<this.height;n++)for(var i=e[n],r=0;r<this.width;r++)i[r]!==0&&(t+=1);return t/(this.height*this.width)};vt.prototype.setEvaluation=function(){var t=Math.round(1/this.precision),e=this.matrix[this.costRowIndex][this.rhsColumn],n=Math.round((Number.EPSILON+e)*t)/t;this.evaluation=n,this.simplexIters===0&&(this.bestPossibleEval=n)};vt.prototype.getSolution=function(){var t=this.model.isMinimization===!0?this.evaluation:-this.evaluation;return this.model.getNumberOfIntegerVariables()>0?new ya(this,t,this.feasible,this.bounded,this.branchAndCutIterations):new Cn(this,t,this.feasible,this.bounded)};j.prototype.simplex=function(){return this.bounded=!0,this.phase1(),this.feasible===!0&&this.phase2(),this};j.prototype.phase1=function(){for(var t=this.model.checkForCycles,e=[],n=this.matrix,i=this.rhsColumn,r=this.width-1,u=this.height-1,s,o=0;;){for(var a=0,h=-this.precision,l=1;l<=u;l++){s=this.unrestrictedVars[this.varIndexByRow[l]]===!0;var c=n[l][i];c<h&&(h=c,a=l)}if(a===0)return this.feasible=!0,o;for(var f=0,d=-1/0,m=n[0],p=n[a],y=1;y<=r;y++){var v=p[y];if(s=this.unrestrictedVars[this.varIndexByCol[y]]===!0,s||v<-this.precision){var b=-m[y]/v;d<b&&(d=b,f=y)}}if(f===0)return this.feasible=!1,o;if(t){e.push([this.varIndexByRow[a],this.varIndexByCol[f]]);var A=this.checkForCycles(e);if(A.length>0)return this.model.messages.push("Cycle in phase 1"),this.model.messages.push("Start :"+A[0]),this.model.messages.push("Length :"+A[1]),this.feasible=!1,o}this.pivot(a,f),o+=1}};j.prototype.phase2=function(){for(var t=this.model.checkForCycles,e=[],n=this.matrix,i=this.rhsColumn,r=this.width-1,u=this.height-1,s=this.precision,o=this.optionalObjectives.length,a=null,h=0,l,c;;){var f=n[this.costRowIndex];o>0&&(a=[]);for(var d=0,m=s,p=!1,y=1;y<=r;y++){if(l=f[y],c=this.unrestrictedVars[this.varIndexByCol[y]]===!0,o>0&&-s<l&&l<s){a.push(y);continue}if(c&&l<0){-l>m&&(m=-l,d=y,p=!0);continue}l>m&&(m=l,d=y,p=!1)}if(o>0)for(var v=0;d===0&&a.length>0&&v<o;){var b=[],A=this.optionalObjectives[v].reducedCosts;m=s;for(var E=0;E<a.length;E++){if(y=a[E],l=A[y],c=this.unrestrictedVars[this.varIndexByCol[y]]===!0,-s<l&&l<s){b.push(y);continue}if(c&&l<0){-l>m&&(m=-l,d=y,p=!0);continue}l>m&&(m=l,d=y,p=!1)}a=b,v+=1}if(d===0)return this.setEvaluation(),this.simplexIters+=1,h;var _=0,w=1/0;this.varIndexByRow;for(var S=1;S<=u;S++){var k=n[S],I=k[i],x=k[d];if(!(-s<x&&x<s)){if(x>0&&s>I&&I>-s){w=0,_=S;break}var M=p?-I/x:I/x;M>s&&w>M&&(w=M,_=S)}}if(w===1/0)return this.evaluation=-1/0,this.bounded=!1,this.unboundedVarIndex=this.varIndexByCol[d],h;if(t){e.push([this.varIndexByRow[_],this.varIndexByCol[d]]);var P=this.checkForCycles(e);if(P.length>0)return this.model.messages.push("Cycle in phase 2"),this.model.messages.push("Start :"+P[0]),this.model.messages.push("Length :"+P[1]),this.feasible=!1,h}this.pivot(_,d,!0),h+=1}};var Re=[];j.prototype.pivot=function(t,e){var n=this.matrix,i=n[t][e],r=this.height-1,u=this.width-1,s=this.varIndexByRow[t],o=this.varIndexByCol[e];this.varIndexByRow[t]=o,this.varIndexByCol[e]=s,this.rowByVarIndex[o]=t,this.rowByVarIndex[s]=-1,this.colByVarIndex[o]=-1,this.colByVarIndex[s]=e;for(var a=n[t],h=0,l=0;l<=u;l++)a[l]>=-1e-16&&a[l]<=1e-16?a[l]=0:(a[l]/=i,Re[h]=l,h+=1);a[e]=1/i;var c,f,d;this.precision;for(var m=0;m<=r;m++)if(m!==t&&!(n[m][e]>=-1e-16&&n[m][e]<=1e-16)){var p=n[m];if(c=p[e],c>=-1e-16&&c<=1e-16)c!==0&&(p[e]=0);else{for(f=0;f<h;f++)l=Re[f],d=a[l],d>=-1e-16&&d<=1e-16?d!==0&&(a[l]=0):p[l]=p[l]-c*d;p[e]=-c/i}}var y=this.optionalObjectives.length;if(y>0)for(var v=0;v<y;v+=1){var b=this.optionalObjectives[v].reducedCosts;if(c=b[e],c!==0){for(f=0;f<h;f++)l=Re[f],d=a[l],d!==0&&(b[l]=b[l]-c*d);b[e]=-c/i}}};j.prototype.checkForCycles=function(t){for(var e=0;e<t.length-1;e++)for(var n=e+1;n<t.length;n++){var i=t[e],r=t[n];if(i[0]===r[0]&&i[1]===r[1]){if(n-e>t.length-n)break;for(var u=!0,s=1;s<n-e;s++){var o=t[e+s],a=t[n+s];if(o[0]!==a[0]||o[1]!==a[1]){u=!1;break}}if(u)return[e,n-e]}}return[]};function En(t,e,n,i){this.id=t,this.cost=e,this.index=n,this.value=0,this.priority=i}function Gi(t,e,n,i){En.call(this,t,e,n,i)}Gi.prototype.isInteger=!0;function _n(t,e){En.call(this,t,0,e,0)}_n.prototype.isSlack=!0;function Hi(t,e){this.variable=t,this.coefficient=e}function Xi(t,e,n){return n===0||n==="required"?null:(e=e||1,n=n||1,t.isMinimization===!1&&(e=-e),t.addVariable(e,"r"+t.relaxationIndex++,!1,!1,n))}function Vt(t,e,n,i){this.slack=new _n("s"+n,n),this.index=n,this.model=i,this.rhs=t,this.isUpperBound=e,this.terms=[],this.termsByVarIndex={},this.relaxation=null}Vt.prototype.addTerm=function(t,e){var n=e.index,i=this.termsByVarIndex[n];if(i===void 0)i=new Hi(e,t),this.termsByVarIndex[n]=i,this.terms.push(i),this.isUpperBound===!0&&(t=-t),this.model.updateConstraintCoefficient(this,e,t);else{var r=i.coefficient+t;this.setVariableCoefficient(r,e)}return this};Vt.prototype.removeTerm=function(t){return this};Vt.prototype.setRightHandSide=function(t){if(t!==this.rhs){var e=t-this.rhs;this.isUpperBound===!0&&(e=-e),this.rhs=t,this.model.updateRightHandSide(this,e)}return this};Vt.prototype.setVariableCoefficient=function(t,e){var n=e.index;if(n===-1){console.warn("[Constraint.setVariableCoefficient] Trying to change coefficient of inexistant variable.");return}var i=this.termsByVarIndex[n];if(i===void 0)this.addTerm(t,e);else if(t!==i.coefficient){var r=t-i.coefficient;this.isUpperBound===!0&&(r=-r),i.coefficient=t,this.model.updateConstraintCoefficient(this,e,r)}return this};Vt.prototype.relax=function(t,e){this.relaxation=Xi(this.model,t,e),this._relax(this.relaxation)};Vt.prototype._relax=function(t){t!==null&&(this.isUpperBound?this.setVariableCoefficient(-1,t):this.setVariableCoefficient(1,t))};function Gt(t,e){this.upperBound=t,this.lowerBound=e,this.model=t.model,this.rhs=t.rhs,this.relaxation=null}Gt.prototype.isEquality=!0;Gt.prototype.addTerm=function(t,e){return this.upperBound.addTerm(t,e),this.lowerBound.addTerm(t,e),this};Gt.prototype.removeTerm=function(t){return this.upperBound.removeTerm(t),this.lowerBound.removeTerm(t),this};Gt.prototype.setRightHandSide=function(t){this.upperBound.setRightHandSide(t),this.lowerBound.setRightHandSide(t),this.rhs=t};Gt.prototype.relax=function(t,e){this.relaxation=Xi(this.model,t,e),this.upperBound.relaxation=this.relaxation,this.upperBound._relax(this.relaxation),this.lowerBound.relaxation=this.relaxation,this.lowerBound._relax(this.relaxation)};var wt={Constraint:Vt,Variable:En,IntegerVariable:Gi,SlackVariable:_n,Equality:Gt,Term:Hi},An=wt.SlackVariable;j.prototype.addCutConstraints=function(t){for(var e=t.length,n=this.height,i=n+e,r=n;r<i;r+=1)this.matrix[r]===void 0&&(this.matrix[r]=this.matrix[r-1].slice());this.height=i,this.nVars=this.width+this.height-2;for(var u,s=this.width-1,o=0;o<e;o+=1){var a=t[o],h=n+o,l=a.type==="min"?-1:1,c=a.varIndex,f=this.rowByVarIndex[c],d=this.matrix[h];if(f===-1){for(d[this.rhsColumn]=l*a.value,u=1;u<=s;u+=1)d[u]=0;d[this.colByVarIndex[c]]=l}else{var m=this.matrix[f],p=m[this.rhsColumn];for(d[this.rhsColumn]=l*(a.value-p),u=1;u<=s;u+=1)d[u]=-l*m[u]}var y=this.getNewElementIndex();this.varIndexByRow[h]=y,this.rowByVarIndex[y]=h,this.colByVarIndex[y]=-1,this.variablesPerIndex[y]=new An("s"+y,y),this.nVars+=1}};j.prototype._addLowerBoundMIRCut=function(t){if(t===this.costRowIndex)return!1;this.model;var e=this.matrix,n=this.variablesPerIndex[this.varIndexByRow[t]];if(!n.isInteger)return!1;var i=e[t][this.rhsColumn],r=i-Math.floor(i);if(r<this.precision||1-this.precision<r)return!1;var u=this.height;e[u]=e[u-1].slice(),this.height+=1,this.nVars+=1;var s=this.getNewElementIndex();this.varIndexByRow[u]=s,this.rowByVarIndex[s]=u,this.colByVarIndex[s]=-1,this.variablesPerIndex[s]=new An("s"+s,s),e[u][this.rhsColumn]=Math.floor(i);for(var o=1;o<this.varIndexByCol.length;o+=1){var a=this.variablesPerIndex[this.varIndexByCol[o]];if(!a.isInteger)e[u][o]=Math.min(0,e[t][o]/(1-r));else{var h=e[t][o],l=Math.floor(h)+Math.max(0,h-Math.floor(h)-r)/(1-r);e[u][o]=l}}for(var c=0;c<this.width;c+=1)e[u][c]-=e[t][c];return!0};j.prototype._addUpperBoundMIRCut=function(t){if(t===this.costRowIndex)return!1;this.model;var e=this.matrix,n=this.variablesPerIndex[this.varIndexByRow[t]];if(!n.isInteger)return!1;var i=e[t][this.rhsColumn],r=i-Math.floor(i);if(r<this.precision||1-this.precision<r)return!1;var u=this.height;e[u]=e[u-1].slice(),this.height+=1,this.nVars+=1;var s=this.getNewElementIndex();this.varIndexByRow[u]=s,this.rowByVarIndex[s]=u,this.colByVarIndex[s]=-1,this.variablesPerIndex[s]=new An("s"+s,s),e[u][this.rhsColumn]=-r;for(var o=1;o<this.varIndexByCol.length;o+=1){var a=this.variablesPerIndex[this.varIndexByCol[o]],h=e[t][o],l=h-Math.floor(h);a.isInteger?l<=r?e[u][o]=-l:e[u][o]=-(1-l)*r/l:h>=0?e[u][o]=-h:e[u][o]=h*r/(1-r)}return!0};j.prototype.applyMIRCuts=function(){};j.prototype._putInBase=function(t){var e=this.rowByVarIndex[t];if(e===-1){for(var n=this.colByVarIndex[t],i=1;i<this.height;i+=1){var r=this.matrix[i][n];if(r<-this.precision||this.precision<r){e=i;break}}this.pivot(e,n)}return e};j.prototype._takeOutOfBase=function(t){var e=this.colByVarIndex[t];if(e===-1){for(var n=this.rowByVarIndex[t],i=this.matrix[n],r=1;r<this.height;r+=1){var u=i[r];if(u<-this.precision||this.precision<u){e=r;break}}this.pivot(n,e)}return e};j.prototype.updateVariableValues=function(){for(var t=this.variables.length,e=Math.round(1/this.precision),n=0;n<t;n+=1){var i=this.variables[n],r=i.index,u=this.rowByVarIndex[r];if(u===-1)i.value=0;else{var s=this.matrix[u][this.rhsColumn];i.value=Math.round((s+Number.EPSILON)*e)/e}}};j.prototype.updateRightHandSide=function(t,e){var n=this.height-1,i=this.rowByVarIndex[t.index];if(i===-1){for(var r=this.colByVarIndex[t.index],u=0;u<=n;u+=1){var s=this.matrix[u];s[this.rhsColumn]-=e*s[r]}var o=this.optionalObjectives.length;if(o>0)for(var a=0;a<o;a+=1){var h=this.optionalObjectives[a].reducedCosts;h[this.rhsColumn]-=e*h[r]}}else this.matrix[i][this.rhsColumn]-=e};j.prototype.updateConstraintCoefficient=function(t,e,n){if(t.index===e.index)throw new Error("[Tableau.updateConstraintCoefficient] constraint index should not be equal to variable index !");var i=this._putInBase(t.index),r=this.colByVarIndex[e.index];if(r===-1)for(var u=this.rowByVarIndex[e.index],s=0;s<this.width;s+=1)this.matrix[i][s]+=n*this.matrix[u][s];else this.matrix[i][r]-=n};j.prototype.updateCost=function(t,e){var n=t.index,i=this.width-1,r=this.colByVarIndex[n];if(r===-1){var u=this.matrix[this.rowByVarIndex[n]],s;if(t.priority===0){var o=this.matrix[0];for(s=0;s<=i;s+=1)o[s]+=e*u[s]}else{var a=this.objectivesByPriority[t.priority].reducedCosts;for(s=0;s<=i;s+=1)a[s]+=e*u[s]}}else this.matrix[0][r]-=e};j.prototype.addConstraint=function(t){var e=t.isUpperBound?1:-1,n=this.height,i=this.matrix[n];i===void 0&&(i=this.matrix[0].slice(),this.matrix[n]=i);for(var r=this.width-1,u=0;u<=r;u+=1)i[u]=0;i[this.rhsColumn]=e*t.rhs;for(var s=t.terms,o=s.length,a=0;a<o;a+=1){var h=s[a],l=h.coefficient,c=h.variable.index,f=this.rowByVarIndex[c];if(f===-1)i[this.colByVarIndex[c]]+=e*l;else{var d=this.matrix[f];for(d[this.rhsColumn],u=0;u<=r;u+=1)i[u]-=e*l*d[u]}}var m=t.index;this.varIndexByRow[n]=m,this.rowByVarIndex[m]=n,this.colByVarIndex[m]=-1,this.height+=1};j.prototype.removeConstraint=function(t){var e=t.index,n=this.height-1,i=this._putInBase(e),r=this.matrix[n];this.matrix[n]=this.matrix[i],this.matrix[i]=r,this.varIndexByRow[i]=this.varIndexByRow[n],this.varIndexByRow[n]=-1,this.rowByVarIndex[e]=-1,this.availableIndexes[this.availableIndexes.length]=e,t.slack.index=-1,this.height-=1};j.prototype.addVariable=function(t){var e=this.height-1,n=this.width,i=this.model.isMinimization===!0?-t.cost:t.cost,r=t.priority,u=this.optionalObjectives.length;if(u>0)for(var s=0;s<u;s+=1)this.optionalObjectives[s].reducedCosts[n]=0;r===0?this.matrix[0][n]=i:(this.setOptionalObjective(r,n,i),this.matrix[0][n]=0);for(var o=1;o<=e;o+=1)this.matrix[o][n]=0;var a=t.index;this.varIndexByCol[n]=a,this.rowByVarIndex[a]=-1,this.colByVarIndex[a]=n,this.width+=1};j.prototype.removeVariable=function(t){var e=t.index,n=this._takeOutOfBase(e),i=this.width-1;if(n!==i){for(var r=this.height-1,u=0;u<=r;u+=1){var s=this.matrix[u];s[n]=s[i]}var o=this.optionalObjectives.length;if(o>0)for(var a=0;a<o;a+=1){var h=this.optionalObjectives[a].reducedCosts;h[n]=h[i]}var l=this.varIndexByCol[i];this.varIndexByCol[n]=l,this.colByVarIndex[l]=n}this.varIndexByCol[i]=-1,this.colByVarIndex[e]=-1,this.availableIndexes[this.availableIndexes.length]=e,t.index=-1,this.width-=1};j.prototype.log=function(t,e){console.log("****",t,"****"),console.log("Nb Variables",this.width-1),console.log("Nb Constraints",this.height-1),console.log("Basic Indexes",this.varIndexByRow),console.log("Non Basic Indexes",this.varIndexByCol),console.log("Rows",this.rowByVarIndex),console.log("Cols",this.colByVarIndex);var n=5,i="",r=[" "],u,s,o,a,h,l,c,f,d,m,p;for(s=1;s<this.width;s+=1)h=this.varIndexByCol[s],a=this.variablesPerIndex[h],a===void 0?l="c"+h:l=a.id,c=l.length,f=" ",d="	",c>5?f+=" ":d+="	",r[s]=f,i+=d+l;console.log(i);var y,v=this.matrix[this.costRowIndex],b="	";for(u=1;u<this.width;u+=1)y="	",b+=y,b+=r[u],b+=v[u].toFixed(n);for(y="	",b+=y+r[0]+v[0].toFixed(n),console.log(b+"	Z"),o=1;o<this.height;o+=1){for(m=this.matrix[o],p="	",s=1;s<this.width;s+=1)y="	",p+=y+r[s]+m[s].toFixed(n);y="	",p+=y+r[0]+m[0].toFixed(n),h=this.varIndexByRow[o],a=this.variablesPerIndex[h],a===void 0?l="c"+h:l=a.id,console.log(p+"	"+l)}console.log("");var A=this.optionalObjectives.length;if(A>0){console.log("    Optional objectives:");for(var E=0;E<A;E+=1){var _=this.optionalObjectives[E].reducedCosts,w="";for(u=1;u<this.width;u+=1)y=_[u]<0?"":" ",w+=y,w+=r[u],w+=_[u].toFixed(n);y=_[0]<0?"":" ",w+=y+r[0]+_[0].toFixed(n),console.log(w+" z"+E)}}return console.log("Feasible?",this.feasible),console.log("evaluation",this.evaluation),this};j.prototype.copy=function(){var t=new j(this.precision);t.width=this.width,t.height=this.height,t.nVars=this.nVars,t.model=this.model,t.variables=this.variables,t.variablesPerIndex=this.variablesPerIndex,t.unrestrictedVars=this.unrestrictedVars,t.lastElementIndex=this.lastElementIndex,t.varIndexByRow=this.varIndexByRow.slice(),t.varIndexByCol=this.varIndexByCol.slice(),t.rowByVarIndex=this.rowByVarIndex.slice(),t.colByVarIndex=this.colByVarIndex.slice(),t.availableIndexes=this.availableIndexes.slice();for(var e=[],n=0;n<this.optionalObjectives.length;n++)e[n]=this.optionalObjectives[n].copy();t.optionalObjectives=e;for(var i=this.matrix,r=new Array(this.height),u=0;u<this.height;u++)r[u]=i[u].slice();return t.matrix=r,t};j.prototype.save=function(){this.savedState=this.copy()};j.prototype.restore=function(){if(this.savedState!==null){var t=this.savedState,e=t.matrix;this.nVars=t.nVars,this.model=t.model,this.variables=t.variables,this.variablesPerIndex=t.variablesPerIndex,this.unrestrictedVars=t.unrestrictedVars,this.lastElementIndex=t.lastElementIndex,this.width=t.width,this.height=t.height;var n,i;for(n=0;n<this.height;n+=1){var r=e[n],u=this.matrix[n];for(i=0;i<this.width;i+=1)u[i]=r[i]}var s=t.varIndexByRow;for(i=0;i<this.height;i+=1)this.varIndexByRow[i]=s[i];for(;this.varIndexByRow.length>this.height;)this.varIndexByRow.pop();var o=t.varIndexByCol;for(n=0;n<this.width;n+=1)this.varIndexByCol[n]=o[n];for(;this.varIndexByCol.length>this.width;)this.varIndexByCol.pop();for(var a=t.rowByVarIndex,h=t.colByVarIndex,l=0;l<this.nVars;l+=1)this.rowByVarIndex[l]=a[l],this.colByVarIndex[l]=h[l];if(t.optionalObjectives.length>0&&this.optionalObjectives.length>0){this.optionalObjectives=[],this.optionalObjectivePerPriority={};for(var c=0;c<t.optionalObjectives.length;c++){var f=t.optionalObjectives[c].copy();this.optionalObjectives[c]=f,this.optionalObjectivePerPriority[f.priority]=f}}}};function Wi(t,e){this.index=t,this.value=e}j.prototype.getMostFractionalVar=function(){for(var t=0,e=null,n=null,i=this.model.integerVariables,r=i.length,u=0;u<r;u++){var s=i[u].index,o=this.rowByVarIndex[s];if(o!==-1){var a=this.matrix[o][this.rhsColumn],h=Math.abs(a-Math.round(a));t<h&&(t=h,e=s,n=a)}}return new Wi(e,n)};j.prototype.getFractionalVarWithLowestCost=function(){for(var t=1/0,e=null,n=null,i=this.model.integerVariables,r=i.length,u=0;u<r;u++){var s=i[u],o=s.index,a=this.rowByVarIndex[o];if(a!==-1){var h=this.matrix[a][this.rhsColumn];if(Math.abs(h-Math.round(h))>this.precision){var l=s.cost;t>l&&(t=l,e=o,n=h)}}}return new Wi(e,n)};j.prototype.countIntegerValues=function(){for(var t=0,e=1;e<this.height;e+=1)if(this.variablesPerIndex[this.varIndexByRow[e]].isInteger){var n=this.matrix[e][this.rhsColumn];n=n-Math.floor(n),n<this.precision&&-n<this.precision&&(t+=1)}return t};j.prototype.isIntegral=function(){for(var t=this.model.integerVariables,e=t.length,n=0;n<e;n++){var i=this.rowByVarIndex[t[n].index];if(i!==-1){var r=this.matrix[i][this.rhsColumn];if(Math.abs(r-Math.round(r))>this.precision)return!1}}return!0};j.prototype.computeFractionalVolume=function(t){for(var e=-1,n=1;n<this.height;n+=1)if(this.variablesPerIndex[this.varIndexByRow[n]].isInteger){var i=this.matrix[n][this.rhsColumn];i=Math.abs(i);var r=Math.min(i-Math.floor(i),Math.floor(i+1));if(r<this.precision){if(!t)return 0}else e===-1?e=i:e*=i}return e===-1?0:e};var Ca=j;function Qn(t,e,n){this.type=t,this.varIndex=e,this.value=n}function Ve(t,e){this.relaxedEvaluation=t,this.cuts=e}function Ea(t,e){return e.relaxedEvaluation-t.relaxedEvaluation}j.prototype.applyCuts=function(t){if(this.restore(),this.addCutConstraints(t),this.simplex(),this.model.useMIRCuts)for(var e=!0;e;){var n=this.computeFractionalVolume(!0);this.applyMIRCuts(),this.simplex();var i=this.computeFractionalVolume(!0);i>=.9*n&&(e=!1)}};j.prototype.branchAndCut=function(){var t=[],e=0,n=this.model.tolerance,i=!0,r=1e99;this.model.timeout&&(r=Date.now()+this.model.timeout);for(var u=1/0,s=null,o=[],a=0;a<this.optionalObjectives.length;a+=1)o.push(1/0);var h=new Ve(-1/0,[]),l;for(t.push(h);t.length>0&&i===!0&&Date.now()<r;)if(this.model.isMinimization?l=this.bestPossibleEval*(1+n):l=this.bestPossibleEval*(1-n),n>0&&u<l&&(i=!1),h=t.pop(),!(h.relaxedEvaluation>u)){var c=h.cuts;if(this.applyCuts(c),e++,this.feasible!==!1){var f=this.evaluation;if(!(f>u)){if(f===u){for(var d=!0,m=0;m<this.optionalObjectives.length&&!(this.optionalObjectives[m].reducedCosts[0]>o[m]);m+=1)if(this.optionalObjectives[m].reducedCosts[0]<o[m]){d=!1;break}if(d)continue}if(this.isIntegral()===!0){if(this.__isIntegral=!0,e===1){this.branchAndCutIterations=e;return}s=h,u=f;for(var p=0;p<this.optionalObjectives.length;p+=1)o[p]=this.optionalObjectives[p].reducedCosts[0]}else{e===1&&this.save();for(var y=this.getMostFractionalVar(),v=y.index,b=[],A=[],E=c.length,_=0;_<E;_+=1){var w=c[_];w.varIndex===v?w.type==="min"?A.push(w):b.push(w):(b.push(w),A.push(w))}var S=Math.ceil(y.value),k=Math.floor(y.value),I=new Qn("min",v,S);b.push(I);var x=new Qn("max",v,k);A.push(x),t.push(new Ve(f,b)),t.push(new Ve(f,A)),t.sort(Ea)}}}}s!==null&&this.applyCuts(s.cuts),this.branchAndCutIterations=e};var _a={},we=wt.Constraint,Yi=wt.Equality,Aa=wt.Variable,wa=wt.IntegerVariable;function W(t,e){this.tableau=new j(t),this.name=e,this.variables=[],this.integerVariables=[],this.unrestrictedVariables={},this.constraints=[],this.nConstraints=0,this.nVariables=0,this.isMinimization=!0,this.tableauInitialized=!1,this.relaxationIndex=1,this.useMIRCuts=!1,this.checkForCycles=!0,this.messages=[]}var ze=W;W.prototype.minimize=function(){return this.isMinimization=!0,this};W.prototype.maximize=function(){return this.isMinimization=!1,this};W.prototype._getNewElementIndex=function(){if(this.availableIndexes.length>0)return this.availableIndexes.pop();var t=this.lastElementIndex;return this.lastElementIndex+=1,t};W.prototype._addConstraint=function(t){var e=t.slack;this.tableau.variablesPerIndex[e.index]=e,this.constraints.push(t),this.nConstraints+=1,this.tableauInitialized===!0&&this.tableau.addConstraint(t)};W.prototype.smallerThan=function(t){var e=new we(t,!0,this.tableau.getNewElementIndex(),this);return this._addConstraint(e),e};W.prototype.greaterThan=function(t){var e=new we(t,!1,this.tableau.getNewElementIndex(),this);return this._addConstraint(e),e};W.prototype.equal=function(t){var e=new we(t,!0,this.tableau.getNewElementIndex(),this);this._addConstraint(e);var n=new we(t,!1,this.tableau.getNewElementIndex(),this);return this._addConstraint(n),new Yi(e,n)};W.prototype.addVariable=function(t,e,n,i,r){if(typeof r=="string")switch(r){case"required":r=0;break;case"strong":r=1;break;case"medium":r=2;break;case"weak":r=3;break;default:r=0;break}var u=this.tableau.getNewElementIndex();e==null&&(e="v"+u),t==null&&(t=0),r==null&&(r=0);var s;return n?(s=new wa(e,t,u,r),this.integerVariables.push(s)):s=new Aa(e,t,u,r),this.variables.push(s),this.tableau.variablesPerIndex[u]=s,i&&(this.unrestrictedVariables[u]=!0),this.nVariables+=1,this.tableauInitialized===!0&&this.tableau.addVariable(s),s};W.prototype._removeConstraint=function(t){var e=this.constraints.indexOf(t);if(e===-1){console.warn("[Model.removeConstraint] Constraint not present in model");return}this.constraints.splice(e,1),this.nConstraints-=1,this.tableauInitialized===!0&&this.tableau.removeConstraint(t),t.relaxation&&this.removeVariable(t.relaxation)};W.prototype.removeConstraint=function(t){return t.isEquality?(this._removeConstraint(t.upperBound),this._removeConstraint(t.lowerBound)):this._removeConstraint(t),this};W.prototype.removeVariable=function(t){var e=this.variables.indexOf(t);if(e===-1){console.warn("[Model.removeVariable] Variable not present in model");return}return this.variables.splice(e,1),this.tableauInitialized===!0&&this.tableau.removeVariable(t),this};W.prototype.updateRightHandSide=function(t,e){return this.tableauInitialized===!0&&this.tableau.updateRightHandSide(t,e),this};W.prototype.updateConstraintCoefficient=function(t,e,n){return this.tableauInitialized===!0&&this.tableau.updateConstraintCoefficient(t,e,n),this};W.prototype.setCost=function(t,e){var n=t-e.cost;return this.isMinimization===!1&&(n=-n),e.cost=t,this.tableau.updateCost(e,n),this};W.prototype.loadJson=function(t){this.isMinimization=t.opType!=="max";for(var e=t.variables,n=t.constraints,i={},r={},u=Object.keys(n),s=u.length,o=0;o<s;o+=1){var a=u[o],h=n[a],l=h.equal,c=h.weight,f=h.priority,d=c!==void 0||f!==void 0,m,p;if(l===void 0){var y=h.min;y!==void 0&&(m=this.greaterThan(y),i[a]=m,d&&m.relax(c,f));var v=h.max;v!==void 0&&(p=this.smallerThan(v),r[a]=p,d&&p.relax(c,f))}else{m=this.greaterThan(l),i[a]=m,p=this.smallerThan(l),r[a]=p;var b=new Yi(m,p);d&&b.relax(c,f)}}var A=Object.keys(e),E=A.length;this.tolerance=t.tolerance||0,t.timeout&&(this.timeout=t.timeout),t.options&&(t.options.timeout&&(this.timeout=t.options.timeout),this.tolerance===0&&(this.tolerance=t.options.tolerance||0),t.options.useMIRCuts&&(this.useMIRCuts=t.options.useMIRCuts),typeof t.options.exitOnCycles>"u"?this.checkForCycles=!0:this.checkForCycles=t.options.exitOnCycles);for(var _=t.ints||{},w=t.binaries||{},S=t.unrestricted||{},k=t.optimize,I=0;I<E;I+=1){var x=A[I],M=e[x],P=M[k]||0,G=!!w[x],g=!!_[x]||G,B=!!S[x],C=this.addVariable(P,x,g,B);G&&this.smallerThan(1).addTerm(1,C);var R=Object.keys(M);for(o=0;o<R.length;o+=1){var T=R[o];if(T!==k){var O=M[T],N=i[T];N!==void 0&&N.addTerm(O,C);var L=r[T];L!==void 0&&L.addTerm(O,C)}}}return this};W.prototype.getNumberOfIntegerVariables=function(){return this.integerVariables.length};W.prototype.solve=function(){return this.tableauInitialized===!1&&(this.tableau.setModel(this),this.tableauInitialized=!0),this.tableau.solve()};W.prototype.isFeasible=function(){return this.tableau.feasible};W.prototype.save=function(){return this.tableau.save()};W.prototype.restore=function(){return this.tableau.restore()};W.prototype.activateMIRCuts=function(t){this.useMIRCuts=t};W.prototype.debug=function(t){this.checkForCycles=t};W.prototype.log=function(t){return this.tableau.log(t)};var xa=function(t){var e,n,i;if(typeof t.optimize=="string")if(t.constraints[t.optimize]){e=Math.random();for(n in t.variables)t.variables[n][t.optimize]&&(t.variables[n][e]=t.variables[n][t.optimize]);return t.constraints[e]=t.constraints[t.optimize],delete t.constraints[t.optimize],t}else return t;else{for(i in t.optimize)if(t.constraints[i])if(t.constraints[i]==="equal")delete t.optimize[i];else{e=Math.random();for(n in t.variables)t.variables[n][i]&&(t.variables[n][e]=t.variables[n][i]);t.constraints[e]=t.constraints[i],delete t.constraints[i]}return t}},ti={CleanObjectiveAttributes:xa};function Fa(t){var e={is_blank:/^\W{0,}$/,is_objective:/(max|min)(imize){0,}\:/i,is_int:/^(?!\/\*)\W{0,}int/i,is_bin:/^(?!\/\*)\W{0,}bin/i,is_constraint:/(\>|\<){0,}\=/i,is_unrestricted:/^\S{0,}unrestricted/i,parse_lhs:/(\-|\+){0,1}\s{0,1}\d{0,}\.{0,}\d{0,}\s{0,}[A-Za-z]\S{0,}/gi,parse_rhs:/(\-|\+){0,1}\d{1,}\.{0,}\d{0,}\W{0,}\;{0,1}$/i,parse_dir:/(\>|\<){0,}\=/gi,parse_int:/[^\s|^\,]+/gi,parse_bin:/[^\s|^\,]+/gi,get_num:/(\-|\+){0,1}(\W|^)\d+\.{0,1}\d{0,}/g,get_word:/[A-Za-z].*/},n={opType:"",optimize:"_obj",constraints:{},variables:{}},i={">=":"min","<=":"max","=":"equal"},r="",u=null,s="",o="",a="",h=0;typeof t=="string"&&(t=t.split(`
`));for(var l=0;l<t.length;l++)if(a="__"+l,r=t[l],u=null,e.is_objective.test(r))n.opType=r.match(/(max|min)/gi)[0],u=r.match(e.parse_lhs).map(function(d){return d.replace(/\s+/,"")}).slice(1),u.forEach(function(d){s=d.match(e.get_num),s===null?d.substr(0,1)==="-"?s=-1:s=1:s=s[0],s=parseFloat(s),o=d.match(e.get_word)[0].replace(/\;$/,""),n.variables[o]=n.variables[o]||{},n.variables[o]._obj=s});else if(e.is_int.test(r))u=r.match(e.parse_int).slice(1),n.ints=n.ints||{},u.forEach(function(d){d=d.replace(";",""),n.ints[d]=1});else if(e.is_bin.test(r))u=r.match(e.parse_bin).slice(1),n.binaries=n.binaries||{},u.forEach(function(d){d=d.replace(";",""),n.binaries[d]=1});else if(e.is_constraint.test(r)){var c=r.indexOf(":"),f=c===-1?r:r.slice(c+1);u=f.match(e.parse_lhs).map(function(d){return d.replace(/\s+/,"")}),u.forEach(function(d){s=d.match(e.get_num),s===null?d.substr(0,1)==="-"?s=-1:s=1:s=s[0],s=parseFloat(s),o=d.match(e.get_word)[0],n.variables[o]=n.variables[o]||{},n.variables[o][a]=s}),h=parseFloat(r.match(e.parse_rhs)[0]),r=i[r.match(e.parse_dir)[0]],n.constraints[a]=n.constraints[a]||{},n.constraints[a][r]=h}else e.is_unrestricted.test(r)&&(u=r.match(e.parse_int).slice(1),n.unrestricted=n.unrestricted||{},u.forEach(function(d){d=d.replace(";",""),n.unrestricted[d]=1}));return n}function ba(t){if(!t)throw new Error("Solver requires a model to operate on");var e="",n={max:"<=",min:">=",equal:"="},i=new RegExp("[^A-Za-z0-9_[{}/.&#$%~'@^]","gi");if(t.opType){e+=t.opType+":";for(var r in t.variables)t.variables[r][r]=t.variables[r][r]?t.variables[r][r]:1,t.variables[r][t.optimize]&&(e+=" "+t.variables[r][t.optimize]+" "+r.replace(i,"_"))}else e+="max:";e+=`;

`;for(var u in t.constraints)for(var s in t.constraints[u])if(typeof n[s]<"u"){for(var o in t.variables)typeof t.variables[o][u]<"u"&&(e+=" "+t.variables[o][u]+" "+o.replace(i,"_"));e+=" "+n[s]+" "+t.constraints[u][s],e+=`;
`}if(t.ints){e+=`

`;for(var a in t.ints)e+="int "+a.replace(i,"_")+`;
`}if(t.unrestricted){e+=`

`;for(var h in t.unrestricted)e+="unrestricted "+h.replace(i,"_")+`;
`}return e}var wn=function(t){return t.length?Fa(t):ba(t)},Ba={},Ia=Object.freeze({__proto__:null,default:Ba});function Sa(t){if(t.__esModule)return t;var e=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(t).forEach(function(n){var i=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,i.get?i:{enumerable:!0,get:function(){return t[n]}})}),e}var ei=Sa(Ia),Ma=wn;function ni(t){return t=t.replace("\\r\\n",`\r
`),t=t.split(`\r
`),t=t.filter(function(e){var n;return n=new RegExp(" 0$","gi"),!(n.test(e)===!0||(n=new RegExp("\\d$","gi"),n.test(e)===!1))}).map(function(e){return e.split(/\:{0,1} +(?=\d)/)}).reduce(function(e,n,i){return e[n[0]]=n[1],e},{}),t}var Na=function(t){return new Promise(function(e,n){typeof window<"u"&&n("Function Not Available in Browser");var i=wn(t);t.external||n("Data for this function must be contained in the 'external' attribute. Not seeing anything there."),t.external.binPath||n("No Executable | Binary path provided in arguments as 'binPath'"),t.external.args||n("No arguments array for cli | bash provided on 'args' attribute"),t.external.tempName||n("No 'tempName' given. This is necessary to produce a staging file for the solver to operate on");var r=ei;r.writeFile(t.external.tempName,i,function(u,s){if(u)n(u);else{var o=ei.execFile;t.external.args.push(t.external.tempName),o(t.external.binPath,t.external.args,function(a,h){if(a)if(a.code===1)e(ni(h));else{var l={"-2":"Out of Memory",1:"SUBOPTIMAL",2:"INFEASIBLE",3:"UNBOUNDED",4:"DEGENERATE",5:"NUMFAILURE",6:"USER-ABORT",7:"TIMEOUT",9:"PRESOLVED",25:"ACCURACY ERROR",255:"FILE-ERROR"},c={code:a.code,meaning:l[a.code],data:h};n(c)}else e(ni(h))})}})})},$a={reformat:Ma,solve:Na},he={lpsolve:$a},ii=function(t,e){var n=e.optimize,i=JSON.parse(JSON.stringify(e.optimize)),r=Object.keys(e.optimize),u,s=0,o={},a="",h={},l=[],c,f,d,m;for(delete e.optimize,c=0;c<r.length;c++)i[r[c]]=0;for(c=0;c<r.length;c++){e.optimize=r[c],e.opType=n[r[c]],u=t.Solve(e,void 0,void 0,!0);for(m in r)if(!e.variables[r[m]]){u[r[m]]=u[r[m]]?u[r[m]]:0;for(d in e.variables)e.variables[d][r[m]]&&u[d]&&(u[r[m]]+=u[d]*e.variables[d][r[m]])}for(a="base",f=0;f<r.length;f++)u[r[f]]?a+="-"+(u[r[f]]*1e3|0)/1e3:a+="-0";if(!o[a]){for(o[a]=1,s++,f=0;f<r.length;f++)u[r[f]]&&(i[r[f]]+=u[r[f]]);delete u.feasible,delete u.result,l.push(u)}}for(c=0;c<r.length;c++)e.constraints[r[c]]={equal:i[r[c]]/s};e.optimize="cheater-"+Math.random(),e.opType="max";for(c in e.variables)e.variables[c].cheater=1;for(c in l)for(d in l[c])h[d]=h[d]||{min:1e99,max:-1e99};for(c in h)for(d in l)l[d][c]?(l[d][c]>h[c].max&&(h[c].max=l[d][c]),l[d][c]<h[c].min&&(h[c].min=l[d][c])):(l[d][c]=0,h[c].min=0);return u=t.Solve(e,void 0,void 0,!0),{midpoint:u,vertices:l,ranges:h}},Ta=wt.Constraint,Oa=wt.Variable,ka=wt.Numeral,Ra=wt.Term,en=function(){this.Model=ze,this.branchAndCut=_a,this.Constraint=Ta,this.Variable=Oa,this.Numeral=ka,this.Term=Ra,this.Tableau=Ca,this.lastSolvedModel=null,this.External=he,this.Solve=function(t,e,n,i){if(i)for(var r in ti)t=ti[r](t);if(!t)throw new Error("Solver requires a model to operate on");if(typeof t.optimize=="object"&&Object.keys(t.optimize>1))return ii(this,t);if(t.external){var u=Object.keys(he);if(u=JSON.stringify(u),!t.external.solver)throw new Error("The model you provided has an 'external' object that doesn't have a solver attribute. Use one of the following:"+u);if(!he[t.external.solver])throw new Error("No support (yet) for "+t.external.solver+". Please use one of these instead:"+u);return he[t.external.solver].solve(t)}else{t instanceof ze||(t=new ze(e).loadJson(t));var s=t.solve();if(this.lastSolvedModel=t,s.solutionSet=s.generateSolutionSet(),n)return s;var o={};return o.feasible=s.feasible,o.result=s.evaluation,o.bounded=s.bounded,s._tableau.__isIntegral&&(o.isIntegral=!0),Object.keys(s.solutionSet).forEach(function(a){s.solutionSet[a]!==0&&(o[a]=s.solutionSet[a])}),o}},this.ReformatLP=wn,this.MultiObjective=function(t){return ii(this,t)}};typeof window=="object"?window.solver=new en:typeof self=="object"&&(self.solver=new en);var Va=new en;function nn(t,e){const n=e?"":"\0",i=e?"rank: ":"\0",r=e?" -> ":"\0";function u(c){return`${n}${c.id}`}function s(c){return`${c.source.id}${r}${c.target.id}`}function o(c,f){return`${i}${c.id}${r}${f.id}`}function a(c){const f=Object.create(null),d=Object.create(null),m=Object.create(null),p=[];for(const _ of c){const w=u(_);d[w]=1,f[w]={opt:_.children.length};const S=t(_);S!==void 0&&p.push([S,_])}for(const _ of c.ilinks()){const w=f[u(_.source)],S=f[u(_.target)],k=s(_);m[k]={min:1},w[k]=-1,w.opt++,S[k]=1,S.opt--}let[y,...v]=p.sort(([_],[w])=>_-w);for(const _ of v){const[w,S]=y,[k,I]=_,x=f[u(S)],M=f[u(I)],P=o(S,I);if(w<k)m[P]={min:1},x[P]=-1,M[P]=1;else{const G=o(I,S);m[P]={min:0},m[G]={min:0},x[P]=-1,x[G]=1,M[P]=1,M[G]=-1}y=_}const b=Va.Solve({optimize:"opt",opType:"max",constraints:m,variables:f,ints:d}),{feasible:A}=b,E=ma(b,["feasible"]);if(!A)throw p.length?new Error("could not find a feasbile simplex layout, check that rank accessors are not ill-defined"):new Error("could not find feasbile simplex layout, this should not happen");for(const _ of c)_.layer=E[u(_)]||0}function h(c){return c===void 0?t:nn(c,e)}a.rank=h;function l(c){return c===void 0?e:nn(t,c)}return a.debug=l,a}function za(){}function Pa(...t){if(t.length)throw new Error(`got arguments to simplex(${t}), but constructor takes no aruguments.`);return nn(za,!1)}function La(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function*qa(t,e){for(let n of t)n!=null&&(n=+n)>=n&&(yield n)}function ri(t,e){let n;for(const i of t)i!=null&&(n<i||n===void 0&&i>=i)&&(n=i);return n}function ui(t,e){let n;for(const i of t)i!=null&&(n>i||n===void 0&&i>=i)&&(n=i);return n}function Ki(t,e,n=0,i=t.length-1,r=La){for(;i>n;){if(i-n>600){const a=i-n+1,h=e-n+1,l=Math.log(a),c=.5*Math.exp(2*l/3),f=.5*Math.sqrt(l*c*(a-c)/a)*(h-a/2<0?-1:1),d=Math.max(n,Math.floor(e-h*c/a+f)),m=Math.min(i,Math.floor(e+(a-h)*c/a+f));Ki(t,e,d,m,r)}const u=t[e];let s=n,o=i;for(Wt(t,n,e),r(t[i],u)>0&&Wt(t,n,i);s<o;){for(Wt(t,s,o),++s,--o;r(t[s],u)<0;)++s;for(;r(t[o],u)>0;)--o}r(t[n],u)===0?Wt(t,n,o):(++o,Wt(t,o,i)),o<=e&&(n=o+1),e<=o&&(i=o-1)}return t}function Wt(t,e,n){const i=t[e];t[e]=t[n],t[n]=i}function ja(t,e,n){if(t=Float64Array.from(qa(t)),!!(i=t.length)){if((e=+e)<=0||i<2)return ui(t);if(e>=1)return ri(t);var i,r=(i-1)*e,u=Math.floor(r),s=ri(Ki(t,u).subarray(0,u+1)),o=ui(t.subarray(u+1));return s+(o-s)*(r-u)}}function Ja(t,e){return ja(t,.5)}function Ua(...t){if(t.length)throw new Error(`got arguments to median(${t}), but constructor takes no aruguments.`);function e(n,i){const r=new at;for(const[o,a]of n.entries())for(const h of a.ichildren())r.setIfAbsent(h.id,[]).push(o);const u=new at;let s=-1;for(const o of i){const a=Ja(r.getDefault(o.id,[]));a===void 0?(u.set(o.id,s),s=+!((s+1)/(n.length+1))*(n.length+1)-1):u.set(o.id,a)}i.sort((o,a)=>u.getThrow(o.id)-u.getThrow(a.id))}return e}function Zi(t){function e(i){i.slice(0,i.length-1).forEach((r,u)=>t(r,i[u+1]))}function n(i){return i===void 0?t:Zi(i)}return e.order=n,e}function Ga(...t){if(t.length)throw new Error(`got arguments to twoLayer(${t}), but constructor takes no aruguments.`);return Zi(Ua())}function xt(t,e,n,i,r,u,s){const[o,a]=r;function h(A){const E=[];for(const _ of A.descendants()){const w=_.layer;(E[w]||(E[w]=[])).push(_),_.dataChildren=_.dataChildren.map(k=>{const I=k.child.layer;if(I<=w)throw new Error(`layering left child node "${k.child.id}" (${I}) with a greater or equal layer to parent node "${_.id}" (${w})`);let x=k.child;for(let M=I-1;M>w;M--){let P;s?P=`${_.id}->${k.child.id} (${M})`:P=`${_.id}\0${k.child.id}\0${M}`;const G=new bt(P);G.dataChildren.push(new ve(x,void 0)),(E[M]||(E[M]=[])).push(G),x=G}return new ve(x,k.data)})}return E}function l(A){for(const E of A)E instanceof bt||(E.dataChildren=E.dataChildren.map(_=>{let w=_.child;const S=[{x:E.x,y:E.y}];for(;w instanceof bt;)S.push({x:w.x,y:w.y}),[w]=w.ichildren();return S.push({x:w.x,y:w.y}),new ve(w,_.data,S)}))}function c(A){t(A);for(const w of A){const S=w.layer;if(S===void 0)throw new Error(`layering did not assign layer to node '${w.id}'`);if(S<0)throw new Error(`layering assigned a negative layer (${S}) to node '${w.id}'`)}const E=h(A);if(E.length===1){const[w]=E;for(const S of w)S.y=a/2}else{const w=i?a:a/(E.length-1);for(const[S,k]of E.entries())for(const I of k)I.y=w*S}if(E.every(w=>w.length===1))for(const[w]of E)w.x=o/2;else if(E.length===1){const[w]=E;Ji(w,u);const S=w,k=i?S.length-1:1;for(const I of S)I.x*=o*k}else{e(E),n(E,u);for(const k of E)for(const I of k)if(I.x===void 0)throw new Error(`coord didn't assign an x to node '${I.id}'`);const w=E,S=i?Math.max(...E.map(k=>k.length))-1:1;for(const k of w)for(const I of k)I.x*=o*S}const _=A;return l(_),_}function f(A){return A===void 0?t:xt(A,e,n,i,r,u,s)}c.layering=f;function d(A){return A===void 0?e:xt(t,A,n,i,r,u,s)}c.decross=d;function m(A){return A===void 0?n:xt(t,e,A,i,r,u,s)}c.coord=m;function p(A){return A!==void 0?xt(t,e,n,!1,A,u,s):i?null:r}c.size=p;function y(A){return A!==void 0?xt(t,e,n,!0,A,u,s):i?r:null}c.nodeSize=y;function v(A){return A===void 0?u:xt(t,e,n,i,r,A,s)}c.separation=v;function b(A){return A===void 0?s:xt(t,e,n,i,r,u,A)}return c.debug=b,c}function Ha(t,e){return+!(t instanceof bt)+ +!(e instanceof bt)}function Xa(...t){if(t.length)throw new Error(`got arguments to sugiyama(${t}), but constructor takes no aruguments.`);return xt(Pa(),Ga(),ga(),!1,[1,1],Ha,!1)}var Wa=function(t,e){return t<e};function Y(t){if(!(this instanceof Y))return new Y(t);this.array=[],this.size=0,this.compare=t||Wa}Y.prototype.clone=function(){var t=new Y(this.compare);t.size=this.size;for(var e=0;e<this.size;e++)t.array.push(this.array[e]);return t};Y.prototype.add=function(t){var e=this.size;this.array[this.size]=t,this.size+=1;for(var n,i;e>0&&(n=e-1>>1,i=this.array[n],!!this.compare(t,i));)this.array[e]=i,e=n;this.array[e]=t};Y.prototype.heapify=function(t){this.array=t,this.size=t.length;var e;for(e=this.size>>1;e>=0;e--)this._percolateDown(e)};Y.prototype._percolateUp=function(t,e){for(var n=this.array[t],i,r;t>0&&(i=t-1>>1,r=this.array[i],!(!e&&!this.compare(n,r)));)this.array[t]=r,t=i;this.array[t]=n};Y.prototype._percolateDown=function(t){for(var e=this.size,n=this.size>>>1,i=this.array[t],r,u,s;t<n&&(r=(t<<1)+1,u=r+1,s=this.array[r],u<e&&this.compare(this.array[u],s)&&(r=u,s=this.array[u]),!!this.compare(s,i));)this.array[t]=s,t=r;this.array[t]=i};Y.prototype._removeAt=function(t){if(!(t>this.size-1||t<0))return this._percolateUp(t,!0),this.poll()};Y.prototype.remove=function(t){for(var e=0;e<this.size;e++)if(!this.compare(this.array[e],t)&&!this.compare(t,this.array[e]))return this._removeAt(e),!0;return!1};Y.prototype._batchRemove=function(t,e){var n=new Array(e||this.size),i=0;if(typeof t=="function"&&this.size)for(var r=0;r<this.size&&i<n.length;)t(this.array[r])?(n[i]=this._removeAt(r),i++,r=r>>1):r++;return n.length=i,n};Y.prototype.removeOne=function(t){var e=this._batchRemove(t,1);return e.length>0?e[0]:void 0};Y.prototype.removeMany=function(t,e){return this._batchRemove(t,e)};Y.prototype.peek=function(){if(this.size!=0)return this.array[0]};Y.prototype.poll=function(){if(this.size!=0){var t=this.array[0];return this.size>1?(this.array[0]=this.array[--this.size],this._percolateDown(0)):this.size-=1,t}};Y.prototype.replaceTop=function(t){if(this.size!=0){var e=this.array[0];return this.array[0]=t,this._percolateDown(0),e}};Y.prototype.trim=function(){this.array=this.array.slice(0,this.size)};Y.prototype.isEmpty=function(){return this.size===0};Y.prototype.forEach=function(t){if(!(this.isEmpty()||typeof t!="function"))for(var e=0,n=this.clone();!n.isEmpty();)t(n.poll(),e++)};Y.prototype.kSmallest=function(t){if(this.size==0)return[];var e=this.compare,n=this.array,i=new Y(function(h,l){return e(n[h],n[l])});t=Math.min(this.size,t);var r=new Array(t),u=0;for(i.add(0);u<t;){var s=i.poll();r[u++]=this.array[s];var o=(s<<1)+1,a=o+1;o<this.size&&i.add(o),a<this.size&&i.add(a)}return r};var Ya=Y;class Ka{constructor(){this.before=[],this.parents=[]}}function Qi(t){function e(i){const r=t||Math.floor(Math.sqrt(i.size()+.5)),u=new at(i.idescendants().map(f=>[f.id,new Ka]));for(const f of i)for(const d of f.ichildren())u.getThrow(d.id).parents.push(f);function s(f,d){const m=u.getThrow(f.id).before,p=u.getThrow(d.id).before;for(const[y,v]of m.entries()){const b=p[y];if(b===void 0)return!1;if(v<b)return!0;if(b<v)return!1}return!0}const o=new Ya(s);for(const f of i.iroots())o.add(f);let a=0,h=0,l=0,c;for(;c=o.poll();){l<r&&u.getThrow(c.id).parents.every(f=>Qe(f.layer)<h)?(c.layer=h,l++):(c.layer=++h,l=1);for(const f of c.ichildren()){const{before:d,parents:m}=u.getThrow(f.id);d.push(a),d.length===m.length&&(d.sort((p,y)=>y-p),o.add(f))}a++}}function n(i){if(i===void 0)return t;if(i<0)throw new Error(`width must be non-negative: ${i}`);return Qi(i)}return e.width=n,e}function Za(...t){if(t.length)throw new Error(`got arguments to coffmanGraham(${t}), but constructor takes no aruguments.`);return Qi(0)}function Qa(...t){if(t.length)throw new Error(`got arguments to center(${t}), but constructor takes no aruguments.`);function e(n,i){const r=Math.max(...n.map(u=>{let[s,...o]=u,a=s.x=0;for(const h of o)a=h.x=a+i(s,h),s=h;return a}));if(r>0)for(const u of n){const s=Qe(u[u.length-1].x)/2;for(const o of u)o.x=(Qe(o.x)-s)/r+.5}else for(const u of n)for(const s of u)s.x=.5}return e}class tr{constructor(){this.stateAtEvent=new tl,this.eventCache=new el}}class tl{constructor(){this.state={}}setState(e,n){this.state[e]=n,console.log(`StateAtEvent ${e} is`,n)}getStateAsEventIds(e){return this.state[e]?new Set(Object.values(this.state[e])):new Set}getState(e){return this.state[e]?JSON.parse(JSON.stringify(this.state[e])):{}}}class el{constructor(){this.cache=new Map}store(e){this.cache.set(e.event_id,e)}get(e){return this.cache.get(e)}}class nl{constructor(e){this.scenario=e,this.index=e.events.length-1,this.eventIdOrdering=e.events.map(n=>n.event_id),this.currentEventId=this.eventIdOrdering[this.index]}next(){this.index++,this.index>=this.eventIdOrdering.length&&(this.index=this.eventIdOrdering.length-1),this.currentEventId=this.eventIdOrdering[this.index]}previous(){this.index--,this.index<0&&(this.index=0),this.currentEventId=this.eventIdOrdering[this.index]}goTo(e){for(let n=0;n<this.eventIdOrdering.length;n++)if(this.eventIdOrdering[n]===e){this.index=n,this.currentEventId=this.eventIdOrdering[this.index];break}}current(){return this.currentEventId}eventsUpToCurrent(){const e=[];for(let n=0;n<=this.index;n++)e.push(this.eventIdOrdering[n]);return e}async resolve(e,n){for(const i of this.eventsUpToCurrent())await this.resolveEvent(i,e,n)}async resolveEvent(e,n,i){if(n.stateAtEvent.getStateAsEventIds(e).size>0)return;const r=n.eventCache.get(e);let u={};switch(r.prev_events.length){case 0:break;case 1:{const s=r.prev_events[0],o=n.stateAtEvent.getState(s);Object.keys(o).length===0&&console.error(`WARN: we do not know the state at ${s} yet, so the state calculation for ${e} may be wrong!`),u=o;break}default:{const s=[];for(const o of r.prev_events){const a=n.stateAtEvent.getState(o);Object.keys(a).length===0&&console.error(`WARN: we do not know the state at ${o} yet, so the state calculation for ${e} may be wrong!`),s.push(a)}console.log("performing state resolution for prev_events:",r.prev_events),u=await i(r.room_id,this.scenario.roomVersion,s)}}r.state_key!=null&&(u[JSON.stringify([r.type,r.state_key])]=e),n.stateAtEvent.setState(e,u)}}class il{constructor(e,n){this.container=e,this.template=n}clear(){this.container.innerHTML=""}onEventClick(e){this.positionListener=e}onEventJsonClick(e){this.jsonListener=e}onCellClick(e){this.onClick(e,this.positionListener)}onJsonClick(e){this.onClick(e,this.jsonListener)}onClick(e,n){var u;const i=(u=e.target)==null?void 0:u.parentElement;if(!i)return;const r=i.getAttribute("id");r&&n&&n(r)}appendEvent(e,n){const i=this.template.content.firstElementChild.cloneNode(!0);i.setAttribute("id",n.event_id);const r=i.getElementsByClassName("eventlistrowprefix")[0];r.textContent=String(e),r.addEventListener("click",this.onCellClick.bind(this)),i.getElementsByClassName("eventlistrowjson")[0].addEventListener("click",this.onJsonClick.bind(this)),i.getElementsByClassName("eventlistrowbody")[0].textContent=this.textRepresentation(n),i.getElementsByClassName("eventlistroweventid")[0].textContent=n.event_id.substr(0,5),n.state_key!=null&&(i.style.fontWeight="600"),this.container.appendChild(i)}textRepresentation(e){var r;let n="",i="";if(e.state_key!=null)switch(e.type){case"m.room.create":n=`by ${e.content.creator}`;break;case"m.room.member":n=`${e.state_key}=${e.content.membership}`;break;case"m.room.join_rules":n=`(${e.content.join_rule})`;break;case"m.room.history_visibility":n=`(${e.content.history_visibility})`;break;case"m.room.name":n=`(${e.content.name})`;break;case"m.room.topic":n=`(${e.content.topic})`;break;default:e.state_key!==""&&(n=e.state_key)}else switch(e.type){case"m.reaction":i=(r=e.content["m.relates_to"])==null?void 0:r.key;break;case"m.room.message":i=e.content.body;break}return`${e.type} ${n}${i}`}highlight(e){if(this.highlightedEventId){const n=document.getElementById(this.highlightedEventId);n&&(n.style.backgroundColor="")}document.getElementById(e).style.backgroundColor="#6f8ea9",this.highlightedEventId=e}}var rl=/[\u1680\u2000-\u200A\u202F\u205F\u3000]/,ul=/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08BD\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312E\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FEA\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC03-\uDC37\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDF00-\uDF19]|\uD806[\uDCA0-\uDCDF\uDCFF\uDE00\uDE0B-\uDE32\uDE3A\uDE50\uDE5C-\uDE83\uDE86-\uDE89\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD46]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50\uDF93-\uDF9F\uDFE0\uDFE1]|\uD821[\uDC00-\uDFEC]|\uD822[\uDC00-\uDEF2]|\uD82C[\uDC00-\uDD1E\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]/,sl=/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05F0-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u082D\u0840-\u085B\u0860-\u086A\u08A0-\u08B4\u08B6-\u08BD\u08D4-\u08E1\u08E3-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u09FC\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0AF9-\u0AFF\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58-\u0C5A\u0C60-\u0C63\u0C66-\u0C6F\u0C80-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D00-\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D54-\u0D57\u0D5F-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1877\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19D9\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1C80-\u1C88\u1CD0-\u1CD2\u1CD4-\u1CF9\u1D00-\u1DF9\u1DFB-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u2E2F\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099\u309A\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312E\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FEA\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA827\uA840-\uA873\uA880-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD\uA900-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDDFD\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF7A\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00-\uDE03\uDE05\uDE06\uDE0C-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE38-\uDE3A\uDE3F\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE6\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC00-\uDC46\uDC66-\uDC6F\uDC7F-\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD00-\uDD34\uDD36-\uDD3F\uDD50-\uDD73\uDD76\uDD80-\uDDC4\uDDCA-\uDDCC\uDDD0-\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE37\uDE3E\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEEA\uDEF0-\uDEF9\uDF00-\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3C-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF50\uDF57\uDF5D-\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC00-\uDC4A\uDC50-\uDC59\uDC80-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDB5\uDDB8-\uDDC0\uDDD8-\uDDDD\uDE00-\uDE40\uDE44\uDE50-\uDE59\uDE80-\uDEB7\uDEC0-\uDEC9\uDF00-\uDF19\uDF1D-\uDF2B\uDF30-\uDF39]|\uD806[\uDCA0-\uDCE9\uDCFF\uDE00-\uDE3E\uDE47\uDE50-\uDE83\uDE86-\uDE99\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC36\uDC38-\uDC40\uDC50-\uDC59\uDC72-\uDC8F\uDC92-\uDCA7\uDCA9-\uDCB6\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD36\uDD3A\uDD3C\uDD3D\uDD3F-\uDD47\uDD50-\uDD59]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50-\uDF7E\uDF8F-\uDF9F\uDFE0\uDFE1]|\uD821[\uDC00-\uDFEC]|\uD822[\uDC00-\uDEF2]|\uD82C[\uDC00-\uDD1E\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9D\uDC9E]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD838[\uDC00-\uDC06\uDC08-\uDC18\uDC1B-\uDC21\uDC23\uDC24\uDC26-\uDC2A]|\uD83A[\uDC00-\uDCC4\uDCD0-\uDCD6\uDD00-\uDD4A\uDD50-\uDD59]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uDB40[\uDD00-\uDDEF]/,Pe={Space_Separator:rl,ID_Start:ul,ID_Continue:sl},K={isSpaceSeparator(t){return typeof t=="string"&&Pe.Space_Separator.test(t)},isIdStartChar(t){return typeof t=="string"&&(t>="a"&&t<="z"||t>="A"&&t<="Z"||t==="$"||t==="_"||Pe.ID_Start.test(t))},isIdContinueChar(t){return typeof t=="string"&&(t>="a"&&t<="z"||t>="A"&&t<="Z"||t>="0"&&t<="9"||t==="$"||t==="_"||t===""||t===""||Pe.ID_Continue.test(t))},isDigit(t){return typeof t=="string"&&/[0-9]/.test(t)},isHexDigit(t){return typeof t=="string"&&/[0-9A-Fa-f]/.test(t)}};let rn,et,Ct,xe,It,ct,tt,xn,te;var ol=function(e,n){rn=String(e),et="start",Ct=[],xe=0,It=1,ct=0,tt=void 0,xn=void 0,te=void 0;do tt=al(),cl[et]();while(tt.type!=="eof");return typeof n=="function"?un({"":te},"",n):te};function un(t,e,n){const i=t[e];if(i!=null&&typeof i=="object")if(Array.isArray(i))for(let r=0;r<i.length;r++){const u=String(r),s=un(i,u,n);s===void 0?delete i[u]:Object.defineProperty(i,u,{value:s,writable:!0,enumerable:!0,configurable:!0})}else for(const r in i){const u=un(i,r,n);u===void 0?delete i[r]:Object.defineProperty(i,r,{value:u,writable:!0,enumerable:!0,configurable:!0})}return n.call(t,e,i)}let z,V,Qt,gt,q;function al(){for(z="default",V="",Qt=!1,gt=1;;){q=_t();const t=er[z]();if(t)return t}}function _t(){if(rn[xe])return String.fromCodePoint(rn.codePointAt(xe))}function F(){const t=_t();return t===`
`?(It++,ct=0):t?ct+=t.length:ct++,t&&(xe+=t.length),t}const er={default(){switch(q){case"	":case"\v":case"\f":case" ":case"":case"\uFEFF":case`
`:case"\r":case"\u2028":case"\u2029":F();return;case"/":F(),z="comment";return;case void 0:return F(),H("eof")}if(K.isSpaceSeparator(q)){F();return}return er[et]()},comment(){switch(q){case"*":F(),z="multiLineComment";return;case"/":F(),z="singleLineComment";return}throw X(F())},multiLineComment(){switch(q){case"*":F(),z="multiLineCommentAsterisk";return;case void 0:throw X(F())}F()},multiLineCommentAsterisk(){switch(q){case"*":F();return;case"/":F(),z="default";return;case void 0:throw X(F())}F(),z="multiLineComment"},singleLineComment(){switch(q){case`
`:case"\r":case"\u2028":case"\u2029":F(),z="default";return;case void 0:return F(),H("eof")}F()},value(){switch(q){case"{":case"[":return H("punctuator",F());case"n":return F(),Nt("ull"),H("null",null);case"t":return F(),Nt("rue"),H("boolean",!0);case"f":return F(),Nt("alse"),H("boolean",!1);case"-":case"+":F()==="-"&&(gt=-1),z="sign";return;case".":V=F(),z="decimalPointLeading";return;case"0":V=F(),z="zero";return;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":V=F(),z="decimalInteger";return;case"I":return F(),Nt("nfinity"),H("numeric",1/0);case"N":return F(),Nt("aN"),H("numeric",NaN);case'"':case"'":Qt=F()==='"',V="",z="string";return}throw X(F())},identifierNameStartEscape(){if(q!=="u")throw X(F());F();const t=sn();switch(t){case"$":case"_":break;default:if(!K.isIdStartChar(t))throw si();break}V+=t,z="identifierName"},identifierName(){switch(q){case"$":case"_":case"":case"":V+=F();return;case"\\":F(),z="identifierNameEscape";return}if(K.isIdContinueChar(q)){V+=F();return}return H("identifier",V)},identifierNameEscape(){if(q!=="u")throw X(F());F();const t=sn();switch(t){case"$":case"_":case"":case"":break;default:if(!K.isIdContinueChar(t))throw si();break}V+=t,z="identifierName"},sign(){switch(q){case".":V=F(),z="decimalPointLeading";return;case"0":V=F(),z="zero";return;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":V=F(),z="decimalInteger";return;case"I":return F(),Nt("nfinity"),H("numeric",gt*(1/0));case"N":return F(),Nt("aN"),H("numeric",NaN)}throw X(F())},zero(){switch(q){case".":V+=F(),z="decimalPoint";return;case"e":case"E":V+=F(),z="decimalExponent";return;case"x":case"X":V+=F(),z="hexadecimal";return}return H("numeric",gt*0)},decimalInteger(){switch(q){case".":V+=F(),z="decimalPoint";return;case"e":case"E":V+=F(),z="decimalExponent";return}if(K.isDigit(q)){V+=F();return}return H("numeric",gt*Number(V))},decimalPointLeading(){if(K.isDigit(q)){V+=F(),z="decimalFraction";return}throw X(F())},decimalPoint(){switch(q){case"e":case"E":V+=F(),z="decimalExponent";return}if(K.isDigit(q)){V+=F(),z="decimalFraction";return}return H("numeric",gt*Number(V))},decimalFraction(){switch(q){case"e":case"E":V+=F(),z="decimalExponent";return}if(K.isDigit(q)){V+=F();return}return H("numeric",gt*Number(V))},decimalExponent(){switch(q){case"+":case"-":V+=F(),z="decimalExponentSign";return}if(K.isDigit(q)){V+=F(),z="decimalExponentInteger";return}throw X(F())},decimalExponentSign(){if(K.isDigit(q)){V+=F(),z="decimalExponentInteger";return}throw X(F())},decimalExponentInteger(){if(K.isDigit(q)){V+=F();return}return H("numeric",gt*Number(V))},hexadecimal(){if(K.isHexDigit(q)){V+=F(),z="hexadecimalInteger";return}throw X(F())},hexadecimalInteger(){if(K.isHexDigit(q)){V+=F();return}return H("numeric",gt*Number(V))},string(){switch(q){case"\\":F(),V+=ll();return;case'"':if(Qt)return F(),H("string",V);V+=F();return;case"'":if(!Qt)return F(),H("string",V);V+=F();return;case`
`:case"\r":throw X(F());case"\u2028":case"\u2029":fl(q);break;case void 0:throw X(F())}V+=F()},start(){switch(q){case"{":case"[":return H("punctuator",F())}z="value"},beforePropertyName(){switch(q){case"$":case"_":V=F(),z="identifierName";return;case"\\":F(),z="identifierNameStartEscape";return;case"}":return H("punctuator",F());case'"':case"'":Qt=F()==='"',z="string";return}if(K.isIdStartChar(q)){V+=F(),z="identifierName";return}throw X(F())},afterPropertyName(){if(q===":")return H("punctuator",F());throw X(F())},beforePropertyValue(){z="value"},afterPropertyValue(){switch(q){case",":case"}":return H("punctuator",F())}throw X(F())},beforeArrayValue(){if(q==="]")return H("punctuator",F());z="value"},afterArrayValue(){switch(q){case",":case"]":return H("punctuator",F())}throw X(F())},end(){throw X(F())}};function H(t,e){return{type:t,value:e,line:It,column:ct}}function Nt(t){for(const e of t){if(_t()!==e)throw X(F());F()}}function ll(){switch(_t()){case"b":return F(),"\b";case"f":return F(),"\f";case"n":return F(),`
`;case"r":return F(),"\r";case"t":return F(),"	";case"v":return F(),"\v";case"0":if(F(),K.isDigit(_t()))throw X(F());return"\0";case"x":return F(),hl();case"u":return F(),sn();case`
`:case"\u2028":case"\u2029":return F(),"";case"\r":return F(),_t()===`
`&&F(),"";case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":throw X(F());case void 0:throw X(F())}return F()}function hl(){let t="",e=_t();if(!K.isHexDigit(e)||(t+=F(),e=_t(),!K.isHexDigit(e)))throw X(F());return t+=F(),String.fromCodePoint(parseInt(t,16))}function sn(){let t="",e=4;for(;e-- >0;){const n=_t();if(!K.isHexDigit(n))throw X(F());t+=F()}return String.fromCodePoint(parseInt(t,16))}const cl={start(){if(tt.type==="eof")throw $t();Le()},beforePropertyName(){switch(tt.type){case"identifier":case"string":xn=tt.value,et="afterPropertyName";return;case"punctuator":ce();return;case"eof":throw $t()}},afterPropertyName(){if(tt.type==="eof")throw $t();et="beforePropertyValue"},beforePropertyValue(){if(tt.type==="eof")throw $t();Le()},beforeArrayValue(){if(tt.type==="eof")throw $t();if(tt.type==="punctuator"&&tt.value==="]"){ce();return}Le()},afterPropertyValue(){if(tt.type==="eof")throw $t();switch(tt.value){case",":et="beforePropertyName";return;case"}":ce()}},afterArrayValue(){if(tt.type==="eof")throw $t();switch(tt.value){case",":et="beforeArrayValue";return;case"]":ce()}},end(){}};function Le(){let t;switch(tt.type){case"punctuator":switch(tt.value){case"{":t={};break;case"[":t=[];break}break;case"null":case"boolean":case"numeric":case"string":t=tt.value;break}if(te===void 0)te=t;else{const e=Ct[Ct.length-1];Array.isArray(e)?e.push(t):Object.defineProperty(e,xn,{value:t,writable:!0,enumerable:!0,configurable:!0})}if(t!==null&&typeof t=="object")Ct.push(t),Array.isArray(t)?et="beforeArrayValue":et="beforePropertyName";else{const e=Ct[Ct.length-1];e==null?et="end":Array.isArray(e)?et="afterArrayValue":et="afterPropertyValue"}}function ce(){Ct.pop();const t=Ct[Ct.length-1];t==null?et="end":Array.isArray(t)?et="afterArrayValue":et="afterPropertyValue"}function X(t){return Fe(t===void 0?`JSON5: invalid end of input at ${It}:${ct}`:`JSON5: invalid character '${nr(t)}' at ${It}:${ct}`)}function $t(){return Fe(`JSON5: invalid end of input at ${It}:${ct}`)}function si(){return ct-=5,Fe(`JSON5: invalid identifier character at ${It}:${ct}`)}function fl(t){console.warn(`JSON5: '${nr(t)}' in strings is not valid ECMAScript; consider escaping`)}function nr(t){const e={"'":"\\'",'"':'\\"',"\\":"\\\\","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t","\v":"\\v","\0":"\\0","\u2028":"\\u2028","\u2029":"\\u2029"};if(e[t])return e[t];if(t<" "){const n=t.charCodeAt(0).toString(16);return"\\x"+("00"+n).substring(n.length)}return t}function Fe(t){const e=new SyntaxError(t);return e.lineNumber=It,e.columnNumber=ct,e}var dl=function(e,n,i){const r=[];let u="",s,o,a="",h;if(n!=null&&typeof n=="object"&&!Array.isArray(n)&&(i=n.space,h=n.quote,n=n.replacer),typeof n=="function")o=n;else if(Array.isArray(n)){s=[];for(const p of n){let y;typeof p=="string"?y=p:(typeof p=="number"||p instanceof String||p instanceof Number)&&(y=String(p)),y!==void 0&&s.indexOf(y)<0&&s.push(y)}}return i instanceof Number?i=Number(i):i instanceof String&&(i=String(i)),typeof i=="number"?i>0&&(i=Math.min(10,Math.floor(i)),a="          ".substr(0,i)):typeof i=="string"&&(a=i.substr(0,10)),l("",{"":e});function l(p,y){let v=y[p];switch(v!=null&&(typeof v.toJSON5=="function"?v=v.toJSON5(p):typeof v.toJSON=="function"&&(v=v.toJSON(p))),o&&(v=o.call(y,p,v)),v instanceof Number?v=Number(v):v instanceof String?v=String(v):v instanceof Boolean&&(v=v.valueOf()),v){case null:return"null";case!0:return"true";case!1:return"false"}if(typeof v=="string")return c(v);if(typeof v=="number")return String(v);if(typeof v=="object")return Array.isArray(v)?m(v):f(v)}function c(p){const y={"'":.1,'"':.2},v={"'":"\\'",'"':'\\"',"\\":"\\\\","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t","\v":"\\v","\0":"\\0","\u2028":"\\u2028","\u2029":"\\u2029"};let b="";for(let E=0;E<p.length;E++){const _=p[E];switch(_){case"'":case'"':y[_]++,b+=_;continue;case"\0":if(K.isDigit(p[E+1])){b+="\\x00";continue}}if(v[_]){b+=v[_];continue}if(_<" "){let w=_.charCodeAt(0).toString(16);b+="\\x"+("00"+w).substring(w.length);continue}b+=_}const A=h||Object.keys(y).reduce((E,_)=>y[E]<y[_]?E:_);return b=b.replace(new RegExp(A,"g"),v[A]),A+b+A}function f(p){if(r.indexOf(p)>=0)throw TypeError("Converting circular structure to JSON5");r.push(p);let y=u;u=u+a;let v=s||Object.keys(p),b=[];for(const E of v){const _=l(E,p);if(_!==void 0){let w=d(E)+":";a!==""&&(w+=" "),w+=_,b.push(w)}}let A;if(b.length===0)A="{}";else{let E;if(a==="")E=b.join(","),A="{"+E+"}";else{let _=`,
`+u;E=b.join(_),A=`{
`+u+E+`,
`+y+"}"}}return r.pop(),u=y,A}function d(p){if(p.length===0)return c(p);const y=String.fromCodePoint(p.codePointAt(0));if(!K.isIdStartChar(y))return c(p);for(let v=y.length;v<p.length;v++)if(!K.isIdContinueChar(String.fromCodePoint(p.codePointAt(v))))return c(p);return p}function m(p){if(r.indexOf(p)>=0)throw TypeError("Converting circular structure to JSON5");r.push(p);let y=u;u=u+a;let v=[];for(let A=0;A<p.length;A++){const E=l(String(A),p);v.push(E!==void 0?E:"null")}let b;if(v.length===0)b="[]";else if(a==="")b="["+v.join(",")+"]";else{let A=`,
`+u,E=v.join(A);b=`[
`+u+E+`,
`+y+"]"}return r.pop(),u=y,b}};const pl={parse:ol,stringify:dl};var Dl=pl;const vl="10";async function gl(t){const e=await new Promise((i,r)=>{const u=new FileReader;u.onload=s=>{if(!s.target||!s.target.result)return;if(t.name.endsWith(".json5")){i(Dl.parse(s.target.result));return}const o=s.target.result.split(`
`).filter(a=>a.trim().length>0).map(a=>JSON.parse(a));i(o)},u.readAsText(t)});let n;return Array.isArray(e)?n={tardis_version:1,room_version:vl,room_id:e[0].room_id,calculate_event_ids:!1,events:e}:n=e,ir(n)}function ir(t){var r;const e={events:[],roomVersion:t.room_version,annotations:t.annotations,precalculatedStateAfter:t.precalculated_state_after},n=new Map;let i=new Date().getTime();for(const u of t.events){if(!u)throw new Error("missing event");if(!u.event_id)throw new Error(`event is missing 'event_id', got ${JSON.stringify(u)}`);if(!u.type)throw new Error(`event is missing 'type' field, got ${JSON.stringify(u)}`);if(u.origin_server_ts||(u.origin_server_ts=i,i+=1e3),!u.room_id&&t.room_id&&(u.room_id=t.room_id),t.calculate_event_ids){const s=u.event_id;for(const a of["prev_events","auth_events"]){const h=[];for(const l of u[a]){const c=n.get(l);c?h.push(c):h.push(l)}u[a]=h}const o=globalThis.gmslEventIDForEvent(JSON.stringify(u),t.room_version);n.set(s,o),u.event_id=o,(r=e.annotations)!=null&&r.events[s]&&(e.annotations.events[o]=e.annotations.events[s])}e.events.push(u)}if(e.precalculatedStateAfter)for(const u in e.precalculatedStateAfter){const s=n.get(u);if(!s){console.error(`precalculated_state_after references ${u} but this does not exist in the events array. Skipping.`);continue}const o=[];for(const a of e.precalculatedStateAfter[u]){const h=n.get(a);h?o.push(h):console.error(`precalculated_state_after for ${u} references ${a} but this does not exist in the events array. Skipping.`)}e.precalculatedStateAfter[s]=o,delete e.precalculatedStateAfter[u]}return console.log(e),e}class ml{constructor(e,n){this.sender=e,this.getEvent=n,this.inflightRequests=new Map}onGetEventRequest(e){const n=this.getEvent(e);return n||console.error(`WS: asked for event ${e.event_id} but didn't find it.`),n}onResolveStateResponse(e,n){const i=this.inflightRequests.get(e);if(!i){console.error(`onResolveStateResponse: no request id for response! id=${e}`);return}i(n),this.inflightRequests.delete(e)}async resolveState(e,n,i){console.log("resolveState",i);const r=globalThis.crypto.randomUUID();return new Promise((s,o)=>{this.inflightRequests.set(r,a=>{if(!a.result){console.error("State resolved to the empty set"),s({state:{}});return}s({state:a.result})}),this.sender.sendResolveState(r,{state:i,room_id:e,room_version:n})})}}class yl{async sendResolveState(e,n){this.sendWs({id:e,type:"resolve_state",data:n})}async connect(e,n){return this.receiver=n,this.ws=new WebSocket(e),new Promise(i=>{this.ws.addEventListener("open",()=>{console.log("WS open"),i()}),this.ws.addEventListener("error",this.onWsError.bind(this)),this.ws.addEventListener("close",this.onWsClose.bind(this)),this.ws.addEventListener("message",this.onWsMessage.bind(this))})}close(){this.ws.close()}sendWs(e){console.log("send",e),this.ws.send(JSON.stringify(e))}onWsClose(e){}onWsError(e){}onWsMessage(e){const n=JSON.parse(e.data);switch(console.log("recv",n),n.type){case"get_event":{const i=n.data,r=this.receiver.onGetEventRequest(i);i.event=r,n.data=i,this.sendWs(n);break}case"resolve_state":{const i=n.data;this.receiver.onResolveStateResponse(n.id,i);break}}}}const mt=new il(document.getElementById("eventlist"),document.getElementById("eventlisttemplate"));class rr{constructor(e){this.cache=e,this.createEventId=null,this.showAuthChain=!1,this.showPrevEvents=!0,this.showOutliers=!1,this.collapse=!1,this.renderEvents={}}setShimUrl(e){this.shimUrl=e,console.log("setShimUrl",e)}async loadFile(e){const n=await gl(e);this.loadScenario(n)}loadScenario(e){for(const n of e.events)this.cache.eventCache.store(n),n.type==="m.room.create"&&n.state_key===""&&(this.createEventId=n.event_id);if(e.precalculatedStateAfter)for(const n in e.precalculatedStateAfter){const i={};for(const r of e.precalculatedStateAfter[n]){const u=this.cache.eventCache.get(r);if(!u||u.state_key==null){console.log(`precalculated_state_after for ${n} includes ${r} but it isn't a state event we know about. Skipping.`);continue}i[JSON.stringify([u.type,u.state_key])]=u.event_id}this.cache.stateAtEvent.setState(n,i)}this.scenario=e,this.debugger=new nl(e),mt.clear(),e.events.forEach((n,i)=>{mt.appendEvent(i,n)}),mt.highlight(this.debugger.current()),mt.onEventClick(n=>{this.debugger.goTo(n),this.refresh(),mt.highlight(U.debugger.current())}),mt.onEventJsonClick(n=>{document.getElementById("eventdetails").textContent=JSON.stringify(this.cache.eventCache.get(n),null,2),document.getElementById("infocontainer").style.display="block"}),this.refresh()}setShowAuthChain(e){this.showAuthChain=e}setShowPrevEvents(e){this.showPrevEvents=e}setShowOutliers(e){this.showOutliers=e}setCollapse(e){this.collapse=e}async refresh(){let e=await this.recalculate();this.collapse&&(e=this.collapsifier(e)),this.renderEvents=e,await this.render(this.eventsToCompleteDag(e))}async recalculate(){const e=Object.create(null);for(const n of this.debugger.eventsUpToCurrent())e[n]=this.cache.eventCache.get(n);return e}eventsToCompleteDag(e){for(const n in e){const i=e[n],r=["auth_events","prev_events"];for(const u of r)for(const s of i[u])e[s]||(this.cache.eventCache.get(s)?e[s]={event_id:s,prev_events:[],auth_events:[],state_key:"...",type:"...",content:{},sender:"",room_id:"!"}:e[s]={event_id:s,prev_events:[],auth_events:[],state_key:"missing",type:"missing",content:{},sender:"",room_id:"!"})}return e}findForwardExtremities(e){const n=new Set;for(const i in e)n.add(i);for(const i in e){const r=e[i];for(const u of r.prev_events)n.delete(u);for(const u of r.auth_events)n.delete(u)}return n}collapsifier(e){const n=JSON.parse(JSON.stringify(e)),i=this.findForwardExtremities(n),r=new Set;for(const h of i)r.add(h);const u=Object.create(null);for(const h in n){const l=n[h];for(const c of l.prev_events){const f=u[c]||0;u[c]=f+1}l.prev_events.length!==1&&r.add(l.event_id)}for(const h in u)u[h]>1&&r.add(h);const s=new Set;for(const h in n){if(r.has(h)){s.add(h);continue}const l=n[h];if(r.has(l.prev_events[0])){s.add(h);continue}for(const c of r){const f=n[c];if(!f)continue;let d=!1;for(const m of f.prev_events)if(m===h){s.add(h),d=!0;break}if(d)break}}const o=[],a=new Set;for(const h of i)o.push({id:h,from:h});for(;o.length>0;){const h=o.pop();if(!h)break;const l=h.id,c=n[l];if(a.has(l)||(a.add(l),!c))continue;for(const m of c.prev_events)o.push({id:m,from:h.id});if(s.has(l))continue;delete n[l];const f=n[h.from],d=[c.prev_events[0]];for(const m in f.prev_events)s.has(m)&&d.push(m);f.prev_events=d,f._collapse=f._collapse||0,f._collapse+=1,n[h.from]=f;for(const m of o)m.from===l&&(m.from=f.event_id)}return console.log("collapsifier complete"),n}async render(e){var k,I;const n=!this.showOutliers,i=document.getElementById("svgcontainer");i.innerHTML="";const r=i.offsetWidth,u=window.innerHeight;if(console.log(e),Object.keys(e).length<=1)return;let s=Yo().id(x=>x.event_id).parentIds(x=>this.showAuthChain?x.prev_events.concat(x.auth_events.filter(M=>M!==this.createEventId)):x.prev_events).parentData(x=>{const M=[],P=this.showAuthChain?x.prev_events.concat(x.auth_events):x.prev_events;for(const G of new Set(P))e[G]&&M.push([G,{auth:x.auth_events.includes(G)&&!x.prev_events.includes(G)}]);return M})(Object.values(e));const o=s.split();if(n){const x=o.filter(M=>M.descendants().length>1);x.length>1&&console.error(`hideOrphans: ${x.length} roots with children, this should not be possible unless there are 2 DAG chunks in this file`),s=x[0]}console.log("dag:",s);const a=10,h=a*4,l=document.createElementNS("http://www.w3.org/2000/svg","svg");l.setAttribute("width",String(r)),l.setAttribute("height",String(u)),l.setAttribute("viewBox",`${-h} ${-h} ${r+10*h} ${u+2*h}`);const c=yt(l),f=c.append("text").attr("x",r/3).attr("y",-40).style("font-size","24px");for(const x of(((I=(k=this.scenario)==null?void 0:k.annotations)==null?void 0:I.title)||"").split(`
`))f.append("tspan").attr("x",r/2).attr("dy","1.2em").text(x);const d=c.append("defs");Xa().layering(Za().width(2)).coord(Qa()).size([r,u])(s);const m=s.size(),p=Fo,y={};s.idescendants("after").forEach((x,M)=>{y[x.id]=p(M/m)});const v=Mo().curve($o).x(x=>x.x).y(x=>x.y),b=c.append("g").selectAll("path").data(s.links()).enter().append("path").attr("d",({points:x})=>v(x)).attr("fill","none").attr("stroke-width",x=>{const M=x.target;return M.data._collapse?M.data._collapse<5?5:10:3}).text("test").attr("stroke",x=>{const M=x.source,P=x.target,G=`${M.id}-${P.id}`,g=d.append("linearGradient").attr("id",G).attr("gradientUnits","userSpaceOnUse").attr("x1",M.x).attr("x2",P.x).attr("y1",M.y).attr("y2",P.y);return g.append("stop").attr("offset","0%").attr("stop-color",x.data.auth?y[M.id]:"#000"),g.append("stop").attr("offset","100%").attr("stop-color",x.data.auth?y[P.id]:"#000"),`url(#${G})`}),A=c.append("g").selectAll("g").data(s.descendants()).enter().append("g").attr("transform",({x,y:M})=>`translate(${x}, ${M})`),E=this.cache.stateAtEvent.getStateAsEventIds(this.debugger.current());A.append("circle").attr("r",x=>{const M=this.cache.eventCache.get(x.id);return M&&M.state_key!=null?a*1.5:a}).attr("fill",x=>x.id===this.debugger.current()?"#6f8ea9":E.has(x.id)?"green":"black");const _=x=>{var T,O,N,L;const M=x.data.event_id,P=M.substr(0,5);if((O=(T=this.scenario)==null?void 0:T.annotations)!=null&&O.events[M])return`${P} ${(L=(N=this.scenario)==null?void 0:N.annotations)==null?void 0:L.events[M]}`;const G=x.data.type;let g="";x.data.state_key&&(g=`(${x.data.state_key})`,G==="m.room.member"&&x.data.content.membership&&(g=`(${x.data.state_key}=${x.data.content.membership})`));const B=x.data.depth?`(${x.data.depth})`:"";let C=x.data._collapse?`+${x.data._collapse} more`:"";return C===""&&x.data.origin!==void 0&&(C=x.data.origin),`${P} ${B} ${G} ${g} ${C}`};A.append("text").text(x=>_(x)).attr("transform",`translate(${a+10}, 0)`).attr("font-family","sans-serif").attr("text-anchor","left").attr("alignment-baseline","middle").attr("fill","white").attr("opacity",.8).attr("stroke","white"),A.append("text").text(x=>_(x)).attr("cursor","pointer").on("click",async(x,M)=>{this.debugger.goTo(M.data.event_id),mt.highlight(M.data.event_id),this.refresh()}).attr("transform",`translate(${a+10}, 0)`).attr("font-family","sans-serif").attr("text-anchor","left").attr("alignment-baseline","middle").attr("fill",x=>"black");function w({transform:x}){A.attr("transform",M=>`translate(${x.applyX(M.x)}, ${x.applyY(M.y)})`),b.attr("d",({points:M})=>v(M.map(P=>({x:x.applyX(P.x),y:x.applyY(P.y)})))),f.attr("transform",()=>`translate(${x.applyX(f.attr("x"))}, ${x.applyY(f.attr("y"))})`)}const S=Po().scaleExtent([.1,10]).on("zoom",w);c.call(S).call(S.transform,yn),yt("#svgcontainer").append(()=>l)}}let U=new rr(new tr);U.setShimUrl(document.getElementById("shimurl").value);const on=new yl,oi=new ml(on,t=>U.cache.eventCache.get(t.event_id));document.getElementById("showauthevents").addEventListener("change",t=>{U.setShowAuthChain(t.target.checked),U.refresh()});document.getElementById("showauthevents").checked=U.showAuthChain;document.getElementById("showoutliers").addEventListener("change",t=>{U.setShowOutliers(t.target.checked),U.refresh()});document.getElementById("showoutliers").checked=U.showOutliers;document.getElementById("collapse").addEventListener("change",t=>{U.setCollapse(t.target.checked),U.refresh()});document.getElementById("collapse").checked=U.collapse;document.getElementById("jsonfile").addEventListener("change",async t=>{const e=document.getElementById("jsonfile").files;e&&(U=new rr(new tr),U.setShimUrl(document.getElementById("shimurl").value),await U.loadFile(e[0]))},!1);document.getElementById("closeinfocontainer").addEventListener("click",t=>{document.getElementById("infocontainer").style.display="none"});document.getElementById("infocontainer").style.display="none";document.getElementById("stepfwd").addEventListener("click",async t=>{U.debugger.next(),U.refresh(),mt.highlight(U.debugger.current())});document.getElementById("stepbwd").addEventListener("click",async t=>{U.debugger.previous(),U.refresh(),mt.highlight(U.debugger.current())});document.getElementById("shimurl").addEventListener("change",t=>{const e=t.target.value;U.setShimUrl(e),globalThis.localStorage.setItem("shim_url",e)});const ai=globalThis.localStorage.getItem("shim_url");ai&&(console.log("setting shim url from local storage"),document.getElementById("shimurl").value=ai);document.getElementById("resolve").addEventListener("click",async t=>{await U.debugger.resolve(U.cache,async(e,n,i)=>{if(!U.shimUrl)return console.error("you need to set a shim url to resolve state!"),{};try{return await on.connect(U.shimUrl,oi),(await oi.resolveState(e,n,i)).state}catch(r){console.error("failed to setup WS connection:",r)}finally{on.close()}return{}}),U.refresh()});const li=new Go;WebAssembly.instantiateStreaming(fetch("gmsl.wasm"),li.importObject).then(t=>{globalThis.wasm=t.instance,li.run(globalThis.wasm);const e=ir({calculate_event_ids:!0,events:[{type:"m.room.create",state_key:"",sender:"@creator:tardis",auth_events:[],prev_events:[],content:{creator:"@creator:tardis"},event_id:"$CREATE",origin_server_ts:140956024e4},{type:"m.room.member",state_key:"@creator:tardis",sender:"@creator:tardis",auth_events:["$CREATE"],prev_events:["$CREATE"],content:{membership:"join"},event_id:"$JOIN",origin_server_ts:1409560241e3},{type:"m.room.message",sender:"@creator:tardis",auth_events:["$CREATE","$JOIN"],prev_events:["$JOIN"],content:{body:"A wild fork appears!"},event_id:"$FORK1",origin_server_ts:1409560242e3},{type:"m.room.message",sender:"@creator:tardis",auth_events:["$CREATE","$JOIN"],prev_events:["$JOIN"],content:{body:"Another wild fork appears!"},event_id:"$FORK2",origin_server_ts:1409560243e3},{type:"m.room.message",sender:"@creator:tardis",auth_events:["$CREATE","$JOIN"],prev_events:["$FORK1","$FORK2"],content:{body:"Merged!"},event_id:"$MERGE",origin_server_ts:1409560244e3},{type:"m.room.message",sender:"@creator:tardis",auth_events:["$CREATE","$JOIN"],prev_events:["$MERGE"],content:{body:"This event has precalculated state"},event_id:"$PRESTATE",origin_server_ts:1409560245e3},{type:"m.room.name",state_key:"",sender:"@creator:tardis",auth_events:["$CREATE","$JOIN"],prev_events:["$PRESTATE"],content:{name:"State events are bigger than messages"},event_id:"$MSG",origin_server_ts:1409560246e3},{type:"m.room.message",sender:"@creator:tardis",auth_events:["$CREATE","$JOIN"],prev_events:["$MSG"],content:{body:"Boring long chains..."},event_id:"$MSG2",origin_server_ts:1409560246e3},{type:"m.room.message",sender:"@creator:tardis",auth_events:["$CREATE","$JOIN"],prev_events:["$MSG2"],content:{body:"...can be collapsed..."},event_id:"$MSG3",origin_server_ts:1409560246e3},{type:"m.room.message",sender:"@creator:tardis",auth_events:["$CREATE","$JOIN"],prev_events:["$MSG3"],content:{body:"...by checking the collapse checkbox."},event_id:"$MSG4",origin_server_ts:1409560246e3}],room_id:"!tutorial:tardis",room_version:"10",tardis_version:1,annotations:{title:["Welcome to TARDIS!","(click, drag, zoom to navigate the DAG)","Select a node or use the arrow buttons to jump forward/back, or select an event number to jump to that point in time.","If you are running a shim server:"," - type in your shim server URL,"," - jump to the event you want to calculate the 'current' state for,"," - hit 'Resolve State'."," - Nodes in green are part of the current state at this event."," - NOTE: as state resolution is iterative, it will resolve state for all earlier events as well."].join(`
`),events:{$MSG:"Bigger nodes like this one are state events.",$MSG2:"Boring long chains...",$MSG3:"...can be collapsed...",$MSG4:"...by checking the collapse checkbox.",$PRESTATE:"This event has pre-calculated state (in green) after this event"}},precalculated_state_after:{$PRESTATE:["$CREATE","$JOIN"]}});console.log(e),U.loadScenario(e)});
