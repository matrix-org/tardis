(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const u of s.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&i(u)}).observe(document,{childList:!0,subtree:!0});function n(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(r){if(r.ep)return;r.ep=!0;const s=n(r);fetch(r.href,s)}})();var ar={value:()=>{}};function an(){for(var t=0,e=arguments.length,n={},i;t<e;++t){if(!(i=arguments[t]+"")||i in n||/[\s.]/.test(i))throw new Error("illegal type: "+i);n[i]=[]}return new fe(n)}function fe(t){this._=t}function lr(t,e){return t.trim().split(/^|\s+/).map(function(n){var i="",r=n.indexOf(".");if(r>=0&&(i=n.slice(r+1),n=n.slice(0,r)),n&&!e.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:i}})}fe.prototype=an.prototype={constructor:fe,on:function(t,e){var n=this._,i=lr(t+"",n),r,s=-1,u=i.length;if(arguments.length<2){for(;++s<u;)if((r=(t=i[s]).type)&&(r=hr(n[r],t.name)))return r;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++s<u;)if(r=(t=i[s]).type)n[r]=bn(n[r],t.name,e);else if(e==null)for(r in n)n[r]=bn(n[r],t.name,null);return this},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new fe(t)},call:function(t,e){if((r=arguments.length-2)>0)for(var n=new Array(r),i=0,r,s;i<r;++i)n[i]=arguments[i+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(s=this._[t],i=0,r=s.length;i<r;++i)s[i].value.apply(e,n)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var i=this._[t],r=0,s=i.length;r<s;++r)i[r].value.apply(e,n)}};function hr(t,e){for(var n=0,i=t.length,r;n<i;++n)if((r=t[n]).name===e)return r.value}function bn(t,e,n){for(var i=0,r=t.length;i<r;++i)if(t[i].name===e){t[i]=ar,t=t.slice(0,i).concat(t.slice(i+1));break}return n!=null&&t.push({name:e,value:n}),t}var je="http://www.w3.org/1999/xhtml";const Fn={svg:"http://www.w3.org/2000/svg",xhtml:je,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Fe(t){var e=t+="",n=e.indexOf(":");return n>=0&&(e=t.slice(0,n))!=="xmlns"&&(t=t.slice(n+1)),Fn.hasOwnProperty(e)?{space:Fn[e],local:t}:t}function cr(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===je&&e.documentElement.namespaceURI===je?e.createElement(t):e.createElementNS(n,t)}}function fr(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function fi(t){var e=Fe(t);return(e.local?fr:cr)(e)}function dr(){}function ln(t){return t==null?dr:function(){return this.querySelector(t)}}function pr(t){typeof t!="function"&&(t=ln(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var s=e[r],u=s.length,o=i[r]=new Array(u),a,h,l=0;l<u;++l)(a=s[l])&&(h=t.call(a,a.__data__,l,s))&&("__data__"in a&&(h.__data__=a.__data__),o[l]=h);return new rt(i,this._parents)}function di(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function vr(){return[]}function pi(t){return t==null?vr:function(){return this.querySelectorAll(t)}}function Dr(t){return function(){var e=t.apply(this,arguments);return e==null?[]:di(e)}}function mr(t){typeof t=="function"?t=Dr(t):t=pi(t);for(var e=this._groups,n=e.length,i=[],r=[],s=0;s<n;++s)for(var u=e[s],o=u.length,a,h=0;h<o;++h)(a=u[h])&&(i.push(t.call(a,a.__data__,h,u)),r.push(a));return new rt(i,r)}function vi(t){return function(){return this.matches(t)}}function Di(t){return function(e){return e.matches(t)}}var gr=Array.prototype.find;function yr(t){return function(){return gr.call(this.children,t)}}function _r(){return this.firstElementChild}function Er(t){return this.select(t==null?_r:yr(typeof t=="function"?t:Di(t)))}var Cr=Array.prototype.filter;function Ar(){return this.children}function wr(t){return function(){return Cr.call(this.children,t)}}function xr(t){return this.selectAll(t==null?Ar:wr(typeof t=="function"?t:Di(t)))}function br(t){typeof t!="function"&&(t=vi(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var s=e[r],u=s.length,o=i[r]=[],a,h=0;h<u;++h)(a=s[h])&&t.call(a,a.__data__,h,s)&&o.push(a);return new rt(i,this._parents)}function mi(t){return new Array(t.length)}function Fr(){return new rt(this._enter||this._groups.map(mi),this._parents)}function ye(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}ye.prototype={constructor:ye,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function Br(t){return function(){return t}}function Ir(t,e,n,i,r,s){for(var u=0,o,a=e.length,h=s.length;u<h;++u)(o=e[u])?(o.__data__=s[u],i[u]=o):n[u]=new ye(t,s[u]);for(;u<a;++u)(o=e[u])&&(r[u]=o)}function $r(t,e,n,i,r,s,u){var o,a,h=new Map,l=e.length,c=s.length,f=new Array(l),d;for(o=0;o<l;++o)(a=e[o])&&(f[o]=d=u.call(a,a.__data__,o,e)+"",h.has(d)?r[o]=a:h.set(d,a));for(o=0;o<c;++o)d=u.call(t,s[o],o,s)+"",(a=h.get(d))?(i[o]=a,a.__data__=s[o],h.delete(d)):n[o]=new ye(t,s[o]);for(o=0;o<l;++o)(a=e[o])&&h.get(f[o])===a&&(r[o]=a)}function Sr(t){return t.__data__}function Mr(t,e){if(!arguments.length)return Array.from(this,Sr);var n=e?$r:Ir,i=this._parents,r=this._groups;typeof t!="function"&&(t=Br(t));for(var s=r.length,u=new Array(s),o=new Array(s),a=new Array(s),h=0;h<s;++h){var l=i[h],c=r[h],f=c.length,d=di(t.call(l,l&&l.__data__,h,i)),g=d.length,p=o[h]=new Array(g),_=u[h]=new Array(g),m=a[h]=new Array(f);n(l,c,p,_,m,d,e);for(var b=0,w=0,E,C;b<g;++b)if(E=p[b]){for(b>=w&&(w=b+1);!(C=_[w])&&++w<g;);E._next=C||null}}return u=new rt(u,i),u._enter=o,u._exit=a,u}function Rr(){return new rt(this._exit||this._groups.map(mi),this._parents)}function Tr(t,e,n){var i=this.enter(),r=this,s=this.exit();return i=typeof t=="function"?t(i):i.append(t+""),e!=null&&(r=e(r)),n==null?s.remove():n(s),i&&r?i.merge(r).order():r}function Nr(t){if(!(t instanceof rt))throw new Error("invalid merge");for(var e=this._groups,n=t._groups,i=e.length,r=n.length,s=Math.min(i,r),u=new Array(i),o=0;o<s;++o)for(var a=e[o],h=n[o],l=a.length,c=u[o]=new Array(l),f,d=0;d<l;++d)(f=a[d]||h[d])&&(c[d]=f);for(;o<i;++o)u[o]=e[o];return new rt(u,this._parents)}function kr(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var i=t[e],r=i.length-1,s=i[r],u;--r>=0;)(u=i[r])&&(s&&u.compareDocumentPosition(s)^4&&s.parentNode.insertBefore(u,s),s=u);return this}function Or(t){t||(t=Pr);function e(c,f){return c&&f?t(c.__data__,f.__data__):!c-!f}for(var n=this._groups,i=n.length,r=new Array(i),s=0;s<i;++s){for(var u=n[s],o=u.length,a=r[s]=new Array(o),h,l=0;l<o;++l)(h=u[l])&&(a[l]=h);a.sort(e)}return new rt(r,this._parents).order()}function Pr(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function Lr(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this}function Vr(){return Array.from(this)}function zr(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var i=t[e],r=0,s=i.length;r<s;++r){var u=i[r];if(u)return u}return null}function jr(){let t=0;for(const e of this)++t;return t}function qr(){return!this.node()}function Jr(t){for(var e=this._groups,n=0,i=e.length;n<i;++n)for(var r=e[n],s=0,u=r.length,o;s<u;++s)(o=r[s])&&t.call(o,o.__data__,s,r);return this}function Gr(t){return function(){this.removeAttribute(t)}}function Hr(t){return function(){this.removeAttributeNS(t.space,t.local)}}function Ur(t,e){return function(){this.setAttribute(t,e)}}function Xr(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function Wr(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttribute(t):this.setAttribute(t,n)}}function Yr(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}function Kr(t,e){var n=Fe(t);if(arguments.length<2){var i=this.node();return n.local?i.getAttributeNS(n.space,n.local):i.getAttribute(n)}return this.each((e==null?n.local?Hr:Gr:typeof e=="function"?n.local?Yr:Wr:n.local?Xr:Ur)(n,e))}function gi(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function Zr(t){return function(){this.style.removeProperty(t)}}function Qr(t,e,n){return function(){this.style.setProperty(t,e,n)}}function ts(t,e,n){return function(){var i=e.apply(this,arguments);i==null?this.style.removeProperty(t):this.style.setProperty(t,i,n)}}function es(t,e,n){return arguments.length>1?this.each((e==null?Zr:typeof e=="function"?ts:Qr)(t,e,n??"")):jt(this.node(),t)}function jt(t,e){return t.style.getPropertyValue(e)||gi(t).getComputedStyle(t,null).getPropertyValue(e)}function ns(t){return function(){delete this[t]}}function is(t,e){return function(){this[t]=e}}function rs(t,e){return function(){var n=e.apply(this,arguments);n==null?delete this[t]:this[t]=n}}function ss(t,e){return arguments.length>1?this.each((e==null?ns:typeof e=="function"?rs:is)(t,e)):this.node()[t]}function yi(t){return t.trim().split(/^|\s+/)}function hn(t){return t.classList||new _i(t)}function _i(t){this._node=t,this._names=yi(t.getAttribute("class")||"")}_i.prototype={add:function(t){var e=this._names.indexOf(t);e<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function Ei(t,e){for(var n=hn(t),i=-1,r=e.length;++i<r;)n.add(e[i])}function Ci(t,e){for(var n=hn(t),i=-1,r=e.length;++i<r;)n.remove(e[i])}function us(t){return function(){Ei(this,t)}}function os(t){return function(){Ci(this,t)}}function as(t,e){return function(){(e.apply(this,arguments)?Ei:Ci)(this,t)}}function ls(t,e){var n=yi(t+"");if(arguments.length<2){for(var i=hn(this.node()),r=-1,s=n.length;++r<s;)if(!i.contains(n[r]))return!1;return!0}return this.each((typeof e=="function"?as:e?us:os)(n,e))}function hs(){this.textContent=""}function cs(t){return function(){this.textContent=t}}function fs(t){return function(){var e=t.apply(this,arguments);this.textContent=e??""}}function ds(t){return arguments.length?this.each(t==null?hs:(typeof t=="function"?fs:cs)(t)):this.node().textContent}function ps(){this.innerHTML=""}function vs(t){return function(){this.innerHTML=t}}function Ds(t){return function(){var e=t.apply(this,arguments);this.innerHTML=e??""}}function ms(t){return arguments.length?this.each(t==null?ps:(typeof t=="function"?Ds:vs)(t)):this.node().innerHTML}function gs(){this.nextSibling&&this.parentNode.appendChild(this)}function ys(){return this.each(gs)}function _s(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Es(){return this.each(_s)}function Cs(t){var e=typeof t=="function"?t:fi(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function As(){return null}function ws(t,e){var n=typeof t=="function"?t:fi(t),i=e==null?As:typeof e=="function"?e:ln(e);return this.select(function(){return this.insertBefore(n.apply(this,arguments),i.apply(this,arguments)||null)})}function xs(){var t=this.parentNode;t&&t.removeChild(this)}function bs(){return this.each(xs)}function Fs(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function Bs(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function Is(t){return this.select(t?Bs:Fs)}function $s(t){return arguments.length?this.property("__data__",t):this.node().__data__}function Ss(t){return function(e){t.call(this,e,this.__data__)}}function Ms(t){return t.trim().split(/^|\s+/).map(function(e){var n="",i=e.indexOf(".");return i>=0&&(n=e.slice(i+1),e=e.slice(0,i)),{type:e,name:n}})}function Rs(t){return function(){var e=this.__on;if(e){for(var n=0,i=-1,r=e.length,s;n<r;++n)s=e[n],(!t.type||s.type===t.type)&&s.name===t.name?this.removeEventListener(s.type,s.listener,s.options):e[++i]=s;++i?e.length=i:delete this.__on}}}function Ts(t,e,n){return function(){var i=this.__on,r,s=Ss(e);if(i){for(var u=0,o=i.length;u<o;++u)if((r=i[u]).type===t.type&&r.name===t.name){this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=s,r.options=n),r.value=e;return}}this.addEventListener(t.type,s,n),r={type:t.type,name:t.name,value:e,listener:s,options:n},i?i.push(r):this.__on=[r]}}function Ns(t,e,n){var i=Ms(t+""),r,s=i.length,u;if(arguments.length<2){var o=this.node().__on;if(o){for(var a=0,h=o.length,l;a<h;++a)for(r=0,l=o[a];r<s;++r)if((u=i[r]).type===l.type&&u.name===l.name)return l.value}return}for(o=e?Ts:Rs,r=0;r<s;++r)this.each(o(i[r],e,n));return this}function Ai(t,e,n){var i=gi(t),r=i.CustomEvent;typeof r=="function"?r=new r(e,n):(r=i.document.createEvent("Event"),n?(r.initEvent(e,n.bubbles,n.cancelable),r.detail=n.detail):r.initEvent(e,!1,!1)),t.dispatchEvent(r)}function ks(t,e){return function(){return Ai(this,t,e)}}function Os(t,e){return function(){return Ai(this,t,e.apply(this,arguments))}}function Ps(t,e){return this.each((typeof e=="function"?Os:ks)(t,e))}function*Ls(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var i=t[e],r=0,s=i.length,u;r<s;++r)(u=i[r])&&(yield u)}var wi=[null];function rt(t,e){this._groups=t,this._parents=e}function se(){return new rt([[document.documentElement]],wi)}function Vs(){return this}rt.prototype=se.prototype={constructor:rt,select:pr,selectAll:mr,selectChild:Er,selectChildren:xr,filter:br,data:Mr,enter:Fr,exit:Rr,join:Tr,merge:Nr,selection:Vs,order:kr,sort:Or,call:Lr,nodes:Vr,node:zr,size:jr,empty:qr,each:Jr,attr:Kr,style:es,property:ss,classed:ls,text:ds,html:ms,raise:ys,lower:Es,append:Cs,insert:ws,remove:bs,clone:Is,datum:$s,on:Ns,dispatch:Ps,[Symbol.iterator]:Ls};function yt(t){return typeof t=="string"?new rt([[document.querySelector(t)]],[document.documentElement]):new rt([[t]],wi)}function zs(t){let e;for(;e=t.sourceEvent;)t=e;return t}function $t(t,e){if(t=zs(t),e===void 0&&(e=t.currentTarget),e){var n=e.ownerSVGElement||e;if(n.createSVGPoint){var i=n.createSVGPoint();return i.x=t.clientX,i.y=t.clientY,i=i.matrixTransform(e.getScreenCTM().inverse()),[i.x,i.y]}if(e.getBoundingClientRect){var r=e.getBoundingClientRect();return[t.clientX-r.left-e.clientLeft,t.clientY-r.top-e.clientTop]}}return[t.pageX,t.pageY]}function qe(t){t.preventDefault(),t.stopImmediatePropagation()}function js(t){var e=t.document.documentElement,n=yt(t).on("dragstart.drag",qe,!0);"onselectstart"in e?n.on("selectstart.drag",qe,!0):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}function qs(t,e){var n=t.document.documentElement,i=yt(t).on("dragstart.drag",null);e&&(i.on("click.drag",qe,!0),setTimeout(function(){i.on("click.drag",null)},0)),"onselectstart"in n?i.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}function Be(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function cn(t,e){var n=Object.create(t.prototype);for(var i in e)n[i]=e[i];return n}function Gt(){}var kt=.7,qt=1/kt,Vt="\\s*([+-]?\\d+)\\s*",ee="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",vt="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Js=/^#([0-9a-f]{3,8})$/,Gs=new RegExp("^rgb\\("+[Vt,Vt,Vt]+"\\)$"),Hs=new RegExp("^rgb\\("+[vt,vt,vt]+"\\)$"),Us=new RegExp("^rgba\\("+[Vt,Vt,Vt,ee]+"\\)$"),Xs=new RegExp("^rgba\\("+[vt,vt,vt,ee]+"\\)$"),Ws=new RegExp("^hsl\\("+[ee,vt,vt]+"\\)$"),Ys=new RegExp("^hsla\\("+[ee,vt,vt,ee]+"\\)$"),Bn={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Be(Gt,ne,{copy:function(t){return Object.assign(new this.constructor,this,t)},displayable:function(){return this.rgb().displayable()},hex:In,formatHex:In,formatHsl:Ks,formatRgb:$n,toString:$n});function In(){return this.rgb().formatHex()}function Ks(){return bi(this).formatHsl()}function $n(){return this.rgb().formatRgb()}function ne(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=Js.exec(t))?(n=e[1].length,e=parseInt(e[1],16),n===6?Sn(e):n===3?new it(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):n===8?ue(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):n===4?ue(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=Gs.exec(t))?new it(e[1],e[2],e[3],1):(e=Hs.exec(t))?new it(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=Us.exec(t))?ue(e[1],e[2],e[3],e[4]):(e=Xs.exec(t))?ue(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=Ws.exec(t))?Tn(e[1],e[2]/100,e[3]/100,1):(e=Ys.exec(t))?Tn(e[1],e[2]/100,e[3]/100,e[4]):Bn.hasOwnProperty(t)?Sn(Bn[t]):t==="transparent"?new it(NaN,NaN,NaN,0):null}function Sn(t){return new it(t>>16&255,t>>8&255,t&255,1)}function ue(t,e,n,i){return i<=0&&(t=e=n=NaN),new it(t,e,n,i)}function xi(t){return t instanceof Gt||(t=ne(t)),t?(t=t.rgb(),new it(t.r,t.g,t.b,t.opacity)):new it}function Je(t,e,n,i){return arguments.length===1?xi(t):new it(t,e,n,i??1)}function it(t,e,n,i){this.r=+t,this.g=+e,this.b=+n,this.opacity=+i}Be(it,Je,cn(Gt,{brighter:function(t){return t=t==null?qt:Math.pow(qt,t),new it(this.r*t,this.g*t,this.b*t,this.opacity)},darker:function(t){return t=t==null?kt:Math.pow(kt,t),new it(this.r*t,this.g*t,this.b*t,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Mn,formatHex:Mn,formatRgb:Rn,toString:Rn}));function Mn(){return"#"+Me(this.r)+Me(this.g)+Me(this.b)}function Rn(){var t=this.opacity;return t=isNaN(t)?1:Math.max(0,Math.min(1,t)),(t===1?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(t===1?")":", "+t+")")}function Me(t){return t=Math.max(0,Math.min(255,Math.round(t)||0)),(t<16?"0":"")+t.toString(16)}function Tn(t,e,n,i){return i<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new pt(t,e,n,i)}function bi(t){if(t instanceof pt)return new pt(t.h,t.s,t.l,t.opacity);if(t instanceof Gt||(t=ne(t)),!t)return new pt;if(t instanceof pt)return t;t=t.rgb();var e=t.r/255,n=t.g/255,i=t.b/255,r=Math.min(e,n,i),s=Math.max(e,n,i),u=NaN,o=s-r,a=(s+r)/2;return o?(e===s?u=(n-i)/o+(n<i)*6:n===s?u=(i-e)/o+2:u=(e-n)/o+4,o/=a<.5?s+r:2-s-r,u*=60):o=a>0&&a<1?0:u,new pt(u,o,a,t.opacity)}function Zs(t,e,n,i){return arguments.length===1?bi(t):new pt(t,e,n,i??1)}function pt(t,e,n,i){this.h=+t,this.s=+e,this.l=+n,this.opacity=+i}Be(pt,Zs,cn(Gt,{brighter:function(t){return t=t==null?qt:Math.pow(qt,t),new pt(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=t==null?kt:Math.pow(kt,t),new pt(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,i=n+(n<.5?n:1-n)*e,r=2*n-i;return new it(Re(t>=240?t-240:t+120,r,i),Re(t,r,i),Re(t<120?t+240:t-120,r,i),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var t=this.opacity;return t=isNaN(t)?1:Math.max(0,Math.min(1,t)),(t===1?"hsl(":"hsla(")+(this.h||0)+", "+(this.s||0)*100+"%, "+(this.l||0)*100+"%"+(t===1?")":", "+t+")")}}));function Re(t,e,n){return(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)*255}const Qs=Math.PI/180,tu=180/Math.PI;var Fi=-.14861,fn=1.78277,dn=-.29227,Ie=-.90649,ie=1.97294,Nn=ie*Ie,kn=ie*fn,On=fn*dn-Ie*Fi;function eu(t){if(t instanceof Nt)return new Nt(t.h,t.s,t.l,t.opacity);t instanceof it||(t=xi(t));var e=t.r/255,n=t.g/255,i=t.b/255,r=(On*i+Nn*e-kn*n)/(On+Nn-kn),s=i-r,u=(ie*(n-r)-dn*s)/Ie,o=Math.sqrt(u*u+s*s)/(ie*r*(1-r)),a=o?Math.atan2(u,s)*tu-120:NaN;return new Nt(a<0?a+360:a,o,r,t.opacity)}function Bt(t,e,n,i){return arguments.length===1?eu(t):new Nt(t,e,n,i??1)}function Nt(t,e,n,i){this.h=+t,this.s=+e,this.l=+n,this.opacity=+i}Be(Nt,Bt,cn(Gt,{brighter:function(t){return t=t==null?qt:Math.pow(qt,t),new Nt(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=t==null?kt:Math.pow(kt,t),new Nt(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=isNaN(this.h)?0:(this.h+120)*Qs,e=+this.l,n=isNaN(this.s)?0:this.s*e*(1-e),i=Math.cos(t),r=Math.sin(t);return new it(255*(e+n*(Fi*i+fn*r)),255*(e+n*(dn*i+Ie*r)),255*(e+n*(ie*i)),this.opacity)}}));const pn=t=>()=>t;function Bi(t,e){return function(n){return t+n*e}}function nu(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(i){return Math.pow(t+i*e,n)}}function iu(t,e){var n=e-t;return n?Bi(t,n>180||n<-180?n-360*Math.round(n/360):n):pn(isNaN(t)?e:t)}function ru(t){return(t=+t)==1?zt:function(e,n){return n-e?nu(e,n,t):pn(isNaN(e)?n:e)}}function zt(t,e){var n=e-t;return n?Bi(t,n):pn(isNaN(t)?e:t)}const Pn=function t(e){var n=ru(e);function i(r,s){var u=n((r=Je(r)).r,(s=Je(s)).r),o=n(r.g,s.g),a=n(r.b,s.b),h=zt(r.opacity,s.opacity);return function(l){return r.r=u(l),r.g=o(l),r.b=a(l),r.opacity=h(l),r+""}}return i.gamma=t,i}(1);function bt(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}var Ge=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Te=new RegExp(Ge.source,"g");function su(t){return function(){return t}}function uu(t){return function(e){return t(e)+""}}function ou(t,e){var n=Ge.lastIndex=Te.lastIndex=0,i,r,s,u=-1,o=[],a=[];for(t=t+"",e=e+"";(i=Ge.exec(t))&&(r=Te.exec(e));)(s=r.index)>n&&(s=e.slice(n,s),o[u]?o[u]+=s:o[++u]=s),(i=i[0])===(r=r[0])?o[u]?o[u]+=r:o[++u]=r:(o[++u]=null,a.push({i:u,x:bt(i,r)})),n=Te.lastIndex;return n<e.length&&(s=e.slice(n),o[u]?o[u]+=s:o[++u]=s),o.length<2?a[0]?uu(a[0].x):su(e):(e=a.length,function(h){for(var l=0,c;l<e;++l)o[(c=a[l]).i]=c.x(h);return o.join("")})}var Ln=180/Math.PI,He={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Ii(t,e,n,i,r,s){var u,o,a;return(u=Math.sqrt(t*t+e*e))&&(t/=u,e/=u),(a=t*n+e*i)&&(n-=t*a,i-=e*a),(o=Math.sqrt(n*n+i*i))&&(n/=o,i/=o,a/=o),t*i<e*n&&(t=-t,e=-e,a=-a,u=-u),{translateX:r,translateY:s,rotate:Math.atan2(e,t)*Ln,skewX:Math.atan(a)*Ln,scaleX:u,scaleY:o}}var oe;function au(t){const e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?He:Ii(e.a,e.b,e.c,e.d,e.e,e.f)}function lu(t){return t==null||(oe||(oe=document.createElementNS("http://www.w3.org/2000/svg","g")),oe.setAttribute("transform",t),!(t=oe.transform.baseVal.consolidate()))?He:(t=t.matrix,Ii(t.a,t.b,t.c,t.d,t.e,t.f))}function $i(t,e,n,i){function r(h){return h.length?h.pop()+" ":""}function s(h,l,c,f,d,g){if(h!==c||l!==f){var p=d.push("translate(",null,e,null,n);g.push({i:p-4,x:bt(h,c)},{i:p-2,x:bt(l,f)})}else(c||f)&&d.push("translate("+c+e+f+n)}function u(h,l,c,f){h!==l?(h-l>180?l+=360:l-h>180&&(h+=360),f.push({i:c.push(r(c)+"rotate(",null,i)-2,x:bt(h,l)})):l&&c.push(r(c)+"rotate("+l+i)}function o(h,l,c,f){h!==l?f.push({i:c.push(r(c)+"skewX(",null,i)-2,x:bt(h,l)}):l&&c.push(r(c)+"skewX("+l+i)}function a(h,l,c,f,d,g){if(h!==c||l!==f){var p=d.push(r(d)+"scale(",null,",",null,")");g.push({i:p-4,x:bt(h,c)},{i:p-2,x:bt(l,f)})}else(c!==1||f!==1)&&d.push(r(d)+"scale("+c+","+f+")")}return function(h,l){var c=[],f=[];return h=t(h),l=t(l),s(h.translateX,h.translateY,l.translateX,l.translateY,c,f),u(h.rotate,l.rotate,c,f),o(h.skewX,l.skewX,c,f),a(h.scaleX,h.scaleY,l.scaleX,l.scaleY,c,f),h=l=null,function(d){for(var g=-1,p=f.length,_;++g<p;)c[(_=f[g]).i]=_.x(d);return c.join("")}}}var hu=$i(au,"px, ","px)","deg)"),cu=$i(lu,", ",")",")"),fu=1e-12;function Vn(t){return((t=Math.exp(t))+1/t)/2}function du(t){return((t=Math.exp(t))-1/t)/2}function pu(t){return((t=Math.exp(2*t))-1)/(t+1)}const vu=function t(e,n,i){function r(s,u){var o=s[0],a=s[1],h=s[2],l=u[0],c=u[1],f=u[2],d=l-o,g=c-a,p=d*d+g*g,_,m;if(p<fu)m=Math.log(f/h)/e,_=function(I){return[o+I*d,a+I*g,h*Math.exp(e*I*m)]};else{var b=Math.sqrt(p),w=(f*f-h*h+i*p)/(2*h*n*b),E=(f*f-h*h-i*p)/(2*f*n*b),C=Math.log(Math.sqrt(w*w+1)-w),A=Math.log(Math.sqrt(E*E+1)-E);m=(A-C)/e,_=function(I){var N=I*m,B=Vn(C),k=h/(n*b)*(B*pu(e*N+C)-du(C));return[o+k*d,a+k*g,h*B/Vn(e*N+C)]}}return _.duration=m*1e3*e/Math.SQRT2,_}return r.rho=function(s){var u=Math.max(.001,+s),o=u*u,a=o*o;return t(u,o,a)},r}(Math.SQRT2,2,4);function Si(t){return function e(n){n=+n;function i(r,s){var u=t((r=Bt(r)).h,(s=Bt(s)).h),o=zt(r.s,s.s),a=zt(r.l,s.l),h=zt(r.opacity,s.opacity);return function(l){return r.h=u(l),r.s=o(l),r.l=a(Math.pow(l,n)),r.opacity=h(l),r+""}}return i.gamma=e,i}(1)}Si(iu);var Mi=Si(zt),Jt=0,Yt=0,Ut=0,Ri=1e3,_e,Kt,Ee=0,Ot=0,$e=0,re=typeof performance=="object"&&performance.now?performance:Date,Ti=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function vn(){return Ot||(Ti(Du),Ot=re.now()+$e)}function Du(){Ot=0}function Ce(){this._call=this._time=this._next=null}Ce.prototype=Ni.prototype={constructor:Ce,restart:function(t,e,n){if(typeof t!="function")throw new TypeError("callback is not a function");n=(n==null?vn():+n)+(e==null?0:+e),!this._next&&Kt!==this&&(Kt?Kt._next=this:_e=this,Kt=this),this._call=t,this._time=n,Ue()},stop:function(){this._call&&(this._call=null,this._time=1/0,Ue())}};function Ni(t,e,n){var i=new Ce;return i.restart(t,e,n),i}function mu(){vn(),++Jt;for(var t=_e,e;t;)(e=Ot-t._time)>=0&&t._call.call(null,e),t=t._next;--Jt}function zn(){Ot=(Ee=re.now())+$e,Jt=Yt=0;try{mu()}finally{Jt=0,yu(),Ot=0}}function gu(){var t=re.now(),e=t-Ee;e>Ri&&($e-=e,Ee=t)}function yu(){for(var t,e=_e,n,i=1/0;e;)e._call?(i>e._time&&(i=e._time),t=e,e=e._next):(n=e._next,e._next=null,e=t?t._next=n:_e=n);Kt=t,Ue(i)}function Ue(t){if(!Jt){Yt&&(Yt=clearTimeout(Yt));var e=t-Ot;e>24?(t<1/0&&(Yt=setTimeout(zn,t-re.now()-$e)),Ut&&(Ut=clearInterval(Ut))):(Ut||(Ee=re.now(),Ut=setInterval(gu,Ri)),Jt=1,Ti(zn))}}function jn(t,e,n){var i=new Ce;return e=e==null?0:+e,i.restart(r=>{i.stop(),t(r+e)},e,n),i}var _u=an("start","end","cancel","interrupt"),Eu=[],ki=0,qn=1,Xe=2,de=3,Jn=4,We=5,pe=6;function Se(t,e,n,i,r,s){var u=t.__transition;if(!u)t.__transition={};else if(n in u)return;Cu(t,n,{name:e,index:i,group:r,on:_u,tween:Eu,time:s.time,delay:s.delay,duration:s.duration,ease:s.ease,timer:null,state:ki})}function Dn(t,e){var n=ft(t,e);if(n.state>ki)throw new Error("too late; already scheduled");return n}function Dt(t,e){var n=ft(t,e);if(n.state>de)throw new Error("too late; already running");return n}function ft(t,e){var n=t.__transition;if(!n||!(n=n[e]))throw new Error("transition not found");return n}function Cu(t,e,n){var i=t.__transition,r;i[e]=n,n.timer=Ni(s,0,n.time);function s(h){n.state=qn,n.timer.restart(u,n.delay,n.time),n.delay<=h&&u(h-n.delay)}function u(h){var l,c,f,d;if(n.state!==qn)return a();for(l in i)if(d=i[l],d.name===n.name){if(d.state===de)return jn(u);d.state===Jn?(d.state=pe,d.timer.stop(),d.on.call("interrupt",t,t.__data__,d.index,d.group),delete i[l]):+l<e&&(d.state=pe,d.timer.stop(),d.on.call("cancel",t,t.__data__,d.index,d.group),delete i[l])}if(jn(function(){n.state===de&&(n.state=Jn,n.timer.restart(o,n.delay,n.time),o(h))}),n.state=Xe,n.on.call("start",t,t.__data__,n.index,n.group),n.state===Xe){for(n.state=de,r=new Array(f=n.tween.length),l=0,c=-1;l<f;++l)(d=n.tween[l].value.call(t,t.__data__,n.index,n.group))&&(r[++c]=d);r.length=c+1}}function o(h){for(var l=h<n.duration?n.ease.call(null,h/n.duration):(n.timer.restart(a),n.state=We,1),c=-1,f=r.length;++c<f;)r[c].call(t,l);n.state===We&&(n.on.call("end",t,t.__data__,n.index,n.group),a())}function a(){n.state=pe,n.timer.stop(),delete i[e];for(var h in i)return;delete t.__transition}}function ve(t,e){var n=t.__transition,i,r,s=!0,u;if(n){e=e==null?null:e+"";for(u in n){if((i=n[u]).name!==e){s=!1;continue}r=i.state>Xe&&i.state<We,i.state=pe,i.timer.stop(),i.on.call(r?"interrupt":"cancel",t,t.__data__,i.index,i.group),delete n[u]}s&&delete t.__transition}}function Au(t){return this.each(function(){ve(this,t)})}function wu(t,e){var n,i;return function(){var r=Dt(this,t),s=r.tween;if(s!==n){i=n=s;for(var u=0,o=i.length;u<o;++u)if(i[u].name===e){i=i.slice(),i.splice(u,1);break}}r.tween=i}}function xu(t,e,n){var i,r;if(typeof n!="function")throw new Error;return function(){var s=Dt(this,t),u=s.tween;if(u!==i){r=(i=u).slice();for(var o={name:e,value:n},a=0,h=r.length;a<h;++a)if(r[a].name===e){r[a]=o;break}a===h&&r.push(o)}s.tween=r}}function bu(t,e){var n=this._id;if(t+="",arguments.length<2){for(var i=ft(this.node(),n).tween,r=0,s=i.length,u;r<s;++r)if((u=i[r]).name===t)return u.value;return null}return this.each((e==null?wu:xu)(n,t,e))}function mn(t,e,n){var i=t._id;return t.each(function(){var r=Dt(this,i);(r.value||(r.value={}))[e]=n.apply(this,arguments)}),function(r){return ft(r,i).value[e]}}function Oi(t,e){var n;return(typeof e=="number"?bt:e instanceof ne?Pn:(n=ne(e))?(e=n,Pn):ou)(t,e)}function Fu(t){return function(){this.removeAttribute(t)}}function Bu(t){return function(){this.removeAttributeNS(t.space,t.local)}}function Iu(t,e,n){var i,r=n+"",s;return function(){var u=this.getAttribute(t);return u===r?null:u===i?s:s=e(i=u,n)}}function $u(t,e,n){var i,r=n+"",s;return function(){var u=this.getAttributeNS(t.space,t.local);return u===r?null:u===i?s:s=e(i=u,n)}}function Su(t,e,n){var i,r,s;return function(){var u,o=n(this),a;return o==null?void this.removeAttribute(t):(u=this.getAttribute(t),a=o+"",u===a?null:u===i&&a===r?s:(r=a,s=e(i=u,o)))}}function Mu(t,e,n){var i,r,s;return function(){var u,o=n(this),a;return o==null?void this.removeAttributeNS(t.space,t.local):(u=this.getAttributeNS(t.space,t.local),a=o+"",u===a?null:u===i&&a===r?s:(r=a,s=e(i=u,o)))}}function Ru(t,e){var n=Fe(t),i=n==="transform"?cu:Oi;return this.attrTween(t,typeof e=="function"?(n.local?Mu:Su)(n,i,mn(this,"attr."+t,e)):e==null?(n.local?Bu:Fu)(n):(n.local?$u:Iu)(n,i,e))}function Tu(t,e){return function(n){this.setAttribute(t,e.call(this,n))}}function Nu(t,e){return function(n){this.setAttributeNS(t.space,t.local,e.call(this,n))}}function ku(t,e){var n,i;function r(){var s=e.apply(this,arguments);return s!==i&&(n=(i=s)&&Nu(t,s)),n}return r._value=e,r}function Ou(t,e){var n,i;function r(){var s=e.apply(this,arguments);return s!==i&&(n=(i=s)&&Tu(t,s)),n}return r._value=e,r}function Pu(t,e){var n="attr."+t;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(e==null)return this.tween(n,null);if(typeof e!="function")throw new Error;var i=Fe(t);return this.tween(n,(i.local?ku:Ou)(i,e))}function Lu(t,e){return function(){Dn(this,t).delay=+e.apply(this,arguments)}}function Vu(t,e){return e=+e,function(){Dn(this,t).delay=e}}function zu(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?Lu:Vu)(e,t)):ft(this.node(),e).delay}function ju(t,e){return function(){Dt(this,t).duration=+e.apply(this,arguments)}}function qu(t,e){return e=+e,function(){Dt(this,t).duration=e}}function Ju(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?ju:qu)(e,t)):ft(this.node(),e).duration}function Gu(t,e){if(typeof e!="function")throw new Error;return function(){Dt(this,t).ease=e}}function Hu(t){var e=this._id;return arguments.length?this.each(Gu(e,t)):ft(this.node(),e).ease}function Uu(t,e){return function(){var n=e.apply(this,arguments);if(typeof n!="function")throw new Error;Dt(this,t).ease=n}}function Xu(t){if(typeof t!="function")throw new Error;return this.each(Uu(this._id,t))}function Wu(t){typeof t!="function"&&(t=vi(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var s=e[r],u=s.length,o=i[r]=[],a,h=0;h<u;++h)(a=s[h])&&t.call(a,a.__data__,h,s)&&o.push(a);return new At(i,this._parents,this._name,this._id)}function Yu(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,n=t._groups,i=e.length,r=n.length,s=Math.min(i,r),u=new Array(i),o=0;o<s;++o)for(var a=e[o],h=n[o],l=a.length,c=u[o]=new Array(l),f,d=0;d<l;++d)(f=a[d]||h[d])&&(c[d]=f);for(;o<i;++o)u[o]=e[o];return new At(u,this._parents,this._name,this._id)}function Ku(t){return(t+"").trim().split(/^|\s+/).every(function(e){var n=e.indexOf(".");return n>=0&&(e=e.slice(0,n)),!e||e==="start"})}function Zu(t,e,n){var i,r,s=Ku(e)?Dn:Dt;return function(){var u=s(this,t),o=u.on;o!==i&&(r=(i=o).copy()).on(e,n),u.on=r}}function Qu(t,e){var n=this._id;return arguments.length<2?ft(this.node(),n).on.on(t):this.each(Zu(n,t,e))}function to(t){return function(){var e=this.parentNode;for(var n in this.__transition)if(+n!==t)return;e&&e.removeChild(this)}}function eo(){return this.on("end.remove",to(this._id))}function no(t){var e=this._name,n=this._id;typeof t!="function"&&(t=ln(t));for(var i=this._groups,r=i.length,s=new Array(r),u=0;u<r;++u)for(var o=i[u],a=o.length,h=s[u]=new Array(a),l,c,f=0;f<a;++f)(l=o[f])&&(c=t.call(l,l.__data__,f,o))&&("__data__"in l&&(c.__data__=l.__data__),h[f]=c,Se(h[f],e,n,f,h,ft(l,n)));return new At(s,this._parents,e,n)}function io(t){var e=this._name,n=this._id;typeof t!="function"&&(t=pi(t));for(var i=this._groups,r=i.length,s=[],u=[],o=0;o<r;++o)for(var a=i[o],h=a.length,l,c=0;c<h;++c)if(l=a[c]){for(var f=t.call(l,l.__data__,c,a),d,g=ft(l,n),p=0,_=f.length;p<_;++p)(d=f[p])&&Se(d,e,n,p,f,g);s.push(f),u.push(l)}return new At(s,u,e,n)}var ro=se.prototype.constructor;function so(){return new ro(this._groups,this._parents)}function uo(t,e){var n,i,r;return function(){var s=jt(this,t),u=(this.style.removeProperty(t),jt(this,t));return s===u?null:s===n&&u===i?r:r=e(n=s,i=u)}}function Pi(t){return function(){this.style.removeProperty(t)}}function oo(t,e,n){var i,r=n+"",s;return function(){var u=jt(this,t);return u===r?null:u===i?s:s=e(i=u,n)}}function ao(t,e,n){var i,r,s;return function(){var u=jt(this,t),o=n(this),a=o+"";return o==null&&(a=o=(this.style.removeProperty(t),jt(this,t))),u===a?null:u===i&&a===r?s:(r=a,s=e(i=u,o))}}function lo(t,e){var n,i,r,s="style."+e,u="end."+s,o;return function(){var a=Dt(this,t),h=a.on,l=a.value[s]==null?o||(o=Pi(e)):void 0;(h!==n||r!==l)&&(i=(n=h).copy()).on(u,r=l),a.on=i}}function ho(t,e,n){var i=(t+="")=="transform"?hu:Oi;return e==null?this.styleTween(t,uo(t,i)).on("end.style."+t,Pi(t)):typeof e=="function"?this.styleTween(t,ao(t,i,mn(this,"style."+t,e))).each(lo(this._id,t)):this.styleTween(t,oo(t,i,e),n).on("end.style."+t,null)}function co(t,e,n){return function(i){this.style.setProperty(t,e.call(this,i),n)}}function fo(t,e,n){var i,r;function s(){var u=e.apply(this,arguments);return u!==r&&(i=(r=u)&&co(t,u,n)),i}return s._value=e,s}function po(t,e,n){var i="style."+(t+="");if(arguments.length<2)return(i=this.tween(i))&&i._value;if(e==null)return this.tween(i,null);if(typeof e!="function")throw new Error;return this.tween(i,fo(t,e,n??""))}function vo(t){return function(){this.textContent=t}}function Do(t){return function(){var e=t(this);this.textContent=e??""}}function mo(t){return this.tween("text",typeof t=="function"?Do(mn(this,"text",t)):vo(t==null?"":t+""))}function go(t){return function(e){this.textContent=t.call(this,e)}}function yo(t){var e,n;function i(){var r=t.apply(this,arguments);return r!==n&&(e=(n=r)&&go(r)),e}return i._value=t,i}function _o(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(t==null)return this.tween(e,null);if(typeof t!="function")throw new Error;return this.tween(e,yo(t))}function Eo(){for(var t=this._name,e=this._id,n=Li(),i=this._groups,r=i.length,s=0;s<r;++s)for(var u=i[s],o=u.length,a,h=0;h<o;++h)if(a=u[h]){var l=ft(a,e);Se(a,t,n,h,u,{time:l.time+l.delay+l.duration,delay:0,duration:l.duration,ease:l.ease})}return new At(i,this._parents,t,n)}function Co(){var t,e,n=this,i=n._id,r=n.size();return new Promise(function(s,u){var o={value:u},a={value:function(){--r===0&&s()}};n.each(function(){var h=Dt(this,i),l=h.on;l!==t&&(e=(t=l).copy(),e._.cancel.push(o),e._.interrupt.push(o),e._.end.push(a)),h.on=e}),r===0&&s()})}var Ao=0;function At(t,e,n,i){this._groups=t,this._parents=e,this._name=n,this._id=i}function Li(){return++Ao}var St=se.prototype;At.prototype={constructor:At,select:no,selectAll:io,filter:Wu,merge:Yu,selection:so,transition:Eo,call:St.call,nodes:St.nodes,node:St.node,size:St.size,empty:St.empty,each:St.each,on:Qu,attr:Ru,attrTween:Pu,style:ho,styleTween:po,text:mo,textTween:_o,remove:eo,tween:bu,delay:zu,duration:Ju,ease:Hu,easeVarying:Xu,end:Co,[Symbol.iterator]:St[Symbol.iterator]};function wo(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}var xo={time:null,delay:0,duration:250,ease:wo};function bo(t,e){for(var n;!(n=t.__transition)||!(n=n[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return n}function Fo(t){var e,n;t instanceof At?(e=t._id,t=t._name):(e=Li(),(n=xo).time=vn(),t=t==null?null:t+"");for(var i=this._groups,r=i.length,s=0;s<r;++s)for(var u=i[s],o=u.length,a,h=0;h<o;++h)(a=u[h])&&Se(a,t,e,h,u,n||bo(a,e));return new At(i,this._parents,t,e)}se.prototype.interrupt=Au;se.prototype.transition=Fo;const Ye=Math.PI,Ke=2*Ye,Tt=1e-6,Bo=Ke-Tt;function Ze(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function Vi(){return new Ze}Ze.prototype=Vi.prototype={constructor:Ze,moveTo:function(t,e){this._+="M"+(this._x0=this._x1=+t)+","+(this._y0=this._y1=+e)},closePath:function(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(t,e){this._+="L"+(this._x1=+t)+","+(this._y1=+e)},quadraticCurveTo:function(t,e,n,i){this._+="Q"+ +t+","+ +e+","+(this._x1=+n)+","+(this._y1=+i)},bezierCurveTo:function(t,e,n,i,r,s){this._+="C"+ +t+","+ +e+","+ +n+","+ +i+","+(this._x1=+r)+","+(this._y1=+s)},arcTo:function(t,e,n,i,r){t=+t,e=+e,n=+n,i=+i,r=+r;var s=this._x1,u=this._y1,o=n-t,a=i-e,h=s-t,l=u-e,c=h*h+l*l;if(r<0)throw new Error("negative radius: "+r);if(this._x1===null)this._+="M"+(this._x1=t)+","+(this._y1=e);else if(c>Tt)if(!(Math.abs(l*o-a*h)>Tt)||!r)this._+="L"+(this._x1=t)+","+(this._y1=e);else{var f=n-s,d=i-u,g=o*o+a*a,p=f*f+d*d,_=Math.sqrt(g),m=Math.sqrt(c),b=r*Math.tan((Ye-Math.acos((g+c-p)/(2*_*m)))/2),w=b/m,E=b/_;Math.abs(w-1)>Tt&&(this._+="L"+(t+w*h)+","+(e+w*l)),this._+="A"+r+","+r+",0,0,"+ +(l*f>h*d)+","+(this._x1=t+E*o)+","+(this._y1=e+E*a)}},arc:function(t,e,n,i,r,s){t=+t,e=+e,n=+n,s=!!s;var u=n*Math.cos(i),o=n*Math.sin(i),a=t+u,h=e+o,l=1^s,c=s?i-r:r-i;if(n<0)throw new Error("negative radius: "+n);this._x1===null?this._+="M"+a+","+h:(Math.abs(this._x1-a)>Tt||Math.abs(this._y1-h)>Tt)&&(this._+="L"+a+","+h),n&&(c<0&&(c=c%Ke+Ke),c>Bo?this._+="A"+n+","+n+",0,1,"+l+","+(t-u)+","+(e-o)+"A"+n+","+n+",0,1,"+l+","+(this._x1=a)+","+(this._y1=h):c>Tt&&(this._+="A"+n+","+n+",0,"+ +(c>=Ye)+","+l+","+(this._x1=t+n*Math.cos(r))+","+(this._y1=e+n*Math.sin(r))))},rect:function(t,e,n,i){this._+="M"+(this._x0=this._x1=+t)+","+(this._y0=this._y1=+e)+"h"+ +n+"v"+ +i+"h"+-n+"Z"},toString:function(){return this._}};Mi(Bt(-100,.75,.35),Bt(80,1.5,.8));Mi(Bt(260,.75,.35),Bt(80,1.5,.8));var ae=Bt();function Io(t){(t<0||t>1)&&(t-=Math.floor(t));var e=Math.abs(t-.5);return ae.h=360*t-100,ae.s=1.5-1.5*e,ae.l=.8-.9*e,ae+""}function Lt(t){return function(){return t}}var Gn=1e-12;function $o(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function zi(t){this._context=t}zi.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;default:this._context.lineTo(t,e);break}}};function So(t){return new zi(t)}function Mo(t){return t[0]}function Ro(t){return t[1]}function To(t,e){var n=Lt(!0),i=null,r=So,s=null;t=typeof t=="function"?t:t===void 0?Mo:Lt(t),e=typeof e=="function"?e:e===void 0?Ro:Lt(e);function u(o){var a,h=(o=$o(o)).length,l,c=!1,f;for(i==null&&(s=r(f=Vi())),a=0;a<=h;++a)!(a<h&&n(l=o[a],a,o))===c&&((c=!c)?s.lineStart():s.lineEnd()),c&&s.point(+t(l,a,o),+e(l,a,o));if(f)return s=null,f+""||null}return u.x=function(o){return arguments.length?(t=typeof o=="function"?o:Lt(+o),u):t},u.y=function(o){return arguments.length?(e=typeof o=="function"?o:Lt(+o),u):e},u.defined=function(o){return arguments.length?(n=typeof o=="function"?o:Lt(!!o),u):n},u.curve=function(o){return arguments.length?(r=o,i!=null&&(s=r(i)),u):r},u.context=function(o){return arguments.length?(o==null?i=s=null:s=r(i=o),u):i},u}function Hn(t,e,n){t._context.bezierCurveTo(t._x1+t._k*(t._x2-t._x0),t._y1+t._k*(t._y2-t._y0),t._x2+t._k*(t._x1-e),t._y2+t._k*(t._y1-n),t._x2,t._y2)}function gn(t,e){this._context=t,this._k=(1-e)/6}gn.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:Hn(this,this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2,this._x1=t,this._y1=e;break;case 2:this._point=3;default:Hn(this,t,e);break}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};(function t(e){function n(i){return new gn(i,e)}return n.tension=function(i){return t(+i)},n})(0);function No(t,e,n){var i=t._x1,r=t._y1,s=t._x2,u=t._y2;if(t._l01_a>Gn){var o=2*t._l01_2a+3*t._l01_a*t._l12_a+t._l12_2a,a=3*t._l01_a*(t._l01_a+t._l12_a);i=(i*o-t._x0*t._l12_2a+t._x2*t._l01_2a)/a,r=(r*o-t._y0*t._l12_2a+t._y2*t._l01_2a)/a}if(t._l23_a>Gn){var h=2*t._l23_2a+3*t._l23_a*t._l12_a+t._l12_2a,l=3*t._l23_a*(t._l23_a+t._l12_a);s=(s*h+t._x1*t._l23_2a-e*t._l12_2a)/l,u=(u*h+t._y1*t._l23_2a-n*t._l12_2a)/l}t._context.bezierCurveTo(i,r,s,u,t._x2,t._y2)}function ji(t,e){this._context=t,this._alpha=e}ji.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:this.point(this._x2,this._y2);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){if(t=+t,e=+e,this._point){var n=this._x2-t,i=this._y2-e;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+i*i,this._alpha))}switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3;default:No(this,t,e);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};const ko=function t(e){function n(i){return e?new ji(i,e):new gn(i,0)}return n.alpha=function(i){return t(+i)},n}(.5),le=t=>()=>t;function Oo(t,{sourceEvent:e,target:n,transform:i,dispatch:r}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:i,enumerable:!0,configurable:!0},_:{value:r}})}function Et(t,e,n){this.k=t,this.x=e,this.y=n}Et.prototype={constructor:Et,scale:function(t){return t===1?this:new Et(this.k*t,this.x,this.y)},translate:function(t,e){return t===0&e===0?this:new Et(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var yn=new Et(1,0,0);Et.prototype;function Ne(t){t.stopImmediatePropagation()}function Xt(t){t.preventDefault(),t.stopImmediatePropagation()}function Po(t){return(!t.ctrlKey||t.type==="wheel")&&!t.button}function Lo(){var t=this;return t instanceof SVGElement?(t=t.ownerSVGElement||t,t.hasAttribute("viewBox")?(t=t.viewBox.baseVal,[[t.x,t.y],[t.x+t.width,t.y+t.height]]):[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]):[[0,0],[t.clientWidth,t.clientHeight]]}function Un(){return this.__zoom||yn}function Vo(t){return-t.deltaY*(t.deltaMode===1?.05:t.deltaMode?1:.002)*(t.ctrlKey?10:1)}function zo(){return navigator.maxTouchPoints||"ontouchstart"in this}function jo(t,e,n){var i=t.invertX(e[0][0])-n[0][0],r=t.invertX(e[1][0])-n[1][0],s=t.invertY(e[0][1])-n[0][1],u=t.invertY(e[1][1])-n[1][1];return t.translate(r>i?(i+r)/2:Math.min(0,i)||Math.max(0,r),u>s?(s+u)/2:Math.min(0,s)||Math.max(0,u))}function qo(){var t=Po,e=Lo,n=jo,i=Vo,r=zo,s=[0,1/0],u=[[-1/0,-1/0],[1/0,1/0]],o=250,a=vu,h=an("start","zoom","end"),l,c,f,d=500,g=150,p=0,_=10;function m(v){v.property("__zoom",Un).on("wheel.zoom",N).on("mousedown.zoom",B).on("dblclick.zoom",k).filter(r).on("touchstart.zoom",q).on("touchmove.zoom",J).on("touchend.zoom touchcancel.zoom",Q).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}m.transform=function(v,F,y,M){var R=v.selection?v.selection():v;R.property("__zoom",Un),v!==R?C(v,F,y,M):R.interrupt().each(function(){A(this,arguments).event(M).start().zoom(null,typeof F=="function"?F.apply(this,arguments):F).end()})},m.scaleBy=function(v,F,y,M){m.scaleTo(v,function(){var R=this.__zoom.k,T=typeof F=="function"?F.apply(this,arguments):F;return R*T},y,M)},m.scaleTo=function(v,F,y,M){m.transform(v,function(){var R=e.apply(this,arguments),T=this.__zoom,$=y==null?E(R):typeof y=="function"?y.apply(this,arguments):y,L=T.invert($),z=typeof F=="function"?F.apply(this,arguments):F;return n(w(b(T,z),$,L),R,u)},y,M)},m.translateBy=function(v,F,y,M){m.transform(v,function(){return n(this.__zoom.translate(typeof F=="function"?F.apply(this,arguments):F,typeof y=="function"?y.apply(this,arguments):y),e.apply(this,arguments),u)},null,M)},m.translateTo=function(v,F,y,M,R){m.transform(v,function(){var T=e.apply(this,arguments),$=this.__zoom,L=M==null?E(T):typeof M=="function"?M.apply(this,arguments):M;return n(yn.translate(L[0],L[1]).scale($.k).translate(typeof F=="function"?-F.apply(this,arguments):-F,typeof y=="function"?-y.apply(this,arguments):-y),T,u)},M,R)};function b(v,F){return F=Math.max(s[0],Math.min(s[1],F)),F===v.k?v:new Et(F,v.x,v.y)}function w(v,F,y){var M=F[0]-y[0]*v.k,R=F[1]-y[1]*v.k;return M===v.x&&R===v.y?v:new Et(v.k,M,R)}function E(v){return[(+v[0][0]+ +v[1][0])/2,(+v[0][1]+ +v[1][1])/2]}function C(v,F,y,M){v.on("start.zoom",function(){A(this,arguments).event(M).start()}).on("interrupt.zoom end.zoom",function(){A(this,arguments).event(M).end()}).tween("zoom",function(){var R=this,T=arguments,$=A(R,T).event(M),L=e.apply(R,T),z=y==null?E(L):typeof y=="function"?y.apply(R,T):y,et=Math.max(L[1][0]-L[0][0],L[1][1]-L[0][1]),W=R.__zoom,st=typeof F=="function"?F.apply(R,T):F,ht=a(W.invert(z).concat(et/W.k),st.invert(z).concat(et/st.k));return function(ut){if(ut===1)ut=st;else{var lt=ht(ut),D=et/lt[2];ut=new Et(D,z[0]-lt[0]*D,z[1]-lt[1]*D)}$.zoom(null,ut)}})}function A(v,F,y){return!y&&v.__zooming||new I(v,F)}function I(v,F){this.that=v,this.args=F,this.active=0,this.sourceEvent=null,this.extent=e.apply(v,F),this.taps=0}I.prototype={event:function(v){return v&&(this.sourceEvent=v),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(v,F){return this.mouse&&v!=="mouse"&&(this.mouse[1]=F.invert(this.mouse[0])),this.touch0&&v!=="touch"&&(this.touch0[1]=F.invert(this.touch0[0])),this.touch1&&v!=="touch"&&(this.touch1[1]=F.invert(this.touch1[0])),this.that.__zoom=F,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(v){var F=yt(this.that).datum();h.call(v,this.that,new Oo(v,{sourceEvent:this.sourceEvent,target:m,type:v,transform:this.that.__zoom,dispatch:h}),F)}};function N(v,...F){if(!t.apply(this,arguments))return;var y=A(this,F).event(v),M=this.__zoom,R=Math.max(s[0],Math.min(s[1],M.k*Math.pow(2,i.apply(this,arguments)))),T=$t(v);if(y.wheel)(y.mouse[0][0]!==T[0]||y.mouse[0][1]!==T[1])&&(y.mouse[1]=M.invert(y.mouse[0]=T)),clearTimeout(y.wheel);else{if(M.k===R)return;y.mouse=[T,M.invert(T)],ve(this),y.start()}Xt(v),y.wheel=setTimeout($,g),y.zoom("mouse",n(w(b(M,R),y.mouse[0],y.mouse[1]),y.extent,u));function $(){y.wheel=null,y.end()}}function B(v,...F){if(f||!t.apply(this,arguments))return;var y=A(this,F,!0).event(v),M=yt(v.view).on("mousemove.zoom",z,!0).on("mouseup.zoom",et,!0),R=$t(v,T),T=v.currentTarget,$=v.clientX,L=v.clientY;js(v.view),Ne(v),y.mouse=[R,this.__zoom.invert(R)],ve(this),y.start();function z(W){if(Xt(W),!y.moved){var st=W.clientX-$,ht=W.clientY-L;y.moved=st*st+ht*ht>p}y.event(W).zoom("mouse",n(w(y.that.__zoom,y.mouse[0]=$t(W,T),y.mouse[1]),y.extent,u))}function et(W){M.on("mousemove.zoom mouseup.zoom",null),qs(W.view,y.moved),Xt(W),y.event(W).end()}}function k(v,...F){if(t.apply(this,arguments)){var y=this.__zoom,M=$t(v.changedTouches?v.changedTouches[0]:v,this),R=y.invert(M),T=y.k*(v.shiftKey?.5:2),$=n(w(b(y,T),M,R),e.apply(this,F),u);Xt(v),o>0?yt(this).transition().duration(o).call(C,$,M,v):yt(this).call(m.transform,$,M,v)}}function q(v,...F){if(t.apply(this,arguments)){var y=v.touches,M=y.length,R=A(this,F,v.changedTouches.length===M).event(v),T,$,L,z;for(Ne(v),$=0;$<M;++$)L=y[$],z=$t(L,this),z=[z,this.__zoom.invert(z),L.identifier],R.touch0?!R.touch1&&R.touch0[2]!==z[2]&&(R.touch1=z,R.taps=0):(R.touch0=z,T=!0,R.taps=1+!!l);l&&(l=clearTimeout(l)),T&&(R.taps<2&&(c=z[0],l=setTimeout(function(){l=null},d)),ve(this),R.start())}}function J(v,...F){if(this.__zooming){var y=A(this,F).event(v),M=v.changedTouches,R=M.length,T,$,L,z;for(Xt(v),T=0;T<R;++T)$=M[T],L=$t($,this),y.touch0&&y.touch0[2]===$.identifier?y.touch0[0]=L:y.touch1&&y.touch1[2]===$.identifier&&(y.touch1[0]=L);if($=y.that.__zoom,y.touch1){var et=y.touch0[0],W=y.touch0[1],st=y.touch1[0],ht=y.touch1[1],ut=(ut=st[0]-et[0])*ut+(ut=st[1]-et[1])*ut,lt=(lt=ht[0]-W[0])*lt+(lt=ht[1]-W[1])*lt;$=b($,Math.sqrt(ut/lt)),L=[(et[0]+st[0])/2,(et[1]+st[1])/2],z=[(W[0]+ht[0])/2,(W[1]+ht[1])/2]}else if(y.touch0)L=y.touch0[0],z=y.touch0[1];else return;y.zoom("touch",n(w($,L,z),y.extent,u))}}function Q(v,...F){if(this.__zooming){var y=A(this,F).event(v),M=v.changedTouches,R=M.length,T,$;for(Ne(v),f&&clearTimeout(f),f=setTimeout(function(){f=null},d),T=0;T<R;++T)$=M[T],y.touch0&&y.touch0[2]===$.identifier?delete y.touch0:y.touch1&&y.touch1[2]===$.identifier&&delete y.touch1;if(y.touch1&&!y.touch0&&(y.touch0=y.touch1,delete y.touch1),y.touch0)y.touch0[1]=this.__zoom.invert(y.touch0[0]);else if(y.end(),y.taps===2&&($=$t($,this),Math.hypot(c[0]-$[0],c[1]-$[1])<_)){var L=yt(this).on("dblclick.zoom");L&&L.apply(this,arguments)}}}return m.wheelDelta=function(v){return arguments.length?(i=typeof v=="function"?v:le(+v),m):i},m.filter=function(v){return arguments.length?(t=typeof v=="function"?v:le(!!v),m):t},m.touchable=function(v){return arguments.length?(r=typeof v=="function"?v:le(!!v),m):r},m.extent=function(v){return arguments.length?(e=typeof v=="function"?v:le([[+v[0][0],+v[0][1]],[+v[1][0],+v[1][1]]]),m):e},m.scaleExtent=function(v){return arguments.length?(s[0]=+v[0],s[1]=+v[1],m):[s[0],s[1]]},m.translateExtent=function(v){return arguments.length?(u[0][0]=+v[0][0],u[1][0]=+v[1][0],u[0][1]=+v[0][1],u[1][1]=+v[1][1],m):[[u[0][0],u[0][1]],[u[1][0],u[1][1]]]},m.constrain=function(v){return arguments.length?(n=v,m):n},m.duration=function(v){return arguments.length?(o=+v,m):o},m.interpolate=function(v){return arguments.length?(a=v,m):a},m.on=function(){var v=h.on.apply(h,arguments);return v===h?m:v},m.clickDistance=function(v){return arguments.length?(p=(v=+v)*v,m):Math.sqrt(p)},m.tapDistance=function(v){return arguments.length?(_=+v,m):_},m}class Xn{constructor(e){this.base=e}[Symbol.iterator](){return this.base[Symbol.iterator]()}concat(...e){return Z(function*(n){for(const i of n)yield*i}([this,...e.map(Z)]))}entries(){return Z(function*(e){let n=0;for(const i of e)yield[n++,i]}(this))}every(e){return!this.some((n,i)=>!e(n,i))}fill(e){return this.map(()=>e)}filter(e){return Z(function*(n){for(const[i,r]of n)e(r,i)&&(yield r)}(this.entries()))}find(e){for(const[n,i]of this.entries())if(e(i,n))return i}findIndex(e){for(const[n,i]of this.entries())if(e(i,n))return n;return-1}flatMap(e){return Z(function*(n){for(const[i,r]of n)yield*Z(e(r,i))}(this.entries()))}forEach(e){for(const[n,i]of this.entries())e(i,n)}includes(e,n=0){return this.indexOf(e,n)>=0}indexOf(e,n=0){if(n<0)throw new Error("fromIndex doesn't support negative numbers because generator length isn't known");for(const[i,r]of this.entries())if(i>=n&&r===e)return i;return-1}join(e=","){return[...this].join(e)}keys(){return Z(function*(e){let n=0;for(const i of e)yield n++}(this))}lastIndexOf(e,n=1/0){if(n<0)throw new Error("fromIndex doesn't support negative numbers because generator length isn't known");let i=-1;for(const[r,s]of this.entries())r<=n&&s===e&&(i=r);return i}get length(){return this.reduce(e=>e+1,0)}map(e){return Z(function*(n){for(const[i,r]of n)yield e(r,i)}(this.entries()))}reduce(e,n){if(n===void 0){const i=e;let r=!0,s;for(const[u,o]of this.entries())r?(s=o,r=!1):s=i(s,o,u);if(r)throw new TypeError("Reduce of empty iterable with no initial value");return s}else{const i=e;let r=n;for(const[s,u]of this.entries())r=i(r,u,s);return r}}reverse(){return Z([...this].reverse())}slice(e=0,n=1/0){return Z(function*(i){for(const[r,s]of i)if(!(r<e))if(r<n)yield s;else break}(this.entries()))}some(e){for(const[n,i]of this.entries())if(e(i,n))return!0;return!1}sort(e){return Z([...this].sort(e))}splice(e,n=0,...i){return Z(function*(r){for(const[s,u]of r)s===e&&(yield*i),(s<e||s>=e+n)&&(yield u)}(this.entries()))}values(){return this}}function Jo(t){return typeof t[Symbol.iterator]=="function"}function Z(t){return Jo(t)?new Xn(t):new Xn({[Symbol.iterator]:()=>t})}function Qe(t){if(t!==void 0)return t;throw new Error("got unexpected undefined value")}function qi(t,e){e.size<t.size&&([e,t]=[t,e]);for(const n of t)if(e.has(n))return!0;return!1}class at extends Map{getThrow(e){const n=this.get(e);if(n===void 0)throw new Error(`map doesn't contain key: ${e}`);return n}getDefault(e,n){const i=this.get(e);return i===void 0?n:i}setIfAbsent(e,n){const i=this.get(e);return i===void 0?(this.set(e,n),n):i}}class De{constructor(e,n,i=[]){this.child=e,this.data=n,this.points=i}}class Ho{constructor(e,n,i,r){this.source=e,this.target=n,this.data=i,this.points=r}}class Ji{constructor(e,n){this.id=e,this.data=n,this.dataChildren=[]}iroots(){return Z([this])}roots(){return[this]}*iterChildren(){for(const{child:e}of this.dataChildren)yield e}ichildren(){return Z(this.iterChildren())}children(){return[...this.ichildren()]}*iterChildLinks(){for(const{child:e,data:n,points:i}of this.dataChildren)yield new Ho(this,e,n,i)}ichildLinks(){return Z(this.iterChildLinks())}childLinks(){return[...this.ichildLinks()]}[Symbol.iterator](){return new ot([this])[Symbol.iterator]()}idescendants(e="depth"){return new ot([this]).idescendants(e)}descendants(e="depth"){return[...this.idescendants(e)]}ilinks(){return new ot([this]).ilinks()}links(){return[...this.ilinks()]}size(){return new ot([this]).size()}sum(e){return new ot([this]).sum(e),this}count(){return new ot([this]).count(),this}height(){return new ot([this]).height(),this}depth(){return new ot([this]).depth(),this}split(){return[this]}connected(){return!0}}class ot{constructor(e){this.dagRoots=e}[Symbol.iterator](){return this.idepth()}iroots(){return Z(this.dagRoots)}roots(){return this.dagRoots.slice()}*idepth(){const e=this.roots(),n=new Set;let i;for(;i=e.pop();)n.has(i.id)||(n.add(i.id),yield i,e.push(...i.ichildren()))}*ibreadth(){const e=new Set;let n=this.roots(),i=[];do{i=n.reverse(),n=[];let r;for(;r=i.pop();)e.has(r.id)||(e.add(r.id),yield r,n.push(...r.ichildren()))}while(n.length)}*ibefore(){const e=new at;for(const r of this)for(const s of r.ichildren())e.set(s.id,e.getDefault(s.id,0)+1);const n=this.roots();let i;for(;i=n.pop();){yield i;for(const r of i.ichildren()){const s=e.getThrow(r.id);s>1?e.set(r.id,s-1):n.push(r)}}}*iafter(){const e=this.roots(),n=new Set;let i;for(;i=e.pop();)n.has(i.id)||(i.ichildren().every(r=>n.has(r.id))?(n.add(i.id),yield i):(e.push(i),e.push(...i.ichildren())))}idescendants(e="depth"){if(e==="depth")return Z(this.idepth());if(e==="breadth")return Z(this.ibreadth());if(e==="before")return Z(this.ibefore());if(e==="after")return Z(this.iafter());throw new Error(`unknown iteration style: ${e}`)}descendants(e="depth"){return[...this.idescendants(e)]}ilinks(){return this.idescendants().flatMap(e=>e.ichildLinks())}links(){return[...this.ilinks()]}size(){return this.idescendants().reduce(e=>e+1,0)}sum(e){const n=new at;for(const[i,r]of this.idescendants("after").entries()){const s=e(r,i),u=new at;u.set(r.id,s);for(const o of r.ichildren()){const a=n.getThrow(o.id);for(const[h,l]of a.entries())u.set(h,l)}r.value=Z(u.entries()).map(([,o])=>o).reduce((o,a)=>o+a),n.set(r.id,u)}return this}count(){const e=new at;for(const n of this.idescendants("after"))if(n.ichildren()[Symbol.iterator]().next().done)e.set(n.id,new Set([n.id])),n.value=1;else{const i=new Set;for(const r of n.ichildren()){const s=e.getThrow(r.id);for(const u of s)i.add(u)}e.set(n.id,i),n.value=i.size}return this}height(){for(const e of this.idescendants("after"))e.value=Math.max(0,...e.ichildren().map(n=>{if(n.value===void 0)throw new Error("`after` iteration didn't iterate in after order");return n.value+1}));return this}depth(){const e=new at;for(const n of this)for(const i of n.ichildren())e.setIfAbsent(i.id,[]).push(n);for(const n of this.idescendants("before"))n.value=Math.max(0,...e.getDefault(n.id,[]).map(i=>{if(i.value===void 0)throw new Error("`before` iteration didn't iterate in before order");return i.value+1}));return this}split(){const e=new at,n=new at;for(const s of this.iroots())e.set(s.id,[]),n.set(s.id,new Set(s.idescendants().map(u=>u.id)));for(const[s,u]of this.iroots().entries()){const o=n.getThrow(u.id);for(const a of this.iroots().slice(s+1)){const h=n.getThrow(a.id);qi(o,h)&&(e.getThrow(u.id).push(a),e.getThrow(a.id).push(u))}}const i=[],r=new Set;for(const s of this.iroots())if(!r.has(s.id)){r.add(s.id);const u=[s];i.push(u);const o=e.getThrow(s.id).slice();let a;for(;a=o.pop();)r.has(a.id)||(r.add(a.id),u.push(a),o.push(...e.getThrow(a.id)))}return i.map(s=>s.length>1?new ot(s):s[0])}connected(){return this.split().length===1}}function Uo(t){if(typeof t!="string")throw new Error(`id is supposed to be string but got type ${typeof t}`);if(t.indexOf("\0")>=0)throw new Error(`node id ${t} contained null character`);return t}function Xo(t){if(!t.length)throw new Error("dag contained no roots");const e=new Set,n=new Set;let i=null;function r(s){if(e.has(s.id))return[];if(n.has(s.id))return i=s.id,[s.id];{n.add(s.id);let u=[];for(const o of s.ichildren())if(u=r(o),u.length)break;return n.delete(s.id),e.add(s.id),u.length&&i!==null&&u.push(s.id),i===s.id&&(i=null),u}}for(const s of t){const u=r(s);if(u.length)throw new Error("dag contained a cycle: "+u.reverse().join(" -> "))}for(const s of new ot(t))if(new Set(s.ichildren().map(o=>o.id)).size!==s.dataChildren.length)throw new Error(`node '${s.id}' contained duplicate children`)}function me(t,e,n){function i(o){if(!o.length)throw new Error("can't stratify empty data");const a=o.map((c,f)=>new Ji(Uo(t(c,f)),c)),h=new Map;a.forEach(c=>{if(h.has(c.id))throw new Error(`found a duplicate id: ${c.id}`);h.set(c.id,c)});const l=[];return a.forEach((c,f)=>{const d=n(c.data,f)||[];d.forEach(([g,p])=>{const _=h.get(g);if(!_)throw new Error(`missing id: ${g}`);return _.dataChildren.push(new De(c,p)),_}),d.length||l.push(c)}),Xo(l),l.length>1?new ot(l):l[0]}function r(o){return o===void 0?t:me(o,e,n)}i.id=r;function s(o){return o===void 0?n:me(t,Wo(o),o)}i.parentData=s;function u(o){return o===void 0?e:me(t,o,Gi(o))}return i.parentIds=u,i}function Gi(t){function e(n,i){return(t(n,i)||[]).map(r=>[r,void 0])}return e.wrapped=t,e}function Wo(t){function e(n,i){return(t(n,i)||[]).map(([r])=>r)}return e.wrapped=t,e}function Yo(t){try{return typeof t.id=="string"}catch{return!1}}function Ko(t){if(Yo(t))return t.id;throw new Error(`default id function expected datum to have an id field but got: ${t}`)}function Zo(t){try{const e=t.parentIds;return e===void 0||e instanceof Array&&e.every(n=>typeof n=="string")}catch{return!1}}function Wn(t){if(Zo(t))return t.parentIds;throw new Error(`default parentIds function expected datum to have a parentIds field but got: ${t}`)}function Qo(...t){if(t.length)throw Error(`got arguments to dagStratify(${t}), but constructor takes no aruguments. These were probably meant as data which should be called as dagStratify()(...)`);return me(Ko,Wn,Gi(Wn))}let Zt=1e-60,Yn,Kn;do Zt+=Zt,Yn=1+.1*Zt,Kn=1+.2*Zt;while(Yn<=1||Kn<=1);var ke=Zt;function ta(t,e,n){let i,r;for(let s=1;s<=n;s+=1){t[s][s]=1/t[s][s],r=-t[s][s];for(let u=1;u<s;u+=1)t[u][s]*=r;if(i=s+1,n<i)break;for(let u=i;u<=n;u+=1){r=t[s][u],t[s][u]=0;for(let o=1;o<=s;o+=1)t[o][u]+=r*t[o][s]}}}var ea=ta;function na(t,e,n,i){let r,s;for(r=1;r<=n;r+=1){s=0;for(let u=1;u<r;u+=1)s+=t[u][r]*i[u];i[r]=(i[r]-s)/t[r][r]}for(let u=1;u<=n;u+=1){r=n+1-u,i[r]/=t[r][r],s=-i[r];for(let o=1;o<r;o+=1)i[o]+=s*t[o][r]}}var ia=na;function ra(t,e,n,i){let r,s,u;for(let o=1;o<=n;o+=1){if(i[1]=o,u=0,r=o-1,r<1){if(u=t[o][o]-u,u<=0)break;t[o][o]=Math.sqrt(u)}else{for(let a=1;a<=r;a+=1){s=t[a][o];for(let h=1;h<a;h+=1)s-=t[h][o]*t[h][a];s/=t[a][a],t[a][o]=s,u+=s*s}if(u=t[o][o]-u,u<=0)break;t[o][o]=Math.sqrt(u)}i[1]=0}}var sa=ra;function ua(t,e,n,i,r,s,u,o,a,h,l,c,f,d=0,g,p,_){let m,b,w,E,C,A,I,N,B,k,q,J,Q,v;const F=Math.min(i,l);let y=2*i+F*(F+5)/2+2*l+1;for(let D=1;D<=i;D+=1)p[D]=e[D];for(let D=i+1;D<=y;D+=1)p[D]=0;for(let D=1;D<=l;D+=1)f[D]=0,s[D]=0;const M=[];if(_[1]===0){if(sa(t,n,i,M),M[1]!==0){_[1]=2;return}ia(t,n,i,e),ea(t,n,i)}else{for(let D=1;D<=i;D+=1){r[D]=0;for(let S=1;S<=D;S+=1)r[D]+=t[S][D]*e[S]}for(let D=1;D<=i;D+=1){e[D]=0;for(let S=D;S<=i;S+=1)e[D]+=t[D][S]*r[S]}}u[1]=0;for(let D=1;D<=i;D+=1){r[D]=e[D],u[1]+=p[D]*r[D],p[D]=0;for(let S=D+1;S<=i;S+=1)t[S][D]=0}u[1]=-u[1]/2,_[1]=0;const R=i,T=R+i,$=T+F,L=$+F+1,z=L+F*(F+1)/2,et=z+l;for(let D=1;D<=l;D+=1){A=0;for(let S=1;S<=i;S+=1)A+=o[S][D]*o[S][D];p[et+D]=Math.sqrt(A)}E=d,g[1]=0,g[2]=0;function W(){g[1]+=1,y=z;for(let D=1;D<=l;D+=1){y+=1,A=-a[D];for(let S=1;S<=i;S+=1)A+=o[S][D]*r[S];if(Math.abs(A)<ke&&(A=0),D>c)p[y]=A;else if(p[y]=-Math.abs(A),A>0){for(let S=1;S<=i;S+=1)o[S][D]=-o[S][D];a[D]=-a[D]}}for(let D=1;D<=E;D+=1)p[z+f[D]]=0;w=0,C=0;for(let D=1;D<=l;D+=1)p[z+D]<C*p[et+D]&&(w=D,C=p[z+D]/p[et+D]);if(w===0){for(let D=1;D<=E;D+=1)s[f[D]]=p[$+D];return 999}return 0}function st(){for(let D=1;D<=i;D+=1){A=0;for(let S=1;S<=i;S+=1)A+=t[S][D]*o[S][w];p[D]=A}m=R;for(let D=1;D<=i;D+=1)p[m+D]=0;for(let D=E+1;D<=i;D+=1)for(let S=1;S<=i;S+=1)p[m+S]=p[m+S]+t[S][D]*p[D];J=!0;for(let D=E;D>=1;D-=1){A=p[D],y=L+D*(D+3)/2,m=y-D;for(let S=D+1;S<=E;S+=1)A-=p[y]*p[T+S],y+=S;A/=p[m],p[T+D]=A,!(f[D]<=c)&&(A<=0||(J=!1,b=D))}if(!J){I=p[$+b]/p[T+b];for(let D=1;D<=E;D+=1)f[D]<=c||p[T+D]<=0||(C=p[$+D]/p[T+D],C<I&&(I=C,b=D))}A=0;for(let D=R+1;D<=R+i;D+=1)A+=p[D]*p[D];if(Math.abs(A)<=ke){if(J)return _[1]=1,999;for(let D=1;D<=E;D+=1)p[$+D]=p[$+D]-I*p[T+D];return p[$+E+1]=p[$+E+1]+I,700}A=0;for(let D=1;D<=i;D+=1)A+=p[R+D]*o[D][w];N=-p[z+w]/A,Q=!0,J||I<N&&(N=I,Q=!1);for(let D=1;D<=i;D+=1)r[D]+=N*p[R+D],Math.abs(r[D])<ke&&(r[D]=0);u[1]+=N*A*(N/2+p[$+E+1]);for(let D=1;D<=E;D+=1)p[$+D]=p[$+D]-N*p[T+D];if(p[$+E+1]=p[$+E+1]+N,Q){E+=1,f[E]=w,y=L+(E-1)*E/2+1;for(let D=1;D<=E-1;D+=1)p[y]=p[D],y+=1;if(E===i)p[y]=p[i];else{for(let D=i;D>=E+1;D-=1)if(p[D]!==0&&(B=Math.max(Math.abs(p[D-1]),Math.abs(p[D])),k=Math.min(Math.abs(p[D-1]),Math.abs(p[D])),p[D-1]>=0?C=Math.abs(B*Math.sqrt(1+k*k/(B*B))):C=-Math.abs(B*Math.sqrt(1+k*k/(B*B))),B=p[D-1]/C,k=p[D]/C,B!==1))if(B===0){p[D-1]=k*C;for(let S=1;S<=i;S+=1)C=t[S][D-1],t[S][D-1]=t[S][D],t[S][D]=C}else{p[D-1]=C,q=k/(1+B);for(let S=1;S<=i;S+=1)C=B*t[S][D-1]+k*t[S][D],t[S][D]=q*(t[S][D-1]+C)-t[S][D],t[S][D-1]=C}p[y]=p[E]}}else{A=-a[w];for(let D=1;D<=i;D+=1)A+=r[D]*o[D][w];if(w>c)p[z+w]=A;else if(p[z+w]=-Math.abs(A),A>0){for(let D=1;D<=i;D+=1)o[D][w]=-o[D][w];a[w]=-a[w]}return 700}return 0}function ht(){if(y=L+b*(b+1)/2+1,m=y+b,p[m]===0||(B=Math.max(Math.abs(p[m-1]),Math.abs(p[m])),k=Math.min(Math.abs(p[m-1]),Math.abs(p[m])),p[m-1]>=0?C=Math.abs(B*Math.sqrt(1+k*k/(B*B))):C=-Math.abs(B*Math.sqrt(1+k*k/(B*B))),B=p[m-1]/C,k=p[m]/C,B===1))return 798;if(B===0){for(let D=b+1;D<=E;D+=1)C=p[m-1],p[m-1]=p[m],p[m]=C,m+=D;for(let D=1;D<=i;D+=1)C=t[D][b],t[D][b]=t[D][b+1],t[D][b+1]=C}else{q=k/(1+B);for(let D=b+1;D<=E;D+=1)C=B*p[m-1]+k*p[m],p[m]=q*(p[m-1]+C)-p[m],p[m-1]=C,m+=D;for(let D=1;D<=i;D+=1)C=B*t[D][b]+k*t[D][b+1],t[D][b+1]=q*(t[D][b]+C)-t[D][b+1],t[D][b]=C}return 0}function ut(){m=y-b;for(let D=1;D<=b;D+=1)p[m]=p[y],y+=1,m+=1;return p[$+b]=p[$+b+1],f[b]=f[b+1],b+=1,b<E?797:0}function lt(){return p[$+E]=p[$+E+1],p[$+E+1]=0,f[E]=0,E-=1,g[2]+=1,0}for(v=0;;){if(v=W(),v===999)return;for(;v=st(),v!==0;){if(v===999)return;if(v===700)if(b===E)lt();else{for(;ht(),v=ut(),v===797;);lt()}}}}var oa=ua;function aa(t,e,n,i=[],r=0,s=[0,0]){const u=[],o=[],a=[],h=[],l=[],c=[];let f="";const d=t.length-1,g=n[1].length-1;if(!i)for(let m=1;m<=g;m+=1)i[m]=0;if(d!==t[1].length-1&&(f="Dmat is not symmetric!"),d!==e.length-1&&(f="Dmat and dvec are incompatible!"),d!==n.length-1&&(f="Amat and dvec are incompatible!"),g!==i.length-1&&(f="Amat and bvec are incompatible!"),(r>g||r<0)&&(f="Value of meq is invalid!"),f!=="")return{message:f};for(let m=1;m<=g;m+=1)o[m]=0,h[m]=0;const p=0,_=Math.min(d,g);for(let m=1;m<=d;m+=1)a[m]=0;u[1]=0;for(let m=1;m<=2*d+_*(_+5)/2+2*g+1;m+=1)l[m]=0;for(let m=1;m<=2;m+=1)c[m]=0;return oa(t,e,d,d,a,h,u,n,i,d,g,r,o,p,c,l,s),s[1]===1&&(f="constraints are inconsistent, no solution!"),s[1]===2&&(f="matrix D in quadratic function is not positive definite!"),{solution:a,Lagrangian:h,value:u,unconstrained_solution:e,iterations:c,iact:o,message:f}}var la=aa,ha={solveQP:la},ca=ha;function Hi(t,e){let[n,...i]=t,r=n.x=0;for(const s of i)r=s.x=r+e(n,s),n=s;if(r>0)for(const s of t)s.x/=r;else for(const s of t)s.x=.5}function fa(t,e,n,i,r){const s=[[0]],u=[0],o=[[0]],a=[0];for(const c of t){const f=[0];f.push(...c),s.push(f)}u.push(...e),o.push(...e.map(()=>[0]));for(const c of n)for(const[f,d]of c.entries())o[f+1].push(-d);a.push(...i.map(c=>-c));const{solution:h,message:l}=ca.solveQP(s,u,o,a,r);if(l.length)throw new Error(`quadprog failed with: ${l}`);return h.shift(),h}function da(t,e,n,i,r=0){e.pop(),t.pop(),t.forEach(u=>u.pop()),n.forEach(u=>u.pop());const s=fa(t,e,n,i,r);return s.push(0),s}function pa(t){const e=new at;let n=0;for(const i of t)for(const r of i)e.set(r.id,n++);return e}function va(t,e,n){const i=1+Math.max(...e.values()),r=[],s=[];for(const a of t){let[h,...l]=a;for(const c of l){const f=e.getThrow(h.id),d=e.getThrow(c.id),g=new Array(i).fill(0);g[f]=1,g[d]=-1,r.push(g),s.push(-n(h,c)),h=c}}const u=new Array(i).fill(0);return[new Array(i).fill(null).map(()=>new Array(i).fill(0)),u,r,s]}function Zn(t,e,n,i){t[n][n]+=i,t[n][e]-=i,t[e][n]-=i,t[e][e]+=i}function Da(t,e,n,i,r){t[i][i]+=r,t[i][n]-=2*r,t[i][e]+=r,t[n][i]-=2*r,t[n][n]+=4*r,t[n][e]-=2*r,t[e][i]+=r,t[e][n]-=2*r,t[e][e]+=r}function ma(t,e,n){const i=Math.min(...n),r=Math.max(...n)-i;if(r>0)for(const s of t)for(const u of s){const o=e.getThrow(u.id);u.x=(n[o]-i)/r}else for(const s of t)for(const u of s)u.x=.5}class Ft extends Ji{constructor(e){super(e,void 0)}}function ga(t){const e=new at;for(const r of t.slice().reverse())for(const s of r){for(const u of s.ichildren())e.delete(u.id);e.set(s.id,s)}const n=new ot([...e.values()]).split(),i=new at;for(const[r,s]of n.entries())for(const u of s)i.set(u.id,r);return i}function ya(t,e){const n=[];let i=[],r=new Set;for(const s of t){const u=new Set(s.map(o=>e.getThrow(o.id)));qi(r,u)||n.push(i=[]),i.push(s),r=u}return n}function ge(t,e,n,i,r){function s(l,c,f){const d=pa(l),[g,p,_,m]=va(l,d,c);for(const w of l)for(const E of w){const C=d.getThrow(E.id),A=E instanceof Ft?e:t;for(const I of E.ichildren()){const N=d.getThrow(I.id),B=I instanceof Ft?e:t,k=I instanceof Ft?i:n;Zn(g,C,N,A+B);for(const q of I.ichildren()){const J=d.getThrow(q.id);Da(g,C,N,J,k)}}}for(let[w,...E]of l)for(const C of E)f.getThrow(w.id)!==f.getThrow(C.id)&&Zn(g,d.getThrow(w.id),d.getThrow(C.id),r),w=C;const b=da(g,p,_,m);ma(l,d,b)}function u(l,c){if(t===0&&n===0)throw new Error("node vertical weight or node curve weight needs to be positive");if(e===0&&i===0)throw new Error("dummy vertical weight or dummy curve weight needs to be positive");const f=ga(l);for(const d of ya(l,f))if(d.every(g=>g.length===1))for(const[g]of d)g.x=.5;else if(d.length===1){const[g]=d;Hi(g,c)}else s(d,c,f)}function o(l){if(l===void 0)return[t,e];const[c,f]=l;if(c<0||f<0)throw new Error(`weights must be non-negative, but were ${c} and ${f}`);return ge(c,f,n,i,r)}u.vertical=o;function a(l){if(l===void 0)return[n,i];const[c,f]=l;if(c<0||f<0)throw new Error(`weights must be non-negative, but were ${c} and ${f}`);return ge(t,e,c,f,r)}u.curve=a;function h(l){if(l===void 0)return r;if(l<=0)throw new Error(`weight must be positive, but was ${l}`);return ge(t,e,n,i,l)}return u.component=h,u}function _a(...t){if(t.length)throw new Error(`got arguments to quad(${t}), but constructor takes no aruguments.`);return ge(1,0,0,1,1)}/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function Ea(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(n[i[r]]=t[i[r]]);return n}function Ui(t,e,n,i){this.feasible=n,this.evaluation=e,this.bounded=i,this._tableau=t}var _n=Ui;Ui.prototype.generateSolutionSet=function(){for(var t={},e=this._tableau,n=e.varIndexByRow,i=e.variablesPerIndex,r=e.matrix,s=e.rhsColumn,u=e.height-1,o=Math.round(1/e.precision),a=1;a<=u;a+=1){var h=n[a],l=i[h];if(!(l===void 0||l.isSlack===!0)){var c=r[a][s];t[l.id]=Math.round((Number.EPSILON+c)*o)/o}}return t};function Ae(t,e,n,i,r){_n.call(this,t,e,n,i),this.iter=r}var Ca=Ae;Ae.prototype=Object.create(_n.prototype);Ae.constructor=Ae;function mt(t){this.model=null,this.matrix=null,this.width=0,this.height=0,this.costRowIndex=0,this.rhsColumn=0,this.variablesPerIndex=[],this.unrestrictedVars=null,this.feasible=!0,this.evaluation=0,this.simplexIters=0,this.varIndexByRow=null,this.varIndexByCol=null,this.rowByVarIndex=null,this.colByVarIndex=null,this.precision=t||1e-8,this.optionalObjectives=[],this.objectivesByPriority={},this.savedState=null,this.availableIndexes=[],this.lastElementIndex=0,this.variables=null,this.nVars=0,this.bounded=!0,this.unboundedVarIndex=null,this.branchAndCutIterations=0}var j=mt;mt.prototype.solve=function(){return this.model.getNumberOfIntegerVariables()>0?this.branchAndCut():this.simplex(),this.updateVariableValues(),this.getSolution()};function tn(t,e){this.priority=t,this.reducedCosts=new Array(e);for(var n=0;n<e;n+=1)this.reducedCosts[n]=0}tn.prototype.copy=function(){var t=new tn(this.priority,this.reducedCosts.length);return t.reducedCosts=this.reducedCosts.slice(),t};mt.prototype.setOptionalObjective=function(t,e,n){var i=this.objectivesByPriority[t];if(i===void 0){var r=Math.max(this.width,e+1);i=new tn(t,r),this.objectivesByPriority[t]=i,this.optionalObjectives.push(i),this.optionalObjectives.sort(function(s,u){return s.priority-u.priority})}i.reducedCosts[e]=n};mt.prototype.initialize=function(t,e,n,i){this.variables=n,this.unrestrictedVars=i,this.width=t,this.height=e;for(var r=new Array(t),s=0;s<t;s++)r[s]=0;this.matrix=new Array(e);for(var u=0;u<e;u++)this.matrix[u]=r.slice();this.varIndexByRow=new Array(this.height),this.varIndexByCol=new Array(this.width),this.varIndexByRow[0]=-1,this.varIndexByCol[0]=-1,this.nVars=t+e-2,this.rowByVarIndex=new Array(this.nVars),this.colByVarIndex=new Array(this.nVars),this.lastElementIndex=this.nVars};mt.prototype._resetMatrix=function(){var t=this.model.variables,e=this.model.constraints,n=t.length,i=e.length,r,s,u=this.matrix[0],o=this.model.isMinimization===!0?-1:1;for(r=0;r<n;r+=1){var a=t[r],h=a.priority,l=o*a.cost;h===0?u[r+1]=l:this.setOptionalObjective(h,r+1,l),s=t[r].index,this.rowByVarIndex[s]=-1,this.colByVarIndex[s]=r+1,this.varIndexByCol[r+1]=s}for(var c=1,f=0;f<i;f+=1){var d=e[f],g=d.index;this.rowByVarIndex[g]=c,this.colByVarIndex[g]=-1,this.varIndexByRow[c]=g;var p,_,m,b=d.terms,w=b.length,E=this.matrix[c++];if(d.isUpperBound){for(p=0;p<w;p+=1)_=b[p],m=this.colByVarIndex[_.variable.index],E[m]=_.coefficient;E[0]=d.rhs}else{for(p=0;p<w;p+=1)_=b[p],m=this.colByVarIndex[_.variable.index],E[m]=-_.coefficient;E[0]=-d.rhs}}};mt.prototype.setModel=function(t){this.model=t;var e=t.nVariables+1,n=t.nConstraints+1;return this.initialize(e,n,t.variables,t.unrestrictedVariables),this._resetMatrix(),this};mt.prototype.getNewElementIndex=function(){if(this.availableIndexes.length>0)return this.availableIndexes.pop();var t=this.lastElementIndex;return this.lastElementIndex+=1,t};mt.prototype.density=function(){for(var t=0,e=this.matrix,n=0;n<this.height;n++)for(var i=e[n],r=0;r<this.width;r++)i[r]!==0&&(t+=1);return t/(this.height*this.width)};mt.prototype.setEvaluation=function(){var t=Math.round(1/this.precision),e=this.matrix[this.costRowIndex][this.rhsColumn],n=Math.round((Number.EPSILON+e)*t)/t;this.evaluation=n,this.simplexIters===0&&(this.bestPossibleEval=n)};mt.prototype.getSolution=function(){var t=this.model.isMinimization===!0?this.evaluation:-this.evaluation;return this.model.getNumberOfIntegerVariables()>0?new Ca(this,t,this.feasible,this.bounded,this.branchAndCutIterations):new _n(this,t,this.feasible,this.bounded)};j.prototype.simplex=function(){return this.bounded=!0,this.phase1(),this.feasible===!0&&this.phase2(),this};j.prototype.phase1=function(){for(var t=this.model.checkForCycles,e=[],n=this.matrix,i=this.rhsColumn,r=this.width-1,s=this.height-1,u,o=0;;){for(var a=0,h=-this.precision,l=1;l<=s;l++){u=this.unrestrictedVars[this.varIndexByRow[l]]===!0;var c=n[l][i];c<h&&(h=c,a=l)}if(a===0)return this.feasible=!0,o;for(var f=0,d=-1/0,g=n[0],p=n[a],_=1;_<=r;_++){var m=p[_];if(u=this.unrestrictedVars[this.varIndexByCol[_]]===!0,u||m<-this.precision){var b=-g[_]/m;d<b&&(d=b,f=_)}}if(f===0)return this.feasible=!1,o;if(t){e.push([this.varIndexByRow[a],this.varIndexByCol[f]]);var w=this.checkForCycles(e);if(w.length>0)return this.model.messages.push("Cycle in phase 1"),this.model.messages.push("Start :"+w[0]),this.model.messages.push("Length :"+w[1]),this.feasible=!1,o}this.pivot(a,f),o+=1}};j.prototype.phase2=function(){for(var t=this.model.checkForCycles,e=[],n=this.matrix,i=this.rhsColumn,r=this.width-1,s=this.height-1,u=this.precision,o=this.optionalObjectives.length,a=null,h=0,l,c;;){var f=n[this.costRowIndex];o>0&&(a=[]);for(var d=0,g=u,p=!1,_=1;_<=r;_++){if(l=f[_],c=this.unrestrictedVars[this.varIndexByCol[_]]===!0,o>0&&-u<l&&l<u){a.push(_);continue}if(c&&l<0){-l>g&&(g=-l,d=_,p=!0);continue}l>g&&(g=l,d=_,p=!1)}if(o>0)for(var m=0;d===0&&a.length>0&&m<o;){var b=[],w=this.optionalObjectives[m].reducedCosts;g=u;for(var E=0;E<a.length;E++){if(_=a[E],l=w[_],c=this.unrestrictedVars[this.varIndexByCol[_]]===!0,-u<l&&l<u){b.push(_);continue}if(c&&l<0){-l>g&&(g=-l,d=_,p=!0);continue}l>g&&(g=l,d=_,p=!1)}a=b,m+=1}if(d===0)return this.setEvaluation(),this.simplexIters+=1,h;var C=0,A=1/0;this.varIndexByRow;for(var I=1;I<=s;I++){var N=n[I],B=N[i],k=N[d];if(!(-u<k&&k<u)){if(k>0&&u>B&&B>-u){A=0,C=I;break}var q=p?-B/k:B/k;q>u&&A>q&&(A=q,C=I)}}if(A===1/0)return this.evaluation=-1/0,this.bounded=!1,this.unboundedVarIndex=this.varIndexByCol[d],h;if(t){e.push([this.varIndexByRow[C],this.varIndexByCol[d]]);var J=this.checkForCycles(e);if(J.length>0)return this.model.messages.push("Cycle in phase 2"),this.model.messages.push("Start :"+J[0]),this.model.messages.push("Length :"+J[1]),this.feasible=!1,h}this.pivot(C,d,!0),h+=1}};var Oe=[];j.prototype.pivot=function(t,e){var n=this.matrix,i=n[t][e],r=this.height-1,s=this.width-1,u=this.varIndexByRow[t],o=this.varIndexByCol[e];this.varIndexByRow[t]=o,this.varIndexByCol[e]=u,this.rowByVarIndex[o]=t,this.rowByVarIndex[u]=-1,this.colByVarIndex[o]=-1,this.colByVarIndex[u]=e;for(var a=n[t],h=0,l=0;l<=s;l++)a[l]>=-1e-16&&a[l]<=1e-16?a[l]=0:(a[l]/=i,Oe[h]=l,h+=1);a[e]=1/i;var c,f,d;this.precision;for(var g=0;g<=r;g++)if(g!==t&&!(n[g][e]>=-1e-16&&n[g][e]<=1e-16)){var p=n[g];if(c=p[e],c>=-1e-16&&c<=1e-16)c!==0&&(p[e]=0);else{for(f=0;f<h;f++)l=Oe[f],d=a[l],d>=-1e-16&&d<=1e-16?d!==0&&(a[l]=0):p[l]=p[l]-c*d;p[e]=-c/i}}var _=this.optionalObjectives.length;if(_>0)for(var m=0;m<_;m+=1){var b=this.optionalObjectives[m].reducedCosts;if(c=b[e],c!==0){for(f=0;f<h;f++)l=Oe[f],d=a[l],d!==0&&(b[l]=b[l]-c*d);b[e]=-c/i}}};j.prototype.checkForCycles=function(t){for(var e=0;e<t.length-1;e++)for(var n=e+1;n<t.length;n++){var i=t[e],r=t[n];if(i[0]===r[0]&&i[1]===r[1]){if(n-e>t.length-n)break;for(var s=!0,u=1;u<n-e;u++){var o=t[e+u],a=t[n+u];if(o[0]!==a[0]||o[1]!==a[1]){s=!1;break}}if(s)return[e,n-e]}}return[]};function En(t,e,n,i){this.id=t,this.cost=e,this.index=n,this.value=0,this.priority=i}function Xi(t,e,n,i){En.call(this,t,e,n,i)}Xi.prototype.isInteger=!0;function Cn(t,e){En.call(this,t,0,e,0)}Cn.prototype.isSlack=!0;function Wi(t,e){this.variable=t,this.coefficient=e}function Yi(t,e,n){return n===0||n==="required"?null:(e=e||1,n=n||1,t.isMinimization===!1&&(e=-e),t.addVariable(e,"r"+t.relaxationIndex++,!1,!1,n))}function Pt(t,e,n,i){this.slack=new Cn("s"+n,n),this.index=n,this.model=i,this.rhs=t,this.isUpperBound=e,this.terms=[],this.termsByVarIndex={},this.relaxation=null}Pt.prototype.addTerm=function(t,e){var n=e.index,i=this.termsByVarIndex[n];if(i===void 0)i=new Wi(e,t),this.termsByVarIndex[n]=i,this.terms.push(i),this.isUpperBound===!0&&(t=-t),this.model.updateConstraintCoefficient(this,e,t);else{var r=i.coefficient+t;this.setVariableCoefficient(r,e)}return this};Pt.prototype.removeTerm=function(t){return this};Pt.prototype.setRightHandSide=function(t){if(t!==this.rhs){var e=t-this.rhs;this.isUpperBound===!0&&(e=-e),this.rhs=t,this.model.updateRightHandSide(this,e)}return this};Pt.prototype.setVariableCoefficient=function(t,e){var n=e.index;if(n===-1){console.warn("[Constraint.setVariableCoefficient] Trying to change coefficient of inexistant variable.");return}var i=this.termsByVarIndex[n];if(i===void 0)this.addTerm(t,e);else if(t!==i.coefficient){var r=t-i.coefficient;this.isUpperBound===!0&&(r=-r),i.coefficient=t,this.model.updateConstraintCoefficient(this,e,r)}return this};Pt.prototype.relax=function(t,e){this.relaxation=Yi(this.model,t,e),this._relax(this.relaxation)};Pt.prototype._relax=function(t){t!==null&&(this.isUpperBound?this.setVariableCoefficient(-1,t):this.setVariableCoefficient(1,t))};function Ht(t,e){this.upperBound=t,this.lowerBound=e,this.model=t.model,this.rhs=t.rhs,this.relaxation=null}Ht.prototype.isEquality=!0;Ht.prototype.addTerm=function(t,e){return this.upperBound.addTerm(t,e),this.lowerBound.addTerm(t,e),this};Ht.prototype.removeTerm=function(t){return this.upperBound.removeTerm(t),this.lowerBound.removeTerm(t),this};Ht.prototype.setRightHandSide=function(t){this.upperBound.setRightHandSide(t),this.lowerBound.setRightHandSide(t),this.rhs=t};Ht.prototype.relax=function(t,e){this.relaxation=Yi(this.model,t,e),this.upperBound.relaxation=this.relaxation,this.upperBound._relax(this.relaxation),this.lowerBound.relaxation=this.relaxation,this.lowerBound._relax(this.relaxation)};var wt={Constraint:Pt,Variable:En,IntegerVariable:Xi,SlackVariable:Cn,Equality:Ht,Term:Wi},An=wt.SlackVariable;j.prototype.addCutConstraints=function(t){for(var e=t.length,n=this.height,i=n+e,r=n;r<i;r+=1)this.matrix[r]===void 0&&(this.matrix[r]=this.matrix[r-1].slice());this.height=i,this.nVars=this.width+this.height-2;for(var s,u=this.width-1,o=0;o<e;o+=1){var a=t[o],h=n+o,l=a.type==="min"?-1:1,c=a.varIndex,f=this.rowByVarIndex[c],d=this.matrix[h];if(f===-1){for(d[this.rhsColumn]=l*a.value,s=1;s<=u;s+=1)d[s]=0;d[this.colByVarIndex[c]]=l}else{var g=this.matrix[f],p=g[this.rhsColumn];for(d[this.rhsColumn]=l*(a.value-p),s=1;s<=u;s+=1)d[s]=-l*g[s]}var _=this.getNewElementIndex();this.varIndexByRow[h]=_,this.rowByVarIndex[_]=h,this.colByVarIndex[_]=-1,this.variablesPerIndex[_]=new An("s"+_,_),this.nVars+=1}};j.prototype._addLowerBoundMIRCut=function(t){if(t===this.costRowIndex)return!1;this.model;var e=this.matrix,n=this.variablesPerIndex[this.varIndexByRow[t]];if(!n.isInteger)return!1;var i=e[t][this.rhsColumn],r=i-Math.floor(i);if(r<this.precision||1-this.precision<r)return!1;var s=this.height;e[s]=e[s-1].slice(),this.height+=1,this.nVars+=1;var u=this.getNewElementIndex();this.varIndexByRow[s]=u,this.rowByVarIndex[u]=s,this.colByVarIndex[u]=-1,this.variablesPerIndex[u]=new An("s"+u,u),e[s][this.rhsColumn]=Math.floor(i);for(var o=1;o<this.varIndexByCol.length;o+=1){var a=this.variablesPerIndex[this.varIndexByCol[o]];if(!a.isInteger)e[s][o]=Math.min(0,e[t][o]/(1-r));else{var h=e[t][o],l=Math.floor(h)+Math.max(0,h-Math.floor(h)-r)/(1-r);e[s][o]=l}}for(var c=0;c<this.width;c+=1)e[s][c]-=e[t][c];return!0};j.prototype._addUpperBoundMIRCut=function(t){if(t===this.costRowIndex)return!1;this.model;var e=this.matrix,n=this.variablesPerIndex[this.varIndexByRow[t]];if(!n.isInteger)return!1;var i=e[t][this.rhsColumn],r=i-Math.floor(i);if(r<this.precision||1-this.precision<r)return!1;var s=this.height;e[s]=e[s-1].slice(),this.height+=1,this.nVars+=1;var u=this.getNewElementIndex();this.varIndexByRow[s]=u,this.rowByVarIndex[u]=s,this.colByVarIndex[u]=-1,this.variablesPerIndex[u]=new An("s"+u,u),e[s][this.rhsColumn]=-r;for(var o=1;o<this.varIndexByCol.length;o+=1){var a=this.variablesPerIndex[this.varIndexByCol[o]],h=e[t][o],l=h-Math.floor(h);a.isInteger?l<=r?e[s][o]=-l:e[s][o]=-(1-l)*r/l:h>=0?e[s][o]=-h:e[s][o]=h*r/(1-r)}return!0};j.prototype.applyMIRCuts=function(){};j.prototype._putInBase=function(t){var e=this.rowByVarIndex[t];if(e===-1){for(var n=this.colByVarIndex[t],i=1;i<this.height;i+=1){var r=this.matrix[i][n];if(r<-this.precision||this.precision<r){e=i;break}}this.pivot(e,n)}return e};j.prototype._takeOutOfBase=function(t){var e=this.colByVarIndex[t];if(e===-1){for(var n=this.rowByVarIndex[t],i=this.matrix[n],r=1;r<this.height;r+=1){var s=i[r];if(s<-this.precision||this.precision<s){e=r;break}}this.pivot(n,e)}return e};j.prototype.updateVariableValues=function(){for(var t=this.variables.length,e=Math.round(1/this.precision),n=0;n<t;n+=1){var i=this.variables[n],r=i.index,s=this.rowByVarIndex[r];if(s===-1)i.value=0;else{var u=this.matrix[s][this.rhsColumn];i.value=Math.round((u+Number.EPSILON)*e)/e}}};j.prototype.updateRightHandSide=function(t,e){var n=this.height-1,i=this.rowByVarIndex[t.index];if(i===-1){for(var r=this.colByVarIndex[t.index],s=0;s<=n;s+=1){var u=this.matrix[s];u[this.rhsColumn]-=e*u[r]}var o=this.optionalObjectives.length;if(o>0)for(var a=0;a<o;a+=1){var h=this.optionalObjectives[a].reducedCosts;h[this.rhsColumn]-=e*h[r]}}else this.matrix[i][this.rhsColumn]-=e};j.prototype.updateConstraintCoefficient=function(t,e,n){if(t.index===e.index)throw new Error("[Tableau.updateConstraintCoefficient] constraint index should not be equal to variable index !");var i=this._putInBase(t.index),r=this.colByVarIndex[e.index];if(r===-1)for(var s=this.rowByVarIndex[e.index],u=0;u<this.width;u+=1)this.matrix[i][u]+=n*this.matrix[s][u];else this.matrix[i][r]-=n};j.prototype.updateCost=function(t,e){var n=t.index,i=this.width-1,r=this.colByVarIndex[n];if(r===-1){var s=this.matrix[this.rowByVarIndex[n]],u;if(t.priority===0){var o=this.matrix[0];for(u=0;u<=i;u+=1)o[u]+=e*s[u]}else{var a=this.objectivesByPriority[t.priority].reducedCosts;for(u=0;u<=i;u+=1)a[u]+=e*s[u]}}else this.matrix[0][r]-=e};j.prototype.addConstraint=function(t){var e=t.isUpperBound?1:-1,n=this.height,i=this.matrix[n];i===void 0&&(i=this.matrix[0].slice(),this.matrix[n]=i);for(var r=this.width-1,s=0;s<=r;s+=1)i[s]=0;i[this.rhsColumn]=e*t.rhs;for(var u=t.terms,o=u.length,a=0;a<o;a+=1){var h=u[a],l=h.coefficient,c=h.variable.index,f=this.rowByVarIndex[c];if(f===-1)i[this.colByVarIndex[c]]+=e*l;else{var d=this.matrix[f];for(d[this.rhsColumn],s=0;s<=r;s+=1)i[s]-=e*l*d[s]}}var g=t.index;this.varIndexByRow[n]=g,this.rowByVarIndex[g]=n,this.colByVarIndex[g]=-1,this.height+=1};j.prototype.removeConstraint=function(t){var e=t.index,n=this.height-1,i=this._putInBase(e),r=this.matrix[n];this.matrix[n]=this.matrix[i],this.matrix[i]=r,this.varIndexByRow[i]=this.varIndexByRow[n],this.varIndexByRow[n]=-1,this.rowByVarIndex[e]=-1,this.availableIndexes[this.availableIndexes.length]=e,t.slack.index=-1,this.height-=1};j.prototype.addVariable=function(t){var e=this.height-1,n=this.width,i=this.model.isMinimization===!0?-t.cost:t.cost,r=t.priority,s=this.optionalObjectives.length;if(s>0)for(var u=0;u<s;u+=1)this.optionalObjectives[u].reducedCosts[n]=0;r===0?this.matrix[0][n]=i:(this.setOptionalObjective(r,n,i),this.matrix[0][n]=0);for(var o=1;o<=e;o+=1)this.matrix[o][n]=0;var a=t.index;this.varIndexByCol[n]=a,this.rowByVarIndex[a]=-1,this.colByVarIndex[a]=n,this.width+=1};j.prototype.removeVariable=function(t){var e=t.index,n=this._takeOutOfBase(e),i=this.width-1;if(n!==i){for(var r=this.height-1,s=0;s<=r;s+=1){var u=this.matrix[s];u[n]=u[i]}var o=this.optionalObjectives.length;if(o>0)for(var a=0;a<o;a+=1){var h=this.optionalObjectives[a].reducedCosts;h[n]=h[i]}var l=this.varIndexByCol[i];this.varIndexByCol[n]=l,this.colByVarIndex[l]=n}this.varIndexByCol[i]=-1,this.colByVarIndex[e]=-1,this.availableIndexes[this.availableIndexes.length]=e,t.index=-1,this.width-=1};j.prototype.log=function(t,e){console.log("****",t,"****"),console.log("Nb Variables",this.width-1),console.log("Nb Constraints",this.height-1),console.log("Basic Indexes",this.varIndexByRow),console.log("Non Basic Indexes",this.varIndexByCol),console.log("Rows",this.rowByVarIndex),console.log("Cols",this.colByVarIndex);var n=5,i="",r=[" "],s,u,o,a,h,l,c,f,d,g,p;for(u=1;u<this.width;u+=1)h=this.varIndexByCol[u],a=this.variablesPerIndex[h],a===void 0?l="c"+h:l=a.id,c=l.length,f=" ",d="	",c>5?f+=" ":d+="	",r[u]=f,i+=d+l;console.log(i);var _,m=this.matrix[this.costRowIndex],b="	";for(s=1;s<this.width;s+=1)_="	",b+=_,b+=r[s],b+=m[s].toFixed(n);for(_="	",b+=_+r[0]+m[0].toFixed(n),console.log(b+"	Z"),o=1;o<this.height;o+=1){for(g=this.matrix[o],p="	",u=1;u<this.width;u+=1)_="	",p+=_+r[u]+g[u].toFixed(n);_="	",p+=_+r[0]+g[0].toFixed(n),h=this.varIndexByRow[o],a=this.variablesPerIndex[h],a===void 0?l="c"+h:l=a.id,console.log(p+"	"+l)}console.log("");var w=this.optionalObjectives.length;if(w>0){console.log("    Optional objectives:");for(var E=0;E<w;E+=1){var C=this.optionalObjectives[E].reducedCosts,A="";for(s=1;s<this.width;s+=1)_=C[s]<0?"":" ",A+=_,A+=r[s],A+=C[s].toFixed(n);_=C[0]<0?"":" ",A+=_+r[0]+C[0].toFixed(n),console.log(A+" z"+E)}}return console.log("Feasible?",this.feasible),console.log("evaluation",this.evaluation),this};j.prototype.copy=function(){var t=new j(this.precision);t.width=this.width,t.height=this.height,t.nVars=this.nVars,t.model=this.model,t.variables=this.variables,t.variablesPerIndex=this.variablesPerIndex,t.unrestrictedVars=this.unrestrictedVars,t.lastElementIndex=this.lastElementIndex,t.varIndexByRow=this.varIndexByRow.slice(),t.varIndexByCol=this.varIndexByCol.slice(),t.rowByVarIndex=this.rowByVarIndex.slice(),t.colByVarIndex=this.colByVarIndex.slice(),t.availableIndexes=this.availableIndexes.slice();for(var e=[],n=0;n<this.optionalObjectives.length;n++)e[n]=this.optionalObjectives[n].copy();t.optionalObjectives=e;for(var i=this.matrix,r=new Array(this.height),s=0;s<this.height;s++)r[s]=i[s].slice();return t.matrix=r,t};j.prototype.save=function(){this.savedState=this.copy()};j.prototype.restore=function(){if(this.savedState!==null){var t=this.savedState,e=t.matrix;this.nVars=t.nVars,this.model=t.model,this.variables=t.variables,this.variablesPerIndex=t.variablesPerIndex,this.unrestrictedVars=t.unrestrictedVars,this.lastElementIndex=t.lastElementIndex,this.width=t.width,this.height=t.height;var n,i;for(n=0;n<this.height;n+=1){var r=e[n],s=this.matrix[n];for(i=0;i<this.width;i+=1)s[i]=r[i]}var u=t.varIndexByRow;for(i=0;i<this.height;i+=1)this.varIndexByRow[i]=u[i];for(;this.varIndexByRow.length>this.height;)this.varIndexByRow.pop();var o=t.varIndexByCol;for(n=0;n<this.width;n+=1)this.varIndexByCol[n]=o[n];for(;this.varIndexByCol.length>this.width;)this.varIndexByCol.pop();for(var a=t.rowByVarIndex,h=t.colByVarIndex,l=0;l<this.nVars;l+=1)this.rowByVarIndex[l]=a[l],this.colByVarIndex[l]=h[l];if(t.optionalObjectives.length>0&&this.optionalObjectives.length>0){this.optionalObjectives=[],this.optionalObjectivePerPriority={};for(var c=0;c<t.optionalObjectives.length;c++){var f=t.optionalObjectives[c].copy();this.optionalObjectives[c]=f,this.optionalObjectivePerPriority[f.priority]=f}}}};function Ki(t,e){this.index=t,this.value=e}j.prototype.getMostFractionalVar=function(){for(var t=0,e=null,n=null,i=this.model.integerVariables,r=i.length,s=0;s<r;s++){var u=i[s].index,o=this.rowByVarIndex[u];if(o!==-1){var a=this.matrix[o][this.rhsColumn],h=Math.abs(a-Math.round(a));t<h&&(t=h,e=u,n=a)}}return new Ki(e,n)};j.prototype.getFractionalVarWithLowestCost=function(){for(var t=1/0,e=null,n=null,i=this.model.integerVariables,r=i.length,s=0;s<r;s++){var u=i[s],o=u.index,a=this.rowByVarIndex[o];if(a!==-1){var h=this.matrix[a][this.rhsColumn];if(Math.abs(h-Math.round(h))>this.precision){var l=u.cost;t>l&&(t=l,e=o,n=h)}}}return new Ki(e,n)};j.prototype.countIntegerValues=function(){for(var t=0,e=1;e<this.height;e+=1)if(this.variablesPerIndex[this.varIndexByRow[e]].isInteger){var n=this.matrix[e][this.rhsColumn];n=n-Math.floor(n),n<this.precision&&-n<this.precision&&(t+=1)}return t};j.prototype.isIntegral=function(){for(var t=this.model.integerVariables,e=t.length,n=0;n<e;n++){var i=this.rowByVarIndex[t[n].index];if(i!==-1){var r=this.matrix[i][this.rhsColumn];if(Math.abs(r-Math.round(r))>this.precision)return!1}}return!0};j.prototype.computeFractionalVolume=function(t){for(var e=-1,n=1;n<this.height;n+=1)if(this.variablesPerIndex[this.varIndexByRow[n]].isInteger){var i=this.matrix[n][this.rhsColumn];i=Math.abs(i);var r=Math.min(i-Math.floor(i),Math.floor(i+1));if(r<this.precision){if(!t)return 0}else e===-1?e=i:e*=i}return e===-1?0:e};var Aa=j;function Qn(t,e,n){this.type=t,this.varIndex=e,this.value=n}function Pe(t,e){this.relaxedEvaluation=t,this.cuts=e}function wa(t,e){return e.relaxedEvaluation-t.relaxedEvaluation}j.prototype.applyCuts=function(t){if(this.restore(),this.addCutConstraints(t),this.simplex(),this.model.useMIRCuts)for(var e=!0;e;){var n=this.computeFractionalVolume(!0);this.applyMIRCuts(),this.simplex();var i=this.computeFractionalVolume(!0);i>=.9*n&&(e=!1)}};j.prototype.branchAndCut=function(){var t=[],e=0,n=this.model.tolerance,i=!0,r=1e99;this.model.timeout&&(r=Date.now()+this.model.timeout);for(var s=1/0,u=null,o=[],a=0;a<this.optionalObjectives.length;a+=1)o.push(1/0);var h=new Pe(-1/0,[]),l;for(t.push(h);t.length>0&&i===!0&&Date.now()<r;)if(this.model.isMinimization?l=this.bestPossibleEval*(1+n):l=this.bestPossibleEval*(1-n),n>0&&s<l&&(i=!1),h=t.pop(),!(h.relaxedEvaluation>s)){var c=h.cuts;if(this.applyCuts(c),e++,this.feasible!==!1){var f=this.evaluation;if(!(f>s)){if(f===s){for(var d=!0,g=0;g<this.optionalObjectives.length&&!(this.optionalObjectives[g].reducedCosts[0]>o[g]);g+=1)if(this.optionalObjectives[g].reducedCosts[0]<o[g]){d=!1;break}if(d)continue}if(this.isIntegral()===!0){if(this.__isIntegral=!0,e===1){this.branchAndCutIterations=e;return}u=h,s=f;for(var p=0;p<this.optionalObjectives.length;p+=1)o[p]=this.optionalObjectives[p].reducedCosts[0]}else{e===1&&this.save();for(var _=this.getMostFractionalVar(),m=_.index,b=[],w=[],E=c.length,C=0;C<E;C+=1){var A=c[C];A.varIndex===m?A.type==="min"?w.push(A):b.push(A):(b.push(A),w.push(A))}var I=Math.ceil(_.value),N=Math.floor(_.value),B=new Qn("min",m,I);b.push(B);var k=new Qn("max",m,N);w.push(k),t.push(new Pe(f,b)),t.push(new Pe(f,w)),t.sort(wa)}}}}u!==null&&this.applyCuts(u.cuts),this.branchAndCutIterations=e};var xa={},we=wt.Constraint,Zi=wt.Equality,ba=wt.Variable,Fa=wt.IntegerVariable;function X(t,e){this.tableau=new j(t),this.name=e,this.variables=[],this.integerVariables=[],this.unrestrictedVariables={},this.constraints=[],this.nConstraints=0,this.nVariables=0,this.isMinimization=!0,this.tableauInitialized=!1,this.relaxationIndex=1,this.useMIRCuts=!1,this.checkForCycles=!0,this.messages=[]}var Le=X;X.prototype.minimize=function(){return this.isMinimization=!0,this};X.prototype.maximize=function(){return this.isMinimization=!1,this};X.prototype._getNewElementIndex=function(){if(this.availableIndexes.length>0)return this.availableIndexes.pop();var t=this.lastElementIndex;return this.lastElementIndex+=1,t};X.prototype._addConstraint=function(t){var e=t.slack;this.tableau.variablesPerIndex[e.index]=e,this.constraints.push(t),this.nConstraints+=1,this.tableauInitialized===!0&&this.tableau.addConstraint(t)};X.prototype.smallerThan=function(t){var e=new we(t,!0,this.tableau.getNewElementIndex(),this);return this._addConstraint(e),e};X.prototype.greaterThan=function(t){var e=new we(t,!1,this.tableau.getNewElementIndex(),this);return this._addConstraint(e),e};X.prototype.equal=function(t){var e=new we(t,!0,this.tableau.getNewElementIndex(),this);this._addConstraint(e);var n=new we(t,!1,this.tableau.getNewElementIndex(),this);return this._addConstraint(n),new Zi(e,n)};X.prototype.addVariable=function(t,e,n,i,r){if(typeof r=="string")switch(r){case"required":r=0;break;case"strong":r=1;break;case"medium":r=2;break;case"weak":r=3;break;default:r=0;break}var s=this.tableau.getNewElementIndex();e==null&&(e="v"+s),t==null&&(t=0),r==null&&(r=0);var u;return n?(u=new Fa(e,t,s,r),this.integerVariables.push(u)):u=new ba(e,t,s,r),this.variables.push(u),this.tableau.variablesPerIndex[s]=u,i&&(this.unrestrictedVariables[s]=!0),this.nVariables+=1,this.tableauInitialized===!0&&this.tableau.addVariable(u),u};X.prototype._removeConstraint=function(t){var e=this.constraints.indexOf(t);if(e===-1){console.warn("[Model.removeConstraint] Constraint not present in model");return}this.constraints.splice(e,1),this.nConstraints-=1,this.tableauInitialized===!0&&this.tableau.removeConstraint(t),t.relaxation&&this.removeVariable(t.relaxation)};X.prototype.removeConstraint=function(t){return t.isEquality?(this._removeConstraint(t.upperBound),this._removeConstraint(t.lowerBound)):this._removeConstraint(t),this};X.prototype.removeVariable=function(t){var e=this.variables.indexOf(t);if(e===-1){console.warn("[Model.removeVariable] Variable not present in model");return}return this.variables.splice(e,1),this.tableauInitialized===!0&&this.tableau.removeVariable(t),this};X.prototype.updateRightHandSide=function(t,e){return this.tableauInitialized===!0&&this.tableau.updateRightHandSide(t,e),this};X.prototype.updateConstraintCoefficient=function(t,e,n){return this.tableauInitialized===!0&&this.tableau.updateConstraintCoefficient(t,e,n),this};X.prototype.setCost=function(t,e){var n=t-e.cost;return this.isMinimization===!1&&(n=-n),e.cost=t,this.tableau.updateCost(e,n),this};X.prototype.loadJson=function(t){this.isMinimization=t.opType!=="max";for(var e=t.variables,n=t.constraints,i={},r={},s=Object.keys(n),u=s.length,o=0;o<u;o+=1){var a=s[o],h=n[a],l=h.equal,c=h.weight,f=h.priority,d=c!==void 0||f!==void 0,g,p;if(l===void 0){var _=h.min;_!==void 0&&(g=this.greaterThan(_),i[a]=g,d&&g.relax(c,f));var m=h.max;m!==void 0&&(p=this.smallerThan(m),r[a]=p,d&&p.relax(c,f))}else{g=this.greaterThan(l),i[a]=g,p=this.smallerThan(l),r[a]=p;var b=new Zi(g,p);d&&b.relax(c,f)}}var w=Object.keys(e),E=w.length;this.tolerance=t.tolerance||0,t.timeout&&(this.timeout=t.timeout),t.options&&(t.options.timeout&&(this.timeout=t.options.timeout),this.tolerance===0&&(this.tolerance=t.options.tolerance||0),t.options.useMIRCuts&&(this.useMIRCuts=t.options.useMIRCuts),typeof t.options.exitOnCycles>"u"?this.checkForCycles=!0:this.checkForCycles=t.options.exitOnCycles);for(var C=t.ints||{},A=t.binaries||{},I=t.unrestricted||{},N=t.optimize,B=0;B<E;B+=1){var k=w[B],q=e[k],J=q[N]||0,Q=!!A[k],v=!!C[k]||Q,F=!!I[k],y=this.addVariable(J,k,v,F);Q&&this.smallerThan(1).addTerm(1,y);var M=Object.keys(q);for(o=0;o<M.length;o+=1){var R=M[o];if(R!==N){var T=q[R],$=i[R];$!==void 0&&$.addTerm(T,y);var L=r[R];L!==void 0&&L.addTerm(T,y)}}}return this};X.prototype.getNumberOfIntegerVariables=function(){return this.integerVariables.length};X.prototype.solve=function(){return this.tableauInitialized===!1&&(this.tableau.setModel(this),this.tableauInitialized=!0),this.tableau.solve()};X.prototype.isFeasible=function(){return this.tableau.feasible};X.prototype.save=function(){return this.tableau.save()};X.prototype.restore=function(){return this.tableau.restore()};X.prototype.activateMIRCuts=function(t){this.useMIRCuts=t};X.prototype.debug=function(t){this.checkForCycles=t};X.prototype.log=function(t){return this.tableau.log(t)};var Ba=function(t){var e,n,i;if(typeof t.optimize=="string")if(t.constraints[t.optimize]){e=Math.random();for(n in t.variables)t.variables[n][t.optimize]&&(t.variables[n][e]=t.variables[n][t.optimize]);return t.constraints[e]=t.constraints[t.optimize],delete t.constraints[t.optimize],t}else return t;else{for(i in t.optimize)if(t.constraints[i])if(t.constraints[i]==="equal")delete t.optimize[i];else{e=Math.random();for(n in t.variables)t.variables[n][i]&&(t.variables[n][e]=t.variables[n][i]);t.constraints[e]=t.constraints[i],delete t.constraints[i]}return t}},ti={CleanObjectiveAttributes:Ba};function Ia(t){var e={is_blank:/^\W{0,}$/,is_objective:/(max|min)(imize){0,}\:/i,is_int:/^(?!\/\*)\W{0,}int/i,is_bin:/^(?!\/\*)\W{0,}bin/i,is_constraint:/(\>|\<){0,}\=/i,is_unrestricted:/^\S{0,}unrestricted/i,parse_lhs:/(\-|\+){0,1}\s{0,1}\d{0,}\.{0,}\d{0,}\s{0,}[A-Za-z]\S{0,}/gi,parse_rhs:/(\-|\+){0,1}\d{1,}\.{0,}\d{0,}\W{0,}\;{0,1}$/i,parse_dir:/(\>|\<){0,}\=/gi,parse_int:/[^\s|^\,]+/gi,parse_bin:/[^\s|^\,]+/gi,get_num:/(\-|\+){0,1}(\W|^)\d+\.{0,1}\d{0,}/g,get_word:/[A-Za-z].*/},n={opType:"",optimize:"_obj",constraints:{},variables:{}},i={">=":"min","<=":"max","=":"equal"},r="",s=null,u="",o="",a="",h=0;typeof t=="string"&&(t=t.split(`
`));for(var l=0;l<t.length;l++)if(a="__"+l,r=t[l],s=null,e.is_objective.test(r))n.opType=r.match(/(max|min)/gi)[0],s=r.match(e.parse_lhs).map(function(d){return d.replace(/\s+/,"")}).slice(1),s.forEach(function(d){u=d.match(e.get_num),u===null?d.substr(0,1)==="-"?u=-1:u=1:u=u[0],u=parseFloat(u),o=d.match(e.get_word)[0].replace(/\;$/,""),n.variables[o]=n.variables[o]||{},n.variables[o]._obj=u});else if(e.is_int.test(r))s=r.match(e.parse_int).slice(1),n.ints=n.ints||{},s.forEach(function(d){d=d.replace(";",""),n.ints[d]=1});else if(e.is_bin.test(r))s=r.match(e.parse_bin).slice(1),n.binaries=n.binaries||{},s.forEach(function(d){d=d.replace(";",""),n.binaries[d]=1});else if(e.is_constraint.test(r)){var c=r.indexOf(":"),f=c===-1?r:r.slice(c+1);s=f.match(e.parse_lhs).map(function(d){return d.replace(/\s+/,"")}),s.forEach(function(d){u=d.match(e.get_num),u===null?d.substr(0,1)==="-"?u=-1:u=1:u=u[0],u=parseFloat(u),o=d.match(e.get_word)[0],n.variables[o]=n.variables[o]||{},n.variables[o][a]=u}),h=parseFloat(r.match(e.parse_rhs)[0]),r=i[r.match(e.parse_dir)[0]],n.constraints[a]=n.constraints[a]||{},n.constraints[a][r]=h}else e.is_unrestricted.test(r)&&(s=r.match(e.parse_int).slice(1),n.unrestricted=n.unrestricted||{},s.forEach(function(d){d=d.replace(";",""),n.unrestricted[d]=1}));return n}function $a(t){if(!t)throw new Error("Solver requires a model to operate on");var e="",n={max:"<=",min:">=",equal:"="},i=new RegExp("[^A-Za-z0-9_[{}/.&#$%~'@^]","gi");if(t.opType){e+=t.opType+":";for(var r in t.variables)t.variables[r][r]=t.variables[r][r]?t.variables[r][r]:1,t.variables[r][t.optimize]&&(e+=" "+t.variables[r][t.optimize]+" "+r.replace(i,"_"))}else e+="max:";e+=`;

`;for(var s in t.constraints)for(var u in t.constraints[s])if(typeof n[u]<"u"){for(var o in t.variables)typeof t.variables[o][s]<"u"&&(e+=" "+t.variables[o][s]+" "+o.replace(i,"_"));e+=" "+n[u]+" "+t.constraints[s][u],e+=`;
`}if(t.ints){e+=`

`;for(var a in t.ints)e+="int "+a.replace(i,"_")+`;
`}if(t.unrestricted){e+=`

`;for(var h in t.unrestricted)e+="unrestricted "+h.replace(i,"_")+`;
`}return e}var wn=function(t){return t.length?Ia(t):$a(t)},Sa={},Ma=Object.freeze({__proto__:null,default:Sa});function Ra(t){if(t.__esModule)return t;var e=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(t).forEach(function(n){var i=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,i.get?i:{enumerable:!0,get:function(){return t[n]}})}),e}var ei=Ra(Ma),Ta=wn;function ni(t){return t=t.replace("\\r\\n",`\r
`),t=t.split(`\r
`),t=t.filter(function(e){var n;return n=new RegExp(" 0$","gi"),!(n.test(e)===!0||(n=new RegExp("\\d$","gi"),n.test(e)===!1))}).map(function(e){return e.split(/\:{0,1} +(?=\d)/)}).reduce(function(e,n,i){return e[n[0]]=n[1],e},{}),t}var Na=function(t){return new Promise(function(e,n){typeof window<"u"&&n("Function Not Available in Browser");var i=wn(t);t.external||n("Data for this function must be contained in the 'external' attribute. Not seeing anything there."),t.external.binPath||n("No Executable | Binary path provided in arguments as 'binPath'"),t.external.args||n("No arguments array for cli | bash provided on 'args' attribute"),t.external.tempName||n("No 'tempName' given. This is necessary to produce a staging file for the solver to operate on");var r=ei;r.writeFile(t.external.tempName,i,function(s,u){if(s)n(s);else{var o=ei.execFile;t.external.args.push(t.external.tempName),o(t.external.binPath,t.external.args,function(a,h){if(a)if(a.code===1)e(ni(h));else{var l={"-2":"Out of Memory",1:"SUBOPTIMAL",2:"INFEASIBLE",3:"UNBOUNDED",4:"DEGENERATE",5:"NUMFAILURE",6:"USER-ABORT",7:"TIMEOUT",9:"PRESOLVED",25:"ACCURACY ERROR",255:"FILE-ERROR"},c={code:a.code,meaning:l[a.code],data:h};n(c)}else e(ni(h))})}})})},ka={reformat:Ta,solve:Na},he={lpsolve:ka},ii=function(t,e){var n=e.optimize,i=JSON.parse(JSON.stringify(e.optimize)),r=Object.keys(e.optimize),s,u=0,o={},a="",h={},l=[],c,f,d,g;for(delete e.optimize,c=0;c<r.length;c++)i[r[c]]=0;for(c=0;c<r.length;c++){e.optimize=r[c],e.opType=n[r[c]],s=t.Solve(e,void 0,void 0,!0);for(g in r)if(!e.variables[r[g]]){s[r[g]]=s[r[g]]?s[r[g]]:0;for(d in e.variables)e.variables[d][r[g]]&&s[d]&&(s[r[g]]+=s[d]*e.variables[d][r[g]])}for(a="base",f=0;f<r.length;f++)s[r[f]]?a+="-"+(s[r[f]]*1e3|0)/1e3:a+="-0";if(!o[a]){for(o[a]=1,u++,f=0;f<r.length;f++)s[r[f]]&&(i[r[f]]+=s[r[f]]);delete s.feasible,delete s.result,l.push(s)}}for(c=0;c<r.length;c++)e.constraints[r[c]]={equal:i[r[c]]/u};e.optimize="cheater-"+Math.random(),e.opType="max";for(c in e.variables)e.variables[c].cheater=1;for(c in l)for(d in l[c])h[d]=h[d]||{min:1e99,max:-1e99};for(c in h)for(d in l)l[d][c]?(l[d][c]>h[c].max&&(h[c].max=l[d][c]),l[d][c]<h[c].min&&(h[c].min=l[d][c])):(l[d][c]=0,h[c].min=0);return s=t.Solve(e,void 0,void 0,!0),{midpoint:s,vertices:l,ranges:h}},Oa=wt.Constraint,Pa=wt.Variable,La=wt.Numeral,Va=wt.Term,en=function(){this.Model=Le,this.branchAndCut=xa,this.Constraint=Oa,this.Variable=Pa,this.Numeral=La,this.Term=Va,this.Tableau=Aa,this.lastSolvedModel=null,this.External=he,this.Solve=function(t,e,n,i){if(i)for(var r in ti)t=ti[r](t);if(!t)throw new Error("Solver requires a model to operate on");if(typeof t.optimize=="object"&&Object.keys(t.optimize>1))return ii(this,t);if(t.external){var s=Object.keys(he);if(s=JSON.stringify(s),!t.external.solver)throw new Error("The model you provided has an 'external' object that doesn't have a solver attribute. Use one of the following:"+s);if(!he[t.external.solver])throw new Error("No support (yet) for "+t.external.solver+". Please use one of these instead:"+s);return he[t.external.solver].solve(t)}else{t instanceof Le||(t=new Le(e).loadJson(t));var u=t.solve();if(this.lastSolvedModel=t,u.solutionSet=u.generateSolutionSet(),n)return u;var o={};return o.feasible=u.feasible,o.result=u.evaluation,o.bounded=u.bounded,u._tableau.__isIntegral&&(o.isIntegral=!0),Object.keys(u.solutionSet).forEach(function(a){u.solutionSet[a]!==0&&(o[a]=u.solutionSet[a])}),o}},this.ReformatLP=wn,this.MultiObjective=function(t){return ii(this,t)}};typeof window=="object"?window.solver=new en:typeof self=="object"&&(self.solver=new en);var za=new en;function nn(t,e){const n=e?"":"\0",i=e?"rank: ":"\0",r=e?" -> ":"\0";function s(c){return`${n}${c.id}`}function u(c){return`${c.source.id}${r}${c.target.id}`}function o(c,f){return`${i}${c.id}${r}${f.id}`}function a(c){const f=Object.create(null),d=Object.create(null),g=Object.create(null),p=[];for(const C of c){const A=s(C);d[A]=1,f[A]={opt:C.children.length};const I=t(C);I!==void 0&&p.push([I,C])}for(const C of c.ilinks()){const A=f[s(C.source)],I=f[s(C.target)],N=u(C);g[N]={min:1},A[N]=-1,A.opt++,I[N]=1,I.opt--}let[_,...m]=p.sort(([C],[A])=>C-A);for(const C of m){const[A,I]=_,[N,B]=C,k=f[s(I)],q=f[s(B)],J=o(I,B);if(A<N)g[J]={min:1},k[J]=-1,q[J]=1;else{const Q=o(B,I);g[J]={min:0},g[Q]={min:0},k[J]=-1,k[Q]=1,q[J]=1,q[Q]=-1}_=C}const b=za.Solve({optimize:"opt",opType:"max",constraints:g,variables:f,ints:d}),{feasible:w}=b,E=Ea(b,["feasible"]);if(!w)throw p.length?new Error("could not find a feasbile simplex layout, check that rank accessors are not ill-defined"):new Error("could not find feasbile simplex layout, this should not happen");for(const C of c)C.layer=E[s(C)]||0}function h(c){return c===void 0?t:nn(c,e)}a.rank=h;function l(c){return c===void 0?e:nn(t,c)}return a.debug=l,a}function ja(){}function qa(...t){if(t.length)throw new Error(`got arguments to simplex(${t}), but constructor takes no aruguments.`);return nn(ja,!1)}function Ja(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function*Ga(t,e){for(let n of t)n!=null&&(n=+n)>=n&&(yield n)}function ri(t,e){let n;for(const i of t)i!=null&&(n<i||n===void 0&&i>=i)&&(n=i);return n}function si(t,e){let n;for(const i of t)i!=null&&(n>i||n===void 0&&i>=i)&&(n=i);return n}function Qi(t,e,n=0,i=t.length-1,r=Ja){for(;i>n;){if(i-n>600){const a=i-n+1,h=e-n+1,l=Math.log(a),c=.5*Math.exp(2*l/3),f=.5*Math.sqrt(l*c*(a-c)/a)*(h-a/2<0?-1:1),d=Math.max(n,Math.floor(e-h*c/a+f)),g=Math.min(i,Math.floor(e+(a-h)*c/a+f));Qi(t,e,d,g,r)}const s=t[e];let u=n,o=i;for(Wt(t,n,e),r(t[i],s)>0&&Wt(t,n,i);u<o;){for(Wt(t,u,o),++u,--o;r(t[u],s)<0;)++u;for(;r(t[o],s)>0;)--o}r(t[n],s)===0?Wt(t,n,o):(++o,Wt(t,o,i)),o<=e&&(n=o+1),e<=o&&(i=o-1)}return t}function Wt(t,e,n){const i=t[e];t[e]=t[n],t[n]=i}function Ha(t,e,n){if(t=Float64Array.from(Ga(t)),!!(i=t.length)){if((e=+e)<=0||i<2)return si(t);if(e>=1)return ri(t);var i,r=(i-1)*e,s=Math.floor(r),u=ri(Qi(t,s).subarray(0,s+1)),o=si(t.subarray(s+1));return u+(o-u)*(r-s)}}function Ua(t,e){return Ha(t,.5)}function Xa(...t){if(t.length)throw new Error(`got arguments to median(${t}), but constructor takes no aruguments.`);function e(n,i){const r=new at;for(const[o,a]of n.entries())for(const h of a.ichildren())r.setIfAbsent(h.id,[]).push(o);const s=new at;let u=-1;for(const o of i){const a=Ua(r.getDefault(o.id,[]));a===void 0?(s.set(o.id,u),u=+!((u+1)/(n.length+1))*(n.length+1)-1):s.set(o.id,a)}i.sort((o,a)=>s.getThrow(o.id)-s.getThrow(a.id))}return e}function tr(t){function e(i){i.slice(0,i.length-1).forEach((r,s)=>t(r,i[s+1]))}function n(i){return i===void 0?t:tr(i)}return e.order=n,e}function Wa(...t){if(t.length)throw new Error(`got arguments to twoLayer(${t}), but constructor takes no aruguments.`);return tr(Xa())}function xt(t,e,n,i,r,s,u){const[o,a]=r;function h(w){const E=[];for(const C of w.descendants()){const A=C.layer;(E[A]||(E[A]=[])).push(C),C.dataChildren=C.dataChildren.map(N=>{const B=N.child.layer;if(B<=A)throw new Error(`layering left child node "${N.child.id}" (${B}) with a greater or equal layer to parent node "${C.id}" (${A})`);let k=N.child;for(let q=B-1;q>A;q--){let J;u?J=`${C.id}->${N.child.id} (${q})`:J=`${C.id}\0${N.child.id}\0${q}`;const Q=new Ft(J);Q.dataChildren.push(new De(k,void 0)),(E[q]||(E[q]=[])).push(Q),k=Q}return new De(k,N.data)})}return E}function l(w){for(const E of w)E instanceof Ft||(E.dataChildren=E.dataChildren.map(C=>{let A=C.child;const I=[{x:E.x,y:E.y}];for(;A instanceof Ft;)I.push({x:A.x,y:A.y}),[A]=A.ichildren();return I.push({x:A.x,y:A.y}),new De(A,C.data,I)}))}function c(w){t(w);for(const A of w){const I=A.layer;if(I===void 0)throw new Error(`layering did not assign layer to node '${A.id}'`);if(I<0)throw new Error(`layering assigned a negative layer (${I}) to node '${A.id}'`)}const E=h(w);if(E.length===1){const[A]=E;for(const I of A)I.y=a/2}else{const A=i?a:a/(E.length-1);for(const[I,N]of E.entries())for(const B of N)B.y=A*I}if(E.every(A=>A.length===1))for(const[A]of E)A.x=o/2;else if(E.length===1){const[A]=E;Hi(A,s);const I=A,N=i?I.length-1:1;for(const B of I)B.x*=o*N}else{e(E),n(E,s);for(const N of E)for(const B of N)if(B.x===void 0)throw new Error(`coord didn't assign an x to node '${B.id}'`);const A=E,I=i?Math.max(...E.map(N=>N.length))-1:1;for(const N of A)for(const B of N)B.x*=o*I}const C=w;return l(C),C}function f(w){return w===void 0?t:xt(w,e,n,i,r,s,u)}c.layering=f;function d(w){return w===void 0?e:xt(t,w,n,i,r,s,u)}c.decross=d;function g(w){return w===void 0?n:xt(t,e,w,i,r,s,u)}c.coord=g;function p(w){return w!==void 0?xt(t,e,n,!1,w,s,u):i?null:r}c.size=p;function _(w){return w!==void 0?xt(t,e,n,!0,w,s,u):i?r:null}c.nodeSize=_;function m(w){return w===void 0?s:xt(t,e,n,i,r,w,u)}c.separation=m;function b(w){return w===void 0?u:xt(t,e,n,i,r,s,w)}return c.debug=b,c}function Ya(t,e){return+!(t instanceof Ft)+ +!(e instanceof Ft)}function Ka(...t){if(t.length)throw new Error(`got arguments to sugiyama(${t}), but constructor takes no aruguments.`);return xt(qa(),Wa(),_a(),!1,[1,1],Ya,!1)}var Za=function(t,e){return t<e};function Y(t){if(!(this instanceof Y))return new Y(t);this.array=[],this.size=0,this.compare=t||Za}Y.prototype.clone=function(){var t=new Y(this.compare);t.size=this.size;for(var e=0;e<this.size;e++)t.array.push(this.array[e]);return t};Y.prototype.add=function(t){var e=this.size;this.array[this.size]=t,this.size+=1;for(var n,i;e>0&&(n=e-1>>1,i=this.array[n],!!this.compare(t,i));)this.array[e]=i,e=n;this.array[e]=t};Y.prototype.heapify=function(t){this.array=t,this.size=t.length;var e;for(e=this.size>>1;e>=0;e--)this._percolateDown(e)};Y.prototype._percolateUp=function(t,e){for(var n=this.array[t],i,r;t>0&&(i=t-1>>1,r=this.array[i],!(!e&&!this.compare(n,r)));)this.array[t]=r,t=i;this.array[t]=n};Y.prototype._percolateDown=function(t){for(var e=this.size,n=this.size>>>1,i=this.array[t],r,s,u;t<n&&(r=(t<<1)+1,s=r+1,u=this.array[r],s<e&&this.compare(this.array[s],u)&&(r=s,u=this.array[s]),!!this.compare(u,i));)this.array[t]=u,t=r;this.array[t]=i};Y.prototype._removeAt=function(t){if(!(t>this.size-1||t<0))return this._percolateUp(t,!0),this.poll()};Y.prototype.remove=function(t){for(var e=0;e<this.size;e++)if(!this.compare(this.array[e],t)&&!this.compare(t,this.array[e]))return this._removeAt(e),!0;return!1};Y.prototype._batchRemove=function(t,e){var n=new Array(e||this.size),i=0;if(typeof t=="function"&&this.size)for(var r=0;r<this.size&&i<n.length;)t(this.array[r])?(n[i]=this._removeAt(r),i++,r=r>>1):r++;return n.length=i,n};Y.prototype.removeOne=function(t){var e=this._batchRemove(t,1);return e.length>0?e[0]:void 0};Y.prototype.removeMany=function(t,e){return this._batchRemove(t,e)};Y.prototype.peek=function(){if(this.size!=0)return this.array[0]};Y.prototype.poll=function(){if(this.size!=0){var t=this.array[0];return this.size>1?(this.array[0]=this.array[--this.size],this._percolateDown(0)):this.size-=1,t}};Y.prototype.replaceTop=function(t){if(this.size!=0){var e=this.array[0];return this.array[0]=t,this._percolateDown(0),e}};Y.prototype.trim=function(){this.array=this.array.slice(0,this.size)};Y.prototype.isEmpty=function(){return this.size===0};Y.prototype.forEach=function(t){if(!(this.isEmpty()||typeof t!="function"))for(var e=0,n=this.clone();!n.isEmpty();)t(n.poll(),e++)};Y.prototype.kSmallest=function(t){if(this.size==0)return[];var e=this.compare,n=this.array,i=new Y(function(h,l){return e(n[h],n[l])});t=Math.min(this.size,t);var r=new Array(t),s=0;for(i.add(0);s<t;){var u=i.poll();r[s++]=this.array[u];var o=(u<<1)+1,a=o+1;o<this.size&&i.add(o),a<this.size&&i.add(a)}return r};var Qa=Y;class tl{constructor(){this.before=[],this.parents=[]}}function er(t){function e(i){const r=t||Math.floor(Math.sqrt(i.size()+.5)),s=new at(i.idescendants().map(f=>[f.id,new tl]));for(const f of i)for(const d of f.ichildren())s.getThrow(d.id).parents.push(f);function u(f,d){const g=s.getThrow(f.id).before,p=s.getThrow(d.id).before;for(const[_,m]of g.entries()){const b=p[_];if(b===void 0)return!1;if(m<b)return!0;if(b<m)return!1}return!0}const o=new Qa(u);for(const f of i.iroots())o.add(f);let a=0,h=0,l=0,c;for(;c=o.poll();){l<r&&s.getThrow(c.id).parents.every(f=>Qe(f.layer)<h)?(c.layer=h,l++):(c.layer=++h,l=1);for(const f of c.ichildren()){const{before:d,parents:g}=s.getThrow(f.id);d.push(a),d.length===g.length&&(d.sort((p,_)=>_-p),o.add(f))}a++}}function n(i){if(i===void 0)return t;if(i<0)throw new Error(`width must be non-negative: ${i}`);return er(i)}return e.width=n,e}function el(...t){if(t.length)throw new Error(`got arguments to coffmanGraham(${t}), but constructor takes no aruguments.`);return er(0)}function nl(...t){if(t.length)throw new Error(`got arguments to center(${t}), but constructor takes no aruguments.`);function e(n,i){const r=Math.max(...n.map(s=>{let[u,...o]=s,a=u.x=0;for(const h of o)a=h.x=a+i(u,h),u=h;return a}));if(r>0)for(const s of n){const u=Qe(s[s.length-1].x)/2;for(const o of s)o.x=(Qe(o.x)-u)/r+.5}else for(const s of n)for(const u of s)u.x=.5}return e}class nr{constructor(){this.stateAtEvent=new il,this.eventCache=new rl}}class il{constructor(){this.state={}}setState(e,n){this.state[e]=n,console.log(`StateAtEvent ${e} is`,n)}getStateAsEventIds(e){return this.state[e]?new Set(Object.values(this.state[e])):new Set}getState(e){return this.state[e]?JSON.parse(JSON.stringify(this.state[e])):{}}}class rl{constructor(){this.cache=new Map}store(e){this.cache.set(e.event_id,e)}get(e){return this.cache.get(e)}}class sl{constructor(e){this.scenario=e,this.index=e.events.length-1,this.eventIdOrdering=e.events.map(n=>n.event_id),this.currentEventId=this.eventIdOrdering[this.index]}next(){this.index++,this.index>=this.eventIdOrdering.length&&(this.index=this.eventIdOrdering.length-1),this.currentEventId=this.eventIdOrdering[this.index]}previous(){this.index--,this.index<0&&(this.index=0),this.currentEventId=this.eventIdOrdering[this.index]}goTo(e){for(let n=0;n<this.eventIdOrdering.length;n++)if(this.eventIdOrdering[n]===e){this.index=n,this.currentEventId=this.eventIdOrdering[this.index];break}}current(){return this.currentEventId}eventsUpToCurrent(){const e=[];for(let n=0;n<=this.index;n++)e.push(this.eventIdOrdering[n]);return e}async resolve(e,n){for(const i of this.eventsUpToCurrent())await this.resolveEvent(i,e,n)}async resolveEvent(e,n,i){if(n.stateAtEvent.getStateAsEventIds(e).size>0)return;const r=n.eventCache.get(e);let s={};switch(r.prev_events.length){case 0:break;case 1:{const u=r.prev_events[0],o=n.stateAtEvent.getState(u);Object.keys(o).length===0&&console.error(`WARN: we do not know the state at ${u} yet, so the state calculation for ${e} may be wrong!`),s=o;break}default:{const u=[];for(const o of r.prev_events){const a=n.stateAtEvent.getState(o);Object.keys(a).length===0&&console.error(`WARN: we do not know the state at ${o} yet, so the state calculation for ${e} may be wrong!`),u.push(a)}console.log("performing state resolution for prev_events:",r.prev_events),s=await i(r.room_id,this.scenario.roomVersion,u)}}r.state_key!=null&&(s[JSON.stringify([r.type,r.state_key])]=e),n.stateAtEvent.setState(e,s)}}class ul{constructor(e,n){this.container=e,this.template=n}clear(){this.container.innerHTML=""}onEventClick(e){this.positionListener=e}onEventJsonClick(e){this.jsonListener=e}onCellClick(e){this.onClick(e,this.positionListener)}onJsonClick(e){this.onClick(e,this.jsonListener)}onClick(e,n){var s;const i=(s=e.target)==null?void 0:s.parentElement;if(!i)return;const r=i.getAttribute("id");r&&n&&n(r)}appendEvent(e,n){const i=this.template.content.firstElementChild.cloneNode(!0);i.setAttribute("id",n.event_id);const r=i.getElementsByClassName("eventlistrowprefix")[0];r.textContent=String(e),i.addEventListener("click",this.onCellClick.bind(this)),i.getElementsByClassName("eventlistrowjson")[0].addEventListener("click",this.onJsonClick.bind(this)),i.getElementsByClassName("eventlistrowbody")[0].textContent=this.textRepresentation(n),i.getElementsByClassName("eventlistroweventid")[0].textContent=n.event_id.substr(0,5),n.state_key!=null&&(i.style.fontWeight="600"),this.container.appendChild(i)}textRepresentation(e){var r;let n="",i="";if(e.state_key!=null)switch(e.type){case"m.room.create":n=`by ${e.content.creator}`;break;case"m.room.member":n=`${e.state_key}=${e.content.membership}`;break;case"m.room.join_rules":n=`(${e.content.join_rule})`;break;case"m.room.history_visibility":n=`(${e.content.history_visibility})`;break;case"m.room.name":n=`(${e.content.name})`;break;case"m.room.topic":n=`(${e.content.topic})`;break;default:e.state_key!==""&&(n=e.state_key)}else switch(e.type){case"m.reaction":i=(r=e.content["m.relates_to"])==null?void 0:r.key;break;case"m.room.message":i=e.content.body;break}return`${e.type} ${n}${i}`}highlight(e){if(this.highlightedEventId){const n=document.getElementById(this.highlightedEventId);n&&(n.style.backgroundColor="")}document.getElementById(e).style.backgroundColor="#6f8ea9",this.highlightedEventId=e}}var ol=/[\u1680\u2000-\u200A\u202F\u205F\u3000]/,al=/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08BD\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312E\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FEA\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC03-\uDC37\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDF00-\uDF19]|\uD806[\uDCA0-\uDCDF\uDCFF\uDE00\uDE0B-\uDE32\uDE3A\uDE50\uDE5C-\uDE83\uDE86-\uDE89\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD46]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50\uDF93-\uDF9F\uDFE0\uDFE1]|\uD821[\uDC00-\uDFEC]|\uD822[\uDC00-\uDEF2]|\uD82C[\uDC00-\uDD1E\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]/,ll=/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05F0-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u082D\u0840-\u085B\u0860-\u086A\u08A0-\u08B4\u08B6-\u08BD\u08D4-\u08E1\u08E3-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u09FC\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0AF9-\u0AFF\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58-\u0C5A\u0C60-\u0C63\u0C66-\u0C6F\u0C80-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D00-\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D54-\u0D57\u0D5F-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1877\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19D9\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1C80-\u1C88\u1CD0-\u1CD2\u1CD4-\u1CF9\u1D00-\u1DF9\u1DFB-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u2E2F\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099\u309A\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312E\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FEA\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA827\uA840-\uA873\uA880-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD\uA900-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDDFD\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF7A\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00-\uDE03\uDE05\uDE06\uDE0C-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE38-\uDE3A\uDE3F\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE6\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC00-\uDC46\uDC66-\uDC6F\uDC7F-\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD00-\uDD34\uDD36-\uDD3F\uDD50-\uDD73\uDD76\uDD80-\uDDC4\uDDCA-\uDDCC\uDDD0-\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE37\uDE3E\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEEA\uDEF0-\uDEF9\uDF00-\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3C-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF50\uDF57\uDF5D-\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC00-\uDC4A\uDC50-\uDC59\uDC80-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDB5\uDDB8-\uDDC0\uDDD8-\uDDDD\uDE00-\uDE40\uDE44\uDE50-\uDE59\uDE80-\uDEB7\uDEC0-\uDEC9\uDF00-\uDF19\uDF1D-\uDF2B\uDF30-\uDF39]|\uD806[\uDCA0-\uDCE9\uDCFF\uDE00-\uDE3E\uDE47\uDE50-\uDE83\uDE86-\uDE99\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC36\uDC38-\uDC40\uDC50-\uDC59\uDC72-\uDC8F\uDC92-\uDCA7\uDCA9-\uDCB6\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD36\uDD3A\uDD3C\uDD3D\uDD3F-\uDD47\uDD50-\uDD59]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50-\uDF7E\uDF8F-\uDF9F\uDFE0\uDFE1]|\uD821[\uDC00-\uDFEC]|\uD822[\uDC00-\uDEF2]|\uD82C[\uDC00-\uDD1E\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9D\uDC9E]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD838[\uDC00-\uDC06\uDC08-\uDC18\uDC1B-\uDC21\uDC23\uDC24\uDC26-\uDC2A]|\uD83A[\uDC00-\uDCC4\uDCD0-\uDCD6\uDD00-\uDD4A\uDD50-\uDD59]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uDB40[\uDD00-\uDDEF]/,Ve={Space_Separator:ol,ID_Start:al,ID_Continue:ll},K={isSpaceSeparator(t){return typeof t=="string"&&Ve.Space_Separator.test(t)},isIdStartChar(t){return typeof t=="string"&&(t>="a"&&t<="z"||t>="A"&&t<="Z"||t==="$"||t==="_"||Ve.ID_Start.test(t))},isIdContinueChar(t){return typeof t=="string"&&(t>="a"&&t<="z"||t>="A"&&t<="Z"||t>="0"&&t<="9"||t==="$"||t==="_"||t===""||t===""||Ve.ID_Continue.test(t))},isDigit(t){return typeof t=="string"&&/[0-9]/.test(t)},isHexDigit(t){return typeof t=="string"&&/[0-9A-Fa-f]/.test(t)}};let rn,nt,_t,xe,It,ct,tt,xn,te;var hl=function(e,n){rn=String(e),nt="start",_t=[],xe=0,It=1,ct=0,tt=void 0,xn=void 0,te=void 0;do tt=cl(),pl[nt]();while(tt.type!=="eof");return typeof n=="function"?sn({"":te},"",n):te};function sn(t,e,n){const i=t[e];if(i!=null&&typeof i=="object")if(Array.isArray(i))for(let r=0;r<i.length;r++){const s=String(r),u=sn(i,s,n);u===void 0?delete i[s]:Object.defineProperty(i,s,{value:u,writable:!0,enumerable:!0,configurable:!0})}else for(const r in i){const s=sn(i,r,n);s===void 0?delete i[r]:Object.defineProperty(i,r,{value:s,writable:!0,enumerable:!0,configurable:!0})}return n.call(t,e,i)}let P,O,Qt,gt,V;function cl(){for(P="default",O="",Qt=!1,gt=1;;){V=Ct();const t=ir[P]();if(t)return t}}function Ct(){if(rn[xe])return String.fromCodePoint(rn.codePointAt(xe))}function x(){const t=Ct();return t===`
`?(It++,ct=0):t?ct+=t.length:ct++,t&&(xe+=t.length),t}const ir={default(){switch(V){case"	":case"\v":case"\f":case" ":case"":case"\uFEFF":case`
`:case"\r":case"\u2028":case"\u2029":x();return;case"/":x(),P="comment";return;case void 0:return x(),H("eof")}if(K.isSpaceSeparator(V)){x();return}return ir[nt]()},comment(){switch(V){case"*":x(),P="multiLineComment";return;case"/":x(),P="singleLineComment";return}throw U(x())},multiLineComment(){switch(V){case"*":x(),P="multiLineCommentAsterisk";return;case void 0:throw U(x())}x()},multiLineCommentAsterisk(){switch(V){case"*":x();return;case"/":x(),P="default";return;case void 0:throw U(x())}x(),P="multiLineComment"},singleLineComment(){switch(V){case`
`:case"\r":case"\u2028":case"\u2029":x(),P="default";return;case void 0:return x(),H("eof")}x()},value(){switch(V){case"{":case"[":return H("punctuator",x());case"n":return x(),Mt("ull"),H("null",null);case"t":return x(),Mt("rue"),H("boolean",!0);case"f":return x(),Mt("alse"),H("boolean",!1);case"-":case"+":x()==="-"&&(gt=-1),P="sign";return;case".":O=x(),P="decimalPointLeading";return;case"0":O=x(),P="zero";return;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":O=x(),P="decimalInteger";return;case"I":return x(),Mt("nfinity"),H("numeric",1/0);case"N":return x(),Mt("aN"),H("numeric",NaN);case'"':case"'":Qt=x()==='"',O="",P="string";return}throw U(x())},identifierNameStartEscape(){if(V!=="u")throw U(x());x();const t=un();switch(t){case"$":case"_":break;default:if(!K.isIdStartChar(t))throw ui();break}O+=t,P="identifierName"},identifierName(){switch(V){case"$":case"_":case"":case"":O+=x();return;case"\\":x(),P="identifierNameEscape";return}if(K.isIdContinueChar(V)){O+=x();return}return H("identifier",O)},identifierNameEscape(){if(V!=="u")throw U(x());x();const t=un();switch(t){case"$":case"_":case"":case"":break;default:if(!K.isIdContinueChar(t))throw ui();break}O+=t,P="identifierName"},sign(){switch(V){case".":O=x(),P="decimalPointLeading";return;case"0":O=x(),P="zero";return;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":O=x(),P="decimalInteger";return;case"I":return x(),Mt("nfinity"),H("numeric",gt*(1/0));case"N":return x(),Mt("aN"),H("numeric",NaN)}throw U(x())},zero(){switch(V){case".":O+=x(),P="decimalPoint";return;case"e":case"E":O+=x(),P="decimalExponent";return;case"x":case"X":O+=x(),P="hexadecimal";return}return H("numeric",gt*0)},decimalInteger(){switch(V){case".":O+=x(),P="decimalPoint";return;case"e":case"E":O+=x(),P="decimalExponent";return}if(K.isDigit(V)){O+=x();return}return H("numeric",gt*Number(O))},decimalPointLeading(){if(K.isDigit(V)){O+=x(),P="decimalFraction";return}throw U(x())},decimalPoint(){switch(V){case"e":case"E":O+=x(),P="decimalExponent";return}if(K.isDigit(V)){O+=x(),P="decimalFraction";return}return H("numeric",gt*Number(O))},decimalFraction(){switch(V){case"e":case"E":O+=x(),P="decimalExponent";return}if(K.isDigit(V)){O+=x();return}return H("numeric",gt*Number(O))},decimalExponent(){switch(V){case"+":case"-":O+=x(),P="decimalExponentSign";return}if(K.isDigit(V)){O+=x(),P="decimalExponentInteger";return}throw U(x())},decimalExponentSign(){if(K.isDigit(V)){O+=x(),P="decimalExponentInteger";return}throw U(x())},decimalExponentInteger(){if(K.isDigit(V)){O+=x();return}return H("numeric",gt*Number(O))},hexadecimal(){if(K.isHexDigit(V)){O+=x(),P="hexadecimalInteger";return}throw U(x())},hexadecimalInteger(){if(K.isHexDigit(V)){O+=x();return}return H("numeric",gt*Number(O))},string(){switch(V){case"\\":x(),O+=fl();return;case'"':if(Qt)return x(),H("string",O);O+=x();return;case"'":if(!Qt)return x(),H("string",O);O+=x();return;case`
`:case"\r":throw U(x());case"\u2028":case"\u2029":vl(V);break;case void 0:throw U(x())}O+=x()},start(){switch(V){case"{":case"[":return H("punctuator",x())}P="value"},beforePropertyName(){switch(V){case"$":case"_":O=x(),P="identifierName";return;case"\\":x(),P="identifierNameStartEscape";return;case"}":return H("punctuator",x());case'"':case"'":Qt=x()==='"',P="string";return}if(K.isIdStartChar(V)){O+=x(),P="identifierName";return}throw U(x())},afterPropertyName(){if(V===":")return H("punctuator",x());throw U(x())},beforePropertyValue(){P="value"},afterPropertyValue(){switch(V){case",":case"}":return H("punctuator",x())}throw U(x())},beforeArrayValue(){if(V==="]")return H("punctuator",x());P="value"},afterArrayValue(){switch(V){case",":case"]":return H("punctuator",x())}throw U(x())},end(){throw U(x())}};function H(t,e){return{type:t,value:e,line:It,column:ct}}function Mt(t){for(const e of t){if(Ct()!==e)throw U(x());x()}}function fl(){switch(Ct()){case"b":return x(),"\b";case"f":return x(),"\f";case"n":return x(),`
`;case"r":return x(),"\r";case"t":return x(),"	";case"v":return x(),"\v";case"0":if(x(),K.isDigit(Ct()))throw U(x());return"\0";case"x":return x(),dl();case"u":return x(),un();case`
`:case"\u2028":case"\u2029":return x(),"";case"\r":return x(),Ct()===`
`&&x(),"";case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":throw U(x());case void 0:throw U(x())}return x()}function dl(){let t="",e=Ct();if(!K.isHexDigit(e)||(t+=x(),e=Ct(),!K.isHexDigit(e)))throw U(x());return t+=x(),String.fromCodePoint(parseInt(t,16))}function un(){let t="",e=4;for(;e-- >0;){const n=Ct();if(!K.isHexDigit(n))throw U(x());t+=x()}return String.fromCodePoint(parseInt(t,16))}const pl={start(){if(tt.type==="eof")throw Rt();ze()},beforePropertyName(){switch(tt.type){case"identifier":case"string":xn=tt.value,nt="afterPropertyName";return;case"punctuator":ce();return;case"eof":throw Rt()}},afterPropertyName(){if(tt.type==="eof")throw Rt();nt="beforePropertyValue"},beforePropertyValue(){if(tt.type==="eof")throw Rt();ze()},beforeArrayValue(){if(tt.type==="eof")throw Rt();if(tt.type==="punctuator"&&tt.value==="]"){ce();return}ze()},afterPropertyValue(){if(tt.type==="eof")throw Rt();switch(tt.value){case",":nt="beforePropertyName";return;case"}":ce()}},afterArrayValue(){if(tt.type==="eof")throw Rt();switch(tt.value){case",":nt="beforeArrayValue";return;case"]":ce()}},end(){}};function ze(){let t;switch(tt.type){case"punctuator":switch(tt.value){case"{":t={};break;case"[":t=[];break}break;case"null":case"boolean":case"numeric":case"string":t=tt.value;break}if(te===void 0)te=t;else{const e=_t[_t.length-1];Array.isArray(e)?e.push(t):Object.defineProperty(e,xn,{value:t,writable:!0,enumerable:!0,configurable:!0})}if(t!==null&&typeof t=="object")_t.push(t),Array.isArray(t)?nt="beforeArrayValue":nt="beforePropertyName";else{const e=_t[_t.length-1];e==null?nt="end":Array.isArray(e)?nt="afterArrayValue":nt="afterPropertyValue"}}function ce(){_t.pop();const t=_t[_t.length-1];t==null?nt="end":Array.isArray(t)?nt="afterArrayValue":nt="afterPropertyValue"}function U(t){return be(t===void 0?`JSON5: invalid end of input at ${It}:${ct}`:`JSON5: invalid character '${rr(t)}' at ${It}:${ct}`)}function Rt(){return be(`JSON5: invalid end of input at ${It}:${ct}`)}function ui(){return ct-=5,be(`JSON5: invalid identifier character at ${It}:${ct}`)}function vl(t){console.warn(`JSON5: '${rr(t)}' in strings is not valid ECMAScript; consider escaping`)}function rr(t){const e={"'":"\\'",'"':'\\"',"\\":"\\\\","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t","\v":"\\v","\0":"\\0","\u2028":"\\u2028","\u2029":"\\u2029"};if(e[t])return e[t];if(t<" "){const n=t.charCodeAt(0).toString(16);return"\\x"+("00"+n).substring(n.length)}return t}function be(t){const e=new SyntaxError(t);return e.lineNumber=It,e.columnNumber=ct,e}var Dl=function(e,n,i){const r=[];let s="",u,o,a="",h;if(n!=null&&typeof n=="object"&&!Array.isArray(n)&&(i=n.space,h=n.quote,n=n.replacer),typeof n=="function")o=n;else if(Array.isArray(n)){u=[];for(const p of n){let _;typeof p=="string"?_=p:(typeof p=="number"||p instanceof String||p instanceof Number)&&(_=String(p)),_!==void 0&&u.indexOf(_)<0&&u.push(_)}}return i instanceof Number?i=Number(i):i instanceof String&&(i=String(i)),typeof i=="number"?i>0&&(i=Math.min(10,Math.floor(i)),a="          ".substr(0,i)):typeof i=="string"&&(a=i.substr(0,10)),l("",{"":e});function l(p,_){let m=_[p];switch(m!=null&&(typeof m.toJSON5=="function"?m=m.toJSON5(p):typeof m.toJSON=="function"&&(m=m.toJSON(p))),o&&(m=o.call(_,p,m)),m instanceof Number?m=Number(m):m instanceof String?m=String(m):m instanceof Boolean&&(m=m.valueOf()),m){case null:return"null";case!0:return"true";case!1:return"false"}if(typeof m=="string")return c(m);if(typeof m=="number")return String(m);if(typeof m=="object")return Array.isArray(m)?g(m):f(m)}function c(p){const _={"'":.1,'"':.2},m={"'":"\\'",'"':'\\"',"\\":"\\\\","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t","\v":"\\v","\0":"\\0","\u2028":"\\u2028","\u2029":"\\u2029"};let b="";for(let E=0;E<p.length;E++){const C=p[E];switch(C){case"'":case'"':_[C]++,b+=C;continue;case"\0":if(K.isDigit(p[E+1])){b+="\\x00";continue}}if(m[C]){b+=m[C];continue}if(C<" "){let A=C.charCodeAt(0).toString(16);b+="\\x"+("00"+A).substring(A.length);continue}b+=C}const w=h||Object.keys(_).reduce((E,C)=>_[E]<_[C]?E:C);return b=b.replace(new RegExp(w,"g"),m[w]),w+b+w}function f(p){if(r.indexOf(p)>=0)throw TypeError("Converting circular structure to JSON5");r.push(p);let _=s;s=s+a;let m=u||Object.keys(p),b=[];for(const E of m){const C=l(E,p);if(C!==void 0){let A=d(E)+":";a!==""&&(A+=" "),A+=C,b.push(A)}}let w;if(b.length===0)w="{}";else{let E;if(a==="")E=b.join(","),w="{"+E+"}";else{let C=`,
`+s;E=b.join(C),w=`{
`+s+E+`,
`+_+"}"}}return r.pop(),s=_,w}function d(p){if(p.length===0)return c(p);const _=String.fromCodePoint(p.codePointAt(0));if(!K.isIdStartChar(_))return c(p);for(let m=_.length;m<p.length;m++)if(!K.isIdContinueChar(String.fromCodePoint(p.codePointAt(m))))return c(p);return p}function g(p){if(r.indexOf(p)>=0)throw TypeError("Converting circular structure to JSON5");r.push(p);let _=s;s=s+a;let m=[];for(let w=0;w<p.length;w++){const E=l(String(w),p);m.push(E!==void 0?E:"null")}let b;if(m.length===0)b="[]";else if(a==="")b="["+m.join(",")+"]";else{let w=`,
`+s,E=m.join(w);b=`[
`+s+E+`,
`+_+"]"}return r.pop(),s=_,b}};const ml={parse:hl,stringify:Dl};var gl=ml;const oi="10";async function yl(t){const e=await new Promise((i,r)=>{const s=new FileReader;s.onload=u=>{if(!u.target||!u.target.result)return;if(t.name.endsWith(".json5")){const a=gl.parse(u.target.result);a.on_load_at_start==null&&(a.on_load_at_start=!1),a.calculate_event_ids==null&&(a.calculate_event_ids=!1),a.room_version==null&&(a.room_version=oi),i(a);return}const o=u.target.result.split(`
`).filter(a=>a.trim().length>0).map(a=>JSON.parse(a));i(o)},s.readAsText(t)});let n;return Array.isArray(e)?n={tardis_version:1,room_version:oi,room_id:e[0].room_id,calculate_event_ids:!1,on_load_at_start:!1,events:e}:n=e,sr(n)}function sr(t){var r,s,u,o;const e={events:[],roomVersion:t.room_version,annotations:t.annotations,precalculatedStateAfter:t.precalculated_state_after,onLoadAtStart:t.on_load_at_start},n=new Map;let i=new Date(2024,0,1).getTime();for(const a of t.events){if(!a)throw new Error("missing event");if(!a.event_id)throw new Error(`event is missing 'event_id', got ${JSON.stringify(a)}`);if(!a.type)throw new Error(`event is missing 'type' field, got ${JSON.stringify(a)}`);if(a.origin_server_ts||(a.origin_server_ts=i,i+=1e3),!a.room_id&&t.room_id&&(a.room_id=t.room_id),t.calculate_event_ids){const h=a.event_id;for(const c of["prev_events","auth_events"]){const f=[];for(const d of a[c]){const g=n.get(d);g?f.push(g):f.push(d)}a[c]=f}const l=globalThis.gmslEventIDForEvent(JSON.stringify(a),t.room_version);n.set(h,l),a.event_id=l,(s=(r=e.annotations)==null?void 0:r.events)!=null&&s[h]&&(e.annotations.events[l]=e.annotations.events[h]),(o=(u=e.annotations)==null?void 0:u.titles)!=null&&o[h]&&(e.annotations.titles[l]=e.annotations.titles[h])}e.events.push(a)}if(e.precalculatedStateAfter)for(const a in e.precalculatedStateAfter){const h=n.get(a);if(!h){console.error(`precalculated_state_after references ${a} but this does not exist in the events array. Skipping.`);continue}const l=[];for(const c of e.precalculatedStateAfter[a]){const f=n.get(c);f?l.push(f):console.error(`precalculated_state_after for ${a} references ${c} but this does not exist in the events array. Skipping.`)}e.precalculatedStateAfter[h]=l,delete e.precalculatedStateAfter[a]}return console.log(e),e}class _l{constructor(e,n){this.sender=e,this.getEvent=n,this.inflightRequests=new Map}onGetEventRequest(e){const n=this.getEvent(e);return n||console.error(`WS: asked for event ${e.event_id} but didn't find it.`),n}onResolveStateResponse(e,n){const i=this.inflightRequests.get(e);if(!i){console.error(`onResolveStateResponse: no request id for response! id=${e}`);return}i(n),this.inflightRequests.delete(e)}async resolveState(e,n,i){console.log("resolveState",i);const r=globalThis.crypto.randomUUID();return new Promise((u,o)=>{this.inflightRequests.set(r,a=>{if(!a.result){console.error("State resolved to the empty set"),u({state:{}});return}u({state:a.result})}),this.sender.sendResolveState(r,{state:i,room_id:e,room_version:n})})}}class El{async sendResolveState(e,n){this.sendWs({id:e,type:"resolve_state",data:n})}async connect(e,n){return this.receiver=n,this.ws=new WebSocket(e),new Promise(i=>{this.ws.addEventListener("open",()=>{console.log("WS open"),i()}),this.ws.addEventListener("error",this.onWsError.bind(this)),this.ws.addEventListener("close",this.onWsClose.bind(this)),this.ws.addEventListener("message",this.onWsMessage.bind(this))})}close(){this.ws.close()}sendWs(e){console.log("send",e),this.ws.send(JSON.stringify(e))}onWsClose(e){}onWsError(e){}onWsMessage(e){const n=JSON.parse(e.data);switch(console.log("recv",n),n.type){case"get_event":{const i=n.data,r=this.receiver.onGetEventRequest(i);i.event=r,n.data=i,this.sendWs(n);break}case"resolve_state":{const i=n.data;this.receiver.onResolveStateResponse(n.id,i);break}}}}const ur={calculate_event_ids:!0,on_load_at_start:!0,events:[{type:"m.room.create",state_key:"",sender:"@creator:tardis",auth_events:[],prev_events:[],content:{creator:"@creator:tardis"},event_id:"$CREATE",origin_server_ts:140956024e4},{type:"m.room.member",state_key:"@creator:tardis",sender:"@creator:tardis",auth_events:["$CREATE"],prev_events:["$CREATE"],content:{membership:"join"},event_id:"$JOIN",origin_server_ts:1409560241e3},{type:"m.room.message",sender:"@creator:tardis",auth_events:["$CREATE","$JOIN"],prev_events:["$JOIN"],content:{body:"A wild fork appears!"},event_id:"$FORK1",origin_server_ts:1409560242e3},{type:"m.room.message",sender:"@creator:tardis",auth_events:["$CREATE","$JOIN"],prev_events:["$JOIN"],content:{body:"Another wild fork appears!"},event_id:"$FORK2",origin_server_ts:1409560243e3},{type:"m.room.message",sender:"@creator:tardis",auth_events:["$CREATE","$JOIN"],prev_events:["$FORK1","$FORK2"],content:{body:"Merged!"},event_id:"$MERGE",origin_server_ts:1409560244e3},{type:"m.room.message",sender:"@creator:tardis",auth_events:["$CREATE","$JOIN"],prev_events:["$MERGE"],content:{body:"This event has precalculated state"},event_id:"$PRESTATE",origin_server_ts:1409560245e3},{type:"m.room.name",state_key:"",sender:"@creator:tardis",auth_events:["$CREATE","$JOIN"],prev_events:["$PRESTATE"],content:{name:"State events are bigger than messages"},event_id:"$MSG",origin_server_ts:1409560246e3},{type:"m.room.message",sender:"@creator:tardis",auth_events:["$CREATE","$JOIN"],prev_events:["$MSG"],content:{body:"Boring long chains..."},event_id:"$MSG2",origin_server_ts:1409560246e3},{type:"m.room.message",sender:"@creator:tardis",auth_events:["$CREATE","$JOIN"],prev_events:["$MSG2"],content:{body:"...can be collapsed..."},event_id:"$MSG3",origin_server_ts:1409560246e3},{type:"m.room.message",sender:"@creator:tardis",auth_events:["$CREATE","$JOIN"],prev_events:["$MSG3"],content:{body:"...by checking the collapse checkbox."},event_id:"$MSG4",origin_server_ts:1409560246e3}],room_id:"!quickstart:tardis",room_version:"10",tardis_version:1,annotations:{title:["Welcome to TARDIS!","(click, drag, zoom to navigate the DAG)","Press the  button to continue."].join(`
`),titles:{$FORK1:["The current event is highlighted in blue.","Message events are smaller than state events."].join(`
`),$FORK2:["The DAG can fork, which indicates","some events were sent at the same time."].join(`
`),$MERGE:["The DAG can merge, which merges","state from each fork together."].join(`
`),$PRESTATE:["Green events indicate the","state at this event.","Message events will never be green."].join(`
`),$MSG:["Check the 'Auth Chain' box to show","the `auth_events` for each event."].join(`
`),$MSG2:["Press the 'Resolve State' button to","calculate which events are part of","the current room state."].join(`
`),$MSG3:["As state resolution is iterative,","it will resolve state for all earlier","events as well. Click on an earlier","event in the list to jump to that event."].join(`
`),$MSG4:["Now load a file or use one of the","pre-loaded files to experiment with","state resolution in Matrix!"].join(`
`)},events:{$MSG:"Bigger nodes like this one are state events.",$MSG2:"Boring long chains...",$MSG3:"...can be collapsed...",$MSG4:"...by checking the collapse checkbox.",$PRESTATE:"This event has pre-calculated state (in green) after this event"}},precalculated_state_after:{$PRESTATE:["$CREATE","$JOIN"]}},Cl={calculate_event_ids:!0,on_load_at_start:!0,events:[{type:"m.room.create",state_key:"",sender:"@alice:tardis",auth_events:[],prev_events:[],content:{creator:"@alice:tardis"},event_id:"$CREATE"},{type:"m.room.member",state_key:"@alice:tardis",sender:"@alice:tardis",auth_events:["$CREATE"],prev_events:["$CREATE"],content:{membership:"join"},event_id:"$ALICE"},{type:"m.room.power_levels",state_key:"",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE"],prev_events:["$ALICE"],content:{users:{"@alice:tardis":100},events:{"m.room.name":50},users_default:50},event_id:"$PL"},{type:"m.room.join_rules",state_key:"",sender:"@creator:tardis",auth_events:["$CREATE","$ALICE","$PL"],prev_events:["$PL"],content:{join_rule:"public"},event_id:"$JR"},{type:"m.room.member",state_key:"@bob:tardis",sender:"@bob:tardis",auth_events:["$CREATE","$JR","$PL"],prev_events:["$JR"],content:{membership:"join"},event_id:"$BOB"},{type:"m.room.name",state_key:"",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE","$PL"],prev_events:["$BOB"],content:{name:"Alice Room"},event_id:"$ALICE_NAME"},{type:"m.room.name",state_key:"",sender:"@bob:tardis",auth_events:["$CREATE","$BOB","$PL"],prev_events:["$BOB"],content:{name:"Bob Room"},event_id:"$BOB_NAME"},{type:"m.room.message",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE","$PL"],prev_events:["$ALICE_NAME","$BOB_NAME"],content:{body:"Bob wins."},event_id:"$MERGE1"},{type:"m.room.name",state_key:"",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE","$PL"],prev_events:["$MERGE1"],content:{name:"Alice Room 2"},origin_server_ts:1704067291337,event_id:"$ALICE_NAME2"},{type:"m.room.name",state_key:"",sender:"@bob:tardis",auth_events:["$CREATE","$BOB","$PL"],prev_events:["$MERGE1"],content:{name:"Bob Room 2"},origin_server_ts:1704067291337,event_id:"$BOB_NAME2"},{type:"m.room.message",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE","$PL"],prev_events:["$ALICE_NAME2","$BOB_NAME2"],content:{body:"Alice wins."},event_id:"$MERGE2"},{type:"m.room.name",state_key:"",sender:"@bob:tardis",auth_events:["$CREATE","$BOB","$PL"],prev_events:["$MERGE2"],content:{name:"Bob Room 3"},origin_server_ts:1704077299300,event_id:"$BOB_NAME3"},{type:"m.room.power_levels",state_key:"",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE"],prev_events:["$MERGE2"],content:{users:{"@alice:tardis":100},events:{"m.room.name":50},users_default:50},event_id:"$PL2"},{type:"m.room.name",state_key:"",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE","$PL2"],prev_events:["$PL2"],content:{name:"Alice Room 3"},origin_server_ts:1704077299300,event_id:"$ALICE_NAME3"},{type:"m.room.message",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE","$PL2"],prev_events:["$ALICE_NAME3","$BOB_NAME3"],content:{body:"Alice wins."},event_id:"$MERGE3"}],room_id:"!mainline-fork:tardis",room_version:"10",tardis_version:1,annotations:{title:["The winner follows this priority:","Mainline depth THEN","origin_server_ts THEN","event ID"].join(`
`),titles:{$ALICE:["Mainline Ordering:","The conflicting state events in this example","are all room name changes and hence do not","restrict anyone's permissions. This makes it","easier to explain. All of the merges in this","example are due to 'mainline ordering'.","NOTE: You need a shim server running to run this,","otherwise you won't see which events win state","resolution!"].join(`
`),$MERGE1:["Bob wins because his event has a higher origin_server_ts.","Both events have the same mainline depth."].join(`
`),$MERGE2:["Both events have the same timestamp.","Alice wins with a higher event ID (A < Z < a < z)."].join(`
`),$MERGE3:["Bob's event has a higher timestamp but","Alice wins because her event","happened AFTER a change to the power levels.","This gives her event a higher 'mainline position'","which is considered before the timestamp or event ID."].join(`
`)},events:{}}},Al={calculate_event_ids:!0,on_load_at_start:!0,events:[{type:"m.room.create",state_key:"",sender:"@alice:tardis",auth_events:[],prev_events:[],content:{creator:"@alice:tardis"},event_id:"$CREATE"},{type:"m.room.member",state_key:"@alice:tardis",sender:"@alice:tardis",auth_events:["$CREATE"],prev_events:["$CREATE"],content:{membership:"join"},event_id:"$ALICE"},{type:"m.room.power_levels",state_key:"",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE"],prev_events:["$ALICE"],content:{users:{"@alice:tardis":100},events:{"m.room.join_rules":50},users_default:50},event_id:"$PL"},{type:"m.room.join_rules",state_key:"",sender:"@creator:tardis",auth_events:["$CREATE","$ALICE","$PL"],prev_events:["$PL"],content:{join_rule:"public"},event_id:"$JR"},{type:"m.room.member",state_key:"@bob:tardis",sender:"@bob:tardis",auth_events:["$CREATE","$JR","$PL"],prev_events:["$JR"],content:{membership:"join"},event_id:"$BOB"},{type:"m.room.member",state_key:"@charlie:tardis",sender:"@charlie:tardis",auth_events:["$CREATE","$JR","$PL"],prev_events:["$BOB"],content:{membership:"join"},event_id:"$CHARLIE"},{type:"m.room.join_rules",state_key:"",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE","$PL"],prev_events:["$CHARLIE"],content:{join_rule:"invite"},event_id:"$ALICE_JR"},{type:"m.room.join_rules",state_key:"",sender:"@bob:tardis",auth_events:["$CREATE","$BOB","$PL"],prev_events:["$CHARLIE"],content:{join_rule:"knock"},event_id:"$BOB_JR"},{type:"m.room.message",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE","$PL"],prev_events:["$ALICE_JR","$BOB_JR"],content:{body:"Bob wins."},event_id:"$MERGE1"},{type:"m.room.join_rules",state_key:"",sender:"@bob:tardis",auth_events:["$CREATE","$BOB","$PL"],prev_events:["$MERGE1"],content:{join_rule:"knock"},event_id:"$BOB_JR2"},{type:"m.room.join_rules",state_key:"",sender:"@charlie:tardis",auth_events:["$CREATE","$CHARLIE","$PL"],prev_events:["$MERGE1"],content:{join_rule:"public"},event_id:"$CHARLIE_JR"},{type:"m.room.message",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE","$PL"],prev_events:["$BOB_JR2","$CHARLIE_JR"],content:{body:"Charlie wins."},event_id:"$MERGE2"},{type:"m.room.join_rules",state_key:"",sender:"@bob:tardis",auth_events:["$CREATE","$BOB","$PL"],prev_events:["$MERGE2"],content:{join_rule:"knock"},origin_server_ts:1704077299300,event_id:"$BOB_JR3"},{type:"m.room.join_rules",state_key:"",sender:"@charlie:tardis",auth_events:["$CREATE","$CHARLIE","$PL"],prev_events:["$MERGE2"],content:{join_rule:"invite"},origin_server_ts:1704077299300,event_id:"$CHARLIE_JR2"},{type:"m.room.message",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE","$PL"],prev_events:["$CHARLIE_JR2","$BOB_JR3"],content:{body:"Bob wins."},event_id:"$MERGE3"}],room_id:"!power-ordering:tardis",room_version:"10",tardis_version:1,annotations:{title:["The winner follows this priority:","Sender Power Level THEN","origin_server_ts THEN","event ID"].join(`
`),titles:{$PL:"Join rules can be modified by ANYONE",$ALICE:["Reverse Topological Power Ordering:","The conflicting state events in this example","potentially restrict permissions because they","are join rules. All of the merges in this","example are due to this ordering.","NOTE: You need a shim server running to run this,","otherwise you won't see which events win state","resolution!"].join(`
`),$MERGE1:["Bob wins because he has a lower PL (50 vs 100).","This seems undesirable at first,","but this can be worded another way:","Alice's event is APPLIED FIRST, and then only","if given Alice's event can Bob's event be","applied will it be applied."].join(`
`),$MERGE2:["Both Bob and Charlie have the same PL (50).","Charlie wins because his event has a higher origin_server_ts"].join(`
`),$MERGE3:["Both events have the same timestamp.","Bob wins because his event ID is greater than Charlie's","(A < Z < a < z)"].join(`
`)},events:{}}},ai={"Quick Start":ur,"Mainline Ordering":Cl,"Reverse Topological Power Ordering":Al},dt=new ul(document.getElementById("eventlist"),document.getElementById("eventlisttemplate"));class or{constructor(e){this.cache=e,this.createEventId=null,this.showAuthChain=!1,this.showPrevEvents=!0,this.showOutliers=!1,this.collapse=!1,this.renderEvents={}}setShimUrl(e){this.shimUrl=e,console.log("setShimUrl",e)}async loadFile(e){const n=await yl(e);this.loadScenario(n)}loadScenario(e){for(const n of e.events)this.cache.eventCache.store(n),n.type==="m.room.create"&&n.state_key===""&&(this.createEventId=n.event_id);if(e.precalculatedStateAfter)for(const n in e.precalculatedStateAfter){const i={};for(const r of e.precalculatedStateAfter[n]){const s=this.cache.eventCache.get(r);if(!s||s.state_key==null){console.log(`precalculated_state_after for ${n} includes ${r} but it isn't a state event we know about. Skipping.`);continue}i[JSON.stringify([s.type,s.state_key])]=s.event_id}this.cache.stateAtEvent.setState(n,i)}this.scenario=e,this.debugger=new sl(e),e.onLoadAtStart&&e.events.length>=2&&this.debugger.goTo(e.events[1].event_id),dt.clear(),e.events.forEach((n,i)=>{dt.appendEvent(i,n)}),dt.highlight(this.debugger.current()),dt.onEventClick(n=>{this.debugger.goTo(n),this.refresh(),dt.highlight(G.debugger.current())}),dt.onEventJsonClick(n=>{document.getElementById("eventdetails").textContent=JSON.stringify(this.cache.eventCache.get(n),null,2),document.getElementById("infocontainer").style.display="block"}),this.refresh()}setShowAuthChain(e){this.showAuthChain=e}setShowPrevEvents(e){this.showPrevEvents=e}setShowOutliers(e){this.showOutliers=e}setCollapse(e){this.collapse=e}async refresh(){let e=await this.recalculate();this.collapse&&(e=this.collapsifier(e)),this.renderEvents=e,await this.render(this.eventsToCompleteDag(e))}async recalculate(){const e=Object.create(null);for(const n of this.debugger.eventsUpToCurrent())e[n]=this.cache.eventCache.get(n);return e}eventsToCompleteDag(e){for(const n in e){const i=e[n],r=["auth_events","prev_events"];for(const s of r)for(const u of i[s])e[u]||(this.cache.eventCache.get(u)?e[u]={event_id:u,prev_events:[],auth_events:[],state_key:"...",type:"...",content:{},sender:"",room_id:"!"}:e[u]={event_id:u,prev_events:[],auth_events:[],state_key:"missing",type:"missing",content:{},sender:"",room_id:"!"})}return e}findForwardExtremities(e){const n=new Set;for(const i in e)n.add(i);for(const i in e){const r=e[i];for(const s of r.prev_events)n.delete(s);for(const s of r.auth_events)n.delete(s)}return n}collapsifier(e){const n=JSON.parse(JSON.stringify(e)),i=this.findForwardExtremities(n),r=new Set;for(const h of i)r.add(h);const s=Object.create(null);for(const h in n){const l=n[h];for(const c of l.prev_events){const f=s[c]||0;s[c]=f+1}l.prev_events.length!==1&&r.add(l.event_id)}for(const h in s)s[h]>1&&r.add(h);const u=new Set;for(const h in n){if(r.has(h)){u.add(h);continue}const l=n[h];if(r.has(l.prev_events[0])){u.add(h);continue}for(const c of r){const f=n[c];if(!f)continue;let d=!1;for(const g of f.prev_events)if(g===h){u.add(h),d=!0;break}if(d)break}}const o=[],a=new Set;for(const h of i)o.push({id:h,from:h});for(;o.length>0;){const h=o.pop();if(!h)break;const l=h.id,c=n[l];if(a.has(l)||(a.add(l),!c))continue;for(const g of c.prev_events)o.push({id:g,from:h.id});if(u.has(l))continue;delete n[l];const f=n[h.from],d=[c.prev_events[0]];for(const g in f.prev_events)u.has(g)&&d.push(g);f.prev_events=d,f._collapse=f._collapse||0,f._collapse+=1,n[h.from]=f;for(const g of o)g.from===l&&(g.from=f.event_id)}return console.log("collapsifier complete"),n}async render(e){var B,k,q,J,Q;const n=!this.showOutliers,i=document.getElementById("svgcontainer");i.innerHTML="";const r=i.offsetWidth,s=window.innerHeight;if(console.log(e),Object.keys(e).length<=1)return;let u=Qo().id(v=>v.event_id).parentIds(v=>this.showAuthChain?v.prev_events.concat(v.auth_events.filter(F=>F!==this.createEventId)):v.prev_events).parentData(v=>{const F=[],y=this.showAuthChain?v.prev_events.concat(v.auth_events):v.prev_events;for(const M of new Set(y))e[M]&&F.push([M,{auth:v.auth_events.includes(M)&&!v.prev_events.includes(M)}]);return F})(Object.values(e));const o=u.split();if(n){const v=o.filter(F=>F.descendants().length>1);v.length>1&&console.error(`hideOrphans: ${v.length} roots with children, this should not be possible unless there are 2 DAG chunks in this file`),u=v[0]}console.log("dag:",u);const a=10,h=a*4,l=document.createElementNS("http://www.w3.org/2000/svg","svg");l.setAttribute("width",String(r)),l.setAttribute("height",String(s)),l.setAttribute("viewBox",`${-h} ${-h} ${r+10*h} ${s+2*h}`);const c=yt(l),f=c.append("text").attr("x",r/3).attr("y",-40).style("font-size","24px");let d=(q=(k=(B=this.scenario)==null?void 0:B.annotations)==null?void 0:k.titles)==null?void 0:q[this.debugger.current()];d||(d=((Q=(J=this.scenario)==null?void 0:J.annotations)==null?void 0:Q.title)||"");for(const v of d.split(`
`))f.append("tspan").attr("x",r/2).attr("dy","1.2em").text(v);const g=c.append("defs");Ka().layering(el().width(2)).coord(nl()).size([r,s])(u);const p=u.size(),_=Io,m={};u.idescendants("after").forEach((v,F)=>{m[v.id]=_(F/p)});const b=To().curve(ko).x(v=>v.x).y(v=>v.y),w=c.append("g").selectAll("path").data(u.links()).enter().append("path").attr("d",({points:v})=>b(v)).attr("fill","none").attr("stroke-width",v=>{const F=v.target;return F.data._collapse?F.data._collapse<5?5:10:3}).text("test").attr("stroke",v=>{const F=v.source,y=v.target,M=`${F.id}-${y.id}`,R=g.append("linearGradient").attr("id",M).attr("gradientUnits","userSpaceOnUse").attr("x1",F.x).attr("x2",y.x).attr("y1",F.y).attr("y2",y.y);return R.append("stop").attr("offset","0%").attr("stop-color",v.data.auth?m[F.id]:"#000"),R.append("stop").attr("offset","100%").attr("stop-color",v.data.auth?m[y.id]:"#000"),`url(#${M})`}),E=c.append("g").selectAll("g").data(u.descendants()).enter().append("g").attr("transform",({x:v,y:F})=>`translate(${v}, ${F})`),C=this.cache.stateAtEvent.getStateAsEventIds(this.debugger.current());E.append("circle").attr("r",v=>{const F=this.cache.eventCache.get(v.id);return F&&F.state_key!=null?a*1.5:a}).attr("fill",v=>v.id===this.debugger.current()?"blue":C.has(v.id)?"green":"black");const A=v=>{var $,L,z,et,W;const F=v.data.event_id,y=F.substr(0,5);if((z=(L=($=this.scenario)==null?void 0:$.annotations)==null?void 0:L.events)!=null&&z[F])return`${y} ${(W=(et=this.scenario)==null?void 0:et.annotations)==null?void 0:W.events[F]}`;const M=dt.textRepresentation(v.data),R=v.data.depth?`(${v.data.depth})`:"";let T=v.data._collapse?`+${v.data._collapse} more`:"";return T===""&&v.data.origin!==void 0&&(T=v.data.origin),`${y} ${R} ${M} ${T}`};E.append("text").text(v=>A(v)).attr("transform",`translate(${a+10}, 0)`).attr("font-family","sans-serif").attr("text-anchor","left").attr("alignment-baseline","middle").attr("fill","white").attr("opacity",.8).attr("stroke","white"),E.append("text").text(v=>A(v)).attr("cursor","pointer").on("click",async(v,F)=>{this.debugger.goTo(F.data.event_id),dt.highlight(F.data.event_id),this.refresh()}).attr("transform",`translate(${a+10}, 0)`).attr("font-family","sans-serif").attr("text-anchor","left").attr("alignment-baseline","middle").attr("fill",v=>"black");function I({transform:v}){E.attr("transform",F=>`translate(${v.applyX(F.x)}, ${v.applyY(F.y)})`),w.attr("d",({points:F})=>b(F.map(y=>({x:v.applyX(y.x),y:v.applyY(y.y)})))),f.attr("transform",()=>`translate(${v.applyX(f.attr("x"))}, ${v.applyY(f.attr("y"))})`)}const N=qo().scaleExtent([.1,10]).on("zoom",I);c.call(N).call(N.transform,yn),yt("#svgcontainer").append(()=>l)}}let G=new or(new nr);G.setShimUrl(document.getElementById("shimurl").value);const on=new El,li=new _l(on,t=>G.cache.eventCache.get(t.event_id));document.getElementById("showauthevents").addEventListener("change",t=>{G.setShowAuthChain(t.target.checked),G.refresh()});document.getElementById("showauthevents").checked=G.showAuthChain;document.getElementById("showoutliers").addEventListener("change",t=>{G.setShowOutliers(t.target.checked),G.refresh()});document.getElementById("showoutliers").checked=G.showOutliers;document.getElementById("collapse").addEventListener("change",t=>{G.setCollapse(t.target.checked),G.refresh()});document.getElementById("collapse").checked=G.collapse;document.getElementById("jsonfile").addEventListener("change",async t=>{const e=document.getElementById("jsonfile").files;e&&(G=new or(new nr),G.setShimUrl(document.getElementById("shimurl").value),await G.loadFile(e[0]))},!1);document.getElementById("closeinfocontainer").addEventListener("click",t=>{document.getElementById("infocontainer").style.display="none"});document.getElementById("infocontainer").style.display="none";document.getElementById("stepfwd").addEventListener("click",async t=>{G.debugger.next(),G.refresh(),dt.highlight(G.debugger.current())});document.getElementById("stepbwd").addEventListener("click",async t=>{G.debugger.previous(),G.refresh(),dt.highlight(G.debugger.current())});document.getElementById("shimurl").addEventListener("change",t=>{const e=t.target.value;G.setShimUrl(e),globalThis.localStorage.setItem("shim_url",e)});const hi=globalThis.localStorage.getItem("shim_url");hi&&(console.log("setting shim url from local storage"),document.getElementById("shimurl").value=hi);document.getElementById("resolve").addEventListener("click",async t=>{await G.debugger.resolve(G.cache,async(e,n,i)=>{if(!G.shimUrl)return console.error("you need to set a shim url to resolve state!"),{};try{return await on.connect(G.shimUrl,li),(await li.resolveState(e,n,i)).state}catch(r){console.error("failed to setup WS connection:",r)}finally{on.close()}return{}}),G.refresh()});const ci=new Go;WebAssembly.instantiateStreaming(fetch("gmsl.wasm"),ci.importObject).then(t=>{globalThis.wasm=t.instance,ci.run(globalThis.wasm);const e=i=>{const r=sr(i);G.loadScenario(r)},n=document.getElementById("file-select");n&&(n.innerHTML="",Object.keys(ai).forEach((i,r)=>{n[r]=new Option(i)}),n.addEventListener("change",i=>{var s;const r=ai[(s=i==null?void 0:i.target)==null?void 0:s.value];e(r)})),e(ur)});
