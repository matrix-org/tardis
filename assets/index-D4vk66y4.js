var jn=Object.defineProperty;var Wn=(e,t,n)=>t in e?jn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var R=(e,t,n)=>Wn(e,typeof t!="symbol"?t+"":t,n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))u(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const s of i.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&u(s)}).observe(document,{childList:!0,subtree:!0});function n(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function u(r){if(r.ep)return;r.ep=!0;const i=n(r);fetch(r.href,i)}})();class on{constructor(){R(this,"stateAtEvent");R(this,"eventCache");this.stateAtEvent=new Un,this.eventCache=new zn}}class Un{constructor(){R(this,"state");this.state={}}setState(t,n){this.state[t]=n,console.log(`StateAtEvent ${t} is`,n)}getStateAsEventIds(t){return this.state[t]?new Set(Object.values(this.state[t])):new Set}getState(t){return this.state[t]?JSON.parse(JSON.stringify(this.state[t])):{}}}class zn{constructor(){R(this,"cache");this.cache=new Map}store(t){this.cache.set(t.event_id,t)}get(t){return this.cache.get(t)}}class Xn{constructor(t){R(this,"index");R(this,"eventIdOrdering");R(this,"currentEventId");this.scenario=t,this.index=t.events.length-1,this.eventIdOrdering=t.events.map(n=>n.event_id),this.currentEventId=this.eventIdOrdering[this.index]}next(){this.index++,this.index>=this.eventIdOrdering.length&&(this.index=this.eventIdOrdering.length-1),this.currentEventId=this.eventIdOrdering[this.index]}previous(){this.index--,this.index<0&&(this.index=0),this.currentEventId=this.eventIdOrdering[this.index]}goTo(t){for(let n=0;n<this.eventIdOrdering.length;n++)if(this.eventIdOrdering[n]===t){this.index=n,this.currentEventId=this.eventIdOrdering[this.index];break}}current(){return this.currentEventId}eventsUpToCurrent(){const t=[];for(let n=0;n<=this.index;n++)t.push(this.eventIdOrdering[n]);return t}async resolve(t,n){for(const u of this.eventsUpToCurrent())await this.resolveEvent(u,t,n)}async resolveEvent(t,n,u){if(n.stateAtEvent.getStateAsEventIds(t).size>0)return;const r=n.eventCache.get(t),i=[];for(const o of r.prev_events){const c=n.stateAtEvent.getState(o);Object.keys(c).length===0&&console.error(`WARN: we do not know the state at ${o} yet, so the state calculation for ${t} may be wrong!`),i.push(c)}console.log("performing state resolution for prev_events:",r.prev_events);const s=await u(r.room_id,this.scenario.roomVersion,i,r);n.stateAtEvent.setState(t,s)}}class Yn{constructor(t,n){R(this,"highlightedEventId");R(this,"positionListener");R(this,"jsonListener");this.container=t,this.template=n}clear(){this.container.innerHTML=""}onEventClick(t){this.positionListener=t}onEventJsonClick(t){this.jsonListener=t}onCellClick(t){this.onClick(t,this.positionListener)}onJsonClick(t){this.onClick(t,this.jsonListener)}onClick(t,n){var i;const u=(i=t.target)==null?void 0:i.parentElement;if(!u)return;const r=u.getAttribute("id");r&&n&&n(r)}appendEvent(t,n){const u=this.template.content.firstElementChild.cloneNode(!0);u.setAttribute("id",n.event_id);const r=u.getElementsByClassName("eventlistrowprefix")[0];r.textContent=String(t),u.addEventListener("click",this.onCellClick.bind(this)),u.getElementsByClassName("eventlistrowjson")[0].addEventListener("click",this.onJsonClick.bind(this)),u.getElementsByClassName("eventlistrowbody")[0].textContent=an(n),u.getElementsByClassName("eventlistroweventid")[0].textContent=n.event_id.substr(0,5),n.state_key!=null&&(u.style.fontWeight="600"),this.container.appendChild(u)}highlight(t){if(this.highlightedEventId){const n=document.getElementById(this.highlightedEventId);n&&(n.style.backgroundColor="")}document.getElementById(t).style.backgroundColor="#6f8ea9",this.highlightedEventId=t}}function an(e){var u;let t="",n="";if(e.state_key!=null)switch(e.type){case"m.room.create":t=`by ${e.content.creator}`;break;case"m.room.member":t=`${e.state_key}=${e.content.membership}`;break;case"m.room.join_rules":t=`(${e.content.join_rule})`;break;case"m.room.history_visibility":t=`(${e.content.history_visibility})`;break;case"m.room.name":t=`(${e.content.name})`;break;case"m.room.topic":t=`(${e.content.topic})`;break;default:e.state_key!==""&&(t=e.state_key)}else switch(e.type){case"m.reaction":n=(u=e.content["m.relates_to"])==null?void 0:u.key;break;case"m.room.message":n=e.content.body;break}return`${e.type} ${t}${n}`}var Kn={value:()=>{}};function cn(){for(var e=0,t=arguments.length,n={},u;e<t;++e){if(!(u=arguments[e]+"")||u in n||/[\s.]/.test(u))throw new Error("illegal type: "+u);n[u]=[]}return new Re(n)}function Re(e){this._=e}function Zn(e,t){return e.trim().split(/^|\s+/).map(function(n){var u="",r=n.indexOf(".");if(r>=0&&(u=n.slice(r+1),n=n.slice(0,r)),n&&!t.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:u}})}Re.prototype=cn.prototype={constructor:Re,on:function(e,t){var n=this._,u=Zn(e+"",n),r,i=-1,s=u.length;if(arguments.length<2){for(;++i<s;)if((r=(e=u[i]).type)&&(r=Qn(n[r],e.name)))return r;return}if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++i<s;)if(r=(e=u[i]).type)n[r]=Pt(n[r],e.name,t);else if(t==null)for(r in n)n[r]=Pt(n[r],e.name,null);return this},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new Re(e)},call:function(e,t){if((r=arguments.length-2)>0)for(var n=new Array(r),u=0,r,i;u<r;++u)n[u]=arguments[u+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(i=this._[e],u=0,r=i.length;u<r;++u)i[u].value.apply(t,n)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var u=this._[e],r=0,i=u.length;r<i;++r)u[r].value.apply(t,n)}};function Qn(e,t){for(var n=0,u=e.length,r;n<u;++n)if((r=e[n]).name===t)return r.value}function Pt(e,t,n){for(var u=0,r=e.length;u<r;++u)if(e[u].name===t){e[u]=Kn,e=e.slice(0,u).concat(e.slice(u+1));break}return n!=null&&e.push({name:t,value:n}),e}var rt="http://www.w3.org/1999/xhtml";const Jt={svg:"http://www.w3.org/2000/svg",xhtml:rt,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function je(e){var t=e+="",n=t.indexOf(":");return n>=0&&(t=e.slice(0,n))!=="xmlns"&&(e=e.slice(n+1)),Jt.hasOwnProperty(t)?{space:Jt[t],local:e}:e}function eu(e){return function(){var t=this.ownerDocument,n=this.namespaceURI;return n===rt&&t.documentElement.namespaceURI===rt?t.createElement(e):t.createElementNS(n,e)}}function tu(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function ln(e){var t=je(e);return(t.local?tu:eu)(t)}function nu(){}function vt(e){return e==null?nu:function(){return this.querySelector(e)}}function uu(e){typeof e!="function"&&(e=vt(e));for(var t=this._groups,n=t.length,u=new Array(n),r=0;r<n;++r)for(var i=t[r],s=i.length,o=u[r]=new Array(s),c,a,l=0;l<s;++l)(c=i[l])&&(a=e.call(c,c.__data__,l,i))&&("__data__"in c&&(a.__data__=c.__data__),o[l]=a);return new P(u,this._parents)}function pt(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function ru(){return[]}function fn(e){return e==null?ru:function(){return this.querySelectorAll(e)}}function iu(e){return function(){var t=e.apply(this,arguments);return t==null?[]:pt(t)}}function su(e){typeof e=="function"?e=iu(e):e=fn(e);for(var t=this._groups,n=t.length,u=[],r=[],i=0;i<n;++i)for(var s=t[i],o=s.length,c,a=0;a<o;++a)(c=s[a])&&(u.push(e.call(c,c.__data__,a,s)),r.push(c));return new P(u,r)}function hn(e){return function(){return this.matches(e)}}function Dn(e){return function(t){return t.matches(e)}}var ou=Array.prototype.find;function au(e){return function(){return ou.call(this.children,e)}}function cu(){return this.firstElementChild}function lu(e){return this.select(e==null?cu:au(typeof e=="function"?e:Dn(e)))}var fu=Array.prototype.filter;function hu(){return this.children}function Du(e){return function(){return fu.call(this.children,e)}}function du(e){return this.selectAll(e==null?hu:Du(typeof e=="function"?e:Dn(e)))}function Eu(e){typeof e!="function"&&(e=hn(e));for(var t=this._groups,n=t.length,u=new Array(n),r=0;r<n;++r)for(var i=t[r],s=i.length,o=u[r]=[],c,a=0;a<s;++a)(c=i[a])&&e.call(c,c.__data__,a,i)&&o.push(c);return new P(u,this._parents)}function dn(e){return new Array(e.length)}function Au(){return new P(this._enter||this._groups.map(dn),this._parents)}function Me(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}Me.prototype={constructor:Me,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};function Cu(e){return function(){return e}}function vu(e,t,n,u,r,i){for(var s=0,o,c=t.length,a=i.length;s<a;++s)(o=t[s])?(o.__data__=i[s],u[s]=o):n[s]=new Me(e,i[s]);for(;s<c;++s)(o=t[s])&&(r[s]=o)}function pu(e,t,n,u,r,i,s){var o,c,a=new Map,l=t.length,D=i.length,d=new Array(l),C;for(o=0;o<l;++o)(c=t[o])&&(d[o]=C=s.call(c,c.__data__,o,t)+"",a.has(C)?r[o]=c:a.set(C,c));for(o=0;o<D;++o)C=s.call(e,i[o],o,i)+"",(c=a.get(C))?(u[o]=c,c.__data__=i[o],a.delete(C)):n[o]=new Me(e,i[o]);for(o=0;o<l;++o)(c=t[o])&&a.get(d[o])===c&&(r[o]=c)}function _u(e){return e.__data__}function Fu(e,t){if(!arguments.length)return Array.from(this,_u);var n=t?pu:vu,u=this._parents,r=this._groups;typeof e!="function"&&(e=Cu(e));for(var i=r.length,s=new Array(i),o=new Array(i),c=new Array(i),a=0;a<i;++a){var l=u[a],D=r[a],d=D.length,C=pt(e.call(l,l&&l.__data__,a,u)),$=C.length,_=o[a]=new Array($),B=s[a]=new Array($),E=c[a]=new Array(d);n(l,D,_,B,E,C,t);for(var p=0,v=0,k,L;p<$;++p)if(k=_[p]){for(p>=v&&(v=p+1);!(L=B[v])&&++v<$;);k._next=L||null}}return s=new P(s,u),s._enter=o,s._exit=c,s}function gu(){return new P(this._exit||this._groups.map(dn),this._parents)}function mu(e,t,n){var u=this.enter(),r=this,i=this.exit();return u=typeof e=="function"?e(u):u.append(e+""),t!=null&&(r=t(r)),n==null?i.remove():n(i),u&&r?u.merge(r).order():r}function yu(e){if(!(e instanceof P))throw new Error("invalid merge");for(var t=this._groups,n=e._groups,u=t.length,r=n.length,i=Math.min(u,r),s=new Array(u),o=0;o<i;++o)for(var c=t[o],a=n[o],l=c.length,D=s[o]=new Array(l),d,C=0;C<l;++C)(d=c[C]||a[C])&&(D[C]=d);for(;o<u;++o)s[o]=t[o];return new P(s,this._parents)}function wu(){for(var e=this._groups,t=-1,n=e.length;++t<n;)for(var u=e[t],r=u.length-1,i=u[r],s;--r>=0;)(s=u[r])&&(i&&s.compareDocumentPosition(i)^4&&i.parentNode.insertBefore(s,i),i=s);return this}function Bu(e){e||(e=xu);function t(D,d){return D&&d?e(D.__data__,d.__data__):!D-!d}for(var n=this._groups,u=n.length,r=new Array(u),i=0;i<u;++i){for(var s=n[i],o=s.length,c=r[i]=new Array(o),a,l=0;l<o;++l)(a=s[l])&&(c[l]=a);c.sort(t)}return new P(r,this._parents).order()}function xu(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function bu(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this}function $u(){return Array.from(this)}function Su(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var u=e[t],r=0,i=u.length;r<i;++r){var s=u[r];if(s)return s}return null}function ku(){let e=0;for(const t of this)++e;return e}function Iu(){return!this.node()}function Nu(e){for(var t=this._groups,n=0,u=t.length;n<u;++n)for(var r=t[n],i=0,s=r.length,o;i<s;++i)(o=r[i])&&e.call(o,o.__data__,i,r);return this}function Ru(e){return function(){this.removeAttribute(e)}}function Tu(e){return function(){this.removeAttributeNS(e.space,e.local)}}function Lu(e,t){return function(){this.setAttribute(e,t)}}function Ou(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function Mu(e,t){return function(){var n=t.apply(this,arguments);n==null?this.removeAttribute(e):this.setAttribute(e,n)}}function Pu(e,t){return function(){var n=t.apply(this,arguments);n==null?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}}function Ju(e,t){var n=je(e);if(arguments.length<2){var u=this.node();return n.local?u.getAttributeNS(n.space,n.local):u.getAttribute(n)}return this.each((t==null?n.local?Tu:Ru:typeof t=="function"?n.local?Pu:Mu:n.local?Ou:Lu)(n,t))}function En(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function Gu(e){return function(){this.style.removeProperty(e)}}function qu(e,t,n){return function(){this.style.setProperty(e,t,n)}}function Hu(e,t,n){return function(){var u=t.apply(this,arguments);u==null?this.style.removeProperty(e):this.style.setProperty(e,u,n)}}function Vu(e,t,n){return arguments.length>1?this.each((t==null?Gu:typeof t=="function"?Hu:qu)(e,t,n??"")):de(this.node(),e)}function de(e,t){return e.style.getPropertyValue(t)||En(e).getComputedStyle(e,null).getPropertyValue(t)}function ju(e){return function(){delete this[e]}}function Wu(e,t){return function(){this[e]=t}}function Uu(e,t){return function(){var n=t.apply(this,arguments);n==null?delete this[e]:this[e]=n}}function zu(e,t){return arguments.length>1?this.each((t==null?ju:typeof t=="function"?Uu:Wu)(e,t)):this.node()[e]}function An(e){return e.trim().split(/^|\s+/)}function _t(e){return e.classList||new Cn(e)}function Cn(e){this._node=e,this._names=An(e.getAttribute("class")||"")}Cn.prototype={add:function(e){var t=this._names.indexOf(e);t<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};function vn(e,t){for(var n=_t(e),u=-1,r=t.length;++u<r;)n.add(t[u])}function pn(e,t){for(var n=_t(e),u=-1,r=t.length;++u<r;)n.remove(t[u])}function Xu(e){return function(){vn(this,e)}}function Yu(e){return function(){pn(this,e)}}function Ku(e,t){return function(){(t.apply(this,arguments)?vn:pn)(this,e)}}function Zu(e,t){var n=An(e+"");if(arguments.length<2){for(var u=_t(this.node()),r=-1,i=n.length;++r<i;)if(!u.contains(n[r]))return!1;return!0}return this.each((typeof t=="function"?Ku:t?Xu:Yu)(n,t))}function Qu(){this.textContent=""}function er(e){return function(){this.textContent=e}}function tr(e){return function(){var t=e.apply(this,arguments);this.textContent=t??""}}function nr(e){return arguments.length?this.each(e==null?Qu:(typeof e=="function"?tr:er)(e)):this.node().textContent}function ur(){this.innerHTML=""}function rr(e){return function(){this.innerHTML=e}}function ir(e){return function(){var t=e.apply(this,arguments);this.innerHTML=t??""}}function sr(e){return arguments.length?this.each(e==null?ur:(typeof e=="function"?ir:rr)(e)):this.node().innerHTML}function or(){this.nextSibling&&this.parentNode.appendChild(this)}function ar(){return this.each(or)}function cr(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function lr(){return this.each(cr)}function fr(e){var t=typeof e=="function"?e:ln(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})}function hr(){return null}function Dr(e,t){var n=typeof e=="function"?e:ln(e),u=t==null?hr:typeof t=="function"?t:vt(t);return this.select(function(){return this.insertBefore(n.apply(this,arguments),u.apply(this,arguments)||null)})}function dr(){var e=this.parentNode;e&&e.removeChild(this)}function Er(){return this.each(dr)}function Ar(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function Cr(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function vr(e){return this.select(e?Cr:Ar)}function pr(e){return arguments.length?this.property("__data__",e):this.node().__data__}function _r(e){return function(t){e.call(this,t,this.__data__)}}function Fr(e){return e.trim().split(/^|\s+/).map(function(t){var n="",u=t.indexOf(".");return u>=0&&(n=t.slice(u+1),t=t.slice(0,u)),{type:t,name:n}})}function gr(e){return function(){var t=this.__on;if(t){for(var n=0,u=-1,r=t.length,i;n<r;++n)i=t[n],(!e.type||i.type===e.type)&&i.name===e.name?this.removeEventListener(i.type,i.listener,i.options):t[++u]=i;++u?t.length=u:delete this.__on}}}function mr(e,t,n){return function(){var u=this.__on,r,i=_r(t);if(u){for(var s=0,o=u.length;s<o;++s)if((r=u[s]).type===e.type&&r.name===e.name){this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=i,r.options=n),r.value=t;return}}this.addEventListener(e.type,i,n),r={type:e.type,name:e.name,value:t,listener:i,options:n},u?u.push(r):this.__on=[r]}}function yr(e,t,n){var u=Fr(e+""),r,i=u.length,s;if(arguments.length<2){var o=this.node().__on;if(o){for(var c=0,a=o.length,l;c<a;++c)for(r=0,l=o[c];r<i;++r)if((s=u[r]).type===l.type&&s.name===l.name)return l.value}return}for(o=t?mr:gr,r=0;r<i;++r)this.each(o(u[r],t,n));return this}function _n(e,t,n){var u=En(e),r=u.CustomEvent;typeof r=="function"?r=new r(t,n):(r=u.document.createEvent("Event"),n?(r.initEvent(t,n.bubbles,n.cancelable),r.detail=n.detail):r.initEvent(t,!1,!1)),e.dispatchEvent(r)}function wr(e,t){return function(){return _n(this,e,t)}}function Br(e,t){return function(){return _n(this,e,t.apply(this,arguments))}}function xr(e,t){return this.each((typeof t=="function"?Br:wr)(e,t))}function*br(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var u=e[t],r=0,i=u.length,s;r<i;++r)(s=u[r])&&(yield s)}var Ft=[null];function P(e,t){this._groups=e,this._parents=t}function xe(){return new P([[document.documentElement]],Ft)}function $r(){return this}P.prototype=xe.prototype={constructor:P,select:uu,selectAll:su,selectChild:lu,selectChildren:du,filter:Eu,data:Fu,enter:Au,exit:gu,join:mu,merge:yu,selection:$r,order:wu,sort:Bu,call:bu,nodes:$u,node:Su,size:ku,empty:Iu,each:Nu,attr:Ju,style:Vu,property:zu,classed:Zu,text:nr,html:sr,raise:ar,lower:lr,append:fr,insert:Dr,remove:Er,clone:vr,datum:pr,on:yr,dispatch:xr,[Symbol.iterator]:br};function U(e){return typeof e=="string"?new P([[document.querySelector(e)]],[document.documentElement]):new P([[e]],Ft)}function ne(e){return typeof e=="string"?new P([document.querySelectorAll(e)],[document.documentElement]):new P([e==null?[]:pt(e)],Ft)}function gt(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function Fn(e,t){var n=Object.create(e.prototype);for(var u in t)n[u]=t[u];return n}function be(){}var me=.7,Pe=1/me,De="\\s*([+-]?\\d+)\\s*",ye="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",X="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Sr=/^#([0-9a-f]{3,8})$/,kr=new RegExp("^rgb\\("+[De,De,De]+"\\)$"),Ir=new RegExp("^rgb\\("+[X,X,X]+"\\)$"),Nr=new RegExp("^rgba\\("+[De,De,De,ye]+"\\)$"),Rr=new RegExp("^rgba\\("+[X,X,X,ye]+"\\)$"),Tr=new RegExp("^hsl\\("+[ye,X,X]+"\\)$"),Lr=new RegExp("^hsla\\("+[ye,X,X,ye]+"\\)$"),Gt={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};gt(be,we,{copy:function(e){return Object.assign(new this.constructor,this,e)},displayable:function(){return this.rgb().displayable()},hex:qt,formatHex:qt,formatHsl:Or,formatRgb:Ht,toString:Ht});function qt(){return this.rgb().formatHex()}function Or(){return gn(this).formatHsl()}function Ht(){return this.rgb().formatRgb()}function we(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=Sr.exec(e))?(n=t[1].length,t=parseInt(t[1],16),n===6?Vt(t):n===3?new G(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):n===8?Se(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):n===4?Se(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=kr.exec(e))?new G(t[1],t[2],t[3],1):(t=Ir.exec(e))?new G(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=Nr.exec(e))?Se(t[1],t[2],t[3],t[4]):(t=Rr.exec(e))?Se(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=Tr.exec(e))?Ut(t[1],t[2]/100,t[3]/100,1):(t=Lr.exec(e))?Ut(t[1],t[2]/100,t[3]/100,t[4]):Gt.hasOwnProperty(e)?Vt(Gt[e]):e==="transparent"?new G(NaN,NaN,NaN,0):null}function Vt(e){return new G(e>>16&255,e>>8&255,e&255,1)}function Se(e,t,n,u){return u<=0&&(e=t=n=NaN),new G(e,t,n,u)}function Mr(e){return e instanceof be||(e=we(e)),e?(e=e.rgb(),new G(e.r,e.g,e.b,e.opacity)):new G}function it(e,t,n,u){return arguments.length===1?Mr(e):new G(e,t,n,u??1)}function G(e,t,n,u){this.r=+e,this.g=+t,this.b=+n,this.opacity=+u}gt(G,it,Fn(be,{brighter:function(e){return e=e==null?Pe:Math.pow(Pe,e),new G(this.r*e,this.g*e,this.b*e,this.opacity)},darker:function(e){return e=e==null?me:Math.pow(me,e),new G(this.r*e,this.g*e,this.b*e,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:jt,formatHex:jt,formatRgb:Wt,toString:Wt}));function jt(){return"#"+Ze(this.r)+Ze(this.g)+Ze(this.b)}function Wt(){var e=this.opacity;return e=isNaN(e)?1:Math.max(0,Math.min(1,e)),(e===1?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(e===1?")":", "+e+")")}function Ze(e){return e=Math.max(0,Math.min(255,Math.round(e)||0)),(e<16?"0":"")+e.toString(16)}function Ut(e,t,n,u){return u<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new z(e,t,n,u)}function gn(e){if(e instanceof z)return new z(e.h,e.s,e.l,e.opacity);if(e instanceof be||(e=we(e)),!e)return new z;if(e instanceof z)return e;e=e.rgb();var t=e.r/255,n=e.g/255,u=e.b/255,r=Math.min(t,n,u),i=Math.max(t,n,u),s=NaN,o=i-r,c=(i+r)/2;return o?(t===i?s=(n-u)/o+(n<u)*6:n===i?s=(u-t)/o+2:s=(t-n)/o+4,o/=c<.5?i+r:2-i-r,s*=60):o=c>0&&c<1?0:s,new z(s,o,c,e.opacity)}function Pr(e,t,n,u){return arguments.length===1?gn(e):new z(e,t,n,u??1)}function z(e,t,n,u){this.h=+e,this.s=+t,this.l=+n,this.opacity=+u}gt(z,Pr,Fn(be,{brighter:function(e){return e=e==null?Pe:Math.pow(Pe,e),new z(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=e==null?me:Math.pow(me,e),new z(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,u=n+(n<.5?n:1-n)*t,r=2*n-u;return new G(Qe(e>=240?e-240:e+120,r,u),Qe(e,r,u),Qe(e<120?e+240:e-120,r,u),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var e=this.opacity;return e=isNaN(e)?1:Math.max(0,Math.min(1,e)),(e===1?"hsl(":"hsla(")+(this.h||0)+", "+(this.s||0)*100+"%, "+(this.l||0)*100+"%"+(e===1?")":", "+e+")")}}));function Qe(e,t,n){return(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)*255}const mn=e=>()=>e;function Jr(e,t){return function(n){return e+n*t}}function Gr(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(u){return Math.pow(e+u*t,n)}}function qr(e){return(e=+e)==1?yn:function(t,n){return n-t?Gr(t,n,e):mn(isNaN(t)?n:t)}}function yn(e,t){var n=t-e;return n?Jr(e,n):mn(isNaN(e)?t:e)}const zt=function e(t){var n=qr(t);function u(r,i){var s=n((r=it(r)).r,(i=it(i)).r),o=n(r.g,i.g),c=n(r.b,i.b),a=yn(r.opacity,i.opacity);return function(l){return r.r=s(l),r.g=o(l),r.b=c(l),r.opacity=a(l),r+""}}return u.gamma=e,u}(1);function ue(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}var st=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,et=new RegExp(st.source,"g");function Hr(e){return function(){return e}}function Vr(e){return function(t){return e(t)+""}}function jr(e,t){var n=st.lastIndex=et.lastIndex=0,u,r,i,s=-1,o=[],c=[];for(e=e+"",t=t+"";(u=st.exec(e))&&(r=et.exec(t));)(i=r.index)>n&&(i=t.slice(n,i),o[s]?o[s]+=i:o[++s]=i),(u=u[0])===(r=r[0])?o[s]?o[s]+=r:o[++s]=r:(o[++s]=null,c.push({i:s,x:ue(u,r)})),n=et.lastIndex;return n<t.length&&(i=t.slice(n),o[s]?o[s]+=i:o[++s]=i),o.length<2?c[0]?Vr(c[0].x):Hr(t):(t=c.length,function(a){for(var l=0,D;l<t;++l)o[(D=c[l]).i]=D.x(a);return o.join("")})}var Xt=180/Math.PI,ot={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function wn(e,t,n,u,r,i){var s,o,c;return(s=Math.sqrt(e*e+t*t))&&(e/=s,t/=s),(c=e*n+t*u)&&(n-=e*c,u-=t*c),(o=Math.sqrt(n*n+u*u))&&(n/=o,u/=o,c/=o),e*u<t*n&&(e=-e,t=-t,c=-c,s=-s),{translateX:r,translateY:i,rotate:Math.atan2(t,e)*Xt,skewX:Math.atan(c)*Xt,scaleX:s,scaleY:o}}var ke;function Wr(e){const t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?ot:wn(t.a,t.b,t.c,t.d,t.e,t.f)}function Ur(e){return e==null||(ke||(ke=document.createElementNS("http://www.w3.org/2000/svg","g")),ke.setAttribute("transform",e),!(e=ke.transform.baseVal.consolidate()))?ot:(e=e.matrix,wn(e.a,e.b,e.c,e.d,e.e,e.f))}function Bn(e,t,n,u){function r(a){return a.length?a.pop()+" ":""}function i(a,l,D,d,C,$){if(a!==D||l!==d){var _=C.push("translate(",null,t,null,n);$.push({i:_-4,x:ue(a,D)},{i:_-2,x:ue(l,d)})}else(D||d)&&C.push("translate("+D+t+d+n)}function s(a,l,D,d){a!==l?(a-l>180?l+=360:l-a>180&&(a+=360),d.push({i:D.push(r(D)+"rotate(",null,u)-2,x:ue(a,l)})):l&&D.push(r(D)+"rotate("+l+u)}function o(a,l,D,d){a!==l?d.push({i:D.push(r(D)+"skewX(",null,u)-2,x:ue(a,l)}):l&&D.push(r(D)+"skewX("+l+u)}function c(a,l,D,d,C,$){if(a!==D||l!==d){var _=C.push(r(C)+"scale(",null,",",null,")");$.push({i:_-4,x:ue(a,D)},{i:_-2,x:ue(l,d)})}else(D!==1||d!==1)&&C.push(r(C)+"scale("+D+","+d+")")}return function(a,l){var D=[],d=[];return a=e(a),l=e(l),i(a.translateX,a.translateY,l.translateX,l.translateY,D,d),s(a.rotate,l.rotate,D,d),o(a.skewX,l.skewX,D,d),c(a.scaleX,a.scaleY,l.scaleX,l.scaleY,D,d),a=l=null,function(C){for(var $=-1,_=d.length,B;++$<_;)D[(B=d[$]).i]=B.x(C);return D.join("")}}}var zr=Bn(Wr,"px, ","px)","deg)"),Xr=Bn(Ur,", ",")",")"),Ee=0,ve=0,Ce=0,xn=1e3,Je,pe,Ge=0,he=0,We=0,Be=typeof performance=="object"&&performance.now?performance:Date,bn=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function mt(){return he||(bn(Yr),he=Be.now()+We)}function Yr(){he=0}function qe(){this._call=this._time=this._next=null}qe.prototype=$n.prototype={constructor:qe,restart:function(e,t,n){if(typeof e!="function")throw new TypeError("callback is not a function");n=(n==null?mt():+n)+(t==null?0:+t),!this._next&&pe!==this&&(pe?pe._next=this:Je=this,pe=this),this._call=e,this._time=n,at()},stop:function(){this._call&&(this._call=null,this._time=1/0,at())}};function $n(e,t,n){var u=new qe;return u.restart(e,t,n),u}function Kr(){mt(),++Ee;for(var e=Je,t;e;)(t=he-e._time)>=0&&e._call.call(null,t),e=e._next;--Ee}function Yt(){he=(Ge=Be.now())+We,Ee=ve=0;try{Kr()}finally{Ee=0,Qr(),he=0}}function Zr(){var e=Be.now(),t=e-Ge;t>xn&&(We-=t,Ge=e)}function Qr(){for(var e,t=Je,n,u=1/0;t;)t._call?(u>t._time&&(u=t._time),e=t,t=t._next):(n=t._next,t._next=null,t=e?e._next=n:Je=n);pe=e,at(u)}function at(e){if(!Ee){ve&&(ve=clearTimeout(ve));var t=e-he;t>24?(e<1/0&&(ve=setTimeout(Yt,e-Be.now()-We)),Ce&&(Ce=clearInterval(Ce))):(Ce||(Ge=Be.now(),Ce=setInterval(Zr,xn)),Ee=1,bn(Yt))}}function Kt(e,t,n){var u=new qe;return t=t==null?0:+t,u.restart(r=>{u.stop(),e(r+t)},t,n),u}var ei=cn("start","end","cancel","interrupt"),ti=[],Sn=0,Zt=1,ct=2,Te=3,Qt=4,lt=5,Le=6;function Ue(e,t,n,u,r,i){var s=e.__transition;if(!s)e.__transition={};else if(n in s)return;ni(e,n,{name:t,index:u,group:r,on:ei,tween:ti,time:i.time,delay:i.delay,duration:i.duration,ease:i.ease,timer:null,state:Sn})}function yt(e,t){var n=j(e,t);if(n.state>Sn)throw new Error("too late; already scheduled");return n}function Y(e,t){var n=j(e,t);if(n.state>Te)throw new Error("too late; already running");return n}function j(e,t){var n=e.__transition;if(!n||!(n=n[t]))throw new Error("transition not found");return n}function ni(e,t,n){var u=e.__transition,r;u[t]=n,n.timer=$n(i,0,n.time);function i(a){n.state=Zt,n.timer.restart(s,n.delay,n.time),n.delay<=a&&s(a-n.delay)}function s(a){var l,D,d,C;if(n.state!==Zt)return c();for(l in u)if(C=u[l],C.name===n.name){if(C.state===Te)return Kt(s);C.state===Qt?(C.state=Le,C.timer.stop(),C.on.call("interrupt",e,e.__data__,C.index,C.group),delete u[l]):+l<t&&(C.state=Le,C.timer.stop(),C.on.call("cancel",e,e.__data__,C.index,C.group),delete u[l])}if(Kt(function(){n.state===Te&&(n.state=Qt,n.timer.restart(o,n.delay,n.time),o(a))}),n.state=ct,n.on.call("start",e,e.__data__,n.index,n.group),n.state===ct){for(n.state=Te,r=new Array(d=n.tween.length),l=0,D=-1;l<d;++l)(C=n.tween[l].value.call(e,e.__data__,n.index,n.group))&&(r[++D]=C);r.length=D+1}}function o(a){for(var l=a<n.duration?n.ease.call(null,a/n.duration):(n.timer.restart(c),n.state=lt,1),D=-1,d=r.length;++D<d;)r[D].call(e,l);n.state===lt&&(n.on.call("end",e,e.__data__,n.index,n.group),c())}function c(){n.state=Le,n.timer.stop(),delete u[t];for(var a in u)return;delete e.__transition}}function ui(e,t){var n=e.__transition,u,r,i=!0,s;if(n){t=t==null?null:t+"";for(s in n){if((u=n[s]).name!==t){i=!1;continue}r=u.state>ct&&u.state<lt,u.state=Le,u.timer.stop(),u.on.call(r?"interrupt":"cancel",e,e.__data__,u.index,u.group),delete n[s]}i&&delete e.__transition}}function ri(e){return this.each(function(){ui(this,e)})}function ii(e,t){var n,u;return function(){var r=Y(this,e),i=r.tween;if(i!==n){u=n=i;for(var s=0,o=u.length;s<o;++s)if(u[s].name===t){u=u.slice(),u.splice(s,1);break}}r.tween=u}}function si(e,t,n){var u,r;if(typeof n!="function")throw new Error;return function(){var i=Y(this,e),s=i.tween;if(s!==u){r=(u=s).slice();for(var o={name:t,value:n},c=0,a=r.length;c<a;++c)if(r[c].name===t){r[c]=o;break}c===a&&r.push(o)}i.tween=r}}function oi(e,t){var n=this._id;if(e+="",arguments.length<2){for(var u=j(this.node(),n).tween,r=0,i=u.length,s;r<i;++r)if((s=u[r]).name===e)return s.value;return null}return this.each((t==null?ii:si)(n,e,t))}function wt(e,t,n){var u=e._id;return e.each(function(){var r=Y(this,u);(r.value||(r.value={}))[t]=n.apply(this,arguments)}),function(r){return j(r,u).value[t]}}function kn(e,t){var n;return(typeof t=="number"?ue:t instanceof we?zt:(n=we(t))?(t=n,zt):jr)(e,t)}function ai(e){return function(){this.removeAttribute(e)}}function ci(e){return function(){this.removeAttributeNS(e.space,e.local)}}function li(e,t,n){var u,r=n+"",i;return function(){var s=this.getAttribute(e);return s===r?null:s===u?i:i=t(u=s,n)}}function fi(e,t,n){var u,r=n+"",i;return function(){var s=this.getAttributeNS(e.space,e.local);return s===r?null:s===u?i:i=t(u=s,n)}}function hi(e,t,n){var u,r,i;return function(){var s,o=n(this),c;return o==null?void this.removeAttribute(e):(s=this.getAttribute(e),c=o+"",s===c?null:s===u&&c===r?i:(r=c,i=t(u=s,o)))}}function Di(e,t,n){var u,r,i;return function(){var s,o=n(this),c;return o==null?void this.removeAttributeNS(e.space,e.local):(s=this.getAttributeNS(e.space,e.local),c=o+"",s===c?null:s===u&&c===r?i:(r=c,i=t(u=s,o)))}}function di(e,t){var n=je(e),u=n==="transform"?Xr:kn;return this.attrTween(e,typeof t=="function"?(n.local?Di:hi)(n,u,wt(this,"attr."+e,t)):t==null?(n.local?ci:ai)(n):(n.local?fi:li)(n,u,t))}function Ei(e,t){return function(n){this.setAttribute(e,t.call(this,n))}}function Ai(e,t){return function(n){this.setAttributeNS(e.space,e.local,t.call(this,n))}}function Ci(e,t){var n,u;function r(){var i=t.apply(this,arguments);return i!==u&&(n=(u=i)&&Ai(e,i)),n}return r._value=t,r}function vi(e,t){var n,u;function r(){var i=t.apply(this,arguments);return i!==u&&(n=(u=i)&&Ei(e,i)),n}return r._value=t,r}function pi(e,t){var n="attr."+e;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(t==null)return this.tween(n,null);if(typeof t!="function")throw new Error;var u=je(e);return this.tween(n,(u.local?Ci:vi)(u,t))}function _i(e,t){return function(){yt(this,e).delay=+t.apply(this,arguments)}}function Fi(e,t){return t=+t,function(){yt(this,e).delay=t}}function gi(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?_i:Fi)(t,e)):j(this.node(),t).delay}function mi(e,t){return function(){Y(this,e).duration=+t.apply(this,arguments)}}function yi(e,t){return t=+t,function(){Y(this,e).duration=t}}function wi(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?mi:yi)(t,e)):j(this.node(),t).duration}function Bi(e,t){if(typeof t!="function")throw new Error;return function(){Y(this,e).ease=t}}function xi(e){var t=this._id;return arguments.length?this.each(Bi(t,e)):j(this.node(),t).ease}function bi(e,t){return function(){var n=t.apply(this,arguments);if(typeof n!="function")throw new Error;Y(this,e).ease=n}}function $i(e){if(typeof e!="function")throw new Error;return this.each(bi(this._id,e))}function Si(e){typeof e!="function"&&(e=hn(e));for(var t=this._groups,n=t.length,u=new Array(n),r=0;r<n;++r)for(var i=t[r],s=i.length,o=u[r]=[],c,a=0;a<s;++a)(c=i[a])&&e.call(c,c.__data__,a,i)&&o.push(c);return new te(u,this._parents,this._name,this._id)}function ki(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,n=e._groups,u=t.length,r=n.length,i=Math.min(u,r),s=new Array(u),o=0;o<i;++o)for(var c=t[o],a=n[o],l=c.length,D=s[o]=new Array(l),d,C=0;C<l;++C)(d=c[C]||a[C])&&(D[C]=d);for(;o<u;++o)s[o]=t[o];return new te(s,this._parents,this._name,this._id)}function Ii(e){return(e+"").trim().split(/^|\s+/).every(function(t){var n=t.indexOf(".");return n>=0&&(t=t.slice(0,n)),!t||t==="start"})}function Ni(e,t,n){var u,r,i=Ii(t)?yt:Y;return function(){var s=i(this,e),o=s.on;o!==u&&(r=(u=o).copy()).on(t,n),s.on=r}}function Ri(e,t){var n=this._id;return arguments.length<2?j(this.node(),n).on.on(e):this.each(Ni(n,e,t))}function Ti(e){return function(){var t=this.parentNode;for(var n in this.__transition)if(+n!==e)return;t&&t.removeChild(this)}}function Li(){return this.on("end.remove",Ti(this._id))}function Oi(e){var t=this._name,n=this._id;typeof e!="function"&&(e=vt(e));for(var u=this._groups,r=u.length,i=new Array(r),s=0;s<r;++s)for(var o=u[s],c=o.length,a=i[s]=new Array(c),l,D,d=0;d<c;++d)(l=o[d])&&(D=e.call(l,l.__data__,d,o))&&("__data__"in l&&(D.__data__=l.__data__),a[d]=D,Ue(a[d],t,n,d,a,j(l,n)));return new te(i,this._parents,t,n)}function Mi(e){var t=this._name,n=this._id;typeof e!="function"&&(e=fn(e));for(var u=this._groups,r=u.length,i=[],s=[],o=0;o<r;++o)for(var c=u[o],a=c.length,l,D=0;D<a;++D)if(l=c[D]){for(var d=e.call(l,l.__data__,D,c),C,$=j(l,n),_=0,B=d.length;_<B;++_)(C=d[_])&&Ue(C,t,n,_,d,$);i.push(d),s.push(l)}return new te(i,s,t,n)}var Pi=xe.prototype.constructor;function Ji(){return new Pi(this._groups,this._parents)}function Gi(e,t){var n,u,r;return function(){var i=de(this,e),s=(this.style.removeProperty(e),de(this,e));return i===s?null:i===n&&s===u?r:r=t(n=i,u=s)}}function In(e){return function(){this.style.removeProperty(e)}}function qi(e,t,n){var u,r=n+"",i;return function(){var s=de(this,e);return s===r?null:s===u?i:i=t(u=s,n)}}function Hi(e,t,n){var u,r,i;return function(){var s=de(this,e),o=n(this),c=o+"";return o==null&&(c=o=(this.style.removeProperty(e),de(this,e))),s===c?null:s===u&&c===r?i:(r=c,i=t(u=s,o))}}function Vi(e,t){var n,u,r,i="style."+t,s="end."+i,o;return function(){var c=Y(this,e),a=c.on,l=c.value[i]==null?o||(o=In(t)):void 0;(a!==n||r!==l)&&(u=(n=a).copy()).on(s,r=l),c.on=u}}function ji(e,t,n){var u=(e+="")=="transform"?zr:kn;return t==null?this.styleTween(e,Gi(e,u)).on("end.style."+e,In(e)):typeof t=="function"?this.styleTween(e,Hi(e,u,wt(this,"style."+e,t))).each(Vi(this._id,e)):this.styleTween(e,qi(e,u,t),n).on("end.style."+e,null)}function Wi(e,t,n){return function(u){this.style.setProperty(e,t.call(this,u),n)}}function Ui(e,t,n){var u,r;function i(){var s=t.apply(this,arguments);return s!==r&&(u=(r=s)&&Wi(e,s,n)),u}return i._value=t,i}function zi(e,t,n){var u="style."+(e+="");if(arguments.length<2)return(u=this.tween(u))&&u._value;if(t==null)return this.tween(u,null);if(typeof t!="function")throw new Error;return this.tween(u,Ui(e,t,n??""))}function Xi(e){return function(){this.textContent=e}}function Yi(e){return function(){var t=e(this);this.textContent=t??""}}function Ki(e){return this.tween("text",typeof e=="function"?Yi(wt(this,"text",e)):Xi(e==null?"":e+""))}function Zi(e){return function(t){this.textContent=e.call(this,t)}}function Qi(e){var t,n;function u(){var r=e.apply(this,arguments);return r!==n&&(t=(n=r)&&Zi(r)),t}return u._value=e,u}function es(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(e==null)return this.tween(t,null);if(typeof e!="function")throw new Error;return this.tween(t,Qi(e))}function ts(){for(var e=this._name,t=this._id,n=Nn(),u=this._groups,r=u.length,i=0;i<r;++i)for(var s=u[i],o=s.length,c,a=0;a<o;++a)if(c=s[a]){var l=j(c,t);Ue(c,e,n,a,s,{time:l.time+l.delay+l.duration,delay:0,duration:l.duration,ease:l.ease})}return new te(u,this._parents,e,n)}function ns(){var e,t,n=this,u=n._id,r=n.size();return new Promise(function(i,s){var o={value:s},c={value:function(){--r===0&&i()}};n.each(function(){var a=Y(this,u),l=a.on;l!==e&&(t=(e=l).copy(),t._.cancel.push(o),t._.interrupt.push(o),t._.end.push(c)),a.on=t}),r===0&&i()})}var us=0;function te(e,t,n,u){this._groups=e,this._parents=t,this._name=n,this._id=u}function Nn(){return++us}var ae=xe.prototype;te.prototype={constructor:te,select:Oi,selectAll:Mi,filter:Si,merge:ki,selection:Ji,transition:ts,call:ae.call,nodes:ae.nodes,node:ae.node,size:ae.size,empty:ae.empty,each:ae.each,on:Ri,attr:di,attrTween:pi,style:ji,styleTween:zi,text:Ki,textTween:es,remove:Li,tween:oi,delay:gi,duration:wi,ease:xi,easeVarying:$i,end:ns,[Symbol.iterator]:ae[Symbol.iterator]};function rs(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}var is={time:null,delay:0,duration:250,ease:rs};function ss(e,t){for(var n;!(n=e.__transition)||!(n=n[t]);)if(!(e=e.parentNode))throw new Error(`transition ${t} not found`);return n}function os(e){var t,n;e instanceof te?(t=e._id,e=e._name):(t=Nn(),(n=is).time=mt(),e=e==null?null:e+"");for(var u=this._groups,r=u.length,i=0;i<r;++i)for(var s=u[i],o=s.length,c,a=0;a<o;++a)(c=s[a])&&Ue(c,e,t,a,s,n||ss(c,t));return new te(u,this._parents,e,t)}xe.prototype.interrupt=ri;xe.prototype.transition=os;const ft=Math.PI,ht=2*ft,fe=1e-6,as=ht-fe;function Dt(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function Oe(){return new Dt}Dt.prototype=Oe.prototype={constructor:Dt,moveTo:function(e,t){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+t)},closePath:function(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(e,t){this._+="L"+(this._x1=+e)+","+(this._y1=+t)},quadraticCurveTo:function(e,t,n,u){this._+="Q"+ +e+","+ +t+","+(this._x1=+n)+","+(this._y1=+u)},bezierCurveTo:function(e,t,n,u,r,i){this._+="C"+ +e+","+ +t+","+ +n+","+ +u+","+(this._x1=+r)+","+(this._y1=+i)},arcTo:function(e,t,n,u,r){e=+e,t=+t,n=+n,u=+u,r=+r;var i=this._x1,s=this._y1,o=n-e,c=u-t,a=i-e,l=s-t,D=a*a+l*l;if(r<0)throw new Error("negative radius: "+r);if(this._x1===null)this._+="M"+(this._x1=e)+","+(this._y1=t);else if(D>fe)if(!(Math.abs(l*o-c*a)>fe)||!r)this._+="L"+(this._x1=e)+","+(this._y1=t);else{var d=n-i,C=u-s,$=o*o+c*c,_=d*d+C*C,B=Math.sqrt($),E=Math.sqrt(D),p=r*Math.tan((ft-Math.acos(($+D-_)/(2*B*E)))/2),v=p/E,k=p/B;Math.abs(v-1)>fe&&(this._+="L"+(e+v*a)+","+(t+v*l)),this._+="A"+r+","+r+",0,0,"+ +(l*d>a*C)+","+(this._x1=e+k*o)+","+(this._y1=t+k*c)}},arc:function(e,t,n,u,r,i){e=+e,t=+t,n=+n,i=!!i;var s=n*Math.cos(u),o=n*Math.sin(u),c=e+s,a=t+o,l=1^i,D=i?u-r:r-u;if(n<0)throw new Error("negative radius: "+n);this._x1===null?this._+="M"+c+","+a:(Math.abs(this._x1-c)>fe||Math.abs(this._y1-a)>fe)&&(this._+="L"+c+","+a),n&&(D<0&&(D=D%ht+ht),D>as?this._+="A"+n+","+n+",0,1,"+l+","+(e-s)+","+(t-o)+"A"+n+","+n+",0,1,"+l+","+(this._x1=c)+","+(this._y1=a):D>fe&&(this._+="A"+n+","+n+",0,"+ +(D>=ft)+","+l+","+(this._x1=e+n*Math.cos(r))+","+(this._y1=t+n*Math.sin(r))))},rect:function(e,t,n,u){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+t)+"h"+ +n+"v"+ +u+"h"+-n+"Z"},toString:function(){return this._}};function _e(e,t,n){this.k=e,this.x=t,this.y=n}_e.prototype={constructor:_e,scale:function(e){return e===1?this:new _e(this.k*e,this.x,this.y)},translate:function(e,t){return e===0&t===0?this:new _e(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};_e.prototype;const cs=(e,t)=>{var i,s,o;const n=e.event_id;if((s=(i=t==null?void 0:t.annotations)==null?void 0:i.events)!=null&&s[n])return`${(o=t==null?void 0:t.annotations)==null?void 0:o.events[n]}`;const u=an(e),r=e._collapse?`+${e._collapse} more`:"";return`${u} ${r}`},ls=(e,t,n)=>{var It,Nt,Rt,Tt,Lt,Ot,Mt;t=JSON.parse(JSON.stringify(t));const u=t,r=new Map;for(let h=0;h<u.length;h++)u[h].streamPosition=h,r.set(u[h].event_id,u[h]);for(const h of u.slice()){h.prev_events=h.prev_events.sort((A,g)=>{var m,S;return(((m=r.get(A))==null?void 0:m.streamPosition)||0)-(((S=r.get(g))==null?void 0:S.streamPosition)||0)}),h.auth_events=(h.auth_events||[]).sort((A,g)=>{var m,S;return(((m=r.get(g))==null?void 0:m.streamPosition)||0)-(((S=r.get(A))==null?void 0:S.streamPosition)||0)});for(const A of h.prev_events){if(!r.get(A)){const m={event_id:A,type:"dangling",prev_events:[],next_events:[],content:{},sender:"dangling",auth_events:[],room_id:"",origin_server_ts:0};r.set(A,m);const S=u.findIndex(T=>T.event_id===h.event_id);console.log("inserting placeholder prev_event at ",S),u.splice(S,0,m)}const g=r.get(A);g.next_events||(g.next_events=[]),g.next_events.push(h.event_id)}}const i=[],s=[];function o(h=null){{const A=h==null?0:h+1;if(A>=i.length)return A;for(let g=A;g<i.length;g++)if(!i[g])return g;return i.length}}u[0].x=0;for(let h=0;h<u.length;h++){const A=u[h];A.y=h;let g=!1;for(const S of A.prev_events){const T=r.get(S);i.findIndex(x=>x===T.event_id)!==-1&&(A.x=T.x,g=!0);break}if(!g&&(A.x=o(),A.prev_events&&r.get(A.prev_events[0]))){const S=r.get(A.prev_events[0]).y;for(;s[A.x]!==void 0&&S<s[A.x];)A.x=o(A.x)}let m=!1;if(A.next_events){for(const S of A.next_events)if(r.get(S).prev_events[0]===A.event_id){m=!0;break}}m?i[A.x]=A.event_id:(delete i[A.x],s[A.x]=h)}const c=[];function a(h,A){let g=0;for(let m=h;m<=A;m++)g=u[m].x>g?u[m].x:g;for(g++;c[g]!==void 0;)g++;return g}for(let h=u.length-1;h>=0;h--){const A=u[h],g=n.showAuthChain?A.auth_events:n.showAuthDAG?A.prev_auth_events:void 0;if(g){if(n.showAuthDAG){const m=S=>{S.authed_list||(S.authed_list=[]),S.authed_list.push(A.event_id);for(const T of S.prev_auth_events)m(r.get(T))};m(A)}A.auth_list=[];for(const m of g){A.auth_list.push(m);const S=r.get(m);if(!S.authLane){const T=a(S.y,h);S.authLane=T,c[T]=m,S.authLaneStart=c.findIndex(x=>x!==void 0)-1}}A.authLane&&delete c[A.authLane]}}let l=0,D=0;const d=[];u[0].laneWidth=0;for(let h=1;h<u.length;h++){const A=u[h-1],g=u[h];for(A.authLane>l&&(l=A.authLane,D=A.authLaneStart);d.length>0&&h>((It=d.at(-1))==null?void 0:It.y);)d.pop();A.next_events&&d.push({x:r.get(A.next_events.at(-1)).x,y:r.get(A.next_events.at(-1)).y}),d.sort((m,S)=>m.x-S.x),g.laneWidth=(Nt=d.at(-1))==null?void 0:Nt.x,g.laneWidth%2&&(g.x-=.5,g.laneWidth-=.5)}const C={top:20,right:20,bottom:30,left:230};let $=(Lt=(Tt=(Rt=n.scenario)==null?void 0:Rt.annotations)==null?void 0:Tt.titles)==null?void 0:Lt[n.currentEventId];$||($=((Mt=(Ot=n.scenario)==null?void 0:Ot.annotations)==null?void 0:Mt.title)||"");const _=$.split(`
`),B=20,E=40,p=25,v=5,k=2,L=3,K=1,xt=3,bt="#f00",Pn="#0a0",$t="#00f",Jn="#faa",Gn="#aaf",Xe="#888";U(e).html(null);const qn=i.length*E+1e3,Ye=u.length*p,St=U(e).append("svg").attr("width",qn+C.left+C.right).attr("height",Ye+C.top+C.bottom+B*_.length).append("g").attr("transform",`translate(${[C.left,C.top]})`),se=St.selectAll("g").data(u).enter().append("g").attr("class",h=>`node-${h.event_id.slice(1,5)}`).on("mouseover",function(h,A){U(this).attr("fill",Pn).attr("font-weight","bold"),ne(`.child-${A.event_id.slice(1,5)}`).raise().attr("stroke",$t).attr("stroke-width",L),ne(`.parent-${A.event_id.slice(1,5)}`).raise().attr("stroke",bt).attr("stroke-width",L),ne(`.authchild-${A.event_id.slice(1,5)}`).raise().attr("stroke",Gn).attr("stroke-width",xt),ne(`.authparent-${A.event_id.slice(1,5)}`).raise().attr("stroke",Jn).attr("stroke-width",xt);for(const m of A.next_events||[])U(`.node-${m.slice(1,5)}`).attr("fill",$t);for(const m of A.prev_events)U(`.node-${m.slice(1,5)}`).attr("fill",bt)}).on("mouseout",function(h,A){U(this).attr("fill",null).attr("font-weight",null);for(const g of A.next_events||[])U(`.node-${g.slice(1,5)}`).attr("fill",null);for(const g of A.prev_events)U(`.node-${g.slice(1,5)}`).attr("fill",null);ne(`.child-${A.event_id.slice(1,5)}`).attr("stroke","black").attr("stroke-width",k),ne(`.parent-${A.event_id.slice(1,5)}`).attr("stroke","black").attr("stroke-width",k),ne(`.authchild-${A.event_id.slice(1,5)}`).attr("stroke",Xe).attr("stroke-width",K),ne(`.authparent-${A.event_id.slice(1,5)}`).attr("stroke",Xe).attr("stroke-width",K)});se.append("circle").attr("cx",h=>h.x*E).attr("cy",h=>h.y*p).attr("r",v).style("fill",h=>{var A;return(A=n.stateAtEvent)!=null&&A.has(h.event_id)?"#43ff00":h.state_key!=null?"#4300ff":"#111111"}).style("fill-opacity","0.5").style("stroke",h=>{var A;return(A=n.stateAtEvent)!=null&&A.has(h.event_id)?"#43ff00":h.state_key!=null?"#4300ff":"#111111"}),se.append("path").attr("d",h=>{const A=Oe();if(h.next_events)for(const g of h.next_events){const m=r.get(g);A.moveTo(h.x*E,h.y*p+v),A.arcTo(h.x*E,(h.y+.5)*p,m.x*E,(h.y+.5)*p,v),A.arcTo(m.x*E,(h.y+.5)*p,m.x*E,m.y*p-v,v),A.lineTo(m.x*E,m.y*p-v)}return A}).attr("stroke","white").attr("stroke-width",k+2).attr("fill","none"),se.each((h,A,g)=>{const m=U(g[A]);if(h.next_events)for(const S of h.next_events){const T=r.get(S);if(!T)continue;const x=Oe();let q=0;x.moveTo(h.x*E,h.y*p+v+0),x.arcTo(h.x*E,(h.y+.5)*p,T.x*E,(h.y+.5)*p,v),x.arcTo(T.x*E,(h.y+.5)*p,T.x*E,T.y*p-v,v),x.lineTo(T.x*E+q,T.y*p-v),x.moveTo(h.x*E-v/3,h.y*p+v+v/2),x.lineTo(h.x*E,h.y*p+v),x.lineTo(h.x*E+v/3,h.y*p+v+v/2),x.lineTo(h.x*E-v/3,h.y*p+v+v/2),x.lineTo(h.x*E,h.y*p+v),m.append("path").attr("d",x.toString()).attr("class",W=>`child-${W.event_id.slice(1,5)} parent-${T==null?void 0:T.event_id.slice(1,5)}`).attr("stroke","black").attr("stroke-width",k).attr("fill","none")}});const $e=E/2;(n.showAuthChain||n.showAuthDAG)&&se.each((h,A,g)=>{const m=U(g[A]),S=n.showAuthChain?h.auth_events:h.prev_auth_events;if(S)for(const T of S){const x=r.get(T);if(!x)continue;const q=Oe(),H=0,W=0,Ke=x.authLaneStart*E+(x.authLane-x.authLaneStart)*$e;q.moveTo(h.x*E+v+W,h.y*p+H),q.arcTo(Ke,h.y*p+H,Ke,x.y*p+H,v*2),q.arcTo(Ke,x.y*p+H,x.x*E+v+W,x.y*p+H,v*2),q.lineTo(x.x*E+v+W,x.y*p+H),q.moveTo(x.x*E+W+v+v/2,x.y*p+H+v/3),q.lineTo(x.x*E+W+v,x.y*p+H),q.lineTo(x.x*E+W+v+v/2,x.y*p+H-v/3),q.lineTo(x.x*E+W+v+v/2,x.y*p+H+v/3),q.lineTo(x.x*E+W+v,x.y*p+H);const Vn=Ae=>n.showAuthChain?`authchild-${x.event_id.slice(1,5)} authparent-${Ae==null?void 0:Ae.event_id.slice(1,5)}`:`${Ae.authed_list.map(oe=>`authparent-${oe==null?void 0:oe.slice(1,5)}`).join(" ")} ${Ae.auth_list.map(oe=>`authchild-${oe==null?void 0:oe.slice(1,5)}`).join(" ")}`;m.append("path").attr("d",q.toString()).attr("class",Vn).attr("stroke",Xe).attr("stroke-width",1).attr("fill","none")}});const kt=h=>n.showAuthChain||n.showAuthDAG?D*E+(l-D)*$e:h.laneWidth*E;se.append("text").text(h=>h.event_id.substr(0,5)).attr("x",h=>kt(h)+$e).attr("y",h=>h.y*p+4),se.append("text").text(h=>cs(h,n.scenario)).attr("class",h=>"node-text").attr("x",h=>kt(h)+$e+70).attr("y",h=>h.y*p+4),se.append("text").text(h=>h.origin_server_ts?new Date(h.origin_server_ts).toLocaleString():"").attr("x",-C.left).attr("y",h=>h.y*p+4);const Hn=St.append("text").attr("class","node-text").attr("x",-C.left).attr("y",Ye);for(let h=0;h<_.length;h++)Hn.append("tspan").attr("x",-C.left).attr("y",Ye+h*B).text(_[h])},Rn={calculate_event_ids:!0,on_load_at_start:!0,events:[{type:"m.room.create",state_key:"",sender:"@creator:tardis",auth_events:[],prev_events:[],content:{creator:"@creator:tardis"},event_id:"$CREATE"},{type:"m.room.member",state_key:"@creator:tardis",sender:"@creator:tardis",auth_events:["$CREATE"],prev_events:["$CREATE"],content:{membership:"join"},event_id:"$JOIN"},{type:"m.room.message",sender:"@creator:tardis",auth_events:["$CREATE","$JOIN"],prev_events:["$JOIN"],content:{body:"A wild fork appears!"},event_id:"$FORK1"},{type:"m.room.message",sender:"@creator:tardis",auth_events:["$CREATE","$JOIN"],prev_events:["$JOIN"],content:{body:"Another wild fork appears!"},event_id:"$FORK2"},{type:"m.room.message",sender:"@creator:tardis",auth_events:["$CREATE","$JOIN"],prev_events:["$FORK1","$FORK2"],content:{body:"Merged!"},event_id:"$MERGE"},{type:"m.room.message",sender:"@creator:tardis",auth_events:["$CREATE","$JOIN"],prev_events:["$MERGE"],content:{body:"This event has precalculated state"},event_id:"$PRESTATE"},{type:"m.room.name",state_key:"",sender:"@creator:tardis",auth_events:["$CREATE","$JOIN"],prev_events:["$PRESTATE"],content:{name:"State events are blue, messages are grey"},event_id:"$MSG"},{type:"m.room.message",sender:"@creator:tardis",auth_events:["$CREATE","$JOIN"],prev_events:["$MSG"],content:{body:"Boring long chains..."},event_id:"$MSG2"},{type:"m.room.message",sender:"@creator:tardis",auth_events:["$CREATE","$JOIN"],prev_events:["$MSG2"],content:{body:"...can be collapsed..."},event_id:"$MSG3"},{type:"m.room.message",sender:"@creator:tardis",auth_events:["$CREATE","$JOIN"],prev_events:["$MSG3"],content:{body:"...by checking the collapse checkbox."},event_id:"$MSG4"}],room_id:"!quickstart:tardis",room_version:"10",tardis_version:1,annotations:{title:["Welcome to TARDIS! Press the → button to continue."].join(`
`),titles:{$FORK1:"State events are highlighted in blue. Messages are highlighted in grey.",$FORK2:"The DAG can fork, which indicates some events were sent at the same time.",$MERGE:"The DAG can merge, which merges state from each fork together. This is state resolution.",$PRESTATE:"Green events indicate the state at this event. Message events will never be green.",$MSG:"Check the 'Auth Chain' box to show the `auth_events` for each event.",$MSG2:"Press the 'Resolve State' button to calculate which events are part of the current room state.",$MSG3:["As state resolution is iterative, it will resolve state for all earlier events as well.","Click on an earlier event in the list to jump to that event."].join(`
`),$MSG4:["Now load a file or use one of the pre-loaded files to experiment with state resolution in Matrix!"].join(`
`)},events:{$MSG:"Blue nodes like this one are state events.",$MSG2:"Boring long chains...",$MSG3:"...can be collapsed...",$MSG4:"...by checking the collapse checkbox.",$PRESTATE:"This event has pre-calculated state (in green) after this event"}},precalculated_state_after:{$PRESTATE:["$CREATE","$JOIN"]}},fs={calculate_event_ids:!0,on_load_at_start:!0,events:[{type:"m.room.create",state_key:"",sender:"@alice:tardis",auth_events:[],prev_events:[],content:{creator:"@alice:tardis"},event_id:"$CREATE"},{type:"m.room.member",state_key:"@alice:tardis",sender:"@alice:tardis",auth_events:["$CREATE"],prev_events:["$CREATE"],content:{membership:"join"},event_id:"$ALICE"},{type:"m.room.power_levels",state_key:"",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE"],prev_events:["$ALICE"],content:{users:{"@alice:tardis":100},events:{"m.room.name":50},users_default:50},event_id:"$PL"},{type:"m.room.join_rules",state_key:"",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE","$PL"],prev_events:["$PL"],content:{join_rule:"public"},event_id:"$JR"},{type:"m.room.member",state_key:"@bob:tardis",sender:"@bob:tardis",auth_events:["$CREATE","$JR","$PL"],prev_events:["$JR"],content:{membership:"join"},event_id:"$BOB"},{type:"m.room.name",state_key:"",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE","$PL"],prev_events:["$BOB"],content:{name:"Alice Room"},event_id:"$ALICE_NAME"},{type:"m.room.name",state_key:"",sender:"@bob:tardis",auth_events:["$CREATE","$BOB","$PL"],prev_events:["$BOB"],content:{name:"Bob Room"},event_id:"$BOB_NAME"},{type:"m.room.message",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE","$PL"],prev_events:["$ALICE_NAME","$BOB_NAME"],content:{body:"Bob wins."},event_id:"$MERGE1"},{type:"m.room.name",state_key:"",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE","$PL"],prev_events:["$MERGE1"],content:{name:"Alice Room 2"},origin_server_ts:1704067281337,event_id:"$ALICE_NAME2"},{type:"m.room.name",state_key:"",sender:"@bob:tardis",auth_events:["$CREATE","$BOB","$PL"],prev_events:["$MERGE1"],content:{name:"Bob Room 2"},origin_server_ts:1704067281337,event_id:"$BOB_NAME2"},{type:"m.room.message",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE","$PL"],prev_events:["$ALICE_NAME2","$BOB_NAME2"],content:{body:"Alice wins."},event_id:"$MERGE2"},{type:"m.room.name",state_key:"",sender:"@bob:tardis",auth_events:["$CREATE","$BOB","$PL"],prev_events:["$MERGE2"],content:{name:"Bob Room 3"},origin_server_ts:1704077300300,event_id:"$BOB_NAME3"},{type:"m.room.power_levels",state_key:"",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE"],prev_events:["$MERGE2"],content:{users:{"@alice:tardis":100},events:{"m.room.name":50},users_default:50},event_id:"$PL2"},{type:"m.room.name",state_key:"",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE","$PL2"],prev_events:["$PL2"],content:{name:"Alice Room 3"},origin_server_ts:1704077299300,event_id:"$ALICE_NAME3"},{type:"m.room.message",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE","$PL2"],prev_events:["$ALICE_NAME3","$BOB_NAME3"],content:{body:"Alice wins."},event_id:"$MERGE3"}],room_id:"!mainline-fork:tardis",room_version:"10",tardis_version:1,annotations:{title:"The winner follows this priority: Mainline depth THEN origin_server_ts THEN event ID",titles:{$ALICE:["Mainline Ordering:","The conflicting state events in this example are all room name changes and hence do not restrict anyone's permissions.","This makes it easier to explain. All of the merges in this example are due to 'mainline ordering'."].join(`
`),$MERGE1:["Bob wins because his event has a higher origin_server_ts. Both events have the same mainline depth."].join(`
`),$MERGE2:["Both events have the same timestamp. Alice wins with a higher event ID (A < Z < a < z)."].join(`
`),$MERGE3:["Bob's event has a higher timestamp but Alice wins because her event happened AFTER a change to the power levels.","This gives her event a higher 'mainline position' which is considered before the timestamp or event ID."].join(`
`)},events:{}}},hs={calculate_event_ids:!0,on_load_at_start:!0,events:[{type:"m.room.create",state_key:"",sender:"@alice:tardis",auth_events:[],prev_events:[],content:{creator:"@alice:tardis"},event_id:"$CREATE"},{type:"m.room.member",state_key:"@alice:tardis",sender:"@alice:tardis",auth_events:["$CREATE"],prev_events:["$CREATE"],content:{membership:"join"},event_id:"$ALICE"},{type:"m.room.power_levels",state_key:"",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE"],prev_events:["$ALICE"],content:{users:{"@alice:tardis":100},events:{"m.room.join_rules":50},users_default:50},event_id:"$PL"},{type:"m.room.join_rules",state_key:"",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE","$PL"],prev_events:["$PL"],content:{join_rule:"public"},event_id:"$JR"},{type:"m.room.member",state_key:"@bob:tardis",sender:"@bob:tardis",auth_events:["$CREATE","$JR","$PL"],prev_events:["$JR"],content:{membership:"join"},event_id:"$BOB"},{type:"m.room.member",state_key:"@charlie:tardis",sender:"@charlie:tardis",auth_events:["$CREATE","$JR","$PL"],prev_events:["$BOB"],content:{membership:"join"},event_id:"$CHARLIE"},{type:"m.room.join_rules",state_key:"",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE","$PL"],prev_events:["$CHARLIE"],content:{join_rule:"invite"},event_id:"$ALICE_JR"},{type:"m.room.join_rules",state_key:"",sender:"@bob:tardis",auth_events:["$CREATE","$BOB","$PL"],prev_events:["$CHARLIE"],content:{join_rule:"knock"},event_id:"$BOB_JR"},{type:"m.room.message",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE","$PL"],prev_events:["$ALICE_JR","$BOB_JR"],content:{body:"Bob wins."},event_id:"$MERGE1"},{type:"m.room.join_rules",state_key:"",sender:"@bob:tardis",auth_events:["$CREATE","$BOB","$PL"],prev_events:["$MERGE1"],content:{join_rule:"knock"},event_id:"$BOB_JR2"},{type:"m.room.join_rules",state_key:"",sender:"@charlie:tardis",auth_events:["$CREATE","$CHARLIE","$PL"],prev_events:["$MERGE1"],content:{join_rule:"public"},event_id:"$CHARLIE_JR"},{type:"m.room.message",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE","$PL"],prev_events:["$BOB_JR2","$CHARLIE_JR"],content:{body:"Charlie wins."},event_id:"$MERGE2"},{type:"m.room.join_rules",state_key:"",sender:"@bob:tardis",auth_events:["$CREATE","$BOB","$PL"],prev_events:["$MERGE2"],content:{join_rule:"knock"},origin_server_ts:1704077299001,event_id:"$BOB_JR3"},{type:"m.room.join_rules",state_key:"",sender:"@charlie:tardis",auth_events:["$CREATE","$CHARLIE","$PL"],prev_events:["$MERGE2"],content:{join_rule:"invite"},origin_server_ts:1704077299001,event_id:"$CHARLIE_JR2"},{type:"m.room.message",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE","$PL"],prev_events:["$CHARLIE_JR2","$BOB_JR3"],content:{body:"Bob wins."},event_id:"$MERGE3"}],room_id:"!power-ordering:tardis",room_version:"10",tardis_version:1,annotations:{title:"The winner follows this priority: Sender Power Level THEN origin_server_ts THEN event ID",titles:{$PL:"Join rules can be modified by ANYONE",$ALICE:["Reverse Topological Power Ordering:","The conflicting state events in this example potentially restrict permissions because they are join rules.","All of the merges in this example are due to this ordering."].join(`
`),$MERGE1:["Bob's 'knock' wins because he has a lower PL (50 vs 100).","This seems undesirable at first, but this can be worded another way: Alice's 'invite' is APPLIED FIRST, and then Bob's.","This order ensures if Alice revokes Bob's permissions, Alice wins."].join(`
`),$MERGE2:["Both Bob and Charlie have the same PL (50). Charlie's 'public' wins because his event has a higher origin_server_ts"].join(`
`),$MERGE3:["Both events have the same timestamp. Bob's 'knock' wins because his event ID is greater than Charlie's (A < Z < a < z)"].join(`
`)},events:{}}};var Ds=/[\u1680\u2000-\u200A\u202F\u205F\u3000]/,ds=/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08BD\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312E\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FEA\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC03-\uDC37\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDF00-\uDF19]|\uD806[\uDCA0-\uDCDF\uDCFF\uDE00\uDE0B-\uDE32\uDE3A\uDE50\uDE5C-\uDE83\uDE86-\uDE89\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD46]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50\uDF93-\uDF9F\uDFE0\uDFE1]|\uD821[\uDC00-\uDFEC]|\uD822[\uDC00-\uDEF2]|\uD82C[\uDC00-\uDD1E\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]/,Es=/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05F0-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u082D\u0840-\u085B\u0860-\u086A\u08A0-\u08B4\u08B6-\u08BD\u08D4-\u08E1\u08E3-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u09FC\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0AF9-\u0AFF\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58-\u0C5A\u0C60-\u0C63\u0C66-\u0C6F\u0C80-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D00-\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D54-\u0D57\u0D5F-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1877\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19D9\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1C80-\u1C88\u1CD0-\u1CD2\u1CD4-\u1CF9\u1D00-\u1DF9\u1DFB-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u2E2F\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099\u309A\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312E\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FEA\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA827\uA840-\uA873\uA880-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD\uA900-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDDFD\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF7A\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00-\uDE03\uDE05\uDE06\uDE0C-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE38-\uDE3A\uDE3F\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE6\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC00-\uDC46\uDC66-\uDC6F\uDC7F-\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD00-\uDD34\uDD36-\uDD3F\uDD50-\uDD73\uDD76\uDD80-\uDDC4\uDDCA-\uDDCC\uDDD0-\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE37\uDE3E\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEEA\uDEF0-\uDEF9\uDF00-\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3C-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF50\uDF57\uDF5D-\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC00-\uDC4A\uDC50-\uDC59\uDC80-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDB5\uDDB8-\uDDC0\uDDD8-\uDDDD\uDE00-\uDE40\uDE44\uDE50-\uDE59\uDE80-\uDEB7\uDEC0-\uDEC9\uDF00-\uDF19\uDF1D-\uDF2B\uDF30-\uDF39]|\uD806[\uDCA0-\uDCE9\uDCFF\uDE00-\uDE3E\uDE47\uDE50-\uDE83\uDE86-\uDE99\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC36\uDC38-\uDC40\uDC50-\uDC59\uDC72-\uDC8F\uDC92-\uDCA7\uDCA9-\uDCB6\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD36\uDD3A\uDD3C\uDD3D\uDD3F-\uDD47\uDD50-\uDD59]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50-\uDF7E\uDF8F-\uDF9F\uDFE0\uDFE1]|\uD821[\uDC00-\uDFEC]|\uD822[\uDC00-\uDEF2]|\uD82C[\uDC00-\uDD1E\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9D\uDC9E]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD838[\uDC00-\uDC06\uDC08-\uDC18\uDC1B-\uDC21\uDC23\uDC24\uDC26-\uDC2A]|\uD83A[\uDC00-\uDCC4\uDCD0-\uDCD6\uDD00-\uDD4A\uDD50-\uDD59]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uDB40[\uDD00-\uDDEF]/,tt={Space_Separator:Ds,ID_Start:ds,ID_Continue:Es},O={isSpaceSeparator(e){return typeof e=="string"&&tt.Space_Separator.test(e)},isIdStartChar(e){return typeof e=="string"&&(e>="a"&&e<="z"||e>="A"&&e<="Z"||e==="$"||e==="_"||tt.ID_Start.test(e))},isIdContinueChar(e){return typeof e=="string"&&(e>="a"&&e<="z"||e>="A"&&e<="Z"||e>="0"&&e<="9"||e==="$"||e==="_"||e==="‌"||e==="‍"||tt.ID_Continue.test(e))},isDigit(e){return typeof e=="string"&&/[0-9]/.test(e)},isHexDigit(e){return typeof e=="string"&&/[0-9A-Fa-f]/.test(e)}};let dt,J,Q,He,ie,V,M,Bt,ge;var As=function(t,n){dt=String(t),J="start",Q=[],He=0,ie=1,V=0,M=void 0,Bt=void 0,ge=void 0;do M=Cs(),_s[J]();while(M.type!=="eof");return typeof n=="function"?Et({"":ge},"",n):ge};function Et(e,t,n){const u=e[t];if(u!=null&&typeof u=="object")if(Array.isArray(u))for(let r=0;r<u.length;r++){const i=String(r),s=Et(u,i,n);s===void 0?delete u[i]:Object.defineProperty(u,i,{value:s,writable:!0,enumerable:!0,configurable:!0})}else for(const r in u){const i=Et(u,r,n);i===void 0?delete u[r]:Object.defineProperty(u,r,{value:i,writable:!0,enumerable:!0,configurable:!0})}return n.call(e,t,u)}let y,F,Fe,Z,b;function Cs(){for(y="default",F="",Fe=!1,Z=1;;){b=ee();const e=Tn[y]();if(e)return e}}function ee(){if(dt[He])return String.fromCodePoint(dt.codePointAt(He))}function f(){const e=ee();return e===`
`?(ie++,V=0):e?V+=e.length:V++,e&&(He+=e.length),e}const Tn={default(){switch(b){case"	":case"\v":case"\f":case" ":case" ":case"\uFEFF":case`
`:case"\r":case"\u2028":case"\u2029":f();return;case"/":f(),y="comment";return;case void 0:return f(),I("eof")}if(O.isSpaceSeparator(b)){f();return}return Tn[J]()},comment(){switch(b){case"*":f(),y="multiLineComment";return;case"/":f(),y="singleLineComment";return}throw N(f())},multiLineComment(){switch(b){case"*":f(),y="multiLineCommentAsterisk";return;case void 0:throw N(f())}f()},multiLineCommentAsterisk(){switch(b){case"*":f();return;case"/":f(),y="default";return;case void 0:throw N(f())}f(),y="multiLineComment"},singleLineComment(){switch(b){case`
`:case"\r":case"\u2028":case"\u2029":f(),y="default";return;case void 0:return f(),I("eof")}f()},value(){switch(b){case"{":case"[":return I("punctuator",f());case"n":return f(),ce("ull"),I("null",null);case"t":return f(),ce("rue"),I("boolean",!0);case"f":return f(),ce("alse"),I("boolean",!1);case"-":case"+":f()==="-"&&(Z=-1),y="sign";return;case".":F=f(),y="decimalPointLeading";return;case"0":F=f(),y="zero";return;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":F=f(),y="decimalInteger";return;case"I":return f(),ce("nfinity"),I("numeric",1/0);case"N":return f(),ce("aN"),I("numeric",NaN);case'"':case"'":Fe=f()==='"',F="",y="string";return}throw N(f())},identifierNameStartEscape(){if(b!=="u")throw N(f());f();const e=At();switch(e){case"$":case"_":break;default:if(!O.isIdStartChar(e))throw en();break}F+=e,y="identifierName"},identifierName(){switch(b){case"$":case"_":case"‌":case"‍":F+=f();return;case"\\":f(),y="identifierNameEscape";return}if(O.isIdContinueChar(b)){F+=f();return}return I("identifier",F)},identifierNameEscape(){if(b!=="u")throw N(f());f();const e=At();switch(e){case"$":case"_":case"‌":case"‍":break;default:if(!O.isIdContinueChar(e))throw en();break}F+=e,y="identifierName"},sign(){switch(b){case".":F=f(),y="decimalPointLeading";return;case"0":F=f(),y="zero";return;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":F=f(),y="decimalInteger";return;case"I":return f(),ce("nfinity"),I("numeric",Z*(1/0));case"N":return f(),ce("aN"),I("numeric",NaN)}throw N(f())},zero(){switch(b){case".":F+=f(),y="decimalPoint";return;case"e":case"E":F+=f(),y="decimalExponent";return;case"x":case"X":F+=f(),y="hexadecimal";return}return I("numeric",Z*0)},decimalInteger(){switch(b){case".":F+=f(),y="decimalPoint";return;case"e":case"E":F+=f(),y="decimalExponent";return}if(O.isDigit(b)){F+=f();return}return I("numeric",Z*Number(F))},decimalPointLeading(){if(O.isDigit(b)){F+=f(),y="decimalFraction";return}throw N(f())},decimalPoint(){switch(b){case"e":case"E":F+=f(),y="decimalExponent";return}if(O.isDigit(b)){F+=f(),y="decimalFraction";return}return I("numeric",Z*Number(F))},decimalFraction(){switch(b){case"e":case"E":F+=f(),y="decimalExponent";return}if(O.isDigit(b)){F+=f();return}return I("numeric",Z*Number(F))},decimalExponent(){switch(b){case"+":case"-":F+=f(),y="decimalExponentSign";return}if(O.isDigit(b)){F+=f(),y="decimalExponentInteger";return}throw N(f())},decimalExponentSign(){if(O.isDigit(b)){F+=f(),y="decimalExponentInteger";return}throw N(f())},decimalExponentInteger(){if(O.isDigit(b)){F+=f();return}return I("numeric",Z*Number(F))},hexadecimal(){if(O.isHexDigit(b)){F+=f(),y="hexadecimalInteger";return}throw N(f())},hexadecimalInteger(){if(O.isHexDigit(b)){F+=f();return}return I("numeric",Z*Number(F))},string(){switch(b){case"\\":f(),F+=vs();return;case'"':if(Fe)return f(),I("string",F);F+=f();return;case"'":if(!Fe)return f(),I("string",F);F+=f();return;case`
`:case"\r":throw N(f());case"\u2028":case"\u2029":Fs(b);break;case void 0:throw N(f())}F+=f()},start(){switch(b){case"{":case"[":return I("punctuator",f())}y="value"},beforePropertyName(){switch(b){case"$":case"_":F=f(),y="identifierName";return;case"\\":f(),y="identifierNameStartEscape";return;case"}":return I("punctuator",f());case'"':case"'":Fe=f()==='"',y="string";return}if(O.isIdStartChar(b)){F+=f(),y="identifierName";return}throw N(f())},afterPropertyName(){if(b===":")return I("punctuator",f());throw N(f())},beforePropertyValue(){y="value"},afterPropertyValue(){switch(b){case",":case"}":return I("punctuator",f())}throw N(f())},beforeArrayValue(){if(b==="]")return I("punctuator",f());y="value"},afterArrayValue(){switch(b){case",":case"]":return I("punctuator",f())}throw N(f())},end(){throw N(f())}};function I(e,t){return{type:e,value:t,line:ie,column:V}}function ce(e){for(const t of e){if(ee()!==t)throw N(f());f()}}function vs(){switch(ee()){case"b":return f(),"\b";case"f":return f(),"\f";case"n":return f(),`
`;case"r":return f(),"\r";case"t":return f(),"	";case"v":return f(),"\v";case"0":if(f(),O.isDigit(ee()))throw N(f());return"\0";case"x":return f(),ps();case"u":return f(),At();case`
`:case"\u2028":case"\u2029":return f(),"";case"\r":return f(),ee()===`
`&&f(),"";case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":throw N(f());case void 0:throw N(f())}return f()}function ps(){let e="",t=ee();if(!O.isHexDigit(t)||(e+=f(),t=ee(),!O.isHexDigit(t)))throw N(f());return e+=f(),String.fromCodePoint(parseInt(e,16))}function At(){let e="",t=4;for(;t-- >0;){const n=ee();if(!O.isHexDigit(n))throw N(f());e+=f()}return String.fromCodePoint(parseInt(e,16))}const _s={start(){if(M.type==="eof")throw le();nt()},beforePropertyName(){switch(M.type){case"identifier":case"string":Bt=M.value,J="afterPropertyName";return;case"punctuator":Ie();return;case"eof":throw le()}},afterPropertyName(){if(M.type==="eof")throw le();J="beforePropertyValue"},beforePropertyValue(){if(M.type==="eof")throw le();nt()},beforeArrayValue(){if(M.type==="eof")throw le();if(M.type==="punctuator"&&M.value==="]"){Ie();return}nt()},afterPropertyValue(){if(M.type==="eof")throw le();switch(M.value){case",":J="beforePropertyName";return;case"}":Ie()}},afterArrayValue(){if(M.type==="eof")throw le();switch(M.value){case",":J="beforeArrayValue";return;case"]":Ie()}},end(){}};function nt(){let e;switch(M.type){case"punctuator":switch(M.value){case"{":e={};break;case"[":e=[];break}break;case"null":case"boolean":case"numeric":case"string":e=M.value;break}if(ge===void 0)ge=e;else{const t=Q[Q.length-1];Array.isArray(t)?t.push(e):Object.defineProperty(t,Bt,{value:e,writable:!0,enumerable:!0,configurable:!0})}if(e!==null&&typeof e=="object")Q.push(e),Array.isArray(e)?J="beforeArrayValue":J="beforePropertyName";else{const t=Q[Q.length-1];t==null?J="end":Array.isArray(t)?J="afterArrayValue":J="afterPropertyValue"}}function Ie(){Q.pop();const e=Q[Q.length-1];e==null?J="end":Array.isArray(e)?J="afterArrayValue":J="afterPropertyValue"}function N(e){return Ve(e===void 0?`JSON5: invalid end of input at ${ie}:${V}`:`JSON5: invalid character '${Ln(e)}' at ${ie}:${V}`)}function le(){return Ve(`JSON5: invalid end of input at ${ie}:${V}`)}function en(){return V-=5,Ve(`JSON5: invalid identifier character at ${ie}:${V}`)}function Fs(e){console.warn(`JSON5: '${Ln(e)}' in strings is not valid ECMAScript; consider escaping`)}function Ln(e){const t={"'":"\\'",'"':'\\"',"\\":"\\\\","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t","\v":"\\v","\0":"\\0","\u2028":"\\u2028","\u2029":"\\u2029"};if(t[e])return t[e];if(e<" "){const n=e.charCodeAt(0).toString(16);return"\\x"+("00"+n).substring(n.length)}return e}function Ve(e){const t=new SyntaxError(e);return t.lineNumber=ie,t.columnNumber=V,t}var gs=function(t,n,u){const r=[];let i="",s,o,c="",a;if(n!=null&&typeof n=="object"&&!Array.isArray(n)&&(u=n.space,a=n.quote,n=n.replacer),typeof n=="function")o=n;else if(Array.isArray(n)){s=[];for(const _ of n){let B;typeof _=="string"?B=_:(typeof _=="number"||_ instanceof String||_ instanceof Number)&&(B=String(_)),B!==void 0&&s.indexOf(B)<0&&s.push(B)}}return u instanceof Number?u=Number(u):u instanceof String&&(u=String(u)),typeof u=="number"?u>0&&(u=Math.min(10,Math.floor(u)),c="          ".substr(0,u)):typeof u=="string"&&(c=u.substr(0,10)),l("",{"":t});function l(_,B){let E=B[_];switch(E!=null&&(typeof E.toJSON5=="function"?E=E.toJSON5(_):typeof E.toJSON=="function"&&(E=E.toJSON(_))),o&&(E=o.call(B,_,E)),E instanceof Number?E=Number(E):E instanceof String?E=String(E):E instanceof Boolean&&(E=E.valueOf()),E){case null:return"null";case!0:return"true";case!1:return"false"}if(typeof E=="string")return D(E);if(typeof E=="number")return String(E);if(typeof E=="object")return Array.isArray(E)?$(E):d(E)}function D(_){const B={"'":.1,'"':.2},E={"'":"\\'",'"':'\\"',"\\":"\\\\","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t","\v":"\\v","\0":"\\0","\u2028":"\\u2028","\u2029":"\\u2029"};let p="";for(let k=0;k<_.length;k++){const L=_[k];switch(L){case"'":case'"':B[L]++,p+=L;continue;case"\0":if(O.isDigit(_[k+1])){p+="\\x00";continue}}if(E[L]){p+=E[L];continue}if(L<" "){let K=L.charCodeAt(0).toString(16);p+="\\x"+("00"+K).substring(K.length);continue}p+=L}const v=a||Object.keys(B).reduce((k,L)=>B[k]<B[L]?k:L);return p=p.replace(new RegExp(v,"g"),E[v]),v+p+v}function d(_){if(r.indexOf(_)>=0)throw TypeError("Converting circular structure to JSON5");r.push(_);let B=i;i=i+c;let E=s||Object.keys(_),p=[];for(const k of E){const L=l(k,_);if(L!==void 0){let K=C(k)+":";c!==""&&(K+=" "),K+=L,p.push(K)}}let v;if(p.length===0)v="{}";else{let k;if(c==="")k=p.join(","),v="{"+k+"}";else{let L=`,
`+i;k=p.join(L),v=`{
`+i+k+`,
`+B+"}"}}return r.pop(),i=B,v}function C(_){if(_.length===0)return D(_);const B=String.fromCodePoint(_.codePointAt(0));if(!O.isIdStartChar(B))return D(_);for(let E=B.length;E<_.length;E++)if(!O.isIdContinueChar(String.fromCodePoint(_.codePointAt(E))))return D(_);return _}function $(_){if(r.indexOf(_)>=0)throw TypeError("Converting circular structure to JSON5");r.push(_);let B=i;i=i+c;let E=[];for(let v=0;v<_.length;v++){const k=l(String(v),_);E.push(k!==void 0?k:"null")}let p;if(E.length===0)p="[]";else if(c==="")p="["+E.join(",")+"]";else{let v=`,
`+i,k=E.join(v);p=`[
`+i+k+`,
`+B+"]"}return r.pop(),i=B,p}};const ms={parse:As,stringify:gs};var ys=ms;const tn="10";async function ws(e){const t=await new Promise((u,r)=>{const i=new FileReader;i.onload=s=>{if(!s.target||!s.target.result)return;if(e.name.endsWith(".json5")){const a=ys.parse(s.target.result);a.on_load_at_start==null&&(a.on_load_at_start=!1),a.calculate_event_ids==null&&(a.calculate_event_ids=!1),a.room_version==null&&(a.room_version=tn),u(a);return}const o=s.target.result;if(o.startsWith("[")){const a=JSON.parse(o);u(a);return}const c=o.split(`
`).filter(a=>a.trim().length>0).map(a=>JSON.parse(a));u(c)},i.readAsText(e)});let n;return Array.isArray(t)?n={tardis_version:1,room_version:tn,room_id:t[0].room_id,calculate_event_ids:!1,on_load_at_start:!1,events:t}:n=t,On(n)}function On(e){var r,i,s,o;const t={events:[],roomVersion:e.room_version,annotations:e.annotations,precalculatedStateAfter:e.precalculated_state_after,onLoadAtStart:e.on_load_at_start},n=new Map;let u=new Date(2024,0,1).getTime();for(const c of e.events){if(!c)throw new Error("missing event");if(!c.event_id)throw new Error(`event is missing 'event_id', got ${JSON.stringify(c)}`);if(!c.type)throw new Error(`event is missing 'type' field, got ${JSON.stringify(c)}`);if(c.origin_server_ts?u=c.origin_server_ts+1e3:(c.origin_server_ts=u,u+=1e3),!c.room_id&&e.room_id&&(c.room_id=e.room_id),e.calculate_event_ids){const a=c.event_id;for(const D of["prev_events","auth_events"]){const d=[];for(const C of c[D]){const $=n.get(C);$?d.push($):d.push(C)}c[D]=d}const l=globalThis.gmslEventIDForEvent(JSON.stringify(c),e.room_version);n.set(a,l),c.event_id=l,(i=(r=t.annotations)==null?void 0:r.events)!=null&&i[a]&&(t.annotations.events[l]=t.annotations.events[a]),(o=(s=t.annotations)==null?void 0:s.titles)!=null&&o[a]&&(t.annotations.titles[l]=t.annotations.titles[a])}t.events.push(c)}if(t.precalculatedStateAfter)for(const c in t.precalculatedStateAfter){const a=n.get(c);if(!a){console.error(`precalculated_state_after references ${c} but this does not exist in the events array. Skipping.`);continue}const l=[];for(const D of t.precalculatedStateAfter[c]){const d=n.get(D);d?l.push(d):console.error(`precalculated_state_after for ${c} references ${D} but this does not exist in the events array. Skipping.`)}t.precalculatedStateAfter[a]=l,delete t.precalculatedStateAfter[c]}return console.log(t),t}class Bs{constructor(t,n){R(this,"inflightRequests");this.sender=t,this.getEvent=n,this.inflightRequests=new Map}onGetEventRequest(t){const n=this.getEvent(t);return n||console.error(`WS: asked for event ${t.event_id} but didn't find it.`),n}onResolveStateResponse(t,n){const u=this.inflightRequests.get(t);if(!u){console.error(`onResolveStateResponse: no request id for response! id=${t}`);return}n.error&&console.error(t,n.error),u(n),this.inflightRequests.delete(t)}async resolveState(t,n,u,r){console.log("resolveState",u,r);const i=globalThis.crypto.randomUUID();return new Promise((o,c)=>{this.inflightRequests.set(i,a=>{if(!a.result){console.error("State resolved to the empty set"),o({state:{}});return}if(a.error&&a.error!==""){c(a.error);return}o({state:a.result})}),this.sender.sendResolveState(i,{state:u,room_id:t,room_version:n,event:r})})}}class xs{constructor(){R(this,"ws");R(this,"receiver")}async sendResolveState(t,n){this.sendWs({id:t,type:"resolve_state",data:n})}async connect(t,n){return this.receiver=n,this.ws=new WebSocket(t),new Promise(u=>{this.ws.addEventListener("open",()=>{console.log("WS open"),u()}),this.ws.addEventListener("error",this.onWsError.bind(this)),this.ws.addEventListener("close",this.onWsClose.bind(this)),this.ws.addEventListener("message",this.onWsMessage.bind(this))})}close(){this.ws.close()}sendWs(t){console.log("send",t),this.ws.send(JSON.stringify(t))}onWsClose(t){}onWsError(t){}onWsMessage(t){const n=JSON.parse(t.data);switch(console.log("recv",n),n.type){case"get_event":{const u=n.data,r=this.receiver.onGetEventRequest(u);u.event=r,n.data=u,this.sendWs(n);break}case"resolve_state":{const u=n.data;this.receiver.onResolveStateResponse(n.id,u);break}}}}const nn={"Quick Start":Rn,"Mainline Ordering":fs,"Reverse Topological Power Ordering":hs},re=new Yn(document.getElementById("eventlist"),document.getElementById("eventlisttemplate"));class Mn{constructor(t){R(this,"cache");R(this,"createEventId");R(this,"showAuthChain");R(this,"showAuthDAG");R(this,"showOutliers");R(this,"collapse");R(this,"shimUrl");R(this,"debugger");R(this,"renderEvents");R(this,"scenario");this.cache=t,this.createEventId=null,this.showAuthChain=!1,this.showAuthDAG=!1,this.showOutliers=!1,this.collapse=!1,this.renderEvents={}}setShimUrl(t){this.shimUrl=t,console.log("setShimUrl",t)}async loadFile(t){const n=await ws(t);this.loadScenario(n)}loadScenario(t){for(const n of t.events)this.cache.eventCache.store(n),n.type==="m.room.create"&&n.state_key===""&&(this.createEventId=n.event_id);if(t.precalculatedStateAfter)for(const n in t.precalculatedStateAfter){const u={};for(const r of t.precalculatedStateAfter[n]){const i=this.cache.eventCache.get(r);if(!i||i.state_key==null){console.log(`precalculated_state_after for ${n} includes ${r} but it isn't a state event we know about. Skipping.`);continue}u[JSON.stringify([i.type,i.state_key])]=i.event_id}this.cache.stateAtEvent.setState(n,u)}this.scenario=t,this.debugger=new Xn(t),t.onLoadAtStart&&t.events.length>=2&&this.debugger.goTo(t.events[1].event_id),re.clear(),t.events.forEach((n,u)=>{re.appendEvent(u,n)}),re.highlight(this.debugger.current()),re.onEventClick(n=>{this.debugger.goTo(n),this.refresh(),re.highlight(w.debugger.current())}),re.onEventJsonClick(n=>{document.getElementById("eventdetails").textContent=JSON.stringify(this.cache.eventCache.get(n),null,2),document.getElementById("infocontainer").style.display="block"}),this.refresh()}setShowAuthChain(t){this.showAuthChain=t}setShowAuthDAG(t){this.showAuthDAG=t}setShowOutliers(t){this.showOutliers=t}setCollapse(t){this.collapse=t}async refresh(){let t=Object.create(null);for(const u of this.debugger.eventsUpToCurrent())t[u]=this.cache.eventCache.get(u);this.collapse&&(t=this.collapsifier(t));const n=[];for(const u in t)n.push(t[u]);ls(document.getElementById("svgcontainer"),n,{currentEventId:this.debugger.current(),scenario:this.scenario,stateAtEvent:this.cache.stateAtEvent.getStateAsEventIds(this.debugger.current()),showAuthChain:this.showAuthChain,showAuthDAG:this.showAuthDAG})}findForwardExtremities(t){const n=new Set;for(const u in t)n.add(u);for(const u in t){const r=t[u];for(const i of r.prev_events)n.delete(i);for(const i of r.auth_events)n.delete(i)}return n}collapsifier(t){const n=JSON.parse(JSON.stringify(t)),u=this.findForwardExtremities(n),r=new Set;for(const a of u)r.add(a);const i=Object.create(null);for(const a in n){const l=n[a];for(const D of l.prev_events){const d=i[D]||0;i[D]=d+1}l.prev_events.length!==1&&r.add(l.event_id)}for(const a in i)i[a]>1&&r.add(a);const s=new Set;for(const a in n){if(r.has(a)){s.add(a);continue}const l=n[a];if(r.has(l.prev_events[0])){s.add(a);continue}for(const D of r){const d=n[D];if(!d)continue;let C=!1;for(const $ of d.prev_events)if($===a){s.add(a),C=!0;break}if(C)break}}const o=[],c=new Set;for(const a of u)o.push({id:a,from:a});for(;o.length>0;){const a=o.pop();if(!a)break;const l=a.id,D=n[l];if(c.has(l)||(c.add(l),!D))continue;for(const $ of D.prev_events)o.push({id:$,from:a.id});if(s.has(l))continue;delete n[l];const d=n[a.from],C=[D.prev_events[0]];for(const $ in d.prev_events)s.has($)&&C.push($);d.prev_events=C,d._collapse=d._collapse||0,d._collapse+=1,n[a.from]=d;for(const $ of o)$.from===l&&($.from=d.event_id)}return console.log("collapsifier complete"),n}}const ze=document.getElementById("shimurl");let w=new Mn(new on);w.setShimUrl(ze.value);const Ct=new xs,un=new Bs(Ct,e=>w.cache.eventCache.get(e.event_id));document.getElementById("showauthevents").addEventListener("change",e=>{w.setShowAuthChain(e.target.checked),e.target.checked&&w.setShowAuthDAG(!1),w.refresh(),document.getElementById("showauthevents").checked=w.showAuthChain,document.getElementById("showauthdag").checked=w.showAuthDAG});document.getElementById("showauthdag").addEventListener("change",e=>{w.setShowAuthDAG(e.target.checked),e.target.checked&&w.setShowAuthChain(!1),w.refresh(),document.getElementById("showauthevents").checked=w.showAuthChain,document.getElementById("showauthdag").checked=w.showAuthDAG});document.getElementById("showoutliers").addEventListener("change",e=>{w.setShowOutliers(e.target.checked),w.refresh()});document.getElementById("showoutliers").checked=w.showOutliers;document.getElementById("collapse").addEventListener("change",e=>{w.setCollapse(e.target.checked),w.refresh()});document.getElementById("collapse").checked=w.collapse;document.getElementById("jsonfile").addEventListener("change",async e=>{const t=document.getElementById("jsonfile").files;t&&(w=new Mn(new on),w.setShimUrl(ze.value),await w.loadFile(t[0]))},!1);document.getElementById("closeinfocontainer").addEventListener("click",e=>{document.getElementById("infocontainer").style.display="none"});document.getElementById("infocontainer").style.display="none";document.getElementById("stepfwd").addEventListener("click",async e=>{w.debugger.next(),w.refresh(),re.highlight(w.debugger.current())});document.getElementById("stepbwd").addEventListener("click",async e=>{w.debugger.previous(),w.refresh(),re.highlight(w.debugger.current())});ze.addEventListener("change",e=>{const t=e.target.value;w.setShimUrl(t),globalThis.localStorage.setItem("shim_url",t)});const ut=globalThis.localStorage.getItem("shim_url");ut&&(console.log("setting shim url from local storage"),ze.value=ut,w.setShimUrl(ut));const rn=document.getElementById("loader"),bs=document.getElementById("loader-status"),Ne=e=>{bs.innerText=e};document.getElementById("resolve").addEventListener("click",async e=>{if(!w.shimUrl)return console.error("you need to set a shim url to resolve state!"),{};rn.style.display="block",Ne(`Connecting to ${w.shimUrl}`);try{await Ct.connect(w.shimUrl,un),await w.debugger.resolve(w.cache,async(t,n,u,r)=>{try{return Ne(`Resolving state at event ${r.event_id}`),(await un.resolveState(t,n,u,r)).state}catch(i){throw console.error("failed to resolve state:",i),Ne(`Failed to resolve state at event ${r.event_id} : ${i}`),i}}),Ne("")}catch(t){console.error("resolving state failed: ",t)}finally{Ct.close()}rn.style.display="none",w.refresh()});const sn=new Go;WebAssembly.instantiateStreaming(fetch("gmsl.wasm"),sn.importObject).then(e=>{globalThis.wasm=e.instance,sn.run(globalThis.wasm);const t=u=>{const r=On(u);w.loadScenario(r)},n=document.getElementById("file-select");n&&(n.innerHTML="",Object.keys(nn).forEach((u,r)=>{n[r]=new Option(u)}),n.addEventListener("change",u=>{var i;const r=nn[(i=u==null?void 0:u.target)==null?void 0:i.value];t(r)})),t(Rn)});
