(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))u(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const s of i.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&u(s)}).observe(document,{childList:!0,subtree:!0});function n(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function u(r){if(r.ep)return;r.ep=!0;const i=n(r);fetch(r.href,i)}})();class jt{constructor(){this.stateAtEvent=new $n,this.eventCache=new Sn}}class $n{constructor(){this.state={}}setState(t,n){this.state[t]=n,console.log(`StateAtEvent ${t} is`,n)}getStateAsEventIds(t){return this.state[t]?new Set(Object.values(this.state[t])):new Set}getState(t){return this.state[t]?JSON.parse(JSON.stringify(this.state[t])):{}}}class Sn{constructor(){this.cache=new Map}store(t){this.cache.set(t.event_id,t)}get(t){return this.cache.get(t)}}class kn{constructor(t){this.scenario=t,this.index=t.events.length-1,this.eventIdOrdering=t.events.map(n=>n.event_id),this.currentEventId=this.eventIdOrdering[this.index]}next(){this.index++,this.index>=this.eventIdOrdering.length&&(this.index=this.eventIdOrdering.length-1),this.currentEventId=this.eventIdOrdering[this.index]}previous(){this.index--,this.index<0&&(this.index=0),this.currentEventId=this.eventIdOrdering[this.index]}goTo(t){for(let n=0;n<this.eventIdOrdering.length;n++)if(this.eventIdOrdering[n]===t){this.index=n,this.currentEventId=this.eventIdOrdering[this.index];break}}current(){return this.currentEventId}eventsUpToCurrent(){const t=[];for(let n=0;n<=this.index;n++)t.push(this.eventIdOrdering[n]);return t}async resolve(t,n){for(const u of this.eventsUpToCurrent())await this.resolveEvent(u,t,n)}async resolveEvent(t,n,u){if(n.stateAtEvent.getStateAsEventIds(t).size>0)return;const r=n.eventCache.get(t),i=[];for(const a of r.prev_events){const o=n.stateAtEvent.getState(a);Object.keys(o).length===0&&console.error(`WARN: we do not know the state at ${a} yet, so the state calculation for ${t} may be wrong!`),i.push(o)}console.log("performing state resolution for prev_events:",r.prev_events);const s=await u(r.room_id,this.scenario.roomVersion,i,r);n.stateAtEvent.setState(t,s)}}class In{constructor(t,n){this.container=t,this.template=n}clear(){this.container.innerHTML=""}onEventClick(t){this.positionListener=t}onEventJsonClick(t){this.jsonListener=t}onCellClick(t){this.onClick(t,this.positionListener)}onJsonClick(t){this.onClick(t,this.jsonListener)}onClick(t,n){var i;const u=(i=t.target)==null?void 0:i.parentElement;if(!u)return;const r=u.getAttribute("id");r&&n&&n(r)}appendEvent(t,n){const u=this.template.content.firstElementChild.cloneNode(!0);u.setAttribute("id",n.event_id);const r=u.getElementsByClassName("eventlistrowprefix")[0];r.textContent=String(t),u.addEventListener("click",this.onCellClick.bind(this)),u.getElementsByClassName("eventlistrowjson")[0].addEventListener("click",this.onJsonClick.bind(this)),u.getElementsByClassName("eventlistrowbody")[0].textContent=zt(n),u.getElementsByClassName("eventlistroweventid")[0].textContent=n.event_id.substr(0,5),n.state_key!=null&&(u.style.fontWeight="600"),this.container.appendChild(u)}highlight(t){if(this.highlightedEventId){const n=document.getElementById(this.highlightedEventId);n&&(n.style.backgroundColor="")}document.getElementById(t).style.backgroundColor="#6f8ea9",this.highlightedEventId=t}}function zt(e){var u;let t="",n="";if(e.state_key!=null)switch(e.type){case"m.room.create":t=`by ${e.content.creator}`;break;case"m.room.member":t=`${e.state_key}=${e.content.membership}`;break;case"m.room.join_rules":t=`(${e.content.join_rule})`;break;case"m.room.history_visibility":t=`(${e.content.history_visibility})`;break;case"m.room.name":t=`(${e.content.name})`;break;case"m.room.topic":t=`(${e.content.topic})`;break;default:e.state_key!==""&&(t=e.state_key)}else switch(e.type){case"m.reaction":n=(u=e.content["m.relates_to"])==null?void 0:u.key;break;case"m.room.message":n=e.content.body;break}return`${e.type} ${t}${n}`}var Nn={value:()=>{}};function Xt(){for(var e=0,t=arguments.length,n={},u;e<t;++e){if(!(u=arguments[e]+"")||u in n||/[\s.]/.test(u))throw new Error("illegal type: "+u);n[u]=[]}return new xe(n)}function xe(e){this._=e}function Rn(e,t){return e.trim().split(/^|\s+/).map(function(n){var u="",r=n.indexOf(".");if(r>=0&&(u=n.slice(r+1),n=n.slice(0,r)),n&&!t.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:u}})}xe.prototype=Xt.prototype={constructor:xe,on:function(e,t){var n=this._,u=Rn(e+"",n),r,i=-1,s=u.length;if(arguments.length<2){for(;++i<s;)if((r=(e=u[i]).type)&&(r=Tn(n[r],e.name)))return r;return}if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++i<s;)if(r=(e=u[i]).type)n[r]=wt(n[r],e.name,t);else if(t==null)for(r in n)n[r]=wt(n[r],e.name,null);return this},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new xe(e)},call:function(e,t){if((r=arguments.length-2)>0)for(var n=new Array(r),u=0,r,i;u<r;++u)n[u]=arguments[u+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(i=this._[e],u=0,r=i.length;u<r;++u)i[u].value.apply(t,n)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var u=this._[e],r=0,i=u.length;r<i;++r)u[r].value.apply(t,n)}};function Tn(e,t){for(var n=0,u=e.length,r;n<u;++n)if((r=e[n]).name===t)return r.value}function wt(e,t,n){for(var u=0,r=e.length;u<r;++u)if(e[u].name===t){e[u]=Nn,e=e.slice(0,u).concat(e.slice(u+1));break}return n!=null&&e.push({name:t,value:n}),e}var ze="http://www.w3.org/1999/xhtml";const xt={svg:"http://www.w3.org/2000/svg",xhtml:ze,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Me(e){var t=e+="",n=t.indexOf(":");return n>=0&&(t=e.slice(0,n))!=="xmlns"&&(e=e.slice(n+1)),xt.hasOwnProperty(t)?{space:xt[t],local:e}:e}function Ln(e){return function(){var t=this.ownerDocument,n=this.namespaceURI;return n===ze&&t.documentElement.namespaceURI===ze?t.createElement(e):t.createElementNS(n,e)}}function Mn(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function Yt(e){var t=Me(e);return(t.local?Mn:Ln)(t)}function On(){}function ct(e){return e==null?On:function(){return this.querySelector(e)}}function Pn(e){typeof e!="function"&&(e=ct(e));for(var t=this._groups,n=t.length,u=new Array(n),r=0;r<n;++r)for(var i=t[r],s=i.length,a=u[r]=new Array(s),o,c,l=0;l<s;++l)(o=i[l])&&(c=e.call(o,o.__data__,l,i))&&("__data__"in o&&(c.__data__=o.__data__),a[l]=c);return new L(u,this._parents)}function lt(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function Jn(){return[]}function Kt(e){return e==null?Jn:function(){return this.querySelectorAll(e)}}function Gn(e){return function(){var t=e.apply(this,arguments);return t==null?[]:lt(t)}}function qn(e){typeof e=="function"?e=Gn(e):e=Kt(e);for(var t=this._groups,n=t.length,u=[],r=[],i=0;i<n;++i)for(var s=t[i],a=s.length,o,c=0;c<a;++c)(o=s[c])&&(u.push(e.call(o,o.__data__,c,s)),r.push(o));return new L(u,r)}function Zt(e){return function(){return this.matches(e)}}function Qt(e){return function(t){return t.matches(e)}}var Hn=Array.prototype.find;function Vn(e){return function(){return Hn.call(this.children,e)}}function Wn(){return this.firstElementChild}function Un(e){return this.select(e==null?Wn:Vn(typeof e=="function"?e:Qt(e)))}var jn=Array.prototype.filter;function zn(){return this.children}function Xn(e){return function(){return jn.call(this.children,e)}}function Yn(e){return this.selectAll(e==null?zn:Xn(typeof e=="function"?e:Qt(e)))}function Kn(e){typeof e!="function"&&(e=Zt(e));for(var t=this._groups,n=t.length,u=new Array(n),r=0;r<n;++r)for(var i=t[r],s=i.length,a=u[r]=[],o,c=0;c<s;++c)(o=i[c])&&e.call(o,o.__data__,c,i)&&a.push(o);return new L(u,this._parents)}function en(e){return new Array(e.length)}function Zn(){return new L(this._enter||this._groups.map(en),this._parents)}function Se(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}Se.prototype={constructor:Se,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};function Qn(e){return function(){return e}}function eu(e,t,n,u,r,i){for(var s=0,a,o=t.length,c=i.length;s<c;++s)(a=t[s])?(a.__data__=i[s],u[s]=a):n[s]=new Se(e,i[s]);for(;s<o;++s)(a=t[s])&&(r[s]=a)}function tu(e,t,n,u,r,i,s){var a,o,c=new Map,l=t.length,f=i.length,d=new Array(l),A;for(a=0;a<l;++a)(o=t[a])&&(d[a]=A=s.call(o,o.__data__,a,t)+"",c.has(A)?r[a]=o:c.set(A,o));for(a=0;a<f;++a)A=s.call(e,i[a],a,i)+"",(o=c.get(A))?(u[a]=o,o.__data__=i[a],c.delete(A)):n[a]=new Se(e,i[a]);for(a=0;a<l;++a)(o=t[a])&&c.get(d[a])===o&&(r[a]=o)}function nu(e){return e.__data__}function uu(e,t){if(!arguments.length)return Array.from(this,nu);var n=t?tu:eu,u=this._parents,r=this._groups;typeof e!="function"&&(e=Qn(e));for(var i=r.length,s=new Array(i),a=new Array(i),o=new Array(i),c=0;c<i;++c){var l=u[c],f=r[c],d=f.length,A=lt(e.call(l,l&&l.__data__,c,u)),v=A.length,E=a[c]=new Array(v),p=s[c]=new Array(v),_=o[c]=new Array(d);n(l,f,E,p,_,A,t);for(var y=0,w=0,x,I;y<v;++y)if(x=E[y]){for(y>=w&&(w=y+1);!(I=p[w])&&++w<v;);x._next=I||null}}return s=new L(s,u),s._enter=a,s._exit=o,s}function ru(){return new L(this._exit||this._groups.map(en),this._parents)}function iu(e,t,n){var u=this.enter(),r=this,i=this.exit();return u=typeof e=="function"?e(u):u.append(e+""),t!=null&&(r=t(r)),n==null?i.remove():n(i),u&&r?u.merge(r).order():r}function su(e){if(!(e instanceof L))throw new Error("invalid merge");for(var t=this._groups,n=e._groups,u=t.length,r=n.length,i=Math.min(u,r),s=new Array(u),a=0;a<i;++a)for(var o=t[a],c=n[a],l=o.length,f=s[a]=new Array(l),d,A=0;A<l;++A)(d=o[A]||c[A])&&(f[A]=d);for(;a<u;++a)s[a]=t[a];return new L(s,this._parents)}function ou(){for(var e=this._groups,t=-1,n=e.length;++t<n;)for(var u=e[t],r=u.length-1,i=u[r],s;--r>=0;)(s=u[r])&&(i&&s.compareDocumentPosition(i)^4&&i.parentNode.insertBefore(s,i),i=s);return this}function au(e){e||(e=cu);function t(f,d){return f&&d?e(f.__data__,d.__data__):!f-!d}for(var n=this._groups,u=n.length,r=new Array(u),i=0;i<u;++i){for(var s=n[i],a=s.length,o=r[i]=new Array(a),c,l=0;l<a;++l)(c=s[l])&&(o[l]=c);o.sort(t)}return new L(r,this._parents).order()}function cu(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function lu(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this}function Du(){return Array.from(this)}function fu(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var u=e[t],r=0,i=u.length;r<i;++r){var s=u[r];if(s)return s}return null}function hu(){let e=0;for(const t of this)++e;return e}function du(){return!this.node()}function Eu(e){for(var t=this._groups,n=0,u=t.length;n<u;++n)for(var r=t[n],i=0,s=r.length,a;i<s;++i)(a=r[i])&&e.call(a,a.__data__,i,r);return this}function Au(e){return function(){this.removeAttribute(e)}}function Cu(e){return function(){this.removeAttributeNS(e.space,e.local)}}function pu(e,t){return function(){this.setAttribute(e,t)}}function vu(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function _u(e,t){return function(){var n=t.apply(this,arguments);n==null?this.removeAttribute(e):this.setAttribute(e,n)}}function Fu(e,t){return function(){var n=t.apply(this,arguments);n==null?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}}function gu(e,t){var n=Me(e);if(arguments.length<2){var u=this.node();return n.local?u.getAttributeNS(n.space,n.local):u.getAttribute(n)}return this.each((t==null?n.local?Cu:Au:typeof t=="function"?n.local?Fu:_u:n.local?vu:pu)(n,t))}function tn(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function mu(e){return function(){this.style.removeProperty(e)}}function yu(e,t,n){return function(){this.style.setProperty(e,t,n)}}function Bu(e,t,n){return function(){var u=t.apply(this,arguments);u==null?this.style.removeProperty(e):this.style.setProperty(e,u,n)}}function wu(e,t,n){return arguments.length>1?this.each((t==null?mu:typeof t=="function"?Bu:yu)(e,t,n??"")):ae(this.node(),e)}function ae(e,t){return e.style.getPropertyValue(t)||tn(e).getComputedStyle(e,null).getPropertyValue(t)}function xu(e){return function(){delete this[e]}}function bu(e,t){return function(){this[e]=t}}function $u(e,t){return function(){var n=t.apply(this,arguments);n==null?delete this[e]:this[e]=n}}function Su(e,t){return arguments.length>1?this.each((t==null?xu:typeof t=="function"?$u:bu)(e,t)):this.node()[e]}function nn(e){return e.trim().split(/^|\s+/)}function Dt(e){return e.classList||new un(e)}function un(e){this._node=e,this._names=nn(e.getAttribute("class")||"")}un.prototype={add:function(e){var t=this._names.indexOf(e);t<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};function rn(e,t){for(var n=Dt(e),u=-1,r=t.length;++u<r;)n.add(t[u])}function sn(e,t){for(var n=Dt(e),u=-1,r=t.length;++u<r;)n.remove(t[u])}function ku(e){return function(){rn(this,e)}}function Iu(e){return function(){sn(this,e)}}function Nu(e,t){return function(){(t.apply(this,arguments)?rn:sn)(this,e)}}function Ru(e,t){var n=nn(e+"");if(arguments.length<2){for(var u=Dt(this.node()),r=-1,i=n.length;++r<i;)if(!u.contains(n[r]))return!1;return!0}return this.each((typeof t=="function"?Nu:t?ku:Iu)(n,t))}function Tu(){this.textContent=""}function Lu(e){return function(){this.textContent=e}}function Mu(e){return function(){var t=e.apply(this,arguments);this.textContent=t??""}}function Ou(e){return arguments.length?this.each(e==null?Tu:(typeof e=="function"?Mu:Lu)(e)):this.node().textContent}function Pu(){this.innerHTML=""}function Ju(e){return function(){this.innerHTML=e}}function Gu(e){return function(){var t=e.apply(this,arguments);this.innerHTML=t??""}}function qu(e){return arguments.length?this.each(e==null?Pu:(typeof e=="function"?Gu:Ju)(e)):this.node().innerHTML}function Hu(){this.nextSibling&&this.parentNode.appendChild(this)}function Vu(){return this.each(Hu)}function Wu(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Uu(){return this.each(Wu)}function ju(e){var t=typeof e=="function"?e:Yt(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})}function zu(){return null}function Xu(e,t){var n=typeof e=="function"?e:Yt(e),u=t==null?zu:typeof t=="function"?t:ct(t);return this.select(function(){return this.insertBefore(n.apply(this,arguments),u.apply(this,arguments)||null)})}function Yu(){var e=this.parentNode;e&&e.removeChild(this)}function Ku(){return this.each(Yu)}function Zu(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function Qu(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function er(e){return this.select(e?Qu:Zu)}function tr(e){return arguments.length?this.property("__data__",e):this.node().__data__}function nr(e){return function(t){e.call(this,t,this.__data__)}}function ur(e){return e.trim().split(/^|\s+/).map(function(t){var n="",u=t.indexOf(".");return u>=0&&(n=t.slice(u+1),t=t.slice(0,u)),{type:t,name:n}})}function rr(e){return function(){var t=this.__on;if(t){for(var n=0,u=-1,r=t.length,i;n<r;++n)i=t[n],(!e.type||i.type===e.type)&&i.name===e.name?this.removeEventListener(i.type,i.listener,i.options):t[++u]=i;++u?t.length=u:delete this.__on}}}function ir(e,t,n){return function(){var u=this.__on,r,i=nr(t);if(u){for(var s=0,a=u.length;s<a;++s)if((r=u[s]).type===e.type&&r.name===e.name){this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=i,r.options=n),r.value=t;return}}this.addEventListener(e.type,i,n),r={type:e.type,name:e.name,value:t,listener:i,options:n},u?u.push(r):this.__on=[r]}}function sr(e,t,n){var u=ur(e+""),r,i=u.length,s;if(arguments.length<2){var a=this.node().__on;if(a){for(var o=0,c=a.length,l;o<c;++o)for(r=0,l=a[o];r<i;++r)if((s=u[r]).type===l.type&&s.name===l.name)return l.value}return}for(a=t?ir:rr,r=0;r<i;++r)this.each(a(u[r],t,n));return this}function on(e,t,n){var u=tn(e),r=u.CustomEvent;typeof r=="function"?r=new r(t,n):(r=u.document.createEvent("Event"),n?(r.initEvent(t,n.bubbles,n.cancelable),r.detail=n.detail):r.initEvent(t,!1,!1)),e.dispatchEvent(r)}function or(e,t){return function(){return on(this,e,t)}}function ar(e,t){return function(){return on(this,e,t.apply(this,arguments))}}function cr(e,t){return this.each((typeof t=="function"?ar:or)(e,t))}function*lr(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var u=e[t],r=0,i=u.length,s;r<i;++r)(s=u[r])&&(yield s)}var ft=[null];function L(e,t){this._groups=e,this._parents=t}function _e(){return new L([[document.documentElement]],ft)}function Dr(){return this}L.prototype=_e.prototype={constructor:L,select:Pn,selectAll:qn,selectChild:Un,selectChildren:Yn,filter:Kn,data:uu,enter:Zn,exit:ru,join:iu,merge:su,selection:Dr,order:ou,sort:au,call:lu,nodes:Du,node:fu,size:hu,empty:du,each:Eu,attr:gu,style:wu,property:Su,classed:Ru,text:Ou,html:qu,raise:Vu,lower:Uu,append:ju,insert:Xu,remove:Ku,clone:er,datum:tr,on:sr,dispatch:cr,[Symbol.iterator]:lr};function U(e){return typeof e=="string"?new L([[document.querySelector(e)]],[document.documentElement]):new L([[e]],ft)}function ge(e){return typeof e=="string"?new L([document.querySelectorAll(e)],[document.documentElement]):new L([e==null?[]:lt(e)],ft)}function ht(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function an(e,t){var n=Object.create(e.prototype);for(var u in t)n[u]=t[u];return n}function Fe(){}var Ae=.7,ke=1/Ae,oe="\\s*([+-]?\\d+)\\s*",Ce="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",V="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",fr=/^#([0-9a-f]{3,8})$/,hr=new RegExp("^rgb\\("+[oe,oe,oe]+"\\)$"),dr=new RegExp("^rgb\\("+[V,V,V]+"\\)$"),Er=new RegExp("^rgba\\("+[oe,oe,oe,Ce]+"\\)$"),Ar=new RegExp("^rgba\\("+[V,V,V,Ce]+"\\)$"),Cr=new RegExp("^hsl\\("+[Ce,V,V]+"\\)$"),pr=new RegExp("^hsla\\("+[Ce,V,V,Ce]+"\\)$"),bt={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};ht(Fe,pe,{copy:function(e){return Object.assign(new this.constructor,this,e)},displayable:function(){return this.rgb().displayable()},hex:$t,formatHex:$t,formatHsl:vr,formatRgb:St,toString:St});function $t(){return this.rgb().formatHex()}function vr(){return cn(this).formatHsl()}function St(){return this.rgb().formatRgb()}function pe(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=fr.exec(e))?(n=t[1].length,t=parseInt(t[1],16),n===6?kt(t):n===3?new P(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):n===8?me(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):n===4?me(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=hr.exec(e))?new P(t[1],t[2],t[3],1):(t=dr.exec(e))?new P(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=Er.exec(e))?me(t[1],t[2],t[3],t[4]):(t=Ar.exec(e))?me(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=Cr.exec(e))?Rt(t[1],t[2]/100,t[3]/100,1):(t=pr.exec(e))?Rt(t[1],t[2]/100,t[3]/100,t[4]):bt.hasOwnProperty(e)?kt(bt[e]):e==="transparent"?new P(NaN,NaN,NaN,0):null}function kt(e){return new P(e>>16&255,e>>8&255,e&255,1)}function me(e,t,n,u){return u<=0&&(e=t=n=NaN),new P(e,t,n,u)}function _r(e){return e instanceof Fe||(e=pe(e)),e?(e=e.rgb(),new P(e.r,e.g,e.b,e.opacity)):new P}function Xe(e,t,n,u){return arguments.length===1?_r(e):new P(e,t,n,u??1)}function P(e,t,n,u){this.r=+e,this.g=+t,this.b=+n,this.opacity=+u}ht(P,Xe,an(Fe,{brighter:function(e){return e=e==null?ke:Math.pow(ke,e),new P(this.r*e,this.g*e,this.b*e,this.opacity)},darker:function(e){return e=e==null?Ae:Math.pow(Ae,e),new P(this.r*e,this.g*e,this.b*e,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:It,formatHex:It,formatRgb:Nt,toString:Nt}));function It(){return"#"+qe(this.r)+qe(this.g)+qe(this.b)}function Nt(){var e=this.opacity;return e=isNaN(e)?1:Math.max(0,Math.min(1,e)),(e===1?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(e===1?")":", "+e+")")}function qe(e){return e=Math.max(0,Math.min(255,Math.round(e)||0)),(e<16?"0":"")+e.toString(16)}function Rt(e,t,n,u){return u<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new H(e,t,n,u)}function cn(e){if(e instanceof H)return new H(e.h,e.s,e.l,e.opacity);if(e instanceof Fe||(e=pe(e)),!e)return new H;if(e instanceof H)return e;e=e.rgb();var t=e.r/255,n=e.g/255,u=e.b/255,r=Math.min(t,n,u),i=Math.max(t,n,u),s=NaN,a=i-r,o=(i+r)/2;return a?(t===i?s=(n-u)/a+(n<u)*6:n===i?s=(u-t)/a+2:s=(t-n)/a+4,a/=o<.5?i+r:2-i-r,s*=60):a=o>0&&o<1?0:s,new H(s,a,o,e.opacity)}function Fr(e,t,n,u){return arguments.length===1?cn(e):new H(e,t,n,u??1)}function H(e,t,n,u){this.h=+e,this.s=+t,this.l=+n,this.opacity=+u}ht(H,Fr,an(Fe,{brighter:function(e){return e=e==null?ke:Math.pow(ke,e),new H(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=e==null?Ae:Math.pow(Ae,e),new H(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,u=n+(n<.5?n:1-n)*t,r=2*n-u;return new P(He(e>=240?e-240:e+120,r,u),He(e,r,u),He(e<120?e+240:e-120,r,u),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var e=this.opacity;return e=isNaN(e)?1:Math.max(0,Math.min(1,e)),(e===1?"hsl(":"hsla(")+(this.h||0)+", "+(this.s||0)*100+"%, "+(this.l||0)*100+"%"+(e===1?")":", "+e+")")}}));function He(e,t,n){return(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)*255}const ln=e=>()=>e;function gr(e,t){return function(n){return e+n*t}}function mr(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(u){return Math.pow(e+u*t,n)}}function yr(e){return(e=+e)==1?Dn:function(t,n){return n-t?mr(t,n,e):ln(isNaN(t)?n:t)}}function Dn(e,t){var n=t-e;return n?gr(e,n):ln(isNaN(e)?t:e)}const Tt=function e(t){var n=yr(t);function u(r,i){var s=n((r=Xe(r)).r,(i=Xe(i)).r),a=n(r.g,i.g),o=n(r.b,i.b),c=Dn(r.opacity,i.opacity);return function(l){return r.r=s(l),r.g=a(l),r.b=o(l),r.opacity=c(l),r+""}}return u.gamma=e,u}(1);function Z(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}var Ye=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Ve=new RegExp(Ye.source,"g");function Br(e){return function(){return e}}function wr(e){return function(t){return e(t)+""}}function xr(e,t){var n=Ye.lastIndex=Ve.lastIndex=0,u,r,i,s=-1,a=[],o=[];for(e=e+"",t=t+"";(u=Ye.exec(e))&&(r=Ve.exec(t));)(i=r.index)>n&&(i=t.slice(n,i),a[s]?a[s]+=i:a[++s]=i),(u=u[0])===(r=r[0])?a[s]?a[s]+=r:a[++s]=r:(a[++s]=null,o.push({i:s,x:Z(u,r)})),n=Ve.lastIndex;return n<t.length&&(i=t.slice(n),a[s]?a[s]+=i:a[++s]=i),a.length<2?o[0]?wr(o[0].x):Br(t):(t=o.length,function(c){for(var l=0,f;l<t;++l)a[(f=o[l]).i]=f.x(c);return a.join("")})}var Lt=180/Math.PI,Ke={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function fn(e,t,n,u,r,i){var s,a,o;return(s=Math.sqrt(e*e+t*t))&&(e/=s,t/=s),(o=e*n+t*u)&&(n-=e*o,u-=t*o),(a=Math.sqrt(n*n+u*u))&&(n/=a,u/=a,o/=a),e*u<t*n&&(e=-e,t=-t,o=-o,s=-s),{translateX:r,translateY:i,rotate:Math.atan2(t,e)*Lt,skewX:Math.atan(o)*Lt,scaleX:s,scaleY:a}}var ye;function br(e){const t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?Ke:fn(t.a,t.b,t.c,t.d,t.e,t.f)}function $r(e){return e==null||(ye||(ye=document.createElementNS("http://www.w3.org/2000/svg","g")),ye.setAttribute("transform",e),!(e=ye.transform.baseVal.consolidate()))?Ke:(e=e.matrix,fn(e.a,e.b,e.c,e.d,e.e,e.f))}function hn(e,t,n,u){function r(c){return c.length?c.pop()+" ":""}function i(c,l,f,d,A,v){if(c!==f||l!==d){var E=A.push("translate(",null,t,null,n);v.push({i:E-4,x:Z(c,f)},{i:E-2,x:Z(l,d)})}else(f||d)&&A.push("translate("+f+t+d+n)}function s(c,l,f,d){c!==l?(c-l>180?l+=360:l-c>180&&(c+=360),d.push({i:f.push(r(f)+"rotate(",null,u)-2,x:Z(c,l)})):l&&f.push(r(f)+"rotate("+l+u)}function a(c,l,f,d){c!==l?d.push({i:f.push(r(f)+"skewX(",null,u)-2,x:Z(c,l)}):l&&f.push(r(f)+"skewX("+l+u)}function o(c,l,f,d,A,v){if(c!==f||l!==d){var E=A.push(r(A)+"scale(",null,",",null,")");v.push({i:E-4,x:Z(c,f)},{i:E-2,x:Z(l,d)})}else(f!==1||d!==1)&&A.push(r(A)+"scale("+f+","+d+")")}return function(c,l){var f=[],d=[];return c=e(c),l=e(l),i(c.translateX,c.translateY,l.translateX,l.translateY,f,d),s(c.rotate,l.rotate,f,d),a(c.skewX,l.skewX,f,d),o(c.scaleX,c.scaleY,l.scaleX,l.scaleY,f,d),c=l=null,function(A){for(var v=-1,E=d.length,p;++v<E;)f[(p=d[v]).i]=p.x(A);return f.join("")}}}var Sr=hn(br,"px, ","px)","deg)"),kr=hn($r,", ",")",")"),ce=0,De=0,le=0,dn=1e3,Ie,fe,Ne=0,ie=0,Oe=0,ve=typeof performance=="object"&&performance.now?performance:Date,En=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function dt(){return ie||(En(Ir),ie=ve.now()+Oe)}function Ir(){ie=0}function Re(){this._call=this._time=this._next=null}Re.prototype=An.prototype={constructor:Re,restart:function(e,t,n){if(typeof e!="function")throw new TypeError("callback is not a function");n=(n==null?dt():+n)+(t==null?0:+t),!this._next&&fe!==this&&(fe?fe._next=this:Ie=this,fe=this),this._call=e,this._time=n,Ze()},stop:function(){this._call&&(this._call=null,this._time=1/0,Ze())}};function An(e,t,n){var u=new Re;return u.restart(e,t,n),u}function Nr(){dt(),++ce;for(var e=Ie,t;e;)(t=ie-e._time)>=0&&e._call.call(null,t),e=e._next;--ce}function Mt(){ie=(Ne=ve.now())+Oe,ce=De=0;try{Nr()}finally{ce=0,Tr(),ie=0}}function Rr(){var e=ve.now(),t=e-Ne;t>dn&&(Oe-=t,Ne=e)}function Tr(){for(var e,t=Ie,n,u=1/0;t;)t._call?(u>t._time&&(u=t._time),e=t,t=t._next):(n=t._next,t._next=null,t=e?e._next=n:Ie=n);fe=e,Ze(u)}function Ze(e){if(!ce){De&&(De=clearTimeout(De));var t=e-ie;t>24?(e<1/0&&(De=setTimeout(Mt,e-ve.now()-Oe)),le&&(le=clearInterval(le))):(le||(Ne=ve.now(),le=setInterval(Rr,dn)),ce=1,En(Mt))}}function Ot(e,t,n){var u=new Re;return t=t==null?0:+t,u.restart(r=>{u.stop(),e(r+t)},t,n),u}var Lr=Xt("start","end","cancel","interrupt"),Mr=[],Cn=0,Pt=1,Qe=2,be=3,Jt=4,et=5,$e=6;function Pe(e,t,n,u,r,i){var s=e.__transition;if(!s)e.__transition={};else if(n in s)return;Or(e,n,{name:t,index:u,group:r,on:Lr,tween:Mr,time:i.time,delay:i.delay,duration:i.duration,ease:i.ease,timer:null,state:Cn})}function Et(e,t){var n=q(e,t);if(n.state>Cn)throw new Error("too late; already scheduled");return n}function W(e,t){var n=q(e,t);if(n.state>be)throw new Error("too late; already running");return n}function q(e,t){var n=e.__transition;if(!n||!(n=n[t]))throw new Error("transition not found");return n}function Or(e,t,n){var u=e.__transition,r;u[t]=n,n.timer=An(i,0,n.time);function i(c){n.state=Pt,n.timer.restart(s,n.delay,n.time),n.delay<=c&&s(c-n.delay)}function s(c){var l,f,d,A;if(n.state!==Pt)return o();for(l in u)if(A=u[l],A.name===n.name){if(A.state===be)return Ot(s);A.state===Jt?(A.state=$e,A.timer.stop(),A.on.call("interrupt",e,e.__data__,A.index,A.group),delete u[l]):+l<t&&(A.state=$e,A.timer.stop(),A.on.call("cancel",e,e.__data__,A.index,A.group),delete u[l])}if(Ot(function(){n.state===be&&(n.state=Jt,n.timer.restart(a,n.delay,n.time),a(c))}),n.state=Qe,n.on.call("start",e,e.__data__,n.index,n.group),n.state===Qe){for(n.state=be,r=new Array(d=n.tween.length),l=0,f=-1;l<d;++l)(A=n.tween[l].value.call(e,e.__data__,n.index,n.group))&&(r[++f]=A);r.length=f+1}}function a(c){for(var l=c<n.duration?n.ease.call(null,c/n.duration):(n.timer.restart(o),n.state=et,1),f=-1,d=r.length;++f<d;)r[f].call(e,l);n.state===et&&(n.on.call("end",e,e.__data__,n.index,n.group),o())}function o(){n.state=$e,n.timer.stop(),delete u[t];for(var c in u)return;delete e.__transition}}function Pr(e,t){var n=e.__transition,u,r,i=!0,s;if(n){t=t==null?null:t+"";for(s in n){if((u=n[s]).name!==t){i=!1;continue}r=u.state>Qe&&u.state<et,u.state=$e,u.timer.stop(),u.on.call(r?"interrupt":"cancel",e,e.__data__,u.index,u.group),delete n[s]}i&&delete e.__transition}}function Jr(e){return this.each(function(){Pr(this,e)})}function Gr(e,t){var n,u;return function(){var r=W(this,e),i=r.tween;if(i!==n){u=n=i;for(var s=0,a=u.length;s<a;++s)if(u[s].name===t){u=u.slice(),u.splice(s,1);break}}r.tween=u}}function qr(e,t,n){var u,r;if(typeof n!="function")throw new Error;return function(){var i=W(this,e),s=i.tween;if(s!==u){r=(u=s).slice();for(var a={name:t,value:n},o=0,c=r.length;o<c;++o)if(r[o].name===t){r[o]=a;break}o===c&&r.push(a)}i.tween=r}}function Hr(e,t){var n=this._id;if(e+="",arguments.length<2){for(var u=q(this.node(),n).tween,r=0,i=u.length,s;r<i;++r)if((s=u[r]).name===e)return s.value;return null}return this.each((t==null?Gr:qr)(n,e,t))}function At(e,t,n){var u=e._id;return e.each(function(){var r=W(this,u);(r.value||(r.value={}))[t]=n.apply(this,arguments)}),function(r){return q(r,u).value[t]}}function pn(e,t){var n;return(typeof t=="number"?Z:t instanceof pe?Tt:(n=pe(t))?(t=n,Tt):xr)(e,t)}function Vr(e){return function(){this.removeAttribute(e)}}function Wr(e){return function(){this.removeAttributeNS(e.space,e.local)}}function Ur(e,t,n){var u,r=n+"",i;return function(){var s=this.getAttribute(e);return s===r?null:s===u?i:i=t(u=s,n)}}function jr(e,t,n){var u,r=n+"",i;return function(){var s=this.getAttributeNS(e.space,e.local);return s===r?null:s===u?i:i=t(u=s,n)}}function zr(e,t,n){var u,r,i;return function(){var s,a=n(this),o;return a==null?void this.removeAttribute(e):(s=this.getAttribute(e),o=a+"",s===o?null:s===u&&o===r?i:(r=o,i=t(u=s,a)))}}function Xr(e,t,n){var u,r,i;return function(){var s,a=n(this),o;return a==null?void this.removeAttributeNS(e.space,e.local):(s=this.getAttributeNS(e.space,e.local),o=a+"",s===o?null:s===u&&o===r?i:(r=o,i=t(u=s,a)))}}function Yr(e,t){var n=Me(e),u=n==="transform"?kr:pn;return this.attrTween(e,typeof t=="function"?(n.local?Xr:zr)(n,u,At(this,"attr."+e,t)):t==null?(n.local?Wr:Vr)(n):(n.local?jr:Ur)(n,u,t))}function Kr(e,t){return function(n){this.setAttribute(e,t.call(this,n))}}function Zr(e,t){return function(n){this.setAttributeNS(e.space,e.local,t.call(this,n))}}function Qr(e,t){var n,u;function r(){var i=t.apply(this,arguments);return i!==u&&(n=(u=i)&&Zr(e,i)),n}return r._value=t,r}function ei(e,t){var n,u;function r(){var i=t.apply(this,arguments);return i!==u&&(n=(u=i)&&Kr(e,i)),n}return r._value=t,r}function ti(e,t){var n="attr."+e;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(t==null)return this.tween(n,null);if(typeof t!="function")throw new Error;var u=Me(e);return this.tween(n,(u.local?Qr:ei)(u,t))}function ni(e,t){return function(){Et(this,e).delay=+t.apply(this,arguments)}}function ui(e,t){return t=+t,function(){Et(this,e).delay=t}}function ri(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?ni:ui)(t,e)):q(this.node(),t).delay}function ii(e,t){return function(){W(this,e).duration=+t.apply(this,arguments)}}function si(e,t){return t=+t,function(){W(this,e).duration=t}}function oi(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?ii:si)(t,e)):q(this.node(),t).duration}function ai(e,t){if(typeof t!="function")throw new Error;return function(){W(this,e).ease=t}}function ci(e){var t=this._id;return arguments.length?this.each(ai(t,e)):q(this.node(),t).ease}function li(e,t){return function(){var n=t.apply(this,arguments);if(typeof n!="function")throw new Error;W(this,e).ease=n}}function Di(e){if(typeof e!="function")throw new Error;return this.each(li(this._id,e))}function fi(e){typeof e!="function"&&(e=Zt(e));for(var t=this._groups,n=t.length,u=new Array(n),r=0;r<n;++r)for(var i=t[r],s=i.length,a=u[r]=[],o,c=0;c<s;++c)(o=i[c])&&e.call(o,o.__data__,c,i)&&a.push(o);return new Y(u,this._parents,this._name,this._id)}function hi(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,n=e._groups,u=t.length,r=n.length,i=Math.min(u,r),s=new Array(u),a=0;a<i;++a)for(var o=t[a],c=n[a],l=o.length,f=s[a]=new Array(l),d,A=0;A<l;++A)(d=o[A]||c[A])&&(f[A]=d);for(;a<u;++a)s[a]=t[a];return new Y(s,this._parents,this._name,this._id)}function di(e){return(e+"").trim().split(/^|\s+/).every(function(t){var n=t.indexOf(".");return n>=0&&(t=t.slice(0,n)),!t||t==="start"})}function Ei(e,t,n){var u,r,i=di(t)?Et:W;return function(){var s=i(this,e),a=s.on;a!==u&&(r=(u=a).copy()).on(t,n),s.on=r}}function Ai(e,t){var n=this._id;return arguments.length<2?q(this.node(),n).on.on(e):this.each(Ei(n,e,t))}function Ci(e){return function(){var t=this.parentNode;for(var n in this.__transition)if(+n!==e)return;t&&t.removeChild(this)}}function pi(){return this.on("end.remove",Ci(this._id))}function vi(e){var t=this._name,n=this._id;typeof e!="function"&&(e=ct(e));for(var u=this._groups,r=u.length,i=new Array(r),s=0;s<r;++s)for(var a=u[s],o=a.length,c=i[s]=new Array(o),l,f,d=0;d<o;++d)(l=a[d])&&(f=e.call(l,l.__data__,d,a))&&("__data__"in l&&(f.__data__=l.__data__),c[d]=f,Pe(c[d],t,n,d,c,q(l,n)));return new Y(i,this._parents,t,n)}function _i(e){var t=this._name,n=this._id;typeof e!="function"&&(e=Kt(e));for(var u=this._groups,r=u.length,i=[],s=[],a=0;a<r;++a)for(var o=u[a],c=o.length,l,f=0;f<c;++f)if(l=o[f]){for(var d=e.call(l,l.__data__,f,o),A,v=q(l,n),E=0,p=d.length;E<p;++E)(A=d[E])&&Pe(A,t,n,E,d,v);i.push(d),s.push(l)}return new Y(i,s,t,n)}var Fi=_e.prototype.constructor;function gi(){return new Fi(this._groups,this._parents)}function mi(e,t){var n,u,r;return function(){var i=ae(this,e),s=(this.style.removeProperty(e),ae(this,e));return i===s?null:i===n&&s===u?r:r=t(n=i,u=s)}}function vn(e){return function(){this.style.removeProperty(e)}}function yi(e,t,n){var u,r=n+"",i;return function(){var s=ae(this,e);return s===r?null:s===u?i:i=t(u=s,n)}}function Bi(e,t,n){var u,r,i;return function(){var s=ae(this,e),a=n(this),o=a+"";return a==null&&(o=a=(this.style.removeProperty(e),ae(this,e))),s===o?null:s===u&&o===r?i:(r=o,i=t(u=s,a))}}function wi(e,t){var n,u,r,i="style."+t,s="end."+i,a;return function(){var o=W(this,e),c=o.on,l=o.value[i]==null?a||(a=vn(t)):void 0;(c!==n||r!==l)&&(u=(n=c).copy()).on(s,r=l),o.on=u}}function xi(e,t,n){var u=(e+="")=="transform"?Sr:pn;return t==null?this.styleTween(e,mi(e,u)).on("end.style."+e,vn(e)):typeof t=="function"?this.styleTween(e,Bi(e,u,At(this,"style."+e,t))).each(wi(this._id,e)):this.styleTween(e,yi(e,u,t),n).on("end.style."+e,null)}function bi(e,t,n){return function(u){this.style.setProperty(e,t.call(this,u),n)}}function $i(e,t,n){var u,r;function i(){var s=t.apply(this,arguments);return s!==r&&(u=(r=s)&&bi(e,s,n)),u}return i._value=t,i}function Si(e,t,n){var u="style."+(e+="");if(arguments.length<2)return(u=this.tween(u))&&u._value;if(t==null)return this.tween(u,null);if(typeof t!="function")throw new Error;return this.tween(u,$i(e,t,n??""))}function ki(e){return function(){this.textContent=e}}function Ii(e){return function(){var t=e(this);this.textContent=t??""}}function Ni(e){return this.tween("text",typeof e=="function"?Ii(At(this,"text",e)):ki(e==null?"":e+""))}function Ri(e){return function(t){this.textContent=e.call(this,t)}}function Ti(e){var t,n;function u(){var r=e.apply(this,arguments);return r!==n&&(t=(n=r)&&Ri(r)),t}return u._value=e,u}function Li(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(e==null)return this.tween(t,null);if(typeof e!="function")throw new Error;return this.tween(t,Ti(e))}function Mi(){for(var e=this._name,t=this._id,n=_n(),u=this._groups,r=u.length,i=0;i<r;++i)for(var s=u[i],a=s.length,o,c=0;c<a;++c)if(o=s[c]){var l=q(o,t);Pe(o,e,n,c,s,{time:l.time+l.delay+l.duration,delay:0,duration:l.duration,ease:l.ease})}return new Y(u,this._parents,e,n)}function Oi(){var e,t,n=this,u=n._id,r=n.size();return new Promise(function(i,s){var a={value:s},o={value:function(){--r===0&&i()}};n.each(function(){var c=W(this,u),l=c.on;l!==e&&(t=(e=l).copy(),t._.cancel.push(a),t._.interrupt.push(a),t._.end.push(o)),c.on=t}),r===0&&i()})}var Pi=0;function Y(e,t,n,u){this._groups=e,this._parents=t,this._name=n,this._id=u}function _n(){return++Pi}var te=_e.prototype;Y.prototype={constructor:Y,select:vi,selectAll:_i,filter:fi,merge:hi,selection:gi,transition:Mi,call:te.call,nodes:te.nodes,node:te.node,size:te.size,empty:te.empty,each:te.each,on:Ai,attr:Yr,attrTween:ti,style:xi,styleTween:Si,text:Ni,textTween:Li,remove:pi,tween:Hr,delay:ri,duration:oi,ease:ci,easeVarying:Di,end:Oi,[Symbol.iterator]:te[Symbol.iterator]};function Ji(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}var Gi={time:null,delay:0,duration:250,ease:Ji};function qi(e,t){for(var n;!(n=e.__transition)||!(n=n[t]);)if(!(e=e.parentNode))throw new Error(`transition ${t} not found`);return n}function Hi(e){var t,n;e instanceof Y?(t=e._id,e=e._name):(t=_n(),(n=Gi).time=dt(),e=e==null?null:e+"");for(var u=this._groups,r=u.length,i=0;i<r;++i)for(var s=u[i],a=s.length,o,c=0;c<a;++c)(o=s[c])&&Pe(o,e,t,c,s,n||qi(o,t));return new Y(u,this._parents,e,t)}_e.prototype.interrupt=Jr;_e.prototype.transition=Hi;const tt=Math.PI,nt=2*tt,re=1e-6,Vi=nt-re;function ut(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function rt(){return new ut}ut.prototype=rt.prototype={constructor:ut,moveTo:function(e,t){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+t)},closePath:function(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(e,t){this._+="L"+(this._x1=+e)+","+(this._y1=+t)},quadraticCurveTo:function(e,t,n,u){this._+="Q"+ +e+","+ +t+","+(this._x1=+n)+","+(this._y1=+u)},bezierCurveTo:function(e,t,n,u,r,i){this._+="C"+ +e+","+ +t+","+ +n+","+ +u+","+(this._x1=+r)+","+(this._y1=+i)},arcTo:function(e,t,n,u,r){e=+e,t=+t,n=+n,u=+u,r=+r;var i=this._x1,s=this._y1,a=n-e,o=u-t,c=i-e,l=s-t,f=c*c+l*l;if(r<0)throw new Error("negative radius: "+r);if(this._x1===null)this._+="M"+(this._x1=e)+","+(this._y1=t);else if(f>re)if(!(Math.abs(l*a-o*c)>re)||!r)this._+="L"+(this._x1=e)+","+(this._y1=t);else{var d=n-i,A=u-s,v=a*a+o*o,E=d*d+A*A,p=Math.sqrt(v),_=Math.sqrt(f),y=r*Math.tan((tt-Math.acos((v+f-E)/(2*p*_)))/2),w=y/_,x=y/p;Math.abs(w-1)>re&&(this._+="L"+(e+w*c)+","+(t+w*l)),this._+="A"+r+","+r+",0,0,"+ +(l*d>c*A)+","+(this._x1=e+x*a)+","+(this._y1=t+x*o)}},arc:function(e,t,n,u,r,i){e=+e,t=+t,n=+n,i=!!i;var s=n*Math.cos(u),a=n*Math.sin(u),o=e+s,c=t+a,l=1^i,f=i?u-r:r-u;if(n<0)throw new Error("negative radius: "+n);this._x1===null?this._+="M"+o+","+c:(Math.abs(this._x1-o)>re||Math.abs(this._y1-c)>re)&&(this._+="L"+o+","+c),n&&(f<0&&(f=f%nt+nt),f>Vi?this._+="A"+n+","+n+",0,1,"+l+","+(e-s)+","+(t-a)+"A"+n+","+n+",0,1,"+l+","+(this._x1=o)+","+(this._y1=c):f>re&&(this._+="A"+n+","+n+",0,"+ +(f>=tt)+","+l+","+(this._x1=e+n*Math.cos(r))+","+(this._y1=t+n*Math.sin(r))))},rect:function(e,t,n,u){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+t)+"h"+ +n+"v"+ +u+"h"+-n+"Z"},toString:function(){return this._}};function he(e,t,n){this.k=e,this.x=t,this.y=n}he.prototype={constructor:he,scale:function(e){return e===1?this:new he(this.k*e,this.x,this.y)},translate:function(e,t){return e===0&t===0?this:new he(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};he.prototype;const Wi=(e,t)=>t.showAuthChain?(e.auth_events||[]).concat(e.prev_events):e.prev_events,Ui=(e,t)=>{var i,s,a;const n=e.event_id;if((s=(i=t==null?void 0:t.annotations)==null?void 0:i.events)!=null&&s[n])return`${(a=t==null?void 0:t.annotations)==null?void 0:a.events[n]}`;const u=zt(e),r=e._collapse?`+${e._collapse} more`:"";return`${u} ${r}`},ji=(e,t,n)=>{var vt,_t,Ft,gt,mt,yt,Bt;t=JSON.parse(JSON.stringify(t));const u=t,r=new Map;for(let h=0;h<u.length;h++)u[h].streamPosition=h,r.set(u[h].event_id,u[h]);for(const h of u.slice()){h.edges=Wi(h,n).sort((C,b)=>{var k,M;return(((k=r.get(C))==null?void 0:k.streamPosition)||0)-(((M=r.get(b))==null?void 0:M.streamPosition)||0)});for(const C of h.edges){if(!r.get(C)){const k={event_id:C,type:"dangling",prev_events:[],next_events:[],content:{},sender:"dangling",auth_events:[],room_id:"",origin_server_ts:0,edges:[]};r.set(C,k);const M=u.findIndex(T=>T.event_id===h.event_id);console.log("inserting placeholder prev_event at ",M),u.splice(M,0,k)}const b=r.get(C);b.next_events||(b.next_events=[]),b.next_events.push(h.event_id)}}const i=[],s=[];function a(h=null){{const C=h==null?0:h+1;if(C>=i.length)return C;for(let b=C;b<i.length;b++)if(!i[b])return b;return i.length}}let o=0;u[0].x=0;for(let h=0;h<u.length;h++){const C=u[h];C.y=o,o++;let b=!1;for(const M of C.edges){const T=r.get(M);i.findIndex(J=>J===T.event_id)!==-1&&(C.x=T.x,b=!0);break}if(!b&&(C.x=a(),C.edges&&r.get(C.edges[0]))){const M=r.get(C.edges[0]).y;for(;s[C.x]!==void 0&&M<s[C.x];)C.x=a(C.x)}let k=!1;if(C.next_events){for(const M of C.next_events)if(r.get(M).edges[0]===C.event_id){k=!0;break}}k?i[C.x]=C.event_id:(delete i[C.x],s[C.x]=o)}const c=[];u[0].laneWidth=0;for(let h=1;h<u.length;h++){const C=u[h-1],b=u[h];for(;c.length>0&&h>((vt=c.at(-1))==null?void 0:vt.y);)c.pop();C.next_events&&c.push({x:r.get(C.next_events.at(-1)).x,y:r.get(C.next_events.at(-1)).y}),c.sort((k,M)=>k.x-M.x),b.laneWidth=(_t=c.at(-1))==null?void 0:_t.x,b.laneWidth%2&&(b.x-=.5,b.laneWidth-=.5)}const l={top:20,right:20,bottom:30,left:230};let f=(mt=(gt=(Ft=n.scenario)==null?void 0:Ft.annotations)==null?void 0:gt.titles)==null?void 0:mt[n.currentEventId];f||(f=((Bt=(yt=n.scenario)==null?void 0:yt.annotations)==null?void 0:Bt.title)||"");const d=f.split(`
`),A=20,v=40,E=25,p=5,_=2,y=3,w="#f00",x="#0a0",I="#00f";U(e).html(null);const K=i.length*v+1e3,Ge=u.length*E,pt=U(e).append("svg").attr("width",K+l.left+l.right).attr("height",Ge+l.top+l.bottom+A*d.length).append("g").attr("transform",`translate(${[l.left,l.top]})`),se=pt.selectAll("g").data(u).enter().append("g").attr("class",h=>`node-${h.event_id.slice(1,5)}`).on("mouseover",function(h,C){U(this).attr("fill",x).attr("font-weight","bold"),ge(`.child-${C.event_id.slice(1,5)}`).raise().attr("stroke",I).attr("stroke-width",y),ge(`.parent-${C.event_id.slice(1,5)}`).raise().attr("stroke",w).attr("stroke-width",y);for(const k of C.next_events||[])U(`.node-${k.slice(1,5)}`).attr("fill",I);for(const k of C.edges)U(`.node-${k.slice(1,5)}`).attr("fill",w)}).on("mouseout",function(h,C){U(this).attr("fill",null).attr("font-weight",null);for(const b of C.next_events||[])U(`.node-${b.slice(1,5)}`).attr("fill",null);for(const b of C.edges)U(`.node-${b.slice(1,5)}`).attr("fill",null);ge(`.child-${C.event_id.slice(1,5)}`).attr("stroke","black").attr("stroke-width",_),ge(`.parent-${C.event_id.slice(1,5)}`).attr("stroke","black").attr("stroke-width",_)});se.append("circle").attr("cx",h=>h.x*v).attr("cy",h=>h.y*E).attr("r",p).style("fill",h=>{var C;return(C=n.stateAtEvent)!=null&&C.has(h.event_id)?"#43ff00":h.state_key!=null?"#4300ff":"#111111"}).style("fill-opacity","0.5").style("stroke",h=>{var C;return(C=n.stateAtEvent)!=null&&C.has(h.event_id)?"#43ff00":h.state_key!=null?"#4300ff":"#111111"}),se.append("path").attr("d",h=>{const C=rt();if(h.next_events)for(const b of h.next_events){const k=r.get(b);C.moveTo(h.x*v,h.y*E+p),C.arcTo(h.x*v,(h.y+.5)*E,k.x*v,(h.y+.5)*E,p),C.arcTo(k.x*v,(h.y+.5)*E,k.x*v,k.y*E-p,p),C.lineTo(k.x*v,k.y*E-p)}return C}).attr("stroke","white").attr("stroke-width",_+2).attr("fill","none"),se.each((h,C,b)=>{const k=U(b[C]);if(h.next_events)for(const M of h.next_events){const T=r.get(M);if(!T)continue;const J=rt();let xn=0;J.moveTo(h.x*v,h.y*E+p+0),J.arcTo(h.x*v,(h.y+.5)*E,T.x*v,(h.y+.5)*E,p),J.arcTo(T.x*v,(h.y+.5)*E,T.x*v,T.y*E-p,p),J.lineTo(T.x*v+xn,T.y*E-p),J.moveTo(h.x*v-p/3,h.y*E+p+p/2),J.lineTo(h.x*v,h.y*E+p),J.lineTo(h.x*v+p/3,h.y*E+p+p/2),J.lineTo(h.x*v-p/3,h.y*E+p+p/2),J.lineTo(h.x*v,h.y*E+p),k.append("path").attr("d",J.toString()).attr("class",bn=>`child-${bn.event_id.slice(1,5)} parent-${T==null?void 0:T.event_id.slice(1,5)}`).attr("stroke","black").attr("stroke-width",_).attr("fill","none")}}),se.append("text").text(h=>h.event_id.substr(0,5)).attr("x",h=>h.laneWidth*v+25).attr("y",h=>h.y*E+4),se.append("text").text(h=>Ui(h,n.scenario)).attr("class",h=>"node-text").attr("x",h=>h.laneWidth*v+105).attr("y",h=>h.y*E+4),se.append("text").text(h=>h.origin_server_ts?new Date(h.origin_server_ts).toLocaleString():"").attr("x",-l.left).attr("y",h=>h.y*E+4);const wn=pt.append("text").attr("class","node-text").attr("x",-l.left).attr("y",Ge);for(let h=0;h<d.length;h++)wn.append("tspan").attr("x",-l.left).attr("y",Ge+h*A).text(d[h])},Fn={calculate_event_ids:!0,on_load_at_start:!0,events:[{type:"m.room.create",state_key:"",sender:"@creator:tardis",auth_events:[],prev_events:[],content:{creator:"@creator:tardis"},event_id:"$CREATE"},{type:"m.room.member",state_key:"@creator:tardis",sender:"@creator:tardis",auth_events:["$CREATE"],prev_events:["$CREATE"],content:{membership:"join"},event_id:"$JOIN"},{type:"m.room.message",sender:"@creator:tardis",auth_events:["$CREATE","$JOIN"],prev_events:["$JOIN"],content:{body:"A wild fork appears!"},event_id:"$FORK1"},{type:"m.room.message",sender:"@creator:tardis",auth_events:["$CREATE","$JOIN"],prev_events:["$JOIN"],content:{body:"Another wild fork appears!"},event_id:"$FORK2"},{type:"m.room.message",sender:"@creator:tardis",auth_events:["$CREATE","$JOIN"],prev_events:["$FORK1","$FORK2"],content:{body:"Merged!"},event_id:"$MERGE"},{type:"m.room.message",sender:"@creator:tardis",auth_events:["$CREATE","$JOIN"],prev_events:["$MERGE"],content:{body:"This event has precalculated state"},event_id:"$PRESTATE"},{type:"m.room.name",state_key:"",sender:"@creator:tardis",auth_events:["$CREATE","$JOIN"],prev_events:["$PRESTATE"],content:{name:"State events are blue, messages are grey"},event_id:"$MSG"},{type:"m.room.message",sender:"@creator:tardis",auth_events:["$CREATE","$JOIN"],prev_events:["$MSG"],content:{body:"Boring long chains..."},event_id:"$MSG2"},{type:"m.room.message",sender:"@creator:tardis",auth_events:["$CREATE","$JOIN"],prev_events:["$MSG2"],content:{body:"...can be collapsed..."},event_id:"$MSG3"},{type:"m.room.message",sender:"@creator:tardis",auth_events:["$CREATE","$JOIN"],prev_events:["$MSG3"],content:{body:"...by checking the collapse checkbox."},event_id:"$MSG4"}],room_id:"!quickstart:tardis",room_version:"10",tardis_version:1,annotations:{title:["Welcome to TARDIS! Press the  button to continue."].join(`
`),titles:{$FORK1:"State events are highlighted in blue. Messages are highlighted in grey.",$FORK2:"The DAG can fork, which indicates some events were sent at the same time.",$MERGE:"The DAG can merge, which merges state from each fork together. This is state resolution.",$PRESTATE:"Green events indicate the state at this event. Message events will never be green.",$MSG:"Check the 'Auth Chain' box to show the `auth_events` for each event.",$MSG2:"Press the 'Resolve State' button to calculate which events are part of the current room state.",$MSG3:["As state resolution is iterative, it will resolve state for all earlier events as well.","Click on an earlier event in the list to jump to that event."].join(`
`),$MSG4:["Now load a file or use one of the pre-loaded files to experiment with state resolution in Matrix!"].join(`
`)},events:{$MSG:"Blue nodes like this one are state events.",$MSG2:"Boring long chains...",$MSG3:"...can be collapsed...",$MSG4:"...by checking the collapse checkbox.",$PRESTATE:"This event has pre-calculated state (in green) after this event"}},precalculated_state_after:{$PRESTATE:["$CREATE","$JOIN"]}},zi={calculate_event_ids:!0,on_load_at_start:!0,events:[{type:"m.room.create",state_key:"",sender:"@alice:tardis",auth_events:[],prev_events:[],content:{creator:"@alice:tardis"},event_id:"$CREATE"},{type:"m.room.member",state_key:"@alice:tardis",sender:"@alice:tardis",auth_events:["$CREATE"],prev_events:["$CREATE"],content:{membership:"join"},event_id:"$ALICE"},{type:"m.room.power_levels",state_key:"",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE"],prev_events:["$ALICE"],content:{users:{"@alice:tardis":100},events:{"m.room.name":50},users_default:50},event_id:"$PL"},{type:"m.room.join_rules",state_key:"",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE","$PL"],prev_events:["$PL"],content:{join_rule:"public"},event_id:"$JR"},{type:"m.room.member",state_key:"@bob:tardis",sender:"@bob:tardis",auth_events:["$CREATE","$JR","$PL"],prev_events:["$JR"],content:{membership:"join"},event_id:"$BOB"},{type:"m.room.name",state_key:"",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE","$PL"],prev_events:["$BOB"],content:{name:"Alice Room"},event_id:"$ALICE_NAME"},{type:"m.room.name",state_key:"",sender:"@bob:tardis",auth_events:["$CREATE","$BOB","$PL"],prev_events:["$BOB"],content:{name:"Bob Room"},event_id:"$BOB_NAME"},{type:"m.room.message",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE","$PL"],prev_events:["$ALICE_NAME","$BOB_NAME"],content:{body:"Bob wins."},event_id:"$MERGE1"},{type:"m.room.name",state_key:"",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE","$PL"],prev_events:["$MERGE1"],content:{name:"Alice Room 2"},origin_server_ts:1704067281337,event_id:"$ALICE_NAME2"},{type:"m.room.name",state_key:"",sender:"@bob:tardis",auth_events:["$CREATE","$BOB","$PL"],prev_events:["$MERGE1"],content:{name:"Bob Room 2"},origin_server_ts:1704067281337,event_id:"$BOB_NAME2"},{type:"m.room.message",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE","$PL"],prev_events:["$ALICE_NAME2","$BOB_NAME2"],content:{body:"Alice wins."},event_id:"$MERGE2"},{type:"m.room.name",state_key:"",sender:"@bob:tardis",auth_events:["$CREATE","$BOB","$PL"],prev_events:["$MERGE2"],content:{name:"Bob Room 3"},origin_server_ts:1704077300300,event_id:"$BOB_NAME3"},{type:"m.room.power_levels",state_key:"",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE"],prev_events:["$MERGE2"],content:{users:{"@alice:tardis":100},events:{"m.room.name":50},users_default:50},event_id:"$PL2"},{type:"m.room.name",state_key:"",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE","$PL2"],prev_events:["$PL2"],content:{name:"Alice Room 3"},origin_server_ts:1704077299300,event_id:"$ALICE_NAME3"},{type:"m.room.message",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE","$PL2"],prev_events:["$ALICE_NAME3","$BOB_NAME3"],content:{body:"Alice wins."},event_id:"$MERGE3"}],room_id:"!mainline-fork:tardis",room_version:"10",tardis_version:1,annotations:{title:"The winner follows this priority: Mainline depth THEN origin_server_ts THEN event ID",titles:{$ALICE:["Mainline Ordering:","The conflicting state events in this example are all room name changes and hence do not restrict anyone's permissions.","This makes it easier to explain. All of the merges in this example are due to 'mainline ordering'."].join(`
`),$MERGE1:["Bob wins because his event has a higher origin_server_ts. Both events have the same mainline depth."].join(`
`),$MERGE2:["Both events have the same timestamp. Alice wins with a higher event ID (A < Z < a < z)."].join(`
`),$MERGE3:["Bob's event has a higher timestamp but Alice wins because her event happened AFTER a change to the power levels.","This gives her event a higher 'mainline position' which is considered before the timestamp or event ID."].join(`
`)},events:{}}},Xi={calculate_event_ids:!0,on_load_at_start:!0,events:[{type:"m.room.create",state_key:"",sender:"@alice:tardis",auth_events:[],prev_events:[],content:{creator:"@alice:tardis"},event_id:"$CREATE"},{type:"m.room.member",state_key:"@alice:tardis",sender:"@alice:tardis",auth_events:["$CREATE"],prev_events:["$CREATE"],content:{membership:"join"},event_id:"$ALICE"},{type:"m.room.power_levels",state_key:"",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE"],prev_events:["$ALICE"],content:{users:{"@alice:tardis":100},events:{"m.room.join_rules":50},users_default:50},event_id:"$PL"},{type:"m.room.join_rules",state_key:"",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE","$PL"],prev_events:["$PL"],content:{join_rule:"public"},event_id:"$JR"},{type:"m.room.member",state_key:"@bob:tardis",sender:"@bob:tardis",auth_events:["$CREATE","$JR","$PL"],prev_events:["$JR"],content:{membership:"join"},event_id:"$BOB"},{type:"m.room.member",state_key:"@charlie:tardis",sender:"@charlie:tardis",auth_events:["$CREATE","$JR","$PL"],prev_events:["$BOB"],content:{membership:"join"},event_id:"$CHARLIE"},{type:"m.room.join_rules",state_key:"",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE","$PL"],prev_events:["$CHARLIE"],content:{join_rule:"invite"},event_id:"$ALICE_JR"},{type:"m.room.join_rules",state_key:"",sender:"@bob:tardis",auth_events:["$CREATE","$BOB","$PL"],prev_events:["$CHARLIE"],content:{join_rule:"knock"},event_id:"$BOB_JR"},{type:"m.room.message",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE","$PL"],prev_events:["$ALICE_JR","$BOB_JR"],content:{body:"Bob wins."},event_id:"$MERGE1"},{type:"m.room.join_rules",state_key:"",sender:"@bob:tardis",auth_events:["$CREATE","$BOB","$PL"],prev_events:["$MERGE1"],content:{join_rule:"knock"},event_id:"$BOB_JR2"},{type:"m.room.join_rules",state_key:"",sender:"@charlie:tardis",auth_events:["$CREATE","$CHARLIE","$PL"],prev_events:["$MERGE1"],content:{join_rule:"public"},event_id:"$CHARLIE_JR"},{type:"m.room.message",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE","$PL"],prev_events:["$BOB_JR2","$CHARLIE_JR"],content:{body:"Charlie wins."},event_id:"$MERGE2"},{type:"m.room.join_rules",state_key:"",sender:"@bob:tardis",auth_events:["$CREATE","$BOB","$PL"],prev_events:["$MERGE2"],content:{join_rule:"knock"},origin_server_ts:1704077299001,event_id:"$BOB_JR3"},{type:"m.room.join_rules",state_key:"",sender:"@charlie:tardis",auth_events:["$CREATE","$CHARLIE","$PL"],prev_events:["$MERGE2"],content:{join_rule:"invite"},origin_server_ts:1704077299001,event_id:"$CHARLIE_JR2"},{type:"m.room.message",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE","$PL"],prev_events:["$CHARLIE_JR2","$BOB_JR3"],content:{body:"Bob wins."},event_id:"$MERGE3"}],room_id:"!power-ordering:tardis",room_version:"10",tardis_version:1,annotations:{title:"The winner follows this priority: Sender Power Level THEN origin_server_ts THEN event ID",titles:{$PL:"Join rules can be modified by ANYONE",$ALICE:["Reverse Topological Power Ordering:","The conflicting state events in this example potentially restrict permissions because they are join rules.","All of the merges in this example are due to this ordering."].join(`
`),$MERGE1:["Bob's 'knock' wins because he has a lower PL (50 vs 100).","This seems undesirable at first, but this can be worded another way: Alice's 'invite' is APPLIED FIRST, and then Bob's.","This order ensures if Alice revokes Bob's permissions, Alice wins."].join(`
`),$MERGE2:["Both Bob and Charlie have the same PL (50). Charlie's 'public' wins because his event has a higher origin_server_ts"].join(`
`),$MERGE3:["Both events have the same timestamp. Bob's 'knock' wins because his event ID is greater than Charlie's (A < Z < a < z)"].join(`
`)},events:{}}};var Yi=/[\u1680\u2000-\u200A\u202F\u205F\u3000]/,Ki=/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08BD\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312E\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FEA\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC03-\uDC37\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDF00-\uDF19]|\uD806[\uDCA0-\uDCDF\uDCFF\uDE00\uDE0B-\uDE32\uDE3A\uDE50\uDE5C-\uDE83\uDE86-\uDE89\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD46]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50\uDF93-\uDF9F\uDFE0\uDFE1]|\uD821[\uDC00-\uDFEC]|\uD822[\uDC00-\uDEF2]|\uD82C[\uDC00-\uDD1E\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]/,Zi=/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05F0-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u082D\u0840-\u085B\u0860-\u086A\u08A0-\u08B4\u08B6-\u08BD\u08D4-\u08E1\u08E3-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u09FC\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0AF9-\u0AFF\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58-\u0C5A\u0C60-\u0C63\u0C66-\u0C6F\u0C80-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D00-\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D54-\u0D57\u0D5F-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1877\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19D9\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1C80-\u1C88\u1CD0-\u1CD2\u1CD4-\u1CF9\u1D00-\u1DF9\u1DFB-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u2E2F\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099\u309A\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312E\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FEA\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA827\uA840-\uA873\uA880-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD\uA900-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDDFD\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF7A\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00-\uDE03\uDE05\uDE06\uDE0C-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE38-\uDE3A\uDE3F\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE6\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC00-\uDC46\uDC66-\uDC6F\uDC7F-\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD00-\uDD34\uDD36-\uDD3F\uDD50-\uDD73\uDD76\uDD80-\uDDC4\uDDCA-\uDDCC\uDDD0-\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE37\uDE3E\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEEA\uDEF0-\uDEF9\uDF00-\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3C-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF50\uDF57\uDF5D-\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC00-\uDC4A\uDC50-\uDC59\uDC80-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDB5\uDDB8-\uDDC0\uDDD8-\uDDDD\uDE00-\uDE40\uDE44\uDE50-\uDE59\uDE80-\uDEB7\uDEC0-\uDEC9\uDF00-\uDF19\uDF1D-\uDF2B\uDF30-\uDF39]|\uD806[\uDCA0-\uDCE9\uDCFF\uDE00-\uDE3E\uDE47\uDE50-\uDE83\uDE86-\uDE99\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC36\uDC38-\uDC40\uDC50-\uDC59\uDC72-\uDC8F\uDC92-\uDCA7\uDCA9-\uDCB6\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD36\uDD3A\uDD3C\uDD3D\uDD3F-\uDD47\uDD50-\uDD59]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50-\uDF7E\uDF8F-\uDF9F\uDFE0\uDFE1]|\uD821[\uDC00-\uDFEC]|\uD822[\uDC00-\uDEF2]|\uD82C[\uDC00-\uDD1E\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9D\uDC9E]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD838[\uDC00-\uDC06\uDC08-\uDC18\uDC1B-\uDC21\uDC23\uDC24\uDC26-\uDC2A]|\uD83A[\uDC00-\uDCC4\uDCD0-\uDCD6\uDD00-\uDD4A\uDD50-\uDD59]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uDB40[\uDD00-\uDDEF]/,We={Space_Separator:Yi,ID_Start:Ki,ID_Continue:Zi},N={isSpaceSeparator(e){return typeof e=="string"&&We.Space_Separator.test(e)},isIdStartChar(e){return typeof e=="string"&&(e>="a"&&e<="z"||e>="A"&&e<="Z"||e==="$"||e==="_"||We.ID_Start.test(e))},isIdContinueChar(e){return typeof e=="string"&&(e>="a"&&e<="z"||e>="A"&&e<="Z"||e>="0"&&e<="9"||e==="$"||e==="_"||e===""||e===""||We.ID_Continue.test(e))},isDigit(e){return typeof e=="string"&&/[0-9]/.test(e)},isHexDigit(e){return typeof e=="string"&&/[0-9A-Fa-f]/.test(e)}};let it,O,z,Te,ee,G,R,Ct,Ee;var Qi=function(t,n){it=String(t),O="start",z=[],Te=0,ee=1,G=0,R=void 0,Ct=void 0,Ee=void 0;do R=es(),us[O]();while(R.type!=="eof");return typeof n=="function"?st({"":Ee},"",n):Ee};function st(e,t,n){const u=e[t];if(u!=null&&typeof u=="object")if(Array.isArray(u))for(let r=0;r<u.length;r++){const i=String(r),s=st(u,i,n);s===void 0?delete u[i]:Object.defineProperty(u,i,{value:s,writable:!0,enumerable:!0,configurable:!0})}else for(const r in u){const i=st(u,r,n);i===void 0?delete u[r]:Object.defineProperty(u,r,{value:i,writable:!0,enumerable:!0,configurable:!0})}return n.call(e,t,u)}let g,F,de,j,m;function es(){for(g="default",F="",de=!1,j=1;;){m=X();const e=gn[g]();if(e)return e}}function X(){if(it[Te])return String.fromCodePoint(it.codePointAt(Te))}function D(){const e=X();return e===`
`?(ee++,G=0):e?G+=e.length:G++,e&&(Te+=e.length),e}const gn={default(){switch(m){case"	":case"\v":case"\f":case" ":case"":case"\uFEFF":case`
`:case"\r":case"\u2028":case"\u2029":D();return;case"/":D(),g="comment";return;case void 0:return D(),$("eof")}if(N.isSpaceSeparator(m)){D();return}return gn[O]()},comment(){switch(m){case"*":D(),g="multiLineComment";return;case"/":D(),g="singleLineComment";return}throw S(D())},multiLineComment(){switch(m){case"*":D(),g="multiLineCommentAsterisk";return;case void 0:throw S(D())}D()},multiLineCommentAsterisk(){switch(m){case"*":D();return;case"/":D(),g="default";return;case void 0:throw S(D())}D(),g="multiLineComment"},singleLineComment(){switch(m){case`
`:case"\r":case"\u2028":case"\u2029":D(),g="default";return;case void 0:return D(),$("eof")}D()},value(){switch(m){case"{":case"[":return $("punctuator",D());case"n":return D(),ne("ull"),$("null",null);case"t":return D(),ne("rue"),$("boolean",!0);case"f":return D(),ne("alse"),$("boolean",!1);case"-":case"+":D()==="-"&&(j=-1),g="sign";return;case".":F=D(),g="decimalPointLeading";return;case"0":F=D(),g="zero";return;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":F=D(),g="decimalInteger";return;case"I":return D(),ne("nfinity"),$("numeric",1/0);case"N":return D(),ne("aN"),$("numeric",NaN);case'"':case"'":de=D()==='"',F="",g="string";return}throw S(D())},identifierNameStartEscape(){if(m!=="u")throw S(D());D();const e=ot();switch(e){case"$":case"_":break;default:if(!N.isIdStartChar(e))throw Gt();break}F+=e,g="identifierName"},identifierName(){switch(m){case"$":case"_":case"":case"":F+=D();return;case"\\":D(),g="identifierNameEscape";return}if(N.isIdContinueChar(m)){F+=D();return}return $("identifier",F)},identifierNameEscape(){if(m!=="u")throw S(D());D();const e=ot();switch(e){case"$":case"_":case"":case"":break;default:if(!N.isIdContinueChar(e))throw Gt();break}F+=e,g="identifierName"},sign(){switch(m){case".":F=D(),g="decimalPointLeading";return;case"0":F=D(),g="zero";return;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":F=D(),g="decimalInteger";return;case"I":return D(),ne("nfinity"),$("numeric",j*(1/0));case"N":return D(),ne("aN"),$("numeric",NaN)}throw S(D())},zero(){switch(m){case".":F+=D(),g="decimalPoint";return;case"e":case"E":F+=D(),g="decimalExponent";return;case"x":case"X":F+=D(),g="hexadecimal";return}return $("numeric",j*0)},decimalInteger(){switch(m){case".":F+=D(),g="decimalPoint";return;case"e":case"E":F+=D(),g="decimalExponent";return}if(N.isDigit(m)){F+=D();return}return $("numeric",j*Number(F))},decimalPointLeading(){if(N.isDigit(m)){F+=D(),g="decimalFraction";return}throw S(D())},decimalPoint(){switch(m){case"e":case"E":F+=D(),g="decimalExponent";return}if(N.isDigit(m)){F+=D(),g="decimalFraction";return}return $("numeric",j*Number(F))},decimalFraction(){switch(m){case"e":case"E":F+=D(),g="decimalExponent";return}if(N.isDigit(m)){F+=D();return}return $("numeric",j*Number(F))},decimalExponent(){switch(m){case"+":case"-":F+=D(),g="decimalExponentSign";return}if(N.isDigit(m)){F+=D(),g="decimalExponentInteger";return}throw S(D())},decimalExponentSign(){if(N.isDigit(m)){F+=D(),g="decimalExponentInteger";return}throw S(D())},decimalExponentInteger(){if(N.isDigit(m)){F+=D();return}return $("numeric",j*Number(F))},hexadecimal(){if(N.isHexDigit(m)){F+=D(),g="hexadecimalInteger";return}throw S(D())},hexadecimalInteger(){if(N.isHexDigit(m)){F+=D();return}return $("numeric",j*Number(F))},string(){switch(m){case"\\":D(),F+=ts();return;case'"':if(de)return D(),$("string",F);F+=D();return;case"'":if(!de)return D(),$("string",F);F+=D();return;case`
`:case"\r":throw S(D());case"\u2028":case"\u2029":rs(m);break;case void 0:throw S(D())}F+=D()},start(){switch(m){case"{":case"[":return $("punctuator",D())}g="value"},beforePropertyName(){switch(m){case"$":case"_":F=D(),g="identifierName";return;case"\\":D(),g="identifierNameStartEscape";return;case"}":return $("punctuator",D());case'"':case"'":de=D()==='"',g="string";return}if(N.isIdStartChar(m)){F+=D(),g="identifierName";return}throw S(D())},afterPropertyName(){if(m===":")return $("punctuator",D());throw S(D())},beforePropertyValue(){g="value"},afterPropertyValue(){switch(m){case",":case"}":return $("punctuator",D())}throw S(D())},beforeArrayValue(){if(m==="]")return $("punctuator",D());g="value"},afterArrayValue(){switch(m){case",":case"]":return $("punctuator",D())}throw S(D())},end(){throw S(D())}};function $(e,t){return{type:e,value:t,line:ee,column:G}}function ne(e){for(const t of e){if(X()!==t)throw S(D());D()}}function ts(){switch(X()){case"b":return D(),"\b";case"f":return D(),"\f";case"n":return D(),`
`;case"r":return D(),"\r";case"t":return D(),"	";case"v":return D(),"\v";case"0":if(D(),N.isDigit(X()))throw S(D());return"\0";case"x":return D(),ns();case"u":return D(),ot();case`
`:case"\u2028":case"\u2029":return D(),"";case"\r":return D(),X()===`
`&&D(),"";case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":throw S(D());case void 0:throw S(D())}return D()}function ns(){let e="",t=X();if(!N.isHexDigit(t)||(e+=D(),t=X(),!N.isHexDigit(t)))throw S(D());return e+=D(),String.fromCodePoint(parseInt(e,16))}function ot(){let e="",t=4;for(;t-- >0;){const n=X();if(!N.isHexDigit(n))throw S(D());e+=D()}return String.fromCodePoint(parseInt(e,16))}const us={start(){if(R.type==="eof")throw ue();Ue()},beforePropertyName(){switch(R.type){case"identifier":case"string":Ct=R.value,O="afterPropertyName";return;case"punctuator":Be();return;case"eof":throw ue()}},afterPropertyName(){if(R.type==="eof")throw ue();O="beforePropertyValue"},beforePropertyValue(){if(R.type==="eof")throw ue();Ue()},beforeArrayValue(){if(R.type==="eof")throw ue();if(R.type==="punctuator"&&R.value==="]"){Be();return}Ue()},afterPropertyValue(){if(R.type==="eof")throw ue();switch(R.value){case",":O="beforePropertyName";return;case"}":Be()}},afterArrayValue(){if(R.type==="eof")throw ue();switch(R.value){case",":O="beforeArrayValue";return;case"]":Be()}},end(){}};function Ue(){let e;switch(R.type){case"punctuator":switch(R.value){case"{":e={};break;case"[":e=[];break}break;case"null":case"boolean":case"numeric":case"string":e=R.value;break}if(Ee===void 0)Ee=e;else{const t=z[z.length-1];Array.isArray(t)?t.push(e):Object.defineProperty(t,Ct,{value:e,writable:!0,enumerable:!0,configurable:!0})}if(e!==null&&typeof e=="object")z.push(e),Array.isArray(e)?O="beforeArrayValue":O="beforePropertyName";else{const t=z[z.length-1];t==null?O="end":Array.isArray(t)?O="afterArrayValue":O="afterPropertyValue"}}function Be(){z.pop();const e=z[z.length-1];e==null?O="end":Array.isArray(e)?O="afterArrayValue":O="afterPropertyValue"}function S(e){return Le(e===void 0?`JSON5: invalid end of input at ${ee}:${G}`:`JSON5: invalid character '${mn(e)}' at ${ee}:${G}`)}function ue(){return Le(`JSON5: invalid end of input at ${ee}:${G}`)}function Gt(){return G-=5,Le(`JSON5: invalid identifier character at ${ee}:${G}`)}function rs(e){console.warn(`JSON5: '${mn(e)}' in strings is not valid ECMAScript; consider escaping`)}function mn(e){const t={"'":"\\'",'"':'\\"',"\\":"\\\\","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t","\v":"\\v","\0":"\\0","\u2028":"\\u2028","\u2029":"\\u2029"};if(t[e])return t[e];if(e<" "){const n=e.charCodeAt(0).toString(16);return"\\x"+("00"+n).substring(n.length)}return e}function Le(e){const t=new SyntaxError(e);return t.lineNumber=ee,t.columnNumber=G,t}var is=function(t,n,u){const r=[];let i="",s,a,o="",c;if(n!=null&&typeof n=="object"&&!Array.isArray(n)&&(u=n.space,c=n.quote,n=n.replacer),typeof n=="function")a=n;else if(Array.isArray(n)){s=[];for(const E of n){let p;typeof E=="string"?p=E:(typeof E=="number"||E instanceof String||E instanceof Number)&&(p=String(E)),p!==void 0&&s.indexOf(p)<0&&s.push(p)}}return u instanceof Number?u=Number(u):u instanceof String&&(u=String(u)),typeof u=="number"?u>0&&(u=Math.min(10,Math.floor(u)),o="          ".substr(0,u)):typeof u=="string"&&(o=u.substr(0,10)),l("",{"":t});function l(E,p){let _=p[E];switch(_!=null&&(typeof _.toJSON5=="function"?_=_.toJSON5(E):typeof _.toJSON=="function"&&(_=_.toJSON(E))),a&&(_=a.call(p,E,_)),_ instanceof Number?_=Number(_):_ instanceof String?_=String(_):_ instanceof Boolean&&(_=_.valueOf()),_){case null:return"null";case!0:return"true";case!1:return"false"}if(typeof _=="string")return f(_);if(typeof _=="number")return String(_);if(typeof _=="object")return Array.isArray(_)?v(_):d(_)}function f(E){const p={"'":.1,'"':.2},_={"'":"\\'",'"':'\\"',"\\":"\\\\","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t","\v":"\\v","\0":"\\0","\u2028":"\\u2028","\u2029":"\\u2029"};let y="";for(let x=0;x<E.length;x++){const I=E[x];switch(I){case"'":case'"':p[I]++,y+=I;continue;case"\0":if(N.isDigit(E[x+1])){y+="\\x00";continue}}if(_[I]){y+=_[I];continue}if(I<" "){let K=I.charCodeAt(0).toString(16);y+="\\x"+("00"+K).substring(K.length);continue}y+=I}const w=c||Object.keys(p).reduce((x,I)=>p[x]<p[I]?x:I);return y=y.replace(new RegExp(w,"g"),_[w]),w+y+w}function d(E){if(r.indexOf(E)>=0)throw TypeError("Converting circular structure to JSON5");r.push(E);let p=i;i=i+o;let _=s||Object.keys(E),y=[];for(const x of _){const I=l(x,E);if(I!==void 0){let K=A(x)+":";o!==""&&(K+=" "),K+=I,y.push(K)}}let w;if(y.length===0)w="{}";else{let x;if(o==="")x=y.join(","),w="{"+x+"}";else{let I=`,
`+i;x=y.join(I),w=`{
`+i+x+`,
`+p+"}"}}return r.pop(),i=p,w}function A(E){if(E.length===0)return f(E);const p=String.fromCodePoint(E.codePointAt(0));if(!N.isIdStartChar(p))return f(E);for(let _=p.length;_<E.length;_++)if(!N.isIdContinueChar(String.fromCodePoint(E.codePointAt(_))))return f(E);return E}function v(E){if(r.indexOf(E)>=0)throw TypeError("Converting circular structure to JSON5");r.push(E);let p=i;i=i+o;let _=[];for(let w=0;w<E.length;w++){const x=l(String(w),E);_.push(x!==void 0?x:"null")}let y;if(_.length===0)y="[]";else if(o==="")y="["+_.join(",")+"]";else{let w=`,
`+i,x=_.join(w);y=`[
`+i+x+`,
`+p+"]"}return r.pop(),i=p,y}};const ss={parse:Qi,stringify:is};var os=ss;const qt="10";async function as(e){const t=await new Promise((u,r)=>{const i=new FileReader;i.onload=s=>{if(!s.target||!s.target.result)return;if(e.name.endsWith(".json5")){const o=os.parse(s.target.result);o.on_load_at_start==null&&(o.on_load_at_start=!1),o.calculate_event_ids==null&&(o.calculate_event_ids=!1),o.room_version==null&&(o.room_version=qt),u(o);return}const a=s.target.result.split(`
`).filter(o=>o.trim().length>0).map(o=>JSON.parse(o));u(a)},i.readAsText(e)});let n;return Array.isArray(t)?n={tardis_version:1,room_version:qt,room_id:t[0].room_id,calculate_event_ids:!1,on_load_at_start:!1,events:t}:n=t,yn(n)}function yn(e){var r,i,s,a;const t={events:[],roomVersion:e.room_version,annotations:e.annotations,precalculatedStateAfter:e.precalculated_state_after,onLoadAtStart:e.on_load_at_start},n=new Map;let u=new Date(2024,0,1).getTime();for(const o of e.events){if(!o)throw new Error("missing event");if(!o.event_id)throw new Error(`event is missing 'event_id', got ${JSON.stringify(o)}`);if(!o.type)throw new Error(`event is missing 'type' field, got ${JSON.stringify(o)}`);if(o.origin_server_ts?u=o.origin_server_ts+1e3:(o.origin_server_ts=u,u+=1e3),!o.room_id&&e.room_id&&(o.room_id=e.room_id),e.calculate_event_ids){const c=o.event_id;for(const f of["prev_events","auth_events"]){const d=[];for(const A of o[f]){const v=n.get(A);v?d.push(v):d.push(A)}o[f]=d}const l=globalThis.gmslEventIDForEvent(JSON.stringify(o),e.room_version);n.set(c,l),o.event_id=l,(i=(r=t.annotations)==null?void 0:r.events)!=null&&i[c]&&(t.annotations.events[l]=t.annotations.events[c]),(a=(s=t.annotations)==null?void 0:s.titles)!=null&&a[c]&&(t.annotations.titles[l]=t.annotations.titles[c])}t.events.push(o)}if(t.precalculatedStateAfter)for(const o in t.precalculatedStateAfter){const c=n.get(o);if(!c){console.error(`precalculated_state_after references ${o} but this does not exist in the events array. Skipping.`);continue}const l=[];for(const f of t.precalculatedStateAfter[o]){const d=n.get(f);d?l.push(d):console.error(`precalculated_state_after for ${o} references ${f} but this does not exist in the events array. Skipping.`)}t.precalculatedStateAfter[c]=l,delete t.precalculatedStateAfter[o]}return console.log(t),t}class cs{constructor(t,n){this.sender=t,this.getEvent=n,this.inflightRequests=new Map}onGetEventRequest(t){const n=this.getEvent(t);return n||console.error(`WS: asked for event ${t.event_id} but didn't find it.`),n}onResolveStateResponse(t,n){const u=this.inflightRequests.get(t);if(!u){console.error(`onResolveStateResponse: no request id for response! id=${t}`);return}n.error&&console.error(t,n.error),u(n),this.inflightRequests.delete(t)}async resolveState(t,n,u,r){console.log("resolveState",u,r);const i=globalThis.crypto.randomUUID();return new Promise((a,o)=>{this.inflightRequests.set(i,c=>{if(!c.result){console.error("State resolved to the empty set"),a({state:{}});return}if(c.error&&c.error!==""){o(c.error);return}a({state:c.result})}),this.sender.sendResolveState(i,{state:u,room_id:t,room_version:n,event:r})})}}class ls{async sendResolveState(t,n){this.sendWs({id:t,type:"resolve_state",data:n})}async connect(t,n){return this.receiver=n,this.ws=new WebSocket(t),new Promise(u=>{this.ws.addEventListener("open",()=>{console.log("WS open"),u()}),this.ws.addEventListener("error",this.onWsError.bind(this)),this.ws.addEventListener("close",this.onWsClose.bind(this)),this.ws.addEventListener("message",this.onWsMessage.bind(this))})}close(){this.ws.close()}sendWs(t){console.log("send",t),this.ws.send(JSON.stringify(t))}onWsClose(t){}onWsError(t){}onWsMessage(t){const n=JSON.parse(t.data);switch(console.log("recv",n),n.type){case"get_event":{const u=n.data,r=this.receiver.onGetEventRequest(u);u.event=r,n.data=u,this.sendWs(n);break}case"resolve_state":{const u=n.data;this.receiver.onResolveStateResponse(n.id,u);break}}}}const Ht={"Quick Start":Fn,"Mainline Ordering":zi,"Reverse Topological Power Ordering":Xi},Q=new In(document.getElementById("eventlist"),document.getElementById("eventlisttemplate"));class Bn{constructor(t){this.cache=t,this.createEventId=null,this.showAuthChain=!1,this.showOutliers=!1,this.collapse=!1,this.renderEvents={}}setShimUrl(t){this.shimUrl=t,console.log("setShimUrl",t)}async loadFile(t){const n=await as(t);this.loadScenario(n)}loadScenario(t){for(const n of t.events)this.cache.eventCache.store(n),n.type==="m.room.create"&&n.state_key===""&&(this.createEventId=n.event_id);if(t.precalculatedStateAfter)for(const n in t.precalculatedStateAfter){const u={};for(const r of t.precalculatedStateAfter[n]){const i=this.cache.eventCache.get(r);if(!i||i.state_key==null){console.log(`precalculated_state_after for ${n} includes ${r} but it isn't a state event we know about. Skipping.`);continue}u[JSON.stringify([i.type,i.state_key])]=i.event_id}this.cache.stateAtEvent.setState(n,u)}this.scenario=t,this.debugger=new kn(t),t.onLoadAtStart&&t.events.length>=2&&this.debugger.goTo(t.events[1].event_id),Q.clear(),t.events.forEach((n,u)=>{Q.appendEvent(u,n)}),Q.highlight(this.debugger.current()),Q.onEventClick(n=>{this.debugger.goTo(n),this.refresh(),Q.highlight(B.debugger.current())}),Q.onEventJsonClick(n=>{document.getElementById("eventdetails").textContent=JSON.stringify(this.cache.eventCache.get(n),null,2),document.getElementById("infocontainer").style.display="block"}),this.refresh()}setShowAuthChain(t){this.showAuthChain=t}setShowOutliers(t){this.showOutliers=t}setCollapse(t){this.collapse=t}async refresh(){let t=Object.create(null);for(const u of this.debugger.eventsUpToCurrent())t[u]=this.cache.eventCache.get(u);this.collapse&&(t=this.collapsifier(t));const n=[];for(const u in t)n.push(t[u]);ji(document.getElementById("svgcontainer"),n,{currentEventId:this.debugger.current(),scenario:this.scenario,stateAtEvent:this.cache.stateAtEvent.getStateAsEventIds(this.debugger.current()),showAuthChain:this.showAuthChain})}findForwardExtremities(t){const n=new Set;for(const u in t)n.add(u);for(const u in t){const r=t[u];for(const i of r.prev_events)n.delete(i);for(const i of r.auth_events)n.delete(i)}return n}collapsifier(t){const n=JSON.parse(JSON.stringify(t)),u=this.findForwardExtremities(n),r=new Set;for(const c of u)r.add(c);const i=Object.create(null);for(const c in n){const l=n[c];for(const f of l.prev_events){const d=i[f]||0;i[f]=d+1}l.prev_events.length!==1&&r.add(l.event_id)}for(const c in i)i[c]>1&&r.add(c);const s=new Set;for(const c in n){if(r.has(c)){s.add(c);continue}const l=n[c];if(r.has(l.prev_events[0])){s.add(c);continue}for(const f of r){const d=n[f];if(!d)continue;let A=!1;for(const v of d.prev_events)if(v===c){s.add(c),A=!0;break}if(A)break}}const a=[],o=new Set;for(const c of u)a.push({id:c,from:c});for(;a.length>0;){const c=a.pop();if(!c)break;const l=c.id,f=n[l];if(o.has(l)||(o.add(l),!f))continue;for(const v of f.prev_events)a.push({id:v,from:c.id});if(s.has(l))continue;delete n[l];const d=n[c.from],A=[f.prev_events[0]];for(const v in d.prev_events)s.has(v)&&A.push(v);d.prev_events=A,d._collapse=d._collapse||0,d._collapse+=1,n[c.from]=d;for(const v of a)v.from===l&&(v.from=d.event_id)}return console.log("collapsifier complete"),n}}const Je=document.getElementById("shimurl");let B=new Bn(new jt);B.setShimUrl(Je.value);const at=new ls,Vt=new cs(at,e=>B.cache.eventCache.get(e.event_id));document.getElementById("showauthevents").addEventListener("change",e=>{B.setShowAuthChain(e.target.checked),B.refresh()});document.getElementById("showauthevents").checked=B.showAuthChain;document.getElementById("showoutliers").addEventListener("change",e=>{B.setShowOutliers(e.target.checked),B.refresh()});document.getElementById("showoutliers").checked=B.showOutliers;document.getElementById("collapse").addEventListener("change",e=>{B.setCollapse(e.target.checked),B.refresh()});document.getElementById("collapse").checked=B.collapse;document.getElementById("jsonfile").addEventListener("change",async e=>{const t=document.getElementById("jsonfile").files;t&&(B=new Bn(new jt),B.setShimUrl(Je.value),await B.loadFile(t[0]))},!1);document.getElementById("closeinfocontainer").addEventListener("click",e=>{document.getElementById("infocontainer").style.display="none"});document.getElementById("infocontainer").style.display="none";document.getElementById("stepfwd").addEventListener("click",async e=>{B.debugger.next(),B.refresh(),Q.highlight(B.debugger.current())});document.getElementById("stepbwd").addEventListener("click",async e=>{B.debugger.previous(),B.refresh(),Q.highlight(B.debugger.current())});Je.addEventListener("change",e=>{const t=e.target.value;B.setShimUrl(t),globalThis.localStorage.setItem("shim_url",t)});const je=globalThis.localStorage.getItem("shim_url");je&&(console.log("setting shim url from local storage"),Je.value=je,B.setShimUrl(je));const Wt=document.getElementById("loader"),Ds=document.getElementById("loader-status"),we=e=>{Ds.innerText=e};document.getElementById("resolve").addEventListener("click",async e=>{if(!B.shimUrl)return console.error("you need to set a shim url to resolve state!"),{};Wt.style.display="block",we(`Connecting to ${B.shimUrl}`);try{await at.connect(B.shimUrl,Vt),await B.debugger.resolve(B.cache,async(t,n,u,r)=>{try{return we(`Resolving state at event ${r.event_id}`),(await Vt.resolveState(t,n,u,r)).state}catch(i){throw console.error("failed to resolve state:",i),we(`Failed to resolve state at event ${r.event_id} : ${i}`),i}}),we("")}catch(t){console.error("resolving state failed: ",t)}finally{at.close()}Wt.style.display="none",B.refresh()});const Ut=new Go;WebAssembly.instantiateStreaming(fetch("gmsl.wasm"),Ut.importObject).then(e=>{globalThis.wasm=e.instance,Ut.run(globalThis.wasm);const t=u=>{const r=yn(u);B.loadScenario(r)},n=document.getElementById("file-select");n&&(n.innerHTML="",Object.keys(Ht).forEach((u,r)=>{n[r]=new Option(u)}),n.addEventListener("change",u=>{var i;const r=Ht[(i=u==null?void 0:u.target)==null?void 0:i.value];t(r)})),t(Fn)});
