var kr=Object.defineProperty;var Ir=(e,t,n)=>t in e?kr(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var V=(e,t,n)=>Ir(e,typeof t!="symbol"?t+"":t,n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))u(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const s of i.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&u(s)}).observe(document,{childList:!0,subtree:!0});function n(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function u(r){if(r.ep)return;r.ep=!0;const i=n(r);fetch(r.href,i)}})();function Mr(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Yt,Wn;function Or(){if(Wn)return Yt;Wn=1;function e(a){return a instanceof Map?a.clear=a.delete=a.set=function(){throw new Error("map is read-only")}:a instanceof Set&&(a.add=a.clear=a.delete=function(){throw new Error("set is read-only")}),Object.freeze(a),Object.getOwnPropertyNames(a).forEach(h=>{const _=a[h],N=typeof _;(N==="object"||N==="function")&&!Object.isFrozen(_)&&e(_)}),a}class t{constructor(h){h.data===void 0&&(h.data={}),this.data=h.data,this.isMatchIgnored=!1}ignoreMatch(){this.isMatchIgnored=!0}}function n(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;")}function u(a,...h){const _=Object.create(null);for(const N in a)_[N]=a[N];return h.forEach(function(N){for(const Z in N)_[Z]=N[Z]}),_}const r="</span>",i=a=>!!a.scope,s=(a,{prefix:h})=>{if(a.startsWith("language:"))return a.replace("language:","language-");if(a.includes(".")){const _=a.split(".");return[`${h}${_.shift()}`,..._.map((N,Z)=>`${N}${"_".repeat(Z+1)}`)].join(" ")}return`${h}${a}`};class o{constructor(h,_){this.buffer="",this.classPrefix=_.classPrefix,h.walk(this)}addText(h){this.buffer+=n(h)}openNode(h){if(!i(h))return;const _=s(h.scope,{prefix:this.classPrefix});this.span(_)}closeNode(h){i(h)&&(this.buffer+=r)}value(){return this.buffer}span(h){this.buffer+=`<span class="${h}">`}}const l=(a={})=>{const h={children:[]};return Object.assign(h,a),h};class c{constructor(){this.rootNode=l(),this.stack=[this.rootNode]}get top(){return this.stack[this.stack.length-1]}get root(){return this.rootNode}add(h){this.top.children.push(h)}openNode(h){const _=l({scope:h});this.add(_),this.stack.push(_)}closeNode(){if(this.stack.length>1)return this.stack.pop()}closeAllNodes(){for(;this.closeNode(););}toJSON(){return JSON.stringify(this.rootNode,null,4)}walk(h){return this.constructor._walk(h,this.rootNode)}static _walk(h,_){return typeof _=="string"?h.addText(_):_.children&&(h.openNode(_),_.children.forEach(N=>this._walk(h,N)),h.closeNode(_)),h}static _collapse(h){typeof h!="string"&&h.children&&(h.children.every(_=>typeof _=="string")?h.children=[h.children.join("")]:h.children.forEach(_=>{c._collapse(_)}))}}class f extends c{constructor(h){super(),this.options=h}addText(h){h!==""&&this.add(h)}startScope(h){this.openNode(h)}endScope(){this.closeNode()}__addSublanguage(h,_){const N=h.root;_&&(N.scope=`language:${_}`),this.add(N)}toHTML(){return new o(this,this.options).value()}finalize(){return this.closeAllNodes(),!0}}function D(a){return a?typeof a=="string"?a:a.source:null}function g(a){return y("(?=",a,")")}function A(a){return y("(?:",a,")*")}function T(a){return y("(?:",a,")?")}function y(...a){return a.map(_=>D(_)).join("")}function O(a){const h=a[a.length-1];return typeof h=="object"&&h.constructor===Object?(a.splice(a.length-1,1),h):{}}function v(...a){return"("+(O(a).capture?"":"?:")+a.map(N=>D(N)).join("|")+")"}function x(a){return new RegExp(a.toString()+"|").exec("").length-1}function S(a,h){const _=a&&a.exec(h);return _&&_.index===0}const j=/\[(?:[^\\\]]|\\.)*\]|\(\??|\\([1-9][0-9]*)|\\./;function W(a,{joinWith:h}){let _=0;return a.map(N=>{_+=1;const Z=_;let Q=D(N),w="";for(;Q.length>0;){const m=j.exec(Q);if(!m){w+=Q;break}w+=Q.substring(0,m.index),Q=Q.substring(m.index+m[0].length),m[0][0]==="\\"&&m[1]?w+="\\"+String(Number(m[1])+Z):(w+=m[0],m[0]==="("&&_++)}return w}).map(N=>`(${N})`).join(h)}const ge=/\b\B/,Dt="[a-zA-Z]\\w*",Ie="[a-zA-Z_]\\w*",Ye="\\b\\d+(\\.\\d+)?",pe="(-?)(\\b0[xX][a-fA-F0-9]+|(\\b\\d+(\\.\\d*)?|\\.\\d+)([eE][-+]?\\d+)?)",qe="\\b(0b[01]+)",Ze="!|!=|!==|%|%=|&|&&|&=|\\*|\\*=|\\+|\\+=|,|-|-=|/=|/|:|;|<<|<<=|<=|<|===|==|=|>>>=|>>=|>=|>>>|>>|>|\\?|\\[|\\{|\\(|\\^|\\^=|\\||\\|=|\\|\\||~",jt=(a={})=>{const h=/^#![ ]*\//;return a.binary&&(a.begin=y(h,/.*\b/,a.binary,/\b.*/)),u({scope:"meta",begin:h,end:/$/,relevance:0,"on:begin":(_,N)=>{_.index!==0&&N.ignoreMatch()}},a)},be={begin:"\\\\[\\s\\S]",relevance:0},dt={scope:"string",begin:"'",end:"'",illegal:"\\n",contains:[be]},Et={scope:"string",begin:'"',end:'"',illegal:"\\n",contains:[be]},gt={begin:/\b(a|an|the|are|I'm|isn't|don't|doesn't|won't|but|just|should|pretty|simply|enough|gonna|going|wtf|so|such|will|you|your|they|like|more)\b/},Me=function(a,h,_={}){const N=u({scope:"comment",begin:a,end:h,contains:[]},_);N.contains.push({scope:"doctag",begin:"[ ]*(?=(TODO|FIXME|NOTE|BUG|OPTIMIZE|HACK|XXX):)",end:/(TODO|FIXME|NOTE|BUG|OPTIMIZE|HACK|XXX):/,excludeBegin:!0,relevance:0});const Z=v("I","a","is","so","us","to","at","if","in","it","on",/[A-Za-z]+['](d|ve|re|ll|t|s|n)/,/[A-Za-z]+[-][a-z]+/,/[A-Za-z][a-z]{2,}/);return N.contains.push({begin:y(/[ ]+/,"(",Z,/[.]?[:]?([.][ ]|[ ])/,"){3}")}),N},pt=Me("//","$"),_t=Me("/\\*","\\*/"),E=Me("#","$"),F={scope:"number",begin:Ye,relevance:0},L={scope:"number",begin:pe,relevance:0},K={scope:"number",begin:qe,relevance:0},te={scope:"regexp",begin:/\/(?=[^/\n]*\/)/,end:/\/[gimuy]*/,contains:[be,{begin:/\[/,end:/\]/,relevance:0,contains:[be]}]},Y={scope:"title",begin:Dt,relevance:0},le={scope:"title",begin:Ie,relevance:0},Gt={begin:"\\.\\s*"+Ie,relevance:0};var Oe=Object.freeze({__proto__:null,APOS_STRING_MODE:dt,BACKSLASH_ESCAPE:be,BINARY_NUMBER_MODE:K,BINARY_NUMBER_RE:qe,COMMENT:Me,C_BLOCK_COMMENT_MODE:_t,C_LINE_COMMENT_MODE:pt,C_NUMBER_MODE:L,C_NUMBER_RE:pe,END_SAME_AS_BEGIN:function(a){return Object.assign(a,{"on:begin":(h,_)=>{_.data._beginMatch=h[1]},"on:end":(h,_)=>{_.data._beginMatch!==h[1]&&_.ignoreMatch()}})},HASH_COMMENT_MODE:E,IDENT_RE:Dt,MATCH_NOTHING_RE:ge,METHOD_GUARD:Gt,NUMBER_MODE:F,NUMBER_RE:Ye,PHRASAL_WORDS_MODE:gt,QUOTE_STRING_MODE:Et,REGEXP_MODE:te,RE_STARTERS_RE:Ze,SHEBANG:jt,TITLE_MODE:Y,UNDERSCORE_IDENT_RE:Ie,UNDERSCORE_TITLE_MODE:le});function Xu(a,h){a.input[a.index-1]==="."&&h.ignoreMatch()}function Ku(a,h){a.className!==void 0&&(a.scope=a.className,delete a.className)}function Yu(a,h){h&&a.beginKeywords&&(a.begin="\\b("+a.beginKeywords.split(" ").join("|")+")(?!\\.)(?=\\b|\\s)",a.__beforeBegin=Xu,a.keywords=a.keywords||a.beginKeywords,delete a.beginKeywords,a.relevance===void 0&&(a.relevance=0))}function Zu(a,h){Array.isArray(a.illegal)&&(a.illegal=v(...a.illegal))}function Qu(a,h){if(a.match){if(a.begin||a.end)throw new Error("begin & end are not supported with match");a.begin=a.match,delete a.match}}function er(a,h){a.relevance===void 0&&(a.relevance=1)}const tr=(a,h)=>{if(!a.beforeMatch)return;if(a.starts)throw new Error("beforeMatch cannot be used with starts");const _=Object.assign({},a);Object.keys(a).forEach(N=>{delete a[N]}),a.keywords=_.keywords,a.begin=y(_.beforeMatch,g(_.begin)),a.starts={relevance:0,contains:[Object.assign(_,{endsParent:!0})]},a.relevance=0,delete _.beforeMatch},nr=["of","and","for","in","not","or","if","then","parent","list","value"],ur="keyword";function $n(a,h,_=ur){const N=Object.create(null);return typeof a=="string"?Z(_,a.split(" ")):Array.isArray(a)?Z(_,a):Object.keys(a).forEach(function(Q){Object.assign(N,$n(a[Q],h,Q))}),N;function Z(Q,w){h&&(w=w.map(m=>m.toLowerCase())),w.forEach(function(m){const $=m.split("|");N[$[0]]=[Q,rr($[0],$[1])]})}}function rr(a,h){return h?Number(h):ir(a)?0:1}function ir(a){return nr.includes(a.toLowerCase())}const Nn={},Te=a=>{console.error(a)},Rn=(a,...h)=>{console.log(`WARN: ${a}`,...h)},We=(a,h)=>{Nn[`${a}/${h}`]||(console.log(`Deprecated as of ${a}. ${h}`),Nn[`${a}/${h}`]=!0)},At=new Error;function kn(a,h,{key:_}){let N=0;const Z=a[_],Q={},w={};for(let m=1;m<=h.length;m++)w[m+N]=Z[m],Q[m+N]=!0,N+=x(h[m-1]);a[_]=w,a[_]._emit=Q,a[_]._multi=!0}function sr(a){if(Array.isArray(a.begin)){if(a.skip||a.excludeBegin||a.returnBegin)throw Te("skip, excludeBegin, returnBegin not compatible with beginScope: {}"),At;if(typeof a.beginScope!="object"||a.beginScope===null)throw Te("beginScope must be object"),At;kn(a,a.begin,{key:"beginScope"}),a.begin=W(a.begin,{joinWith:""})}}function or(a){if(Array.isArray(a.end)){if(a.skip||a.excludeEnd||a.returnEnd)throw Te("skip, excludeEnd, returnEnd not compatible with endScope: {}"),At;if(typeof a.endScope!="object"||a.endScope===null)throw Te("endScope must be object"),At;kn(a,a.end,{key:"endScope"}),a.end=W(a.end,{joinWith:""})}}function ar(a){a.scope&&typeof a.scope=="object"&&a.scope!==null&&(a.beginScope=a.scope,delete a.scope)}function cr(a){ar(a),typeof a.beginScope=="string"&&(a.beginScope={_wrap:a.beginScope}),typeof a.endScope=="string"&&(a.endScope={_wrap:a.endScope}),sr(a),or(a)}function lr(a){function h(w,m){return new RegExp(D(w),"m"+(a.case_insensitive?"i":"")+(a.unicodeRegex?"u":"")+(m?"g":""))}class _{constructor(){this.matchIndexes={},this.regexes=[],this.matchAt=1,this.position=0}addRule(m,$){$.position=this.position++,this.matchIndexes[this.matchAt]=$,this.regexes.push([$,m]),this.matchAt+=x(m)+1}compile(){this.regexes.length===0&&(this.exec=()=>null);const m=this.regexes.map($=>$[1]);this.matcherRe=h(W(m,{joinWith:"|"}),!0),this.lastIndex=0}exec(m){this.matcherRe.lastIndex=this.lastIndex;const $=this.matcherRe.exec(m);if(!$)return null;const re=$.findIndex((Qe,qt)=>qt>0&&Qe!==void 0),ne=this.matchIndexes[re];return $.splice(0,re),Object.assign($,ne)}}class N{constructor(){this.rules=[],this.multiRegexes=[],this.count=0,this.lastIndex=0,this.regexIndex=0}getMatcher(m){if(this.multiRegexes[m])return this.multiRegexes[m];const $=new _;return this.rules.slice(m).forEach(([re,ne])=>$.addRule(re,ne)),$.compile(),this.multiRegexes[m]=$,$}resumingScanAtSamePosition(){return this.regexIndex!==0}considerAll(){this.regexIndex=0}addRule(m,$){this.rules.push([m,$]),$.type==="begin"&&this.count++}exec(m){const $=this.getMatcher(this.regexIndex);$.lastIndex=this.lastIndex;let re=$.exec(m);if(this.resumingScanAtSamePosition()&&!(re&&re.index===this.lastIndex)){const ne=this.getMatcher(0);ne.lastIndex=this.lastIndex+1,re=ne.exec(m)}return re&&(this.regexIndex+=re.position+1,this.regexIndex===this.count&&this.considerAll()),re}}function Z(w){const m=new N;return w.contains.forEach($=>m.addRule($.begin,{rule:$,type:"begin"})),w.terminatorEnd&&m.addRule(w.terminatorEnd,{type:"end"}),w.illegal&&m.addRule(w.illegal,{type:"illegal"}),m}function Q(w,m){const $=w;if(w.isCompiled)return $;[Ku,Qu,cr,tr].forEach(ne=>ne(w,m)),a.compilerExtensions.forEach(ne=>ne(w,m)),w.__beforeBegin=null,[Yu,Zu,er].forEach(ne=>ne(w,m)),w.isCompiled=!0;let re=null;return typeof w.keywords=="object"&&w.keywords.$pattern&&(w.keywords=Object.assign({},w.keywords),re=w.keywords.$pattern,delete w.keywords.$pattern),re=re||/\w+/,w.keywords&&(w.keywords=$n(w.keywords,a.case_insensitive)),$.keywordPatternRe=h(re,!0),m&&(w.begin||(w.begin=/\B|\b/),$.beginRe=h($.begin),!w.end&&!w.endsWithParent&&(w.end=/\B|\b/),w.end&&($.endRe=h($.end)),$.terminatorEnd=D($.end)||"",w.endsWithParent&&m.terminatorEnd&&($.terminatorEnd+=(w.end?"|":"")+m.terminatorEnd)),w.illegal&&($.illegalRe=h(w.illegal)),w.contains||(w.contains=[]),w.contains=[].concat(...w.contains.map(function(ne){return fr(ne==="self"?w:ne)})),w.contains.forEach(function(ne){Q(ne,$)}),w.starts&&Q(w.starts,m),$.matcher=Z($),$}if(a.compilerExtensions||(a.compilerExtensions=[]),a.contains&&a.contains.includes("self"))throw new Error("ERR: contains `self` is not supported at the top-level of a language.  See documentation.");return a.classNameAliases=u(a.classNameAliases||{}),Q(a)}function In(a){return a?a.endsWithParent||In(a.starts):!1}function fr(a){return a.variants&&!a.cachedVariants&&(a.cachedVariants=a.variants.map(function(h){return u(a,{variants:null},h)})),a.cachedVariants?a.cachedVariants:In(a)?u(a,{starts:a.starts?u(a.starts):null}):Object.isFrozen(a)?u(a):a}var hr="11.11.1";class Dr extends Error{constructor(h,_){super(h),this.name="HTMLInjectionError",this.html=_}}const Ut=n,Mn=u,On=Symbol("nomatch"),dr=7,Tn=function(a){const h=Object.create(null),_=Object.create(null),N=[];let Z=!0;const Q="Could not find the language '{}', did you forget to load/include a language module?",w={disableAutodetect:!0,name:"Plain text",contains:[]};let m={ignoreUnescapedHTML:!1,throwUnescapedHTML:!1,noHighlightRe:/^(no-?highlight)$/i,languageDetectRe:/\blang(?:uage)?-([\w-]+)\b/i,classPrefix:"hljs-",cssSelector:"pre code",languages:null,__emitter:f};function $(p){return m.noHighlightRe.test(p)}function re(p){let b=p.className+" ";b+=p.parentNode?p.parentNode.className:"";const H=m.languageDetectRe.exec(b);if(H){const U=Se(H[1]);return U||(Rn(Q.replace("{}",H[1])),Rn("Falling back to no-highlight mode for this block.",p)),U?H[1]:"no-highlight"}return b.split(/\s+/).find(U=>$(U)||Se(U))}function ne(p,b,H){let U="",ue="";typeof b=="object"?(U=p,H=b.ignoreIllegals,ue=b.language):(We("10.7.0","highlight(lang, code, ...args) has been deprecated."),We("10.7.0",`Please use highlight(code, options) instead.
https://github.com/highlightjs/highlight.js/issues/2277`),ue=p,U=b),H===void 0&&(H=!0);const De={code:U,language:ue};Ct("before:highlight",De);const $e=De.result?De.result:Qe(De.language,De.code,H);return $e.code=De.code,Ct("after:highlight",$e),$e}function Qe(p,b,H,U){const ue=Object.create(null);function De(C,B){return C.keywords[B]}function $e(){if(!R.keywords){se.addText(q);return}let C=0;R.keywordPatternRe.lastIndex=0;let B=R.keywordPatternRe.exec(q),M="";for(;B;){M+=q.substring(C,B.index);const G=Ae.case_insensitive?B[0].toLowerCase():B[0],oe=De(R,G);if(oe){const[me,Nr]=oe;if(se.addText(M),M="",ue[G]=(ue[G]||0)+1,ue[G]<=dr&&(yt+=Nr),me.startsWith("_"))M+=B[0];else{const Rr=Ae.classNameAliases[me]||me;_e(B[0],Rr)}}else M+=B[0];C=R.keywordPatternRe.lastIndex,B=R.keywordPatternRe.exec(q)}M+=q.substring(C),se.addText(M)}function Ft(){if(q==="")return;let C=null;if(typeof R.subLanguage=="string"){if(!h[R.subLanguage]){se.addText(q);return}C=Qe(R.subLanguage,q,!0,qn[R.subLanguage]),qn[R.subLanguage]=C._top}else C=Wt(q,R.subLanguage.length?R.subLanguage:null);R.relevance>0&&(yt+=C.relevance),se.__addSublanguage(C._emitter,C.language)}function fe(){R.subLanguage!=null?Ft():$e(),q=""}function _e(C,B){C!==""&&(se.startScope(B),se.addText(C),se.endScope())}function Jn(C,B){let M=1;const G=B.length-1;for(;M<=G;){if(!C._emit[M]){M++;continue}const oe=Ae.classNameAliases[C[M]]||C[M],me=B[M];oe?_e(me,oe):(q=me,$e(),q=""),M++}}function jn(C,B){return C.scope&&typeof C.scope=="string"&&se.openNode(Ae.classNameAliases[C.scope]||C.scope),C.beginScope&&(C.beginScope._wrap?(_e(q,Ae.classNameAliases[C.beginScope._wrap]||C.beginScope._wrap),q=""):C.beginScope._multi&&(Jn(C.beginScope,B),q="")),R=Object.create(C,{parent:{value:R}}),R}function Gn(C,B,M){let G=S(C.endRe,M);if(G){if(C["on:end"]){const oe=new t(C);C["on:end"](B,oe),oe.isMatchIgnored&&(G=!1)}if(G){for(;C.endsParent&&C.parent;)C=C.parent;return C}}if(C.endsWithParent)return Gn(C.parent,B,M)}function Br(C){return R.matcher.regexIndex===0?(q+=C[0],1):(Kt=!0,0)}function xr(C){const B=C[0],M=C.rule,G=new t(M),oe=[M.__beforeBegin,M["on:begin"]];for(const me of oe)if(me&&(me(C,G),G.isMatchIgnored))return Br(B);return M.skip?q+=B:(M.excludeBegin&&(q+=B),fe(),!M.returnBegin&&!M.excludeBegin&&(q=B)),jn(M,C),M.returnBegin?0:B.length}function br(C){const B=C[0],M=b.substring(C.index),G=Gn(R,C,M);if(!G)return On;const oe=R;R.endScope&&R.endScope._wrap?(fe(),_e(B,R.endScope._wrap)):R.endScope&&R.endScope._multi?(fe(),Jn(R.endScope,C)):oe.skip?q+=B:(oe.returnEnd||oe.excludeEnd||(q+=B),fe(),oe.excludeEnd&&(q=B));do R.scope&&se.closeNode(),!R.skip&&!R.subLanguage&&(yt+=R.relevance),R=R.parent;while(R!==G.parent);return G.starts&&jn(G.starts,C),oe.returnEnd?0:B.length}function Sr(){const C=[];for(let B=R;B!==Ae;B=B.parent)B.scope&&C.unshift(B.scope);C.forEach(B=>se.openNode(B))}let mt={};function Un(C,B){const M=B&&B[0];if(q+=C,M==null)return fe(),0;if(mt.type==="begin"&&B.type==="end"&&mt.index===B.index&&M===""){if(q+=b.slice(B.index,B.index+1),!Z){const G=new Error(`0 width match regex (${p})`);throw G.languageName=p,G.badRule=mt.rule,G}return 1}if(mt=B,B.type==="begin")return xr(B);if(B.type==="illegal"&&!H){const G=new Error('Illegal lexeme "'+M+'" for mode "'+(R.scope||"<unnamed>")+'"');throw G.mode=R,G}else if(B.type==="end"){const G=br(B);if(G!==On)return G}if(B.type==="illegal"&&M==="")return q+=`
`,1;if(Xt>1e5&&Xt>B.index*3)throw new Error("potential infinite loop, way more iterations than matches");return q+=M,M.length}const Ae=Se(p);if(!Ae)throw Te(Q.replace("{}",p)),new Error('Unknown language: "'+p+'"');const $r=lr(Ae);let zt="",R=U||$r;const qn={},se=new m.__emitter(m);Sr();let q="",yt=0,Le=0,Xt=0,Kt=!1;try{if(Ae.__emitTokens)Ae.__emitTokens(b,se);else{for(R.matcher.considerAll();;){Xt++,Kt?Kt=!1:R.matcher.considerAll(),R.matcher.lastIndex=Le;const C=R.matcher.exec(b);if(!C)break;const B=b.substring(Le,C.index),M=Un(B,C);Le=C.index+M}Un(b.substring(Le))}return se.finalize(),zt=se.toHTML(),{language:p,value:zt,relevance:yt,illegal:!1,_emitter:se,_top:R}}catch(C){if(C.message&&C.message.includes("Illegal"))return{language:p,value:Ut(b),illegal:!0,relevance:0,_illegalBy:{message:C.message,index:Le,context:b.slice(Le-100,Le+100),mode:C.mode,resultSoFar:zt},_emitter:se};if(Z)return{language:p,value:Ut(b),illegal:!1,relevance:0,errorRaised:C,_emitter:se,_top:R};throw C}}function qt(p){const b={value:Ut(p),illegal:!1,relevance:0,_top:w,_emitter:new m.__emitter(m)};return b._emitter.addText(p),b}function Wt(p,b){b=b||m.languages||Object.keys(h);const H=qt(p),U=b.filter(Se).filter(Hn).map(fe=>Qe(fe,p,!1));U.unshift(H);const ue=U.sort((fe,_e)=>{if(fe.relevance!==_e.relevance)return _e.relevance-fe.relevance;if(fe.language&&_e.language){if(Se(fe.language).supersetOf===_e.language)return 1;if(Se(_e.language).supersetOf===fe.language)return-1}return 0}),[De,$e]=ue,Ft=De;return Ft.secondBest=$e,Ft}function Er(p,b,H){const U=b&&_[b]||H;p.classList.add("hljs"),p.classList.add(`language-${U}`)}function Vt(p){let b=null;const H=re(p);if($(H))return;if(Ct("before:highlightElement",{el:p,language:H}),p.dataset.highlighted){console.log("Element previously highlighted. To highlight again, first unset `dataset.highlighted`.",p);return}if(p.children.length>0&&(m.ignoreUnescapedHTML||(console.warn("One of your code blocks includes unescaped HTML. This is a potentially serious security risk."),console.warn("https://github.com/highlightjs/highlight.js/wiki/security"),console.warn("The element with unescaped HTML:"),console.warn(p)),m.throwUnescapedHTML))throw new Dr("One of your code blocks includes unescaped HTML.",p.innerHTML);b=p;const U=b.textContent,ue=H?ne(U,{language:H,ignoreIllegals:!0}):Wt(U);p.innerHTML=ue.value,p.dataset.highlighted="yes",Er(p,H,ue.language),p.result={language:ue.language,re:ue.relevance,relevance:ue.relevance},ue.secondBest&&(p.secondBest={language:ue.secondBest.language,relevance:ue.secondBest.relevance}),Ct("after:highlightElement",{el:p,result:ue,text:U})}function gr(p){m=Mn(m,p)}const pr=()=>{vt(),We("10.6.0","initHighlighting() deprecated.  Use highlightAll() now.")};function _r(){vt(),We("10.6.0","initHighlightingOnLoad() deprecated.  Use highlightAll() now.")}let Ln=!1;function vt(){function p(){vt()}if(document.readyState==="loading"){Ln||window.addEventListener("DOMContentLoaded",p,!1),Ln=!0;return}document.querySelectorAll(m.cssSelector).forEach(Vt)}function Ar(p,b){let H=null;try{H=b(a)}catch(U){if(Te("Language definition for '{}' could not be registered.".replace("{}",p)),Z)Te(U);else throw U;H=w}H.name||(H.name=p),h[p]=H,H.rawDefinition=b.bind(null,a),H.aliases&&Pn(H.aliases,{languageName:p})}function vr(p){delete h[p];for(const b of Object.keys(_))_[b]===p&&delete _[b]}function Cr(){return Object.keys(h)}function Se(p){return p=(p||"").toLowerCase(),h[p]||h[_[p]]}function Pn(p,{languageName:b}){typeof p=="string"&&(p=[p]),p.forEach(H=>{_[H.toLowerCase()]=b})}function Hn(p){const b=Se(p);return b&&!b.disableAutodetect}function Fr(p){p["before:highlightBlock"]&&!p["before:highlightElement"]&&(p["before:highlightElement"]=b=>{p["before:highlightBlock"](Object.assign({block:b.el},b))}),p["after:highlightBlock"]&&!p["after:highlightElement"]&&(p["after:highlightElement"]=b=>{p["after:highlightBlock"](Object.assign({block:b.el},b))})}function mr(p){Fr(p),N.push(p)}function yr(p){const b=N.indexOf(p);b!==-1&&N.splice(b,1)}function Ct(p,b){const H=p;N.forEach(function(U){U[H]&&U[H](b)})}function wr(p){return We("10.7.0","highlightBlock will be removed entirely in v12.0"),We("10.7.0","Please use highlightElement now."),Vt(p)}Object.assign(a,{highlight:ne,highlightAuto:Wt,highlightAll:vt,highlightElement:Vt,highlightBlock:wr,configure:gr,initHighlighting:pr,initHighlightingOnLoad:_r,registerLanguage:Ar,unregisterLanguage:vr,listLanguages:Cr,getLanguage:Se,registerAliases:Pn,autoDetection:Hn,inherit:Mn,addPlugin:mr,removePlugin:yr}),a.debugMode=function(){Z=!1},a.safeMode=function(){Z=!0},a.versionString=hr,a.regex={concat:y,lookahead:g,either:v,optional:T,anyNumberOfTimes:A};for(const p in Oe)typeof Oe[p]=="object"&&e(Oe[p]);return Object.assign(a,Oe),a},Ve=Tn({});return Ve.newInstance=()=>Tn({}),Yt=Ve,Ve.HighlightJS=Ve,Ve.default=Ve,Yt}var Tr=Or();const gu=Mr(Tr);function Lr(e){const t={className:"attr",begin:/"(\\.|[^\\"\r\n])*"(?=\s*:)/,relevance:1.01},n={match:/[{}[\],:]/,className:"punctuation",relevance:0},u=["true","false","null"],r={scope:"literal",beginKeywords:u.join(" ")};return{name:"JSON",aliases:["jsonc"],keywords:{literal:u},contains:[t,n,e.QUOTE_STRING_MODE,r,e.C_NUMBER_MODE,e.C_LINE_COMMENT_MODE,e.C_BLOCK_COMMENT_MODE],illegal:"\\S"}}function Pr(e){const t=[1,2,3,4,5,6,7,8,9,10,15,20,50,Number.POSITIVE_INFINITY],n=new Map(t.map(c=>[c,0])),u=new Map(t.map(c=>[c,0]));let r=0;const i=new Set,s=new Set;for(const c of e.events){if(i.add(c.event_id),c.prev_auth_events===void 0){console.error(`printAuthDagAnalysis: event ${c.event_id} has no prev_auth_events. Bailing.`);return}if(c.prev_auth_events.length>r&&(r=c.prev_auth_events.length),c.prev_auth_events.length===0)continue;for(const D of c.prev_auth_events)s.add(D);let f=c.prev_auth_events.length;c.prev_auth_events.length>10&&(c.prev_auth_events.length<=15?f=15:c.prev_auth_events.length<=20?f=20:c.prev_auth_events.length<=50?f=50:f=Number.POSITIVE_INFINITY),u.set(f,(u.get(f)||0)+1);for(const D of t){if(D>f)break;n.set(D,(n.get(D)||0)+1)}}const o=["Auth DAG Analysis:",`Max prev_auth_events: ${r}`,"Histogram:"];u.forEach((c,f)=>{o.push(`${f} ${c}`)}),o.push("CDF:"),n.forEach((c,f)=>{o.push(`${f} ${c}`)});const l=s.isSubsetOf(i);o.push(`Connected: ${l}`),console.log(o.join(`
`))}function Hr(e){const t=JSON.stringify(e),n=new TextEncoder().encode(t);return Gr(n)}function Jr(e){const t=jr(e),n=new TextDecoder().decode(t);return JSON.parse(n)}function jr(e){const t=e.replace(/\-/g,"+").replace(/_/g,"/"),n=atob(t);return Uint8Array.from(n,(u,r)=>u.codePointAt(0))}function Gr(e){const t=String.fromCodePoint(...e);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}class pu{constructor(){V(this,"stateAtEvent");V(this,"eventCache");this.stateAtEvent=new Ur,this.eventCache=new qr}}class Ur{constructor(){V(this,"state");this.state={}}setState(t,n){this.state[t]=n,console.log(`StateAtEvent ${t} is`,n)}getStateAsEventIds(t){return this.state[t]?new Set(Object.values(this.state[t])):new Set}getState(t){return this.state[t]?JSON.parse(JSON.stringify(this.state[t])):{}}getInverseStateForEventIds(t){const n={};for(const u of t){const r=this.getStateAsEventIds(u);for(const i of r){const s=n[i]||new Set;s.add(u),n[i]=s}}return n}}class qr{constructor(){V(this,"cache");this.cache=new Map}store(t){this.cache.set(t.event_id,t)}get(t){return this.cache.get(t)}}class Wr{constructor(t){V(this,"index");V(this,"eventIdOrdering");V(this,"currentEventId");this.scenario=t,this.index=t.events.length-1,this.eventIdOrdering=t.events.map(n=>n.event_id),this.currentEventId=this.eventIdOrdering[this.index]}next(){this.index++,this.index>=this.eventIdOrdering.length&&(this.index=this.eventIdOrdering.length-1),this.currentEventId=this.eventIdOrdering[this.index]}previous(){this.index--,this.index<0&&(this.index=0),this.currentEventId=this.eventIdOrdering[this.index]}goTo(t){for(let n=0;n<this.eventIdOrdering.length;n++)if(this.eventIdOrdering[n]===t){this.index=n,this.currentEventId=this.eventIdOrdering[this.index];break}}current(){return this.currentEventId}eventsUpToCurrent(){const t=[];for(let n=0;n<=this.index;n++)t.push(this.eventIdOrdering[n]);return t}async resolve(t,n){for(const u of this.eventsUpToCurrent())await this.resolveEvent(u,t,n)}async resolveEvent(t,n,u){if(n.stateAtEvent.getStateAsEventIds(t).size>0)return;const r=n.eventCache.get(t),i=[];for(const o of r.prev_events){const l=n.stateAtEvent.getState(o);Object.keys(l).length===0&&console.error(`WARN: we do not know the state at ${o} yet, so the state calculation for ${t} may be wrong!`),i.push(l)}console.log("performing state resolution for prev_events:",r.prev_events);const s=await u(r.room_id,this.scenario.roomVersion,i,r);n.stateAtEvent.setState(t,s)}}class Vr{constructor(t,n){V(this,"highlightedEventId");V(this,"positionListener");V(this,"jsonListener");this.container=t,this.template=n}clear(){this.container.innerHTML=""}onEventClick(t){this.positionListener=t}onEventJsonClick(t){this.jsonListener=t}onCellClick(t){this.onClick(t,this.positionListener)}onJsonClick(t){t.stopPropagation(),this.onClick(t,this.jsonListener)}onClick(t,n){var i;const u=(i=t.target)==null?void 0:i.parentElement;if(!u)return;const r=u.getAttribute("id");r&&n&&n(r)}appendEvent(t,n){const u=this.template.content.firstElementChild.cloneNode(!0);u.setAttribute("id",n.event_id);const r=u.getElementsByClassName("eventlistrowprefix")[0];r.textContent=String(t),u.addEventListener("click",this.onCellClick.bind(this)),u.getElementsByClassName("eventlistrowjson")[0].addEventListener("click",this.onJsonClick.bind(this)),u.getElementsByClassName("eventlistrowbody")[0].textContent=_u(n),u.getElementsByClassName("eventlistroweventid")[0].textContent=n.event_id.substr(0,5),n.state_key!=null&&(u.style.fontWeight="600"),this.container.appendChild(u)}highlight(t){if(this.highlightedEventId){const n=document.getElementById(this.highlightedEventId);n&&(n.style.backgroundColor="")}document.getElementById(t).style.backgroundColor="#6f8ea9",this.highlightedEventId=t}}function _u(e){var u;let t="",n="";if(e.state_key!=null)switch(e.type){case"m.room.create":t=`by ${e.content.creator}`;break;case"m.room.member":t=`${e.state_key}=${e.content.membership}`;break;case"m.room.join_rules":t=`(${e.content.join_rule})`;break;case"m.room.history_visibility":t=`(${e.content.history_visibility})`;break;case"m.room.name":t=`(${e.content.name})`;break;case"m.room.topic":t=`(${e.content.topic})`;break;default:e.state_key!==""&&(t=e.state_key)}else switch(e.type){case"m.reaction":n=(u=e.content["m.relates_to"])==null?void 0:u.key;break;case"m.room.message":n=e.content.body;break}return`${e.type} ${t}${n}`}var zr={value:()=>{}};function Au(){for(var e=0,t=arguments.length,n={},u;e<t;++e){if(!(u=arguments[e]+"")||u in n||/[\s.]/.test(u))throw new Error("illegal type: "+u);n[u]=[]}return new bt(n)}function bt(e){this._=e}function Xr(e,t){return e.trim().split(/^|\s+/).map(function(n){var u="",r=n.indexOf(".");if(r>=0&&(u=n.slice(r+1),n=n.slice(0,r)),n&&!t.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:u}})}bt.prototype=Au.prototype={constructor:bt,on:function(e,t){var n=this._,u=Xr(e+"",n),r,i=-1,s=u.length;if(arguments.length<2){for(;++i<s;)if((r=(e=u[i]).type)&&(r=Kr(n[r],e.name)))return r;return}if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++i<s;)if(r=(e=u[i]).type)n[r]=Vn(n[r],e.name,t);else if(t==null)for(r in n)n[r]=Vn(n[r],e.name,null);return this},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new bt(e)},call:function(e,t){if((r=arguments.length-2)>0)for(var n=new Array(r),u=0,r,i;u<r;++u)n[u]=arguments[u+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(i=this._[e],u=0,r=i.length;u<r;++u)i[u].value.apply(t,n)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var u=this._[e],r=0,i=u.length;r<i;++r)u[r].value.apply(t,n)}};function Kr(e,t){for(var n=0,u=e.length,r;n<u;++n)if((r=e[n]).name===t)return r.value}function Vn(e,t,n){for(var u=0,r=e.length;u<r;++u)if(e[u].name===t){e[u]=zr,e=e.slice(0,u).concat(e.slice(u+1));break}return n!=null&&e.push({name:t,value:n}),e}var sn="http://www.w3.org/1999/xhtml";const zn={svg:"http://www.w3.org/2000/svg",xhtml:sn,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Lt(e){var t=e+="",n=t.indexOf(":");return n>=0&&(t=e.slice(0,n))!=="xmlns"&&(e=e.slice(n+1)),zn.hasOwnProperty(t)?{space:zn[t],local:e}:e}function Yr(e){return function(){var t=this.ownerDocument,n=this.namespaceURI;return n===sn&&t.documentElement.namespaceURI===sn?t.createElement(e):t.createElementNS(n,e)}}function Zr(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function vu(e){var t=Lt(e);return(t.local?Zr:Yr)(t)}function Qr(){}function Cn(e){return e==null?Qr:function(){return this.querySelector(e)}}function ei(e){typeof e!="function"&&(e=Cn(e));for(var t=this._groups,n=t.length,u=new Array(n),r=0;r<n;++r)for(var i=t[r],s=i.length,o=u[r]=new Array(s),l,c,f=0;f<s;++f)(l=i[f])&&(c=e.call(l,l.__data__,f,i))&&("__data__"in l&&(c.__data__=l.__data__),o[f]=c);return new ae(u,this._parents)}function Fn(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function ti(){return[]}function Cu(e){return e==null?ti:function(){return this.querySelectorAll(e)}}function ni(e){return function(){var t=e.apply(this,arguments);return t==null?[]:Fn(t)}}function ui(e){typeof e=="function"?e=ni(e):e=Cu(e);for(var t=this._groups,n=t.length,u=[],r=[],i=0;i<n;++i)for(var s=t[i],o=s.length,l,c=0;c<o;++c)(l=s[c])&&(u.push(e.call(l,l.__data__,c,s)),r.push(l));return new ae(u,r)}function Fu(e){return function(){return this.matches(e)}}function mu(e){return function(t){return t.matches(e)}}var ri=Array.prototype.find;function ii(e){return function(){return ri.call(this.children,e)}}function si(){return this.firstElementChild}function oi(e){return this.select(e==null?si:ii(typeof e=="function"?e:mu(e)))}var ai=Array.prototype.filter;function ci(){return this.children}function li(e){return function(){return ai.call(this.children,e)}}function fi(e){return this.selectAll(e==null?ci:li(typeof e=="function"?e:mu(e)))}function hi(e){typeof e!="function"&&(e=Fu(e));for(var t=this._groups,n=t.length,u=new Array(n),r=0;r<n;++r)for(var i=t[r],s=i.length,o=u[r]=[],l,c=0;c<s;++c)(l=i[c])&&e.call(l,l.__data__,c,i)&&o.push(l);return new ae(u,this._parents)}function yu(e){return new Array(e.length)}function Di(){return new ae(this._enter||this._groups.map(yu),this._parents)}function Nt(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}Nt.prototype={constructor:Nt,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};function di(e){return function(){return e}}function Ei(e,t,n,u,r,i){for(var s=0,o,l=t.length,c=i.length;s<c;++s)(o=t[s])?(o.__data__=i[s],u[s]=o):n[s]=new Nt(e,i[s]);for(;s<l;++s)(o=t[s])&&(r[s]=o)}function gi(e,t,n,u,r,i,s){var o,l,c=new Map,f=t.length,D=i.length,g=new Array(f),A;for(o=0;o<f;++o)(l=t[o])&&(g[o]=A=s.call(l,l.__data__,o,t)+"",c.has(A)?r[o]=l:c.set(A,l));for(o=0;o<D;++o)A=s.call(e,i[o],o,i)+"",(l=c.get(A))?(u[o]=l,l.__data__=i[o],c.delete(A)):n[o]=new Nt(e,i[o]);for(o=0;o<f;++o)(l=t[o])&&c.get(g[o])===l&&(r[o]=l)}function pi(e){return e.__data__}function _i(e,t){if(!arguments.length)return Array.from(this,pi);var n=t?gi:Ei,u=this._parents,r=this._groups;typeof e!="function"&&(e=di(e));for(var i=r.length,s=new Array(i),o=new Array(i),l=new Array(i),c=0;c<i;++c){var f=u[c],D=r[c],g=D.length,A=Fn(e.call(f,f&&f.__data__,c,u)),T=A.length,y=o[c]=new Array(T),O=s[c]=new Array(T),v=l[c]=new Array(g);n(f,D,y,O,v,A,t);for(var x=0,S=0,j,W;x<T;++x)if(j=y[x]){for(x>=S&&(S=x+1);!(W=O[S])&&++S<T;);j._next=W||null}}return s=new ae(s,u),s._enter=o,s._exit=l,s}function Ai(){return new ae(this._exit||this._groups.map(yu),this._parents)}function vi(e,t,n){var u=this.enter(),r=this,i=this.exit();return u=typeof e=="function"?e(u):u.append(e+""),t!=null&&(r=t(r)),n==null?i.remove():n(i),u&&r?u.merge(r).order():r}function Ci(e){if(!(e instanceof ae))throw new Error("invalid merge");for(var t=this._groups,n=e._groups,u=t.length,r=n.length,i=Math.min(u,r),s=new Array(u),o=0;o<i;++o)for(var l=t[o],c=n[o],f=l.length,D=s[o]=new Array(f),g,A=0;A<f;++A)(g=l[A]||c[A])&&(D[A]=g);for(;o<u;++o)s[o]=t[o];return new ae(s,this._parents)}function Fi(){for(var e=this._groups,t=-1,n=e.length;++t<n;)for(var u=e[t],r=u.length-1,i=u[r],s;--r>=0;)(s=u[r])&&(i&&s.compareDocumentPosition(i)^4&&i.parentNode.insertBefore(s,i),i=s);return this}function mi(e){e||(e=yi);function t(D,g){return D&&g?e(D.__data__,g.__data__):!D-!g}for(var n=this._groups,u=n.length,r=new Array(u),i=0;i<u;++i){for(var s=n[i],o=s.length,l=r[i]=new Array(o),c,f=0;f<o;++f)(c=s[f])&&(l[f]=c);l.sort(t)}return new ae(r,this._parents).order()}function yi(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function wi(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this}function Bi(){return Array.from(this)}function xi(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var u=e[t],r=0,i=u.length;r<i;++r){var s=u[r];if(s)return s}return null}function bi(){let e=0;for(const t of this)++e;return e}function Si(){return!this.node()}function $i(e){for(var t=this._groups,n=0,u=t.length;n<u;++n)for(var r=t[n],i=0,s=r.length,o;i<s;++i)(o=r[i])&&e.call(o,o.__data__,i,r);return this}function Ni(e){return function(){this.removeAttribute(e)}}function Ri(e){return function(){this.removeAttributeNS(e.space,e.local)}}function ki(e,t){return function(){this.setAttribute(e,t)}}function Ii(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function Mi(e,t){return function(){var n=t.apply(this,arguments);n==null?this.removeAttribute(e):this.setAttribute(e,n)}}function Oi(e,t){return function(){var n=t.apply(this,arguments);n==null?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}}function Ti(e,t){var n=Lt(e);if(arguments.length<2){var u=this.node();return n.local?u.getAttributeNS(n.space,n.local):u.getAttribute(n)}return this.each((t==null?n.local?Ri:Ni:typeof t=="function"?n.local?Oi:Mi:n.local?Ii:ki)(n,t))}function wu(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function Li(e){return function(){this.style.removeProperty(e)}}function Pi(e,t,n){return function(){this.style.setProperty(e,t,n)}}function Hi(e,t,n){return function(){var u=t.apply(this,arguments);u==null?this.style.removeProperty(e):this.style.setProperty(e,u,n)}}function Ji(e,t,n){return arguments.length>1?this.each((t==null?Li:typeof t=="function"?Hi:Pi)(e,t,n??"")):Xe(this.node(),e)}function Xe(e,t){return e.style.getPropertyValue(t)||wu(e).getComputedStyle(e,null).getPropertyValue(t)}function ji(e){return function(){delete this[e]}}function Gi(e,t){return function(){this[e]=t}}function Ui(e,t){return function(){var n=t.apply(this,arguments);n==null?delete this[e]:this[e]=n}}function qi(e,t){return arguments.length>1?this.each((t==null?ji:typeof t=="function"?Ui:Gi)(e,t)):this.node()[e]}function Bu(e){return e.trim().split(/^|\s+/)}function mn(e){return e.classList||new xu(e)}function xu(e){this._node=e,this._names=Bu(e.getAttribute("class")||"")}xu.prototype={add:function(e){var t=this._names.indexOf(e);t<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};function bu(e,t){for(var n=mn(e),u=-1,r=t.length;++u<r;)n.add(t[u])}function Su(e,t){for(var n=mn(e),u=-1,r=t.length;++u<r;)n.remove(t[u])}function Wi(e){return function(){bu(this,e)}}function Vi(e){return function(){Su(this,e)}}function zi(e,t){return function(){(t.apply(this,arguments)?bu:Su)(this,e)}}function Xi(e,t){var n=Bu(e+"");if(arguments.length<2){for(var u=mn(this.node()),r=-1,i=n.length;++r<i;)if(!u.contains(n[r]))return!1;return!0}return this.each((typeof t=="function"?zi:t?Wi:Vi)(n,t))}function Ki(){this.textContent=""}function Yi(e){return function(){this.textContent=e}}function Zi(e){return function(){var t=e.apply(this,arguments);this.textContent=t??""}}function Qi(e){return arguments.length?this.each(e==null?Ki:(typeof e=="function"?Zi:Yi)(e)):this.node().textContent}function es(){this.innerHTML=""}function ts(e){return function(){this.innerHTML=e}}function ns(e){return function(){var t=e.apply(this,arguments);this.innerHTML=t??""}}function us(e){return arguments.length?this.each(e==null?es:(typeof e=="function"?ns:ts)(e)):this.node().innerHTML}function rs(){this.nextSibling&&this.parentNode.appendChild(this)}function is(){return this.each(rs)}function ss(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function os(){return this.each(ss)}function as(e){var t=typeof e=="function"?e:vu(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})}function cs(){return null}function ls(e,t){var n=typeof e=="function"?e:vu(e),u=t==null?cs:typeof t=="function"?t:Cn(t);return this.select(function(){return this.insertBefore(n.apply(this,arguments),u.apply(this,arguments)||null)})}function fs(){var e=this.parentNode;e&&e.removeChild(this)}function hs(){return this.each(fs)}function Ds(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function ds(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function Es(e){return this.select(e?ds:Ds)}function gs(e){return arguments.length?this.property("__data__",e):this.node().__data__}function ps(e){return function(t){e.call(this,t,this.__data__)}}function _s(e){return e.trim().split(/^|\s+/).map(function(t){var n="",u=t.indexOf(".");return u>=0&&(n=t.slice(u+1),t=t.slice(0,u)),{type:t,name:n}})}function As(e){return function(){var t=this.__on;if(t){for(var n=0,u=-1,r=t.length,i;n<r;++n)i=t[n],(!e.type||i.type===e.type)&&i.name===e.name?this.removeEventListener(i.type,i.listener,i.options):t[++u]=i;++u?t.length=u:delete this.__on}}}function vs(e,t,n){return function(){var u=this.__on,r,i=ps(t);if(u){for(var s=0,o=u.length;s<o;++s)if((r=u[s]).type===e.type&&r.name===e.name){this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=i,r.options=n),r.value=t;return}}this.addEventListener(e.type,i,n),r={type:e.type,name:e.name,value:t,listener:i,options:n},u?u.push(r):this.__on=[r]}}function Cs(e,t,n){var u=_s(e+""),r,i=u.length,s;if(arguments.length<2){var o=this.node().__on;if(o){for(var l=0,c=o.length,f;l<c;++l)for(r=0,f=o[l];r<i;++r)if((s=u[r]).type===f.type&&s.name===f.name)return f.value}return}for(o=t?vs:As,r=0;r<i;++r)this.each(o(u[r],t,n));return this}function $u(e,t,n){var u=wu(e),r=u.CustomEvent;typeof r=="function"?r=new r(t,n):(r=u.document.createEvent("Event"),n?(r.initEvent(t,n.bubbles,n.cancelable),r.detail=n.detail):r.initEvent(t,!1,!1)),e.dispatchEvent(r)}function Fs(e,t){return function(){return $u(this,e,t)}}function ms(e,t){return function(){return $u(this,e,t.apply(this,arguments))}}function ys(e,t){return this.each((typeof t=="function"?ms:Fs)(e,t))}function*ws(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var u=e[t],r=0,i=u.length,s;r<i;++r)(s=u[r])&&(yield s)}var yn=[null];function ae(e,t){this._groups=e,this._parents=t}function ft(){return new ae([[document.documentElement]],yn)}function Bs(){return this}ae.prototype=ft.prototype={constructor:ae,select:ei,selectAll:ui,selectChild:oi,selectChildren:fi,filter:hi,data:_i,enter:Di,exit:Ai,join:vi,merge:Ci,selection:Bs,order:Fi,sort:mi,call:wi,nodes:Bi,node:xi,size:bi,empty:Si,each:$i,attr:Ti,style:Ji,property:qi,classed:Xi,text:Qi,html:us,raise:is,lower:os,append:as,insert:ls,remove:hs,clone:Es,datum:gs,on:Cs,dispatch:ys,[Symbol.iterator]:ws};function et(e){return typeof e=="string"?new ae([[document.querySelector(e)]],[document.documentElement]):new ae([[e]],yn)}function xs(e){return typeof e=="string"?new ae([document.querySelectorAll(e)],[document.documentElement]):new ae([e==null?[]:Fn(e)],yn)}function wn(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function Nu(e,t){var n=Object.create(e.prototype);for(var u in t)n[u]=t[u];return n}function ht(){}var ot=.7,Rt=1/ot,ze="\\s*([+-]?\\d+)\\s*",at="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",Ce="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",bs=/^#([0-9a-f]{3,8})$/,Ss=new RegExp("^rgb\\("+[ze,ze,ze]+"\\)$"),$s=new RegExp("^rgb\\("+[Ce,Ce,Ce]+"\\)$"),Ns=new RegExp("^rgba\\("+[ze,ze,ze,at]+"\\)$"),Rs=new RegExp("^rgba\\("+[Ce,Ce,Ce,at]+"\\)$"),ks=new RegExp("^hsl\\("+[at,Ce,Ce]+"\\)$"),Is=new RegExp("^hsla\\("+[at,Ce,Ce,at]+"\\)$"),Xn={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};wn(ht,ct,{copy:function(e){return Object.assign(new this.constructor,this,e)},displayable:function(){return this.rgb().displayable()},hex:Kn,formatHex:Kn,formatHsl:Ms,formatRgb:Yn,toString:Yn});function Kn(){return this.rgb().formatHex()}function Ms(){return Ru(this).formatHsl()}function Yn(){return this.rgb().formatRgb()}function ct(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=bs.exec(e))?(n=t[1].length,t=parseInt(t[1],16),n===6?Zn(t):n===3?new he(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):n===8?wt(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):n===4?wt(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=Ss.exec(e))?new he(t[1],t[2],t[3],1):(t=$s.exec(e))?new he(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=Ns.exec(e))?wt(t[1],t[2],t[3],t[4]):(t=Rs.exec(e))?wt(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=ks.exec(e))?tu(t[1],t[2]/100,t[3]/100,1):(t=Is.exec(e))?tu(t[1],t[2]/100,t[3]/100,t[4]):Xn.hasOwnProperty(e)?Zn(Xn[e]):e==="transparent"?new he(NaN,NaN,NaN,0):null}function Zn(e){return new he(e>>16&255,e>>8&255,e&255,1)}function wt(e,t,n,u){return u<=0&&(e=t=n=NaN),new he(e,t,n,u)}function Os(e){return e instanceof ht||(e=ct(e)),e?(e=e.rgb(),new he(e.r,e.g,e.b,e.opacity)):new he}function on(e,t,n,u){return arguments.length===1?Os(e):new he(e,t,n,u??1)}function he(e,t,n,u){this.r=+e,this.g=+t,this.b=+n,this.opacity=+u}wn(he,on,Nu(ht,{brighter:function(e){return e=e==null?Rt:Math.pow(Rt,e),new he(this.r*e,this.g*e,this.b*e,this.opacity)},darker:function(e){return e=e==null?ot:Math.pow(ot,e),new he(this.r*e,this.g*e,this.b*e,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Qn,formatHex:Qn,formatRgb:eu,toString:eu}));function Qn(){return"#"+Zt(this.r)+Zt(this.g)+Zt(this.b)}function eu(){var e=this.opacity;return e=isNaN(e)?1:Math.max(0,Math.min(1,e)),(e===1?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(e===1?")":", "+e+")")}function Zt(e){return e=Math.max(0,Math.min(255,Math.round(e)||0)),(e<16?"0":"")+e.toString(16)}function tu(e,t,n,u){return u<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new ve(e,t,n,u)}function Ru(e){if(e instanceof ve)return new ve(e.h,e.s,e.l,e.opacity);if(e instanceof ht||(e=ct(e)),!e)return new ve;if(e instanceof ve)return e;e=e.rgb();var t=e.r/255,n=e.g/255,u=e.b/255,r=Math.min(t,n,u),i=Math.max(t,n,u),s=NaN,o=i-r,l=(i+r)/2;return o?(t===i?s=(n-u)/o+(n<u)*6:n===i?s=(u-t)/o+2:s=(t-n)/o+4,o/=l<.5?i+r:2-i-r,s*=60):o=l>0&&l<1?0:s,new ve(s,o,l,e.opacity)}function Ts(e,t,n,u){return arguments.length===1?Ru(e):new ve(e,t,n,u??1)}function ve(e,t,n,u){this.h=+e,this.s=+t,this.l=+n,this.opacity=+u}wn(ve,Ts,Nu(ht,{brighter:function(e){return e=e==null?Rt:Math.pow(Rt,e),new ve(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=e==null?ot:Math.pow(ot,e),new ve(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,u=n+(n<.5?n:1-n)*t,r=2*n-u;return new he(Qt(e>=240?e-240:e+120,r,u),Qt(e,r,u),Qt(e<120?e+240:e-120,r,u),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var e=this.opacity;return e=isNaN(e)?1:Math.max(0,Math.min(1,e)),(e===1?"hsl(":"hsla(")+(this.h||0)+", "+(this.s||0)*100+"%, "+(this.l||0)*100+"%"+(e===1?")":", "+e+")")}}));function Qt(e,t,n){return(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)*255}const ku=e=>()=>e;function Ls(e,t){return function(n){return e+n*t}}function Ps(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(u){return Math.pow(e+u*t,n)}}function Hs(e){return(e=+e)==1?Iu:function(t,n){return n-t?Ps(t,n,e):ku(isNaN(t)?n:t)}}function Iu(e,t){var n=t-e;return n?Ls(e,n):ku(isNaN(e)?t:e)}const nu=function e(t){var n=Hs(t);function u(r,i){var s=n((r=on(r)).r,(i=on(i)).r),o=n(r.g,i.g),l=n(r.b,i.b),c=Iu(r.opacity,i.opacity);return function(f){return r.r=s(f),r.g=o(f),r.b=l(f),r.opacity=c(f),r+""}}return u.gamma=e,u}(1);function Ne(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}var an=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,en=new RegExp(an.source,"g");function Js(e){return function(){return e}}function js(e){return function(t){return e(t)+""}}function Gs(e,t){var n=an.lastIndex=en.lastIndex=0,u,r,i,s=-1,o=[],l=[];for(e=e+"",t=t+"";(u=an.exec(e))&&(r=en.exec(t));)(i=r.index)>n&&(i=t.slice(n,i),o[s]?o[s]+=i:o[++s]=i),(u=u[0])===(r=r[0])?o[s]?o[s]+=r:o[++s]=r:(o[++s]=null,l.push({i:s,x:Ne(u,r)})),n=en.lastIndex;return n<t.length&&(i=t.slice(n),o[s]?o[s]+=i:o[++s]=i),o.length<2?l[0]?js(l[0].x):Js(t):(t=l.length,function(c){for(var f=0,D;f<t;++f)o[(D=l[f]).i]=D.x(c);return o.join("")})}var uu=180/Math.PI,cn={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Mu(e,t,n,u,r,i){var s,o,l;return(s=Math.sqrt(e*e+t*t))&&(e/=s,t/=s),(l=e*n+t*u)&&(n-=e*l,u-=t*l),(o=Math.sqrt(n*n+u*u))&&(n/=o,u/=o,l/=o),e*u<t*n&&(e=-e,t=-t,l=-l,s=-s),{translateX:r,translateY:i,rotate:Math.atan2(t,e)*uu,skewX:Math.atan(l)*uu,scaleX:s,scaleY:o}}var Bt;function Us(e){const t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?cn:Mu(t.a,t.b,t.c,t.d,t.e,t.f)}function qs(e){return e==null||(Bt||(Bt=document.createElementNS("http://www.w3.org/2000/svg","g")),Bt.setAttribute("transform",e),!(e=Bt.transform.baseVal.consolidate()))?cn:(e=e.matrix,Mu(e.a,e.b,e.c,e.d,e.e,e.f))}function Ou(e,t,n,u){function r(c){return c.length?c.pop()+" ":""}function i(c,f,D,g,A,T){if(c!==D||f!==g){var y=A.push("translate(",null,t,null,n);T.push({i:y-4,x:Ne(c,D)},{i:y-2,x:Ne(f,g)})}else(D||g)&&A.push("translate("+D+t+g+n)}function s(c,f,D,g){c!==f?(c-f>180?f+=360:f-c>180&&(c+=360),g.push({i:D.push(r(D)+"rotate(",null,u)-2,x:Ne(c,f)})):f&&D.push(r(D)+"rotate("+f+u)}function o(c,f,D,g){c!==f?g.push({i:D.push(r(D)+"skewX(",null,u)-2,x:Ne(c,f)}):f&&D.push(r(D)+"skewX("+f+u)}function l(c,f,D,g,A,T){if(c!==D||f!==g){var y=A.push(r(A)+"scale(",null,",",null,")");T.push({i:y-4,x:Ne(c,D)},{i:y-2,x:Ne(f,g)})}else(D!==1||g!==1)&&A.push(r(A)+"scale("+D+","+g+")")}return function(c,f){var D=[],g=[];return c=e(c),f=e(f),i(c.translateX,c.translateY,f.translateX,f.translateY,D,g),s(c.rotate,f.rotate,D,g),o(c.skewX,f.skewX,D,g),l(c.scaleX,c.scaleY,f.scaleX,f.scaleY,D,g),c=f=null,function(A){for(var T=-1,y=g.length,O;++T<y;)D[(O=g[T]).i]=O.x(A);return D.join("")}}}var Ws=Ou(Us,"px, ","px)","deg)"),Vs=Ou(qs,", ",")",")"),Ke=0,nt=0,tt=0,Tu=1e3,kt,ut,It=0,Ue=0,Pt=0,lt=typeof performance=="object"&&performance.now?performance:Date,Lu=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function Bn(){return Ue||(Lu(zs),Ue=lt.now()+Pt)}function zs(){Ue=0}function Mt(){this._call=this._time=this._next=null}Mt.prototype=Pu.prototype={constructor:Mt,restart:function(e,t,n){if(typeof e!="function")throw new TypeError("callback is not a function");n=(n==null?Bn():+n)+(t==null?0:+t),!this._next&&ut!==this&&(ut?ut._next=this:kt=this,ut=this),this._call=e,this._time=n,ln()},stop:function(){this._call&&(this._call=null,this._time=1/0,ln())}};function Pu(e,t,n){var u=new Mt;return u.restart(e,t,n),u}function Xs(){Bn(),++Ke;for(var e=kt,t;e;)(t=Ue-e._time)>=0&&e._call.call(null,t),e=e._next;--Ke}function ru(){Ue=(It=lt.now())+Pt,Ke=nt=0;try{Xs()}finally{Ke=0,Ys(),Ue=0}}function Ks(){var e=lt.now(),t=e-It;t>Tu&&(Pt-=t,It=e)}function Ys(){for(var e,t=kt,n,u=1/0;t;)t._call?(u>t._time&&(u=t._time),e=t,t=t._next):(n=t._next,t._next=null,t=e?e._next=n:kt=n);ut=e,ln(u)}function ln(e){if(!Ke){nt&&(nt=clearTimeout(nt));var t=e-Ue;t>24?(e<1/0&&(nt=setTimeout(ru,e-lt.now()-Pt)),tt&&(tt=clearInterval(tt))):(tt||(It=lt.now(),tt=setInterval(Ks,Tu)),Ke=1,Lu(ru))}}function iu(e,t,n){var u=new Mt;return t=t==null?0:+t,u.restart(r=>{u.stop(),e(r+t)},t,n),u}var Zs=Au("start","end","cancel","interrupt"),Qs=[],Hu=0,su=1,fn=2,St=3,ou=4,hn=5,$t=6;function Ht(e,t,n,u,r,i){var s=e.__transition;if(!s)e.__transition={};else if(n in s)return;eo(e,n,{name:t,index:u,group:r,on:Zs,tween:Qs,time:i.time,delay:i.delay,duration:i.duration,ease:i.ease,timer:null,state:Hu})}function xn(e,t){var n=Ee(e,t);if(n.state>Hu)throw new Error("too late; already scheduled");return n}function Fe(e,t){var n=Ee(e,t);if(n.state>St)throw new Error("too late; already running");return n}function Ee(e,t){var n=e.__transition;if(!n||!(n=n[t]))throw new Error("transition not found");return n}function eo(e,t,n){var u=e.__transition,r;u[t]=n,n.timer=Pu(i,0,n.time);function i(c){n.state=su,n.timer.restart(s,n.delay,n.time),n.delay<=c&&s(c-n.delay)}function s(c){var f,D,g,A;if(n.state!==su)return l();for(f in u)if(A=u[f],A.name===n.name){if(A.state===St)return iu(s);A.state===ou?(A.state=$t,A.timer.stop(),A.on.call("interrupt",e,e.__data__,A.index,A.group),delete u[f]):+f<t&&(A.state=$t,A.timer.stop(),A.on.call("cancel",e,e.__data__,A.index,A.group),delete u[f])}if(iu(function(){n.state===St&&(n.state=ou,n.timer.restart(o,n.delay,n.time),o(c))}),n.state=fn,n.on.call("start",e,e.__data__,n.index,n.group),n.state===fn){for(n.state=St,r=new Array(g=n.tween.length),f=0,D=-1;f<g;++f)(A=n.tween[f].value.call(e,e.__data__,n.index,n.group))&&(r[++D]=A);r.length=D+1}}function o(c){for(var f=c<n.duration?n.ease.call(null,c/n.duration):(n.timer.restart(l),n.state=hn,1),D=-1,g=r.length;++D<g;)r[D].call(e,f);n.state===hn&&(n.on.call("end",e,e.__data__,n.index,n.group),l())}function l(){n.state=$t,n.timer.stop(),delete u[t];for(var c in u)return;delete e.__transition}}function to(e,t){var n=e.__transition,u,r,i=!0,s;if(n){t=t==null?null:t+"";for(s in n){if((u=n[s]).name!==t){i=!1;continue}r=u.state>fn&&u.state<hn,u.state=$t,u.timer.stop(),u.on.call(r?"interrupt":"cancel",e,e.__data__,u.index,u.group),delete n[s]}i&&delete e.__transition}}function no(e){return this.each(function(){to(this,e)})}function uo(e,t){var n,u;return function(){var r=Fe(this,e),i=r.tween;if(i!==n){u=n=i;for(var s=0,o=u.length;s<o;++s)if(u[s].name===t){u=u.slice(),u.splice(s,1);break}}r.tween=u}}function ro(e,t,n){var u,r;if(typeof n!="function")throw new Error;return function(){var i=Fe(this,e),s=i.tween;if(s!==u){r=(u=s).slice();for(var o={name:t,value:n},l=0,c=r.length;l<c;++l)if(r[l].name===t){r[l]=o;break}l===c&&r.push(o)}i.tween=r}}function io(e,t){var n=this._id;if(e+="",arguments.length<2){for(var u=Ee(this.node(),n).tween,r=0,i=u.length,s;r<i;++r)if((s=u[r]).name===e)return s.value;return null}return this.each((t==null?uo:ro)(n,e,t))}function bn(e,t,n){var u=e._id;return e.each(function(){var r=Fe(this,u);(r.value||(r.value={}))[t]=n.apply(this,arguments)}),function(r){return Ee(r,u).value[t]}}function Ju(e,t){var n;return(typeof t=="number"?Ne:t instanceof ct?nu:(n=ct(t))?(t=n,nu):Gs)(e,t)}function so(e){return function(){this.removeAttribute(e)}}function oo(e){return function(){this.removeAttributeNS(e.space,e.local)}}function ao(e,t,n){var u,r=n+"",i;return function(){var s=this.getAttribute(e);return s===r?null:s===u?i:i=t(u=s,n)}}function co(e,t,n){var u,r=n+"",i;return function(){var s=this.getAttributeNS(e.space,e.local);return s===r?null:s===u?i:i=t(u=s,n)}}function lo(e,t,n){var u,r,i;return function(){var s,o=n(this),l;return o==null?void this.removeAttribute(e):(s=this.getAttribute(e),l=o+"",s===l?null:s===u&&l===r?i:(r=l,i=t(u=s,o)))}}function fo(e,t,n){var u,r,i;return function(){var s,o=n(this),l;return o==null?void this.removeAttributeNS(e.space,e.local):(s=this.getAttributeNS(e.space,e.local),l=o+"",s===l?null:s===u&&l===r?i:(r=l,i=t(u=s,o)))}}function ho(e,t){var n=Lt(e),u=n==="transform"?Vs:Ju;return this.attrTween(e,typeof t=="function"?(n.local?fo:lo)(n,u,bn(this,"attr."+e,t)):t==null?(n.local?oo:so)(n):(n.local?co:ao)(n,u,t))}function Do(e,t){return function(n){this.setAttribute(e,t.call(this,n))}}function Eo(e,t){return function(n){this.setAttributeNS(e.space,e.local,t.call(this,n))}}function go(e,t){var n,u;function r(){var i=t.apply(this,arguments);return i!==u&&(n=(u=i)&&Eo(e,i)),n}return r._value=t,r}function po(e,t){var n,u;function r(){var i=t.apply(this,arguments);return i!==u&&(n=(u=i)&&Do(e,i)),n}return r._value=t,r}function _o(e,t){var n="attr."+e;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(t==null)return this.tween(n,null);if(typeof t!="function")throw new Error;var u=Lt(e);return this.tween(n,(u.local?go:po)(u,t))}function Ao(e,t){return function(){xn(this,e).delay=+t.apply(this,arguments)}}function vo(e,t){return t=+t,function(){xn(this,e).delay=t}}function Co(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?Ao:vo)(t,e)):Ee(this.node(),t).delay}function Fo(e,t){return function(){Fe(this,e).duration=+t.apply(this,arguments)}}function mo(e,t){return t=+t,function(){Fe(this,e).duration=t}}function yo(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?Fo:mo)(t,e)):Ee(this.node(),t).duration}function wo(e,t){if(typeof t!="function")throw new Error;return function(){Fe(this,e).ease=t}}function Bo(e){var t=this._id;return arguments.length?this.each(wo(t,e)):Ee(this.node(),t).ease}function xo(e,t){return function(){var n=t.apply(this,arguments);if(typeof n!="function")throw new Error;Fe(this,e).ease=n}}function bo(e){if(typeof e!="function")throw new Error;return this.each(xo(this._id,e))}function So(e){typeof e!="function"&&(e=Fu(e));for(var t=this._groups,n=t.length,u=new Array(n),r=0;r<n;++r)for(var i=t[r],s=i.length,o=u[r]=[],l,c=0;c<s;++c)(l=i[c])&&e.call(l,l.__data__,c,i)&&o.push(l);return new xe(u,this._parents,this._name,this._id)}function $o(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,n=e._groups,u=t.length,r=n.length,i=Math.min(u,r),s=new Array(u),o=0;o<i;++o)for(var l=t[o],c=n[o],f=l.length,D=s[o]=new Array(f),g,A=0;A<f;++A)(g=l[A]||c[A])&&(D[A]=g);for(;o<u;++o)s[o]=t[o];return new xe(s,this._parents,this._name,this._id)}function No(e){return(e+"").trim().split(/^|\s+/).every(function(t){var n=t.indexOf(".");return n>=0&&(t=t.slice(0,n)),!t||t==="start"})}function Ro(e,t,n){var u,r,i=No(t)?xn:Fe;return function(){var s=i(this,e),o=s.on;o!==u&&(r=(u=o).copy()).on(t,n),s.on=r}}function ko(e,t){var n=this._id;return arguments.length<2?Ee(this.node(),n).on.on(e):this.each(Ro(n,e,t))}function Io(e){return function(){var t=this.parentNode;for(var n in this.__transition)if(+n!==e)return;t&&t.removeChild(this)}}function Mo(){return this.on("end.remove",Io(this._id))}function Oo(e){var t=this._name,n=this._id;typeof e!="function"&&(e=Cn(e));for(var u=this._groups,r=u.length,i=new Array(r),s=0;s<r;++s)for(var o=u[s],l=o.length,c=i[s]=new Array(l),f,D,g=0;g<l;++g)(f=o[g])&&(D=e.call(f,f.__data__,g,o))&&("__data__"in f&&(D.__data__=f.__data__),c[g]=D,Ht(c[g],t,n,g,c,Ee(f,n)));return new xe(i,this._parents,t,n)}function To(e){var t=this._name,n=this._id;typeof e!="function"&&(e=Cu(e));for(var u=this._groups,r=u.length,i=[],s=[],o=0;o<r;++o)for(var l=u[o],c=l.length,f,D=0;D<c;++D)if(f=l[D]){for(var g=e.call(f,f.__data__,D,l),A,T=Ee(f,n),y=0,O=g.length;y<O;++y)(A=g[y])&&Ht(A,t,n,y,g,T);i.push(g),s.push(f)}return new xe(i,s,t,n)}var Lo=ft.prototype.constructor;function Po(){return new Lo(this._groups,this._parents)}function Ho(e,t){var n,u,r;return function(){var i=Xe(this,e),s=(this.style.removeProperty(e),Xe(this,e));return i===s?null:i===n&&s===u?r:r=t(n=i,u=s)}}function ju(e){return function(){this.style.removeProperty(e)}}function Jo(e,t,n){var u,r=n+"",i;return function(){var s=Xe(this,e);return s===r?null:s===u?i:i=t(u=s,n)}}function jo(e,t,n){var u,r,i;return function(){var s=Xe(this,e),o=n(this),l=o+"";return o==null&&(l=o=(this.style.removeProperty(e),Xe(this,e))),s===l?null:s===u&&l===r?i:(r=l,i=t(u=s,o))}}function Uo(e,t){var n,u,r,i="style."+t,s="end."+i,o;return function(){var l=Fe(this,e),c=l.on,f=l.value[i]==null?o||(o=ju(t)):void 0;(c!==n||r!==f)&&(u=(n=c).copy()).on(s,r=f),l.on=u}}function qo(e,t,n){var u=(e+="")=="transform"?Ws:Ju;return t==null?this.styleTween(e,Ho(e,u)).on("end.style."+e,ju(e)):typeof t=="function"?this.styleTween(e,jo(e,u,bn(this,"style."+e,t))).each(Uo(this._id,e)):this.styleTween(e,Jo(e,u,t),n).on("end.style."+e,null)}function Wo(e,t,n){return function(u){this.style.setProperty(e,t.call(this,u),n)}}function Vo(e,t,n){var u,r;function i(){var s=t.apply(this,arguments);return s!==r&&(u=(r=s)&&Wo(e,s,n)),u}return i._value=t,i}function zo(e,t,n){var u="style."+(e+="");if(arguments.length<2)return(u=this.tween(u))&&u._value;if(t==null)return this.tween(u,null);if(typeof t!="function")throw new Error;return this.tween(u,Vo(e,t,n??""))}function Xo(e){return function(){this.textContent=e}}function Ko(e){return function(){var t=e(this);this.textContent=t??""}}function Yo(e){return this.tween("text",typeof e=="function"?Ko(bn(this,"text",e)):Xo(e==null?"":e+""))}function Zo(e){return function(t){this.textContent=e.call(this,t)}}function Qo(e){var t,n;function u(){var r=e.apply(this,arguments);return r!==n&&(t=(n=r)&&Zo(r)),t}return u._value=e,u}function ea(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(e==null)return this.tween(t,null);if(typeof e!="function")throw new Error;return this.tween(t,Qo(e))}function ta(){for(var e=this._name,t=this._id,n=Gu(),u=this._groups,r=u.length,i=0;i<r;++i)for(var s=u[i],o=s.length,l,c=0;c<o;++c)if(l=s[c]){var f=Ee(l,t);Ht(l,e,n,c,s,{time:f.time+f.delay+f.duration,delay:0,duration:f.duration,ease:f.ease})}return new xe(u,this._parents,e,n)}function na(){var e,t,n=this,u=n._id,r=n.size();return new Promise(function(i,s){var o={value:s},l={value:function(){--r===0&&i()}};n.each(function(){var c=Fe(this,u),f=c.on;f!==e&&(t=(e=f).copy(),t._.cancel.push(o),t._.interrupt.push(o),t._.end.push(l)),c.on=t}),r===0&&i()})}var ua=0;function xe(e,t,n,u){this._groups=e,this._parents=t,this._name=n,this._id=u}function Gu(){return++ua}var Pe=ft.prototype;xe.prototype={constructor:xe,select:Oo,selectAll:To,filter:So,merge:$o,selection:Po,transition:ta,call:Pe.call,nodes:Pe.nodes,node:Pe.node,size:Pe.size,empty:Pe.empty,each:Pe.each,on:ko,attr:ho,attrTween:_o,style:qo,styleTween:zo,text:Yo,textTween:ea,remove:Mo,tween:io,delay:Co,duration:yo,ease:Bo,easeVarying:bo,end:na,[Symbol.iterator]:Pe[Symbol.iterator]};function ra(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}var ia={time:null,delay:0,duration:250,ease:ra};function sa(e,t){for(var n;!(n=e.__transition)||!(n=n[t]);)if(!(e=e.parentNode))throw new Error(`transition ${t} not found`);return n}function oa(e){var t,n;e instanceof xe?(t=e._id,e=e._name):(t=Gu(),(n=ia).time=Bn(),e=e==null?null:e+"");for(var u=this._groups,r=u.length,i=0;i<r;++i)for(var s=u[i],o=s.length,l,c=0;c<o;++c)(l=s[c])&&Ht(l,e,t,c,s,n||sa(l,t));return new xe(u,this._parents,e,t)}ft.prototype.interrupt=no;ft.prototype.transition=oa;const Dn=Math.PI,dn=2*Dn,je=1e-6,aa=dn-je;function En(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function gn(){return new En}En.prototype=gn.prototype={constructor:En,moveTo:function(e,t){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+t)},closePath:function(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(e,t){this._+="L"+(this._x1=+e)+","+(this._y1=+t)},quadraticCurveTo:function(e,t,n,u){this._+="Q"+ +e+","+ +t+","+(this._x1=+n)+","+(this._y1=+u)},bezierCurveTo:function(e,t,n,u,r,i){this._+="C"+ +e+","+ +t+","+ +n+","+ +u+","+(this._x1=+r)+","+(this._y1=+i)},arcTo:function(e,t,n,u,r){e=+e,t=+t,n=+n,u=+u,r=+r;var i=this._x1,s=this._y1,o=n-e,l=u-t,c=i-e,f=s-t,D=c*c+f*f;if(r<0)throw new Error("negative radius: "+r);if(this._x1===null)this._+="M"+(this._x1=e)+","+(this._y1=t);else if(D>je)if(!(Math.abs(f*o-l*c)>je)||!r)this._+="L"+(this._x1=e)+","+(this._y1=t);else{var g=n-i,A=u-s,T=o*o+l*l,y=g*g+A*A,O=Math.sqrt(T),v=Math.sqrt(D),x=r*Math.tan((Dn-Math.acos((T+D-y)/(2*O*v)))/2),S=x/v,j=x/O;Math.abs(S-1)>je&&(this._+="L"+(e+S*c)+","+(t+S*f)),this._+="A"+r+","+r+",0,0,"+ +(f*g>c*A)+","+(this._x1=e+j*o)+","+(this._y1=t+j*l)}},arc:function(e,t,n,u,r,i){e=+e,t=+t,n=+n,i=!!i;var s=n*Math.cos(u),o=n*Math.sin(u),l=e+s,c=t+o,f=1^i,D=i?u-r:r-u;if(n<0)throw new Error("negative radius: "+n);this._x1===null?this._+="M"+l+","+c:(Math.abs(this._x1-l)>je||Math.abs(this._y1-c)>je)&&(this._+="L"+l+","+c),n&&(D<0&&(D=D%dn+dn),D>aa?this._+="A"+n+","+n+",0,1,"+f+","+(e-s)+","+(t-o)+"A"+n+","+n+",0,1,"+f+","+(this._x1=l)+","+(this._y1=c):D>je&&(this._+="A"+n+","+n+",0,"+ +(D>=Dn)+","+f+","+(this._x1=e+n*Math.cos(r))+","+(this._y1=t+n*Math.sin(r))))},rect:function(e,t,n,u){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+t)+"h"+ +n+"v"+ +u+"h"+-n+"Z"},toString:function(){return this._}};function rt(e,t,n){this.k=e,this.x=t,this.y=n}rt.prototype={constructor:rt,scale:function(e){return e===1?this:new rt(this.k*e,this.x,this.y)},translate:function(e,t){return e===0&t===0?this:new rt(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};rt.prototype;const tn=["#E69F00","#56B4E9","#009E73","#F0E442","#0072B2","#D55E00","#CC79A7"],ca=(e,t)=>{var i,s,o;const n=e.event_id;if((s=(i=t==null?void 0:t.annotations)==null?void 0:i.events)!=null&&s[n])return`${(o=t==null?void 0:t.annotations)==null?void 0:o.events[n]}`;const u=_u(e),r=e._collapse?`+${e._collapse} more`:"";return`${u} ${r}`},la=(e,t,n)=>{var be,dt,Et,gt,Me,pt,_t;let u=JSON.parse(JSON.stringify(t)),r=null;for(const E of u)if(E.event_id===n.currentEventId){r=E;break}let i="prev_events";n.showAuthChainTransitiveReduction&&(u=fa(u,"auth_events"),i="auth_events",u=u.filter(E=>["m.room.create","m.room.member","m.room.join_rules","m.room.power_levels"].includes(E.type)));const s=u,o=new Map;for(let E=0;E<s.length;E++)s[E].streamPosition=E,o.set(s[E].event_id,s[E]);for(const E of s.slice()){E[i]=E[i].sort((F,L)=>{var K,te;return(((K=o.get(F))==null?void 0:K.streamPosition)||0)-(((te=o.get(L))==null?void 0:te.streamPosition)||0)}),E.auth_events=(E.auth_events||[]).sort((F,L)=>{var K,te;return(((K=o.get(L))==null?void 0:K.streamPosition)||0)-(((te=o.get(F))==null?void 0:te.streamPosition)||0)});for(const F of E[i]){if(!o.get(F)){const K={event_id:F,type:"dangling",prev_events:[],next_events:[],content:{},sender:"dangling",auth_events:[],room_id:"",origin_server_ts:0};o.set(F,K);const te=s.findIndex(Y=>Y.event_id===E.event_id);console.log("inserting placeholder prev_event at ",te),s.splice(te,0,K)}const L=o.get(F);L.next_events||(L.next_events=[]),L.next_events.push(E.event_id)}}const l=[],c=[];function f(E=null){{const F=E==null?0:E+1;if(F>=l.length)return F;for(let L=F;L<l.length;L++)if(!l[L])return L;return l.length}}s[0].x=0;for(let E=0;E<s.length;E++){const F=s[E];F.y=E;let L=!1;for(const te of F[i]){const Y=o.get(te);l.findIndex(le=>le===Y.event_id)!==-1&&(F.x=Y.x,L=!0);break}if(!L&&(F.x=f(),F[i]&&o.get(F[i][0]))){const te=o.get(F[i][0]).y;for(;c[F.x]!==void 0&&te<c[F.x];)F.x=f(F.x)}let K=!1;if(F.next_events){for(const te of F.next_events)if(o.get(te)[i][0]===F.event_id){K=!0;break}}K?l[F.x]=F.event_id:(delete l[F.x],c[F.x]=E)}let D=0;const g=[];s[0].laneWidth=0;for(let E=1;E<s.length;E++){const F=s[E-1],L=s[E];for(F.authLane>D&&(D=F.authLane,F.authLaneStart);g.length>0&&E>((be=g.at(-1))==null?void 0:be.y);)g.pop();F.next_events&&g.push({x:o.get(F.next_events.at(-1)).x,y:o.get(F.next_events.at(-1)).y}),g.sort((K,te)=>K.x-te.x),L.laneWidth=(dt=g.at(-1))==null?void 0:dt.x,L.laneWidth%2&&(L.x-=.5,L.laneWidth-=.5)}const A={top:20,right:20,bottom:30,left:230};let T=(Me=(gt=(Et=n.scenario)==null?void 0:Et.annotations)==null?void 0:gt.titles)==null?void 0:Me[n.currentEventId];T||(T=((_t=(pt=n.scenario)==null?void 0:pt.annotations)==null?void 0:_t.title)||"");const y=T.split(`
`),O=20,v=40,x=25,S=5,j=2,W=3,ge="#0a0";et(e).html(null);const Dt=l.length*v+1140,Ie=s.length*x,Ye=et(e).append("svg").attr("width",Dt+A.left+A.right).attr("height",Ie+A.top+A.bottom+O*y.length).append("g").attr("transform",`translate(${[A.left,A.top]})`),pe=Ye.selectAll("g").data(s).enter().append("g").attr("class",E=>`node-${E.event_id.slice(1,5)}`).on("mouseover",function(E,F){et(this).attr("fill",ge).attr("font-weight","bold")}).on("mouseout",function(E,F){et(this).attr("fill",null).attr("font-weight",null)});pe.append("circle").attr("cx",E=>E.x*v).attr("cy",E=>E.y*x).attr("r",S).style("fill",E=>{var F;return(F=n.stateAtEvent)!=null&&F.has(E.event_id)?"#43ff00":E.state_key!=null?"#4300ff":"#111111"}).style("fill-opacity","0.5").style("stroke",E=>{var F;return(F=n.stateAtEvent)!=null&&F.has(E.event_id)?"#43ff00":E.state_key!=null?"#4300ff":"#111111"}),pe.append("path").attr("d",E=>{const F=gn();if(E.next_events)for(const L of E.next_events){const K=o.get(L);F.moveTo(E.x*v,E.y*x+S),F.arcTo(E.x*v,(E.y+.5)*x,K.x*v,(E.y+.5)*x,S),F.arcTo(K.x*v,(E.y+.5)*x,K.x*v,K.y*x-S,S),F.lineTo(K.x*v,K.y*x-S)}return F}).attr("stroke","white").attr("stroke-width",j+2).attr("fill","none"),pe.each((E,F,L)=>{const K=et(L[F]);if(E.next_events)for(const te of E.next_events){const Y=o.get(te);if(!Y)continue;const le=gn();let Gt=0;le.moveTo(E.x*v,E.y*x+S+0),le.arcTo(E.x*v,(E.y+.5)*x,Y.x*v,(E.y+.5)*x,S),le.arcTo(Y.x*v,(E.y+.5)*x,Y.x*v,Y.y*x-S,S),le.lineTo(Y.x*v+Gt,Y.y*x-S),le.moveTo(E.x*v-S/3,E.y*x+S+S/2),le.lineTo(E.x*v,E.y*x+S),le.lineTo(E.x*v+S/3,E.y*x+S+S/2),le.lineTo(E.x*v-S/3,E.y*x+S+S/2),le.lineTo(E.x*v,E.y*x+S),K.append("path").attr("d",le.toString()).attr("class",Oe=>`child-${Oe.event_id.slice(1,5)} parent-${Y==null?void 0:Y.event_id.slice(1,5)} edge-${Oe.event_id.slice(1,5)}-${Y==null?void 0:Y.event_id.slice(1,5)}`).attr("stroke","black").attr("stroke-width",j).attr("fill","none")}});const qe=v/2,Ze=E=>(E.laneWidth??0)*v;if(pe.append("text").text(E=>E.event_id.substr(0,5)).attr("x",E=>Ze(E)+qe).attr("y",E=>E.y*x+4).on("click",(E,F)=>{n.onEventIDClick(F.event_id),E.stopPropagation()}),n.showStateSets&&r&&n.inverseStateSets){for(let F=0;F<tn.length;F++)pe.append("circle").attr("cx",L=>Ze(L)+qe+60+F*5).attr("cy",L=>L.y*x).attr("r",S).style("fill",L=>tn[F]).style("fill-opacity",L=>F>=r.prev_events.length?"0":(n.inverseStateSets[L.event_id]||new Set).has(r.prev_events[F])?"1":"0");const E=r.event_id;for(let F=0;F<r.prev_events.length;F++){const L=r.prev_events[F];xs(`.edge-${L.slice(1,5)}-${E.slice(1,5)}`).raise().attr("stroke",tn[F]||"#fff").attr("stroke-width",W)}}pe.append("text").text(E=>ca(E,n.scenario)).attr("class",E=>"node-text").attr("x",E=>Ze(E)+qe+100).attr("y",E=>E.y*x+4),pe.append("text").text(E=>E.origin_server_ts?new Date(E.origin_server_ts).toLocaleString(void 0,{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"}):"").attr("x",-230).attr("y",E=>E.y*x+4);const jt=Ye.append("text").attr("class","node-text").attr("x",-230).attr("y",Ie);for(let E=0;E<y.length;E++)jt.append("tspan").attr("x",-230).attr("y",Ie+E*O).text(y[E])};function fa(e,t){const n=new Map;for(const s of e)n.set(s.event_id,s);const u=new Map;for(const s of e)u.set(s.event_id,new Set(s[t]));function r(s,o,l){const c=new Set,f=[s];for(;f.length;){const D=f.pop();if(D===o)return!0;if(!(c.has(D)||D===l)){c.add(D);for(const g of u.get(D)??[])f.push(g)}}return!1}const i=[];for(const s of e){const o=[];for(const c of s[t]){const f=s[t].filter(g=>g!==c);let D=!1;for(const g of f)if(r(g,c,s.event_id)){D=!0;break}D||o.push(c)}const l=JSON.parse(JSON.stringify(s));l[t]=o,i.push(l)}return i}const Uu={calculate_event_ids:!0,on_load_at_start:!0,events:[{type:"m.room.create",state_key:"",sender:"@creator:tardis",auth_events:[],prev_events:[],content:{creator:"@creator:tardis"},event_id:"$CREATE"},{type:"m.room.member",state_key:"@creator:tardis",sender:"@creator:tardis",auth_events:["$CREATE"],prev_events:["$CREATE"],content:{membership:"join"},event_id:"$JOIN"},{type:"m.room.message",sender:"@creator:tardis",auth_events:["$CREATE","$JOIN"],prev_events:["$JOIN"],content:{body:"A wild fork appears!"},event_id:"$FORK1"},{type:"m.room.message",sender:"@creator:tardis",auth_events:["$CREATE","$JOIN"],prev_events:["$JOIN"],content:{body:"Another wild fork appears!"},event_id:"$FORK2"},{type:"m.room.message",sender:"@creator:tardis",auth_events:["$CREATE","$JOIN"],prev_events:["$FORK1","$FORK2"],content:{body:"Merged!"},event_id:"$MERGE"},{type:"m.room.message",sender:"@creator:tardis",auth_events:["$CREATE","$JOIN"],prev_events:["$MERGE"],content:{body:"This event has precalculated state"},event_id:"$PRESTATE"},{type:"m.room.name",state_key:"",sender:"@creator:tardis",auth_events:["$CREATE","$JOIN"],prev_events:["$PRESTATE"],content:{name:"State events are blue, messages are grey"},event_id:"$MSG"},{type:"m.room.message",sender:"@creator:tardis",auth_events:["$CREATE","$JOIN"],prev_events:["$MSG"],content:{body:"Boring long chains..."},event_id:"$MSG2"},{type:"m.room.message",sender:"@creator:tardis",auth_events:["$CREATE","$JOIN"],prev_events:["$MSG2"],content:{body:"...can be collapsed..."},event_id:"$MSG3"},{type:"m.room.message",sender:"@creator:tardis",auth_events:["$CREATE","$JOIN"],prev_events:["$MSG3"],content:{body:"...by checking the collapse checkbox."},event_id:"$MSG4"}],room_id:"!quickstart:tardis",room_version:"10",tardis_version:1,annotations:{title:["Welcome to TARDIS! Press the → button to continue."].join(`
`),titles:{$FORK1:"State events are highlighted in blue. Messages are highlighted in grey.",$FORK2:"The DAG can fork, which indicates some events were sent at the same time.",$MERGE:"The DAG can merge, which merges state from each fork together. This is state resolution.",$PRESTATE:"Green events indicate the state at this event. Message events will never be green.",$MSG:"Check the 'Auth Chain' box to show the `auth_events` for each event.",$MSG2:"Press the 'Resolve State' button to calculate which events are part of the current room state.",$MSG3:["As state resolution is iterative, it will resolve state for all earlier events as well.","Click on an earlier event in the list to jump to that event."].join(`
`),$MSG4:["Now load a file or use one of the pre-loaded files to experiment with state resolution in Matrix!"].join(`
`)},events:{$MSG:"Blue nodes like this one are state events.",$MSG2:"Boring long chains...",$MSG3:"...can be collapsed...",$MSG4:"...by checking the collapse checkbox.",$PRESTATE:"This event has pre-calculated state (in green) after this event"}},precalculated_state_after:{$PRESTATE:["$CREATE","$JOIN"]}},ha={calculate_event_ids:!0,on_load_at_start:!0,events:[{type:"m.room.create",state_key:"",sender:"@alice:tardis",auth_events:[],prev_events:[],content:{creator:"@alice:tardis"},event_id:"$CREATE"},{type:"m.room.member",state_key:"@alice:tardis",sender:"@alice:tardis",auth_events:["$CREATE"],prev_events:["$CREATE"],content:{membership:"join"},event_id:"$ALICE"},{type:"m.room.power_levels",state_key:"",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE"],prev_events:["$ALICE"],content:{users:{"@alice:tardis":100},events:{"m.room.name":50},users_default:50},event_id:"$PL"},{type:"m.room.join_rules",state_key:"",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE","$PL"],prev_events:["$PL"],content:{join_rule:"public"},event_id:"$JR"},{type:"m.room.member",state_key:"@bob:tardis",sender:"@bob:tardis",auth_events:["$CREATE","$JR","$PL"],prev_events:["$JR"],content:{membership:"join"},event_id:"$BOB"},{type:"m.room.name",state_key:"",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE","$PL"],prev_events:["$BOB"],content:{name:"Alice Room"},event_id:"$ALICE_NAME"},{type:"m.room.name",state_key:"",sender:"@bob:tardis",auth_events:["$CREATE","$BOB","$PL"],prev_events:["$BOB"],content:{name:"Bob Room"},event_id:"$BOB_NAME"},{type:"m.room.message",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE","$PL"],prev_events:["$ALICE_NAME","$BOB_NAME"],content:{body:"Bob wins."},event_id:"$MERGE1"},{type:"m.room.name",state_key:"",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE","$PL"],prev_events:["$MERGE1"],content:{name:"Alice Room 2"},origin_server_ts:1704067281337,event_id:"$ALICE_NAME2"},{type:"m.room.name",state_key:"",sender:"@bob:tardis",auth_events:["$CREATE","$BOB","$PL"],prev_events:["$MERGE1"],content:{name:"Bob Room 2"},origin_server_ts:1704067281337,event_id:"$BOB_NAME2"},{type:"m.room.message",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE","$PL"],prev_events:["$ALICE_NAME2","$BOB_NAME2"],content:{body:"Alice wins."},event_id:"$MERGE2"},{type:"m.room.name",state_key:"",sender:"@bob:tardis",auth_events:["$CREATE","$BOB","$PL"],prev_events:["$MERGE2"],content:{name:"Bob Room 3"},origin_server_ts:1704077300300,event_id:"$BOB_NAME3"},{type:"m.room.power_levels",state_key:"",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE"],prev_events:["$MERGE2"],content:{users:{"@alice:tardis":100},events:{"m.room.name":50},users_default:50},event_id:"$PL2"},{type:"m.room.name",state_key:"",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE","$PL2"],prev_events:["$PL2"],content:{name:"Alice Room 3"},origin_server_ts:1704077299300,event_id:"$ALICE_NAME3"},{type:"m.room.message",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE","$PL2"],prev_events:["$ALICE_NAME3","$BOB_NAME3"],content:{body:"Alice wins."},event_id:"$MERGE3"}],room_id:"!mainline-fork:tardis",room_version:"10",tardis_version:1,annotations:{title:"The winner follows this priority: Mainline depth THEN origin_server_ts THEN event ID",titles:{$ALICE:["Mainline Ordering:","The conflicting state events in this example are all room name changes and hence do not restrict anyone's permissions.","This makes it easier to explain. All of the merges in this example are due to 'mainline ordering'."].join(`
`),$MERGE1:["Bob wins because his event has a higher origin_server_ts. Both events have the same mainline depth."].join(`
`),$MERGE2:["Both events have the same timestamp. Alice wins with a higher event ID (A < Z < a < z)."].join(`
`),$MERGE3:["Bob's event has a higher timestamp but Alice wins because her event happened AFTER a change to the power levels.","This gives her event a higher 'mainline position' which is considered before the timestamp or event ID."].join(`
`)},events:{}}},Da={calculate_event_ids:!0,on_load_at_start:!0,events:[{type:"m.room.create",state_key:"",sender:"@alice:tardis",auth_events:[],prev_events:[],content:{creator:"@alice:tardis"},event_id:"$CREATE"},{type:"m.room.member",state_key:"@alice:tardis",sender:"@alice:tardis",auth_events:["$CREATE"],prev_events:["$CREATE"],content:{membership:"join"},event_id:"$ALICE"},{type:"m.room.power_levels",state_key:"",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE"],prev_events:["$ALICE"],content:{users:{"@alice:tardis":100},events:{"m.room.join_rules":50},users_default:50},event_id:"$PL"},{type:"m.room.join_rules",state_key:"",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE","$PL"],prev_events:["$PL"],content:{join_rule:"public"},event_id:"$JR"},{type:"m.room.member",state_key:"@bob:tardis",sender:"@bob:tardis",auth_events:["$CREATE","$JR","$PL"],prev_events:["$JR"],content:{membership:"join"},event_id:"$BOB"},{type:"m.room.member",state_key:"@charlie:tardis",sender:"@charlie:tardis",auth_events:["$CREATE","$JR","$PL"],prev_events:["$BOB"],content:{membership:"join"},event_id:"$CHARLIE"},{type:"m.room.join_rules",state_key:"",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE","$PL"],prev_events:["$CHARLIE"],content:{join_rule:"invite"},event_id:"$ALICE_JR"},{type:"m.room.join_rules",state_key:"",sender:"@bob:tardis",auth_events:["$CREATE","$BOB","$PL"],prev_events:["$CHARLIE"],content:{join_rule:"knock"},event_id:"$BOB_JR"},{type:"m.room.message",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE","$PL"],prev_events:["$ALICE_JR","$BOB_JR"],content:{body:"Bob wins."},event_id:"$MERGE1"},{type:"m.room.join_rules",state_key:"",sender:"@bob:tardis",auth_events:["$CREATE","$BOB","$PL"],prev_events:["$MERGE1"],content:{join_rule:"knock"},event_id:"$BOB_JR2"},{type:"m.room.join_rules",state_key:"",sender:"@charlie:tardis",auth_events:["$CREATE","$CHARLIE","$PL"],prev_events:["$MERGE1"],content:{join_rule:"public"},event_id:"$CHARLIE_JR"},{type:"m.room.message",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE","$PL"],prev_events:["$BOB_JR2","$CHARLIE_JR"],content:{body:"Charlie wins."},event_id:"$MERGE2"},{type:"m.room.join_rules",state_key:"",sender:"@bob:tardis",auth_events:["$CREATE","$BOB","$PL"],prev_events:["$MERGE2"],content:{join_rule:"knock"},origin_server_ts:1704077299001,event_id:"$BOB_JR3"},{type:"m.room.join_rules",state_key:"",sender:"@charlie:tardis",auth_events:["$CREATE","$CHARLIE","$PL"],prev_events:["$MERGE2"],content:{join_rule:"invite"},origin_server_ts:1704077299001,event_id:"$CHARLIE_JR2"},{type:"m.room.message",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE","$PL"],prev_events:["$CHARLIE_JR2","$BOB_JR3"],content:{body:"Bob wins."},event_id:"$MERGE3"}],room_id:"!power-ordering:tardis",room_version:"10",tardis_version:1,annotations:{title:"The winner follows this priority: Sender Power Level THEN origin_server_ts THEN event ID",titles:{$PL:"Join rules can be modified by ANYONE",$ALICE:["Reverse Topological Power Ordering:","The conflicting state events in this example potentially restrict permissions because they are join rules.","All of the merges in this example are due to this ordering."].join(`
`),$MERGE1:["Bob's 'knock' wins because he has a lower PL (50 vs 100).","This seems undesirable at first, but this can be worded another way: Alice's 'invite' is APPLIED FIRST, and then Bob's.","This order ensures if Alice revokes Bob's permissions, Alice wins."].join(`
`),$MERGE2:["Both Bob and Charlie have the same PL (50). Charlie's 'public' wins because his event has a higher origin_server_ts"].join(`
`),$MERGE3:["Both events have the same timestamp. Bob's 'knock' wins because his event ID is greater than Charlie's (A < Z < a < z)"].join(`
`)},events:{}}};var da=/[\u1680\u2000-\u200A\u202F\u205F\u3000]/,Ea=/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08BD\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312E\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FEA\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC03-\uDC37\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDF00-\uDF19]|\uD806[\uDCA0-\uDCDF\uDCFF\uDE00\uDE0B-\uDE32\uDE3A\uDE50\uDE5C-\uDE83\uDE86-\uDE89\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD46]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50\uDF93-\uDF9F\uDFE0\uDFE1]|\uD821[\uDC00-\uDFEC]|\uD822[\uDC00-\uDEF2]|\uD82C[\uDC00-\uDD1E\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]/,ga=/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05F0-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u082D\u0840-\u085B\u0860-\u086A\u08A0-\u08B4\u08B6-\u08BD\u08D4-\u08E1\u08E3-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u09FC\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0AF9-\u0AFF\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58-\u0C5A\u0C60-\u0C63\u0C66-\u0C6F\u0C80-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D00-\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D54-\u0D57\u0D5F-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1877\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19D9\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1C80-\u1C88\u1CD0-\u1CD2\u1CD4-\u1CF9\u1D00-\u1DF9\u1DFB-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u2E2F\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099\u309A\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312E\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FEA\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA827\uA840-\uA873\uA880-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD\uA900-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDDFD\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF7A\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00-\uDE03\uDE05\uDE06\uDE0C-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE38-\uDE3A\uDE3F\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE6\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC00-\uDC46\uDC66-\uDC6F\uDC7F-\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD00-\uDD34\uDD36-\uDD3F\uDD50-\uDD73\uDD76\uDD80-\uDDC4\uDDCA-\uDDCC\uDDD0-\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE37\uDE3E\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEEA\uDEF0-\uDEF9\uDF00-\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3C-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF50\uDF57\uDF5D-\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC00-\uDC4A\uDC50-\uDC59\uDC80-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDB5\uDDB8-\uDDC0\uDDD8-\uDDDD\uDE00-\uDE40\uDE44\uDE50-\uDE59\uDE80-\uDEB7\uDEC0-\uDEC9\uDF00-\uDF19\uDF1D-\uDF2B\uDF30-\uDF39]|\uD806[\uDCA0-\uDCE9\uDCFF\uDE00-\uDE3E\uDE47\uDE50-\uDE83\uDE86-\uDE99\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC36\uDC38-\uDC40\uDC50-\uDC59\uDC72-\uDC8F\uDC92-\uDCA7\uDCA9-\uDCB6\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD36\uDD3A\uDD3C\uDD3D\uDD3F-\uDD47\uDD50-\uDD59]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50-\uDF7E\uDF8F-\uDF9F\uDFE0\uDFE1]|\uD821[\uDC00-\uDFEC]|\uD822[\uDC00-\uDEF2]|\uD82C[\uDC00-\uDD1E\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9D\uDC9E]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD838[\uDC00-\uDC06\uDC08-\uDC18\uDC1B-\uDC21\uDC23\uDC24\uDC26-\uDC2A]|\uD83A[\uDC00-\uDCC4\uDCD0-\uDCD6\uDD00-\uDD4A\uDD50-\uDD59]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uDB40[\uDD00-\uDDEF]/,nn={Space_Separator:da,ID_Start:Ea,ID_Continue:ga},ee={isSpaceSeparator(e){return typeof e=="string"&&nn.Space_Separator.test(e)},isIdStartChar(e){return typeof e=="string"&&(e>="a"&&e<="z"||e>="A"&&e<="Z"||e==="$"||e==="_"||nn.ID_Start.test(e))},isIdContinueChar(e){return typeof e=="string"&&(e>="a"&&e<="z"||e>="A"&&e<="Z"||e>="0"&&e<="9"||e==="$"||e==="_"||e==="‌"||e==="‍"||nn.ID_Continue.test(e))},isDigit(e){return typeof e=="string"&&/[0-9]/.test(e)},isHexDigit(e){return typeof e=="string"&&/[0-9A-Fa-f]/.test(e)}};let pn,ce,we,Ot,ke,de,ie,Sn,st;var pa=function(t,n){pn=String(t),ce="start",we=[],Ot=0,ke=1,de=0,ie=void 0,Sn=void 0,st=void 0;do ie=_a(),Ca[ce]();while(ie.type!=="eof");return typeof n=="function"?_n({"":st},"",n):st};function _n(e,t,n){const u=e[t];if(u!=null&&typeof u=="object")if(Array.isArray(u))for(let r=0;r<u.length;r++){const i=String(r),s=_n(u,i,n);s===void 0?delete u[i]:Object.defineProperty(u,i,{value:s,writable:!0,enumerable:!0,configurable:!0})}else for(const r in u){const i=_n(u,r,n);i===void 0?delete u[r]:Object.defineProperty(u,r,{value:i,writable:!0,enumerable:!0,configurable:!0})}return n.call(e,t,u)}let I,k,it,ye,P;function _a(){for(I="default",k="",it=!1,ye=1;;){P=Be();const e=qu[I]();if(e)return e}}function Be(){if(pn[Ot])return String.fromCodePoint(pn.codePointAt(Ot))}function d(){const e=Be();return e===`
`?(ke++,de=0):e?de+=e.length:de++,e&&(Ot+=e.length),e}const qu={default(){switch(P){case"	":case"\v":case"\f":case" ":case" ":case"\uFEFF":case`
`:case"\r":case"\u2028":case"\u2029":d();return;case"/":d(),I="comment";return;case void 0:return d(),z("eof")}if(ee.isSpaceSeparator(P)){d();return}return qu[ce]()},comment(){switch(P){case"*":d(),I="multiLineComment";return;case"/":d(),I="singleLineComment";return}throw X(d())},multiLineComment(){switch(P){case"*":d(),I="multiLineCommentAsterisk";return;case void 0:throw X(d())}d()},multiLineCommentAsterisk(){switch(P){case"*":d();return;case"/":d(),I="default";return;case void 0:throw X(d())}d(),I="multiLineComment"},singleLineComment(){switch(P){case`
`:case"\r":case"\u2028":case"\u2029":d(),I="default";return;case void 0:return d(),z("eof")}d()},value(){switch(P){case"{":case"[":return z("punctuator",d());case"n":return d(),He("ull"),z("null",null);case"t":return d(),He("rue"),z("boolean",!0);case"f":return d(),He("alse"),z("boolean",!1);case"-":case"+":d()==="-"&&(ye=-1),I="sign";return;case".":k=d(),I="decimalPointLeading";return;case"0":k=d(),I="zero";return;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":k=d(),I="decimalInteger";return;case"I":return d(),He("nfinity"),z("numeric",1/0);case"N":return d(),He("aN"),z("numeric",NaN);case'"':case"'":it=d()==='"',k="",I="string";return}throw X(d())},identifierNameStartEscape(){if(P!=="u")throw X(d());d();const e=An();switch(e){case"$":case"_":break;default:if(!ee.isIdStartChar(e))throw au();break}k+=e,I="identifierName"},identifierName(){switch(P){case"$":case"_":case"‌":case"‍":k+=d();return;case"\\":d(),I="identifierNameEscape";return}if(ee.isIdContinueChar(P)){k+=d();return}return z("identifier",k)},identifierNameEscape(){if(P!=="u")throw X(d());d();const e=An();switch(e){case"$":case"_":case"‌":case"‍":break;default:if(!ee.isIdContinueChar(e))throw au();break}k+=e,I="identifierName"},sign(){switch(P){case".":k=d(),I="decimalPointLeading";return;case"0":k=d(),I="zero";return;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":k=d(),I="decimalInteger";return;case"I":return d(),He("nfinity"),z("numeric",ye*(1/0));case"N":return d(),He("aN"),z("numeric",NaN)}throw X(d())},zero(){switch(P){case".":k+=d(),I="decimalPoint";return;case"e":case"E":k+=d(),I="decimalExponent";return;case"x":case"X":k+=d(),I="hexadecimal";return}return z("numeric",ye*0)},decimalInteger(){switch(P){case".":k+=d(),I="decimalPoint";return;case"e":case"E":k+=d(),I="decimalExponent";return}if(ee.isDigit(P)){k+=d();return}return z("numeric",ye*Number(k))},decimalPointLeading(){if(ee.isDigit(P)){k+=d(),I="decimalFraction";return}throw X(d())},decimalPoint(){switch(P){case"e":case"E":k+=d(),I="decimalExponent";return}if(ee.isDigit(P)){k+=d(),I="decimalFraction";return}return z("numeric",ye*Number(k))},decimalFraction(){switch(P){case"e":case"E":k+=d(),I="decimalExponent";return}if(ee.isDigit(P)){k+=d();return}return z("numeric",ye*Number(k))},decimalExponent(){switch(P){case"+":case"-":k+=d(),I="decimalExponentSign";return}if(ee.isDigit(P)){k+=d(),I="decimalExponentInteger";return}throw X(d())},decimalExponentSign(){if(ee.isDigit(P)){k+=d(),I="decimalExponentInteger";return}throw X(d())},decimalExponentInteger(){if(ee.isDigit(P)){k+=d();return}return z("numeric",ye*Number(k))},hexadecimal(){if(ee.isHexDigit(P)){k+=d(),I="hexadecimalInteger";return}throw X(d())},hexadecimalInteger(){if(ee.isHexDigit(P)){k+=d();return}return z("numeric",ye*Number(k))},string(){switch(P){case"\\":d(),k+=Aa();return;case'"':if(it)return d(),z("string",k);k+=d();return;case"'":if(!it)return d(),z("string",k);k+=d();return;case`
`:case"\r":throw X(d());case"\u2028":case"\u2029":Fa(P);break;case void 0:throw X(d())}k+=d()},start(){switch(P){case"{":case"[":return z("punctuator",d())}I="value"},beforePropertyName(){switch(P){case"$":case"_":k=d(),I="identifierName";return;case"\\":d(),I="identifierNameStartEscape";return;case"}":return z("punctuator",d());case'"':case"'":it=d()==='"',I="string";return}if(ee.isIdStartChar(P)){k+=d(),I="identifierName";return}throw X(d())},afterPropertyName(){if(P===":")return z("punctuator",d());throw X(d())},beforePropertyValue(){I="value"},afterPropertyValue(){switch(P){case",":case"}":return z("punctuator",d())}throw X(d())},beforeArrayValue(){if(P==="]")return z("punctuator",d());I="value"},afterArrayValue(){switch(P){case",":case"]":return z("punctuator",d())}throw X(d())},end(){throw X(d())}};function z(e,t){return{type:e,value:t,line:ke,column:de}}function He(e){for(const t of e){if(Be()!==t)throw X(d());d()}}function Aa(){switch(Be()){case"b":return d(),"\b";case"f":return d(),"\f";case"n":return d(),`
`;case"r":return d(),"\r";case"t":return d(),"	";case"v":return d(),"\v";case"0":if(d(),ee.isDigit(Be()))throw X(d());return"\0";case"x":return d(),va();case"u":return d(),An();case`
`:case"\u2028":case"\u2029":return d(),"";case"\r":return d(),Be()===`
`&&d(),"";case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":throw X(d());case void 0:throw X(d())}return d()}function va(){let e="",t=Be();if(!ee.isHexDigit(t)||(e+=d(),t=Be(),!ee.isHexDigit(t)))throw X(d());return e+=d(),String.fromCodePoint(parseInt(e,16))}function An(){let e="",t=4;for(;t-- >0;){const n=Be();if(!ee.isHexDigit(n))throw X(d());e+=d()}return String.fromCodePoint(parseInt(e,16))}const Ca={start(){if(ie.type==="eof")throw Je();un()},beforePropertyName(){switch(ie.type){case"identifier":case"string":Sn=ie.value,ce="afterPropertyName";return;case"punctuator":xt();return;case"eof":throw Je()}},afterPropertyName(){if(ie.type==="eof")throw Je();ce="beforePropertyValue"},beforePropertyValue(){if(ie.type==="eof")throw Je();un()},beforeArrayValue(){if(ie.type==="eof")throw Je();if(ie.type==="punctuator"&&ie.value==="]"){xt();return}un()},afterPropertyValue(){if(ie.type==="eof")throw Je();switch(ie.value){case",":ce="beforePropertyName";return;case"}":xt()}},afterArrayValue(){if(ie.type==="eof")throw Je();switch(ie.value){case",":ce="beforeArrayValue";return;case"]":xt()}},end(){}};function un(){let e;switch(ie.type){case"punctuator":switch(ie.value){case"{":e={};break;case"[":e=[];break}break;case"null":case"boolean":case"numeric":case"string":e=ie.value;break}if(st===void 0)st=e;else{const t=we[we.length-1];Array.isArray(t)?t.push(e):Object.defineProperty(t,Sn,{value:e,writable:!0,enumerable:!0,configurable:!0})}if(e!==null&&typeof e=="object")we.push(e),Array.isArray(e)?ce="beforeArrayValue":ce="beforePropertyName";else{const t=we[we.length-1];t==null?ce="end":Array.isArray(t)?ce="afterArrayValue":ce="afterPropertyValue"}}function xt(){we.pop();const e=we[we.length-1];e==null?ce="end":Array.isArray(e)?ce="afterArrayValue":ce="afterPropertyValue"}function X(e){return Tt(e===void 0?`JSON5: invalid end of input at ${ke}:${de}`:`JSON5: invalid character '${Wu(e)}' at ${ke}:${de}`)}function Je(){return Tt(`JSON5: invalid end of input at ${ke}:${de}`)}function au(){return de-=5,Tt(`JSON5: invalid identifier character at ${ke}:${de}`)}function Fa(e){console.warn(`JSON5: '${Wu(e)}' in strings is not valid ECMAScript; consider escaping`)}function Wu(e){const t={"'":"\\'",'"':'\\"',"\\":"\\\\","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t","\v":"\\v","\0":"\\0","\u2028":"\\u2028","\u2029":"\\u2029"};if(t[e])return t[e];if(e<" "){const n=e.charCodeAt(0).toString(16);return"\\x"+("00"+n).substring(n.length)}return e}function Tt(e){const t=new SyntaxError(e);return t.lineNumber=ke,t.columnNumber=de,t}var ma=function(t,n,u){const r=[];let i="",s,o,l="",c;if(n!=null&&typeof n=="object"&&!Array.isArray(n)&&(u=n.space,c=n.quote,n=n.replacer),typeof n=="function")o=n;else if(Array.isArray(n)){s=[];for(const y of n){let O;typeof y=="string"?O=y:(typeof y=="number"||y instanceof String||y instanceof Number)&&(O=String(y)),O!==void 0&&s.indexOf(O)<0&&s.push(O)}}return u instanceof Number?u=Number(u):u instanceof String&&(u=String(u)),typeof u=="number"?u>0&&(u=Math.min(10,Math.floor(u)),l="          ".substr(0,u)):typeof u=="string"&&(l=u.substr(0,10)),f("",{"":t});function f(y,O){let v=O[y];switch(v!=null&&(typeof v.toJSON5=="function"?v=v.toJSON5(y):typeof v.toJSON=="function"&&(v=v.toJSON(y))),o&&(v=o.call(O,y,v)),v instanceof Number?v=Number(v):v instanceof String?v=String(v):v instanceof Boolean&&(v=v.valueOf()),v){case null:return"null";case!0:return"true";case!1:return"false"}if(typeof v=="string")return D(v);if(typeof v=="number")return String(v);if(typeof v=="object")return Array.isArray(v)?T(v):g(v)}function D(y){const O={"'":.1,'"':.2},v={"'":"\\'",'"':'\\"',"\\":"\\\\","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t","\v":"\\v","\0":"\\0","\u2028":"\\u2028","\u2029":"\\u2029"};let x="";for(let j=0;j<y.length;j++){const W=y[j];switch(W){case"'":case'"':O[W]++,x+=W;continue;case"\0":if(ee.isDigit(y[j+1])){x+="\\x00";continue}}if(v[W]){x+=v[W];continue}if(W<" "){let ge=W.charCodeAt(0).toString(16);x+="\\x"+("00"+ge).substring(ge.length);continue}x+=W}const S=c||Object.keys(O).reduce((j,W)=>O[j]<O[W]?j:W);return x=x.replace(new RegExp(S,"g"),v[S]),S+x+S}function g(y){if(r.indexOf(y)>=0)throw TypeError("Converting circular structure to JSON5");r.push(y);let O=i;i=i+l;let v=s||Object.keys(y),x=[];for(const j of v){const W=f(j,y);if(W!==void 0){let ge=A(j)+":";l!==""&&(ge+=" "),ge+=W,x.push(ge)}}let S;if(x.length===0)S="{}";else{let j;if(l==="")j=x.join(","),S="{"+j+"}";else{let W=`,
`+i;j=x.join(W),S=`{
`+i+j+`,
`+O+"}"}}return r.pop(),i=O,S}function A(y){if(y.length===0)return D(y);const O=String.fromCodePoint(y.codePointAt(0));if(!ee.isIdStartChar(O))return D(y);for(let v=O.length;v<y.length;v++)if(!ee.isIdContinueChar(String.fromCodePoint(y.codePointAt(v))))return D(y);return y}function T(y){if(r.indexOf(y)>=0)throw TypeError("Converting circular structure to JSON5");r.push(y);let O=i;i=i+l;let v=[];for(let S=0;S<y.length;S++){const j=f(String(S),y);v.push(j!==void 0?j:"null")}let x;if(v.length===0)x="[]";else if(l==="")x="["+v.join(",")+"]";else{let S=`,
`+i,j=v.join(S);x=`[
`+i+j+`,
`+O+"]"}return r.pop(),i=O,x}};const ya={parse:pa,stringify:ma};var wa=ya;const cu="10";async function Ba(e){const t=await new Promise((u,r)=>{const i=new FileReader;i.onload=s=>{if(!s.target||!s.target.result)return;if(e.name.endsWith(".json5")){const c=wa.parse(s.target.result);c.on_load_at_start==null&&(c.on_load_at_start=!1),c.calculate_event_ids==null&&(c.calculate_event_ids=!1),c.room_version==null&&(c.room_version=cu),u(c);return}const o=s.target.result;if(o.startsWith("[")){const c=JSON.parse(o);u(c);return}const l=o.split(`
`).filter(c=>c.trim().length>0).map(c=>JSON.parse(c));u(l)},i.readAsText(e)});let n;return Array.isArray(t)?n={tardis_version:1,room_version:cu,room_id:t[0].room_id,calculate_event_ids:!1,on_load_at_start:!1,events:t}:n=t,n}function xa(e){var r,i,s,o;const t={events:[],roomVersion:e.room_version,annotations:e.annotations,precalculatedStateAfter:e.precalculated_state_after,onLoadAtStart:e.on_load_at_start},n=new Map;let u=new Date(2024,0,1).getTime();for(const l of e.events){if(!l)throw new Error("missing event");if(!l.event_id)throw new Error(`event is missing 'event_id', got ${JSON.stringify(l)}`);if(!l.type)throw new Error(`event is missing 'type' field, got ${JSON.stringify(l)}`);if(l.origin_server_ts?u=l.origin_server_ts+1e3:(l.origin_server_ts=u,u+=1e3),!l.room_id&&e.room_id&&(l.room_id=e.room_id),e.calculate_event_ids){const c=l.event_id;for(const D of["prev_events","auth_events"]){const g=[];for(const A of l[D]){const T=n.get(A);T?g.push(T):g.push(A)}l[D]=g}const f=globalThis.gmslEventIDForEvent(JSON.stringify(l),e.room_version);n.set(c,f),l.event_id=f,(i=(r=t.annotations)==null?void 0:r.events)!=null&&i[c]&&(t.annotations.events[f]=t.annotations.events[c]),(o=(s=t.annotations)==null?void 0:s.titles)!=null&&o[c]&&(t.annotations.titles[f]=t.annotations.titles[c])}t.events.push(l)}if(t.precalculatedStateAfter)for(const l in t.precalculatedStateAfter){const c=n.get(l);if(!c){console.error(`precalculated_state_after references ${l} but this does not exist in the events array. Skipping.`);continue}const f=[];for(const D of t.precalculatedStateAfter[l]){const g=n.get(D);g?f.push(g):console.error(`precalculated_state_after for ${l} references ${D} but this does not exist in the events array. Skipping.`)}t.precalculatedStateAfter[c]=f,delete t.precalculatedStateAfter[l]}return console.log(t),t}class ba{constructor(t,n){V(this,"inflightRequests");this.sender=t,this.getEvent=n,this.inflightRequests=new Map}onGetEventRequest(t){const n=this.getEvent(t);return n||console.error(`WS: asked for event ${t.event_id} but didn't find it.`),n}onResolveStateResponse(t,n){const u=this.inflightRequests.get(t);if(!u){console.error(`onResolveStateResponse: no request id for response! id=${t}`);return}n.error&&console.error(t,n.error),u(n),this.inflightRequests.delete(t)}async resolveState(t,n,u,r){console.log("resolveState",u,r);const i=globalThis.crypto.randomUUID();return new Promise((o,l)=>{this.inflightRequests.set(i,c=>{if(!c.result){console.error("State resolved to the empty set"),o({state:{}});return}if(c.error&&c.error!==""){l(c.error);return}o({state:c.result})}),this.sender.sendResolveState(i,{state:u,room_id:t,room_version:n,event:r})})}}class Sa{constructor(){V(this,"ws");V(this,"receiver")}async sendResolveState(t,n){this.sendWs({id:t,type:"resolve_state",data:n})}async connect(t,n){return this.receiver=n,this.ws=new WebSocket(t),new Promise(u=>{this.ws.addEventListener("open",()=>{console.log("WS open"),u()}),this.ws.addEventListener("error",this.onWsError.bind(this)),this.ws.addEventListener("close",this.onWsClose.bind(this)),this.ws.addEventListener("message",this.onWsMessage.bind(this))})}close(){this.ws.close()}sendWs(t){console.log("send",t),this.ws.send(JSON.stringify(t))}onWsClose(t){}onWsError(t){}onWsMessage(t){const n=JSON.parse(t.data);switch(console.log("recv",n),n.type){case"get_event":{const u=n.data,r=this.receiver.onGetEventRequest(u);u.event=r,n.data=u,this.sendWs(n);break}case"resolve_state":{const u=n.data;this.receiver.onResolveStateResponse(n.id,u);break}}}}gu.registerLanguage("json",Lr);const lu={"Quick Start":Uu,"Mainline Ordering":ha,"Reverse Topological Power Ordering":Da},Re=new Vr(document.getElementById("eventlist"),document.getElementById("eventlisttemplate"));class Vu{constructor(t){V(this,"cache");V(this,"createEventId");V(this,"showAuthChain");V(this,"showOutliers");V(this,"showStateSets");V(this,"collapse");V(this,"shimUrl");V(this,"debugger");V(this,"renderEvents");V(this,"scenario");V(this,"scenarioFile");this.cache=t,this.createEventId=null,this.showAuthChain=!1,this.showOutliers=!1,this.showStateSets=!1,this.collapse=!1,this.renderEvents={},this.scenarioFile=null}setShimUrl(t){this.shimUrl=t,console.log("setShimUrl",t)}async loadFile(t){const n=await Ba(t);this.loadScenarioFile(n)}loadScenarioFile(t){this.scenarioFile=JSON.parse(JSON.stringify(t));const n=xa(t);for(const r of n.events)this.cache.eventCache.store(r),r.type==="m.room.create"&&r.state_key===""&&(this.createEventId=r.event_id);if(n.precalculatedStateAfter)for(const r in n.precalculatedStateAfter){const i={};for(const s of n.precalculatedStateAfter[r]){const o=this.cache.eventCache.get(s);if(!o||o.state_key==null){console.log(`precalculated_state_after for ${r} includes ${s} but it isn't a state event we know about. Skipping.`);continue}i[JSON.stringify([o.type,o.state_key])]=o.event_id}this.cache.stateAtEvent.setState(r,i)}this.scenario=n,this.debugger=new Wr(n),n.onLoadAtStart&&n.events.length>=2&&this.debugger.goTo(n.events[1].event_id),Re.clear();let u=!1;n.events.forEach((r,i)=>{Re.appendEvent(i,r),r.prev_auth_events&&r.prev_auth_events.length>0&&(u=!0)}),Re.highlight(this.debugger.current()),Re.onEventClick(r=>{this.debugger.goTo(r),this.refresh(),Re.highlight(J.debugger.current())}),Re.onEventJsonClick(this.showEventJSONDialog.bind(this)),u&&Pr(n),this.refresh()}showEventJSONDialog(t){console.log("showEventJSONDialog",t);const n=gu.highlight(JSON.stringify(this.cache.eventCache.get(t),null,2),{language:"json"});document.getElementById("infocontainer-event-id").textContent=t,document.getElementById("eventdetails").innerHTML=n.value,document.getElementById("infocontainer").style.display="block"}setShowAuthChain(t){this.showAuthChain=t}setShowOutliers(t){this.showOutliers=t}setShowStateSets(t){this.showStateSets=t}setCollapse(t){this.collapse=t}async refresh(){let t=Object.create(null);for(const i of this.debugger.eventsUpToCurrent())t[i]=this.cache.eventCache.get(i);this.collapse&&(t=this.collapsifier(t));const n=[];for(const i in t)n.push(t[i]);let u={};const r=this.cache.eventCache.get(this.debugger.current());r&&(u=this.cache.stateAtEvent.getInverseStateForEventIds(new Set(r.prev_events))),la(document.getElementById("svgcontainer"),n,{currentEventId:this.debugger.current(),scenario:this.scenario,stateAtEvent:this.cache.stateAtEvent.getStateAsEventIds(this.debugger.current()),inverseStateSets:u,showStateSets:this.showStateSets,showAuthChainTransitiveReduction:this.showAuthChain,onEventIDClick:this.showEventJSONDialog.bind(this)})}findForwardExtremities(t){const n=new Set;for(const u in t)n.add(u);for(const u in t){const r=t[u];for(const i of r.prev_events)n.delete(i);for(const i of r.auth_events)n.delete(i)}return n}collapsifier(t){const n=JSON.parse(JSON.stringify(t)),u=this.findForwardExtremities(n),r=new Set;for(const c of u)r.add(c);const i=Object.create(null);for(const c in n){const f=n[c];for(const D of f.prev_events){const g=i[D]||0;i[D]=g+1}f.prev_events.length!==1&&r.add(f.event_id)}for(const c in i)i[c]>1&&r.add(c);const s=new Set;for(const c in n){if(r.has(c)){s.add(c);continue}const f=n[c];if(r.has(f.prev_events[0])){s.add(c);continue}for(const D of r){const g=n[D];if(!g)continue;let A=!1;for(const T of g.prev_events)if(T===c){s.add(c),A=!0;break}if(A)break}}const o=[],l=new Set;for(const c of u)o.push({id:c,from:c});for(;o.length>0;){const c=o.pop();if(!c)break;const f=c.id,D=n[f];if(l.has(f)||(l.add(f),!D))continue;for(const T of D.prev_events)o.push({id:T,from:c.id});if(s.has(f))continue;delete n[f];const g=n[c.from],A=[D.prev_events[0]];for(const T in g.prev_events)s.has(T)&&A.push(T);g.prev_events=A,g._collapse=g._collapse||0,g._collapse+=1,n[c.from]=g;for(const T of o)T.from===f&&(T.from=g.event_id)}return console.log("collapsifier complete"),n}}const Jt=document.getElementById("shimurl");let J=new Vu(new pu);J.setShimUrl(Jt.value);const vn=new Sa,fu=new ba(vn,e=>J.cache.eventCache.get(e.event_id));document.getElementById("showauthevents").addEventListener("change",e=>{J.setShowAuthChain(e.target.checked),J.refresh()});document.getElementById("showstatesets").addEventListener("change",e=>{J.setShowStateSets(e.target.checked),J.refresh()});document.getElementById("showoutliers").addEventListener("change",e=>{J.setShowOutliers(e.target.checked),J.refresh()});document.getElementById("showoutliers").checked=J.showOutliers;document.getElementById("collapse").addEventListener("change",e=>{J.setCollapse(e.target.checked),J.refresh()});document.getElementById("collapse").checked=J.collapse;document.getElementById("jsonfile").addEventListener("change",async e=>{const t=document.getElementById("jsonfile").files;t&&(J=new Vu(new pu),J.setShimUrl(Jt.value),await J.loadFile(t[0]))},!1);document.getElementById("infocontainer").style.display="none";document.addEventListener("click",e=>{const t=document.getElementById("infocontainer");t.contains(e.target)||(t.style.display="none")});document.getElementById("stepfwd").addEventListener("click",async e=>{J.debugger.next(),J.refresh(),Re.highlight(J.debugger.current())});document.getElementById("stepbwd").addEventListener("click",async e=>{J.debugger.previous(),J.refresh(),Re.highlight(J.debugger.current())});Jt.addEventListener("change",e=>{const t=e.target.value;J.setShimUrl(t),globalThis.localStorage.setItem("shim_url",t)});const rn=globalThis.localStorage.getItem("shim_url");rn&&(console.log("setting shim url from local storage"),Jt.value=rn,J.setShimUrl(rn));const hu=document.getElementById("loader"),$a=document.getElementById("loader-status"),Ge=e=>{$a.innerText=e};document.getElementById("resolve").addEventListener("click",async e=>{if(!J.shimUrl)return console.error("you need to set a shim url to resolve state!"),{};hu.style.display="block",Ge(`Connecting to ${J.shimUrl}`);try{await vn.connect(J.shimUrl,fu),await J.debugger.resolve(J.cache,async(t,n,u,r)=>{try{return Ge(`Resolving state at event ${r.event_id}`),(await fu.resolveState(t,n,u,r)).state}catch(i){throw console.error("failed to resolve state:",i),Ge(`Failed to resolve state at event ${r.event_id} : ${i}`),i}}),Ge("")}catch(t){console.error("resolving state failed: ",t)}finally{vn.close()}hu.style.display="none",J.refresh()});var du;(du=document.getElementById("share"))==null||du.addEventListener("click",async e=>{try{if(!J.scenarioFile)throw new Error("no loaded file");const t=Hr(J.scenarioFile),n=window.location.href.split("#")[0];await navigator.clipboard.writeText(`${n}#${t}`),Ge("Share link copied to clipboard")}catch(t){Ge(`Unable to copy to clipboard: ${t}`)}});var Eu;(Eu=document.getElementById("save"))==null||Eu.addEventListener("click",async e=>{if(!J.scenarioFile){Ge("No loaded scenario");return}const t=new Blob([JSON.stringify(J.scenarioFile,null,4)],{type:"text/plain"}),n=URL.createObjectURL(t),u=document.createElement("a");u.href=n,u.download="scenario.json5",document.body.appendChild(u),u.click(),document.body.removeChild(u),URL.revokeObjectURL(n)});const Du=new Go;WebAssembly.instantiateStreaming(fetch("gmsl.wasm"),Du.importObject).then(e=>{globalThis.wasm=e.instance,Du.run(globalThis.wasm);const t=u=>{J.loadScenarioFile(u)},n=document.getElementById("file-select");if(n&&(n.innerHTML="",Object.keys(lu).forEach((u,r)=>{n[r]=new Option(u)}),n.addEventListener("change",u=>{var i;const r=lu[(i=u==null?void 0:u.target)==null?void 0:i.value];t(r)})),globalThis.location.hash.length>1)try{const u=Jr(globalThis.location.hash.substring(1));t(u);return}catch(u){console.error("failed to read fragment: ",u)}t(Uu)});
