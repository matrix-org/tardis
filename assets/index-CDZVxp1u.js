(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const u of s.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&i(u)}).observe(document,{childList:!0,subtree:!0});function n(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(r){if(r.ep)return;r.ep=!0;const s=n(r);fetch(r.href,s)}})();var lr={value:()=>{}};function hn(){for(var t=0,e=arguments.length,n={},i;t<e;++t){if(!(i=arguments[t]+"")||i in n||/[\s.]/.test(i))throw new Error("illegal type: "+i);n[i]=[]}return new de(n)}function de(t){this._=t}function hr(t,e){return t.trim().split(/^|\s+/).map(function(n){var i="",r=n.indexOf(".");if(r>=0&&(i=n.slice(r+1),n=n.slice(0,r)),n&&!e.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:i}})}de.prototype=hn.prototype={constructor:de,on:function(t,e){var n=this._,i=hr(t+"",n),r,s=-1,u=i.length;if(arguments.length<2){for(;++s<u;)if((r=(t=i[s]).type)&&(r=cr(n[r],t.name)))return r;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++s<u;)if(r=(t=i[s]).type)n[r]=$n(n[r],t.name,e);else if(e==null)for(r in n)n[r]=$n(n[r],t.name,null);return this},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new de(t)},call:function(t,e){if((r=arguments.length-2)>0)for(var n=new Array(r),i=0,r,s;i<r;++i)n[i]=arguments[i+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(s=this._[t],i=0,r=s.length;i<r;++i)s[i].value.apply(e,n)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var i=this._[t],r=0,s=i.length;r<s;++r)i[r].value.apply(e,n)}};function cr(t,e){for(var n=0,i=t.length,r;n<i;++n)if((r=t[n]).name===e)return r.value}function $n(t,e,n){for(var i=0,r=t.length;i<r;++i)if(t[i].name===e){t[i]=lr,t=t.slice(0,i).concat(t.slice(i+1));break}return n!=null&&t.push({name:e,value:n}),t}var Je="http://www.w3.org/1999/xhtml";const Sn={svg:"http://www.w3.org/2000/svg",xhtml:Je,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Ie(t){var e=t+="",n=e.indexOf(":");return n>=0&&(e=t.slice(0,n))!=="xmlns"&&(t=t.slice(n+1)),Sn.hasOwnProperty(e)?{space:Sn[e],local:t}:t}function fr(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===Je&&e.documentElement.namespaceURI===Je?e.createElement(t):e.createElementNS(n,t)}}function dr(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function Di(t){var e=Ie(t);return(e.local?dr:fr)(e)}function pr(){}function cn(t){return t==null?pr:function(){return this.querySelector(t)}}function vr(t){typeof t!="function"&&(t=cn(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var s=e[r],u=s.length,o=i[r]=new Array(u),a,h,l=0;l<u;++l)(a=s[l])&&(h=t.call(a,a.__data__,l,s))&&("__data__"in a&&(h.__data__=a.__data__),o[l]=h);return new it(i,this._parents)}function fn(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function Dr(){return[]}function mi(t){return t==null?Dr:function(){return this.querySelectorAll(t)}}function mr(t){return function(){var e=t.apply(this,arguments);return e==null?[]:fn(e)}}function gr(t){typeof t=="function"?t=mr(t):t=mi(t);for(var e=this._groups,n=e.length,i=[],r=[],s=0;s<n;++s)for(var u=e[s],o=u.length,a,h=0;h<o;++h)(a=u[h])&&(i.push(t.call(a,a.__data__,h,u)),r.push(a));return new it(i,r)}function gi(t){return function(){return this.matches(t)}}function yi(t){return function(e){return e.matches(t)}}var yr=Array.prototype.find;function _r(t){return function(){return yr.call(this.children,t)}}function Er(){return this.firstElementChild}function Cr(t){return this.select(t==null?Er:_r(typeof t=="function"?t:yi(t)))}var Ar=Array.prototype.filter;function xr(){return this.children}function wr(t){return function(){return Ar.call(this.children,t)}}function br(t){return this.selectAll(t==null?xr:wr(typeof t=="function"?t:yi(t)))}function Fr(t){typeof t!="function"&&(t=gi(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var s=e[r],u=s.length,o=i[r]=[],a,h=0;h<u;++h)(a=s[h])&&t.call(a,a.__data__,h,s)&&o.push(a);return new it(i,this._parents)}function _i(t){return new Array(t.length)}function Br(){return new it(this._enter||this._groups.map(_i),this._parents)}function _e(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}_e.prototype={constructor:_e,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function Ir(t){return function(){return t}}function $r(t,e,n,i,r,s){for(var u=0,o,a=e.length,h=s.length;u<h;++u)(o=e[u])?(o.__data__=s[u],i[u]=o):n[u]=new _e(t,s[u]);for(;u<a;++u)(o=e[u])&&(r[u]=o)}function Sr(t,e,n,i,r,s,u){var o,a,h=new Map,l=e.length,c=s.length,f=new Array(l),d;for(o=0;o<l;++o)(a=e[o])&&(f[o]=d=u.call(a,a.__data__,o,e)+"",h.has(d)?r[o]=a:h.set(d,a));for(o=0;o<c;++o)d=u.call(t,s[o],o,s)+"",(a=h.get(d))?(i[o]=a,a.__data__=s[o],h.delete(d)):n[o]=new _e(t,s[o]);for(o=0;o<l;++o)(a=e[o])&&h.get(f[o])===a&&(r[o]=a)}function Mr(t){return t.__data__}function Tr(t,e){if(!arguments.length)return Array.from(this,Mr);var n=e?Sr:$r,i=this._parents,r=this._groups;typeof t!="function"&&(t=Ir(t));for(var s=r.length,u=new Array(s),o=new Array(s),a=new Array(s),h=0;h<s;++h){var l=i[h],c=r[h],f=c.length,d=fn(t.call(l,l&&l.__data__,h,i)),g=d.length,v=o[h]=new Array(g),E=u[h]=new Array(g),m=a[h]=new Array(f);n(l,c,v,E,m,d,e);for(var B=0,b=0,C,A;B<g;++B)if(C=v[B]){for(B>=b&&(b=B+1);!(A=E[b])&&++b<g;);C._next=A||null}}return u=new it(u,i),u._enter=o,u._exit=a,u}function Rr(){return new it(this._exit||this._groups.map(_i),this._parents)}function kr(t,e,n){var i=this.enter(),r=this,s=this.exit();return i=typeof t=="function"?t(i):i.append(t+""),e!=null&&(r=e(r)),n==null?s.remove():n(s),i&&r?i.merge(r).order():r}function Nr(t){if(!(t instanceof it))throw new Error("invalid merge");for(var e=this._groups,n=t._groups,i=e.length,r=n.length,s=Math.min(i,r),u=new Array(i),o=0;o<s;++o)for(var a=e[o],h=n[o],l=a.length,c=u[o]=new Array(l),f,d=0;d<l;++d)(f=a[d]||h[d])&&(c[d]=f);for(;o<i;++o)u[o]=e[o];return new it(u,this._parents)}function Or(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var i=t[e],r=i.length-1,s=i[r],u;--r>=0;)(u=i[r])&&(s&&u.compareDocumentPosition(s)^4&&s.parentNode.insertBefore(u,s),s=u);return this}function Lr(t){t||(t=Pr);function e(c,f){return c&&f?t(c.__data__,f.__data__):!c-!f}for(var n=this._groups,i=n.length,r=new Array(i),s=0;s<i;++s){for(var u=n[s],o=u.length,a=r[s]=new Array(o),h,l=0;l<o;++l)(h=u[l])&&(a[l]=h);a.sort(e)}return new it(r,this._parents).order()}function Pr(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function Vr(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this}function zr(){return Array.from(this)}function jr(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var i=t[e],r=0,s=i.length;r<s;++r){var u=i[r];if(u)return u}return null}function qr(){let t=0;for(const e of this)++t;return t}function Jr(){return!this.node()}function Gr(t){for(var e=this._groups,n=0,i=e.length;n<i;++n)for(var r=e[n],s=0,u=r.length,o;s<u;++s)(o=r[s])&&t.call(o,o.__data__,s,r);return this}function Hr(t){return function(){this.removeAttribute(t)}}function Ur(t){return function(){this.removeAttributeNS(t.space,t.local)}}function Wr(t,e){return function(){this.setAttribute(t,e)}}function Xr(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function Yr(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttribute(t):this.setAttribute(t,n)}}function Kr(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}function Zr(t,e){var n=Ie(t);if(arguments.length<2){var i=this.node();return n.local?i.getAttributeNS(n.space,n.local):i.getAttribute(n)}return this.each((e==null?n.local?Ur:Hr:typeof e=="function"?n.local?Kr:Yr:n.local?Xr:Wr)(n,e))}function Ei(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function Qr(t){return function(){this.style.removeProperty(t)}}function ts(t,e,n){return function(){this.style.setProperty(t,e,n)}}function es(t,e,n){return function(){var i=e.apply(this,arguments);i==null?this.style.removeProperty(t):this.style.setProperty(t,i,n)}}function ns(t,e,n){return arguments.length>1?this.each((e==null?Qr:typeof e=="function"?es:ts)(t,e,n??"")):jt(this.node(),t)}function jt(t,e){return t.style.getPropertyValue(e)||Ei(t).getComputedStyle(t,null).getPropertyValue(e)}function is(t){return function(){delete this[t]}}function rs(t,e){return function(){this[t]=e}}function ss(t,e){return function(){var n=e.apply(this,arguments);n==null?delete this[t]:this[t]=n}}function us(t,e){return arguments.length>1?this.each((e==null?is:typeof e=="function"?ss:rs)(t,e)):this.node()[t]}function Ci(t){return t.trim().split(/^|\s+/)}function dn(t){return t.classList||new Ai(t)}function Ai(t){this._node=t,this._names=Ci(t.getAttribute("class")||"")}Ai.prototype={add:function(t){var e=this._names.indexOf(t);e<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function xi(t,e){for(var n=dn(t),i=-1,r=e.length;++i<r;)n.add(e[i])}function wi(t,e){for(var n=dn(t),i=-1,r=e.length;++i<r;)n.remove(e[i])}function os(t){return function(){xi(this,t)}}function as(t){return function(){wi(this,t)}}function ls(t,e){return function(){(e.apply(this,arguments)?xi:wi)(this,t)}}function hs(t,e){var n=Ci(t+"");if(arguments.length<2){for(var i=dn(this.node()),r=-1,s=n.length;++r<s;)if(!i.contains(n[r]))return!1;return!0}return this.each((typeof e=="function"?ls:e?os:as)(n,e))}function cs(){this.textContent=""}function fs(t){return function(){this.textContent=t}}function ds(t){return function(){var e=t.apply(this,arguments);this.textContent=e??""}}function ps(t){return arguments.length?this.each(t==null?cs:(typeof t=="function"?ds:fs)(t)):this.node().textContent}function vs(){this.innerHTML=""}function Ds(t){return function(){this.innerHTML=t}}function ms(t){return function(){var e=t.apply(this,arguments);this.innerHTML=e??""}}function gs(t){return arguments.length?this.each(t==null?vs:(typeof t=="function"?ms:Ds)(t)):this.node().innerHTML}function ys(){this.nextSibling&&this.parentNode.appendChild(this)}function _s(){return this.each(ys)}function Es(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Cs(){return this.each(Es)}function As(t){var e=typeof t=="function"?t:Di(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function xs(){return null}function ws(t,e){var n=typeof t=="function"?t:Di(t),i=e==null?xs:typeof e=="function"?e:cn(e);return this.select(function(){return this.insertBefore(n.apply(this,arguments),i.apply(this,arguments)||null)})}function bs(){var t=this.parentNode;t&&t.removeChild(this)}function Fs(){return this.each(bs)}function Bs(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function Is(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function $s(t){return this.select(t?Is:Bs)}function Ss(t){return arguments.length?this.property("__data__",t):this.node().__data__}function Ms(t){return function(e){t.call(this,e,this.__data__)}}function Ts(t){return t.trim().split(/^|\s+/).map(function(e){var n="",i=e.indexOf(".");return i>=0&&(n=e.slice(i+1),e=e.slice(0,i)),{type:e,name:n}})}function Rs(t){return function(){var e=this.__on;if(e){for(var n=0,i=-1,r=e.length,s;n<r;++n)s=e[n],(!t.type||s.type===t.type)&&s.name===t.name?this.removeEventListener(s.type,s.listener,s.options):e[++i]=s;++i?e.length=i:delete this.__on}}}function ks(t,e,n){return function(){var i=this.__on,r,s=Ms(e);if(i){for(var u=0,o=i.length;u<o;++u)if((r=i[u]).type===t.type&&r.name===t.name){this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=s,r.options=n),r.value=e;return}}this.addEventListener(t.type,s,n),r={type:t.type,name:t.name,value:e,listener:s,options:n},i?i.push(r):this.__on=[r]}}function Ns(t,e,n){var i=Ts(t+""),r,s=i.length,u;if(arguments.length<2){var o=this.node().__on;if(o){for(var a=0,h=o.length,l;a<h;++a)for(r=0,l=o[a];r<s;++r)if((u=i[r]).type===l.type&&u.name===l.name)return l.value}return}for(o=e?ks:Rs,r=0;r<s;++r)this.each(o(i[r],e,n));return this}function bi(t,e,n){var i=Ei(t),r=i.CustomEvent;typeof r=="function"?r=new r(e,n):(r=i.document.createEvent("Event"),n?(r.initEvent(e,n.bubbles,n.cancelable),r.detail=n.detail):r.initEvent(e,!1,!1)),t.dispatchEvent(r)}function Os(t,e){return function(){return bi(this,t,e)}}function Ls(t,e){return function(){return bi(this,t,e.apply(this,arguments))}}function Ps(t,e){return this.each((typeof e=="function"?Ls:Os)(t,e))}function*Vs(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var i=t[e],r=0,s=i.length,u;r<s;++r)(u=i[r])&&(yield u)}var pn=[null];function it(t,e){this._groups=t,this._parents=e}function se(){return new it([[document.documentElement]],pn)}function zs(){return this}it.prototype=se.prototype={constructor:it,select:vr,selectAll:gr,selectChild:Cr,selectChildren:br,filter:Fr,data:Tr,enter:Br,exit:Rr,join:kr,merge:Nr,selection:zs,order:Or,sort:Lr,call:Vr,nodes:zr,node:jr,size:qr,empty:Jr,each:Gr,attr:Zr,style:ns,property:us,classed:hs,text:ps,html:gs,raise:_s,lower:Cs,append:As,insert:ws,remove:Fs,clone:$s,datum:Ss,on:Ns,dispatch:Ps,[Symbol.iterator]:Vs};function et(t){return typeof t=="string"?new it([[document.querySelector(t)]],[document.documentElement]):new it([[t]],pn)}function js(t){let e;for(;e=t.sourceEvent;)t=e;return t}function $t(t,e){if(t=js(t),e===void 0&&(e=t.currentTarget),e){var n=e.ownerSVGElement||e;if(n.createSVGPoint){var i=n.createSVGPoint();return i.x=t.clientX,i.y=t.clientY,i=i.matrixTransform(e.getScreenCTM().inverse()),[i.x,i.y]}if(e.getBoundingClientRect){var r=e.getBoundingClientRect();return[t.clientX-r.left-e.clientLeft,t.clientY-r.top-e.clientTop]}}return[t.pageX,t.pageY]}function ue(t){return typeof t=="string"?new it([document.querySelectorAll(t)],[document.documentElement]):new it([t==null?[]:fn(t)],pn)}function Ge(t){t.preventDefault(),t.stopImmediatePropagation()}function qs(t){var e=t.document.documentElement,n=et(t).on("dragstart.drag",Ge,!0);"onselectstart"in e?n.on("selectstart.drag",Ge,!0):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}function Js(t,e){var n=t.document.documentElement,i=et(t).on("dragstart.drag",null);e&&(i.on("click.drag",Ge,!0),setTimeout(function(){i.on("click.drag",null)},0)),"onselectstart"in n?i.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}function $e(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function vn(t,e){var n=Object.create(t.prototype);for(var i in e)n[i]=e[i];return n}function Gt(){}var Nt=.7,qt=1/Nt,Vt="\\s*([+-]?\\d+)\\s*",ee="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",Dt="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Gs=/^#([0-9a-f]{3,8})$/,Hs=new RegExp("^rgb\\("+[Vt,Vt,Vt]+"\\)$"),Us=new RegExp("^rgb\\("+[Dt,Dt,Dt]+"\\)$"),Ws=new RegExp("^rgba\\("+[Vt,Vt,Vt,ee]+"\\)$"),Xs=new RegExp("^rgba\\("+[Dt,Dt,Dt,ee]+"\\)$"),Ys=new RegExp("^hsl\\("+[ee,Dt,Dt]+"\\)$"),Ks=new RegExp("^hsla\\("+[ee,Dt,Dt,ee]+"\\)$"),Mn={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};$e(Gt,ne,{copy:function(t){return Object.assign(new this.constructor,this,t)},displayable:function(){return this.rgb().displayable()},hex:Tn,formatHex:Tn,formatHsl:Zs,formatRgb:Rn,toString:Rn});function Tn(){return this.rgb().formatHex()}function Zs(){return Bi(this).formatHsl()}function Rn(){return this.rgb().formatRgb()}function ne(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=Gs.exec(t))?(n=e[1].length,e=parseInt(e[1],16),n===6?kn(e):n===3?new st(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):n===8?oe(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):n===4?oe(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=Hs.exec(t))?new st(e[1],e[2],e[3],1):(e=Us.exec(t))?new st(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=Ws.exec(t))?oe(e[1],e[2],e[3],e[4]):(e=Xs.exec(t))?oe(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=Ys.exec(t))?Ln(e[1],e[2]/100,e[3]/100,1):(e=Ks.exec(t))?Ln(e[1],e[2]/100,e[3]/100,e[4]):Mn.hasOwnProperty(t)?kn(Mn[t]):t==="transparent"?new st(NaN,NaN,NaN,0):null}function kn(t){return new st(t>>16&255,t>>8&255,t&255,1)}function oe(t,e,n,i){return i<=0&&(t=e=n=NaN),new st(t,e,n,i)}function Fi(t){return t instanceof Gt||(t=ne(t)),t?(t=t.rgb(),new st(t.r,t.g,t.b,t.opacity)):new st}function He(t,e,n,i){return arguments.length===1?Fi(t):new st(t,e,n,i??1)}function st(t,e,n,i){this.r=+t,this.g=+e,this.b=+n,this.opacity=+i}$e(st,He,vn(Gt,{brighter:function(t){return t=t==null?qt:Math.pow(qt,t),new st(this.r*t,this.g*t,this.b*t,this.opacity)},darker:function(t){return t=t==null?Nt:Math.pow(Nt,t),new st(this.r*t,this.g*t,this.b*t,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Nn,formatHex:Nn,formatRgb:On,toString:On}));function Nn(){return"#"+Re(this.r)+Re(this.g)+Re(this.b)}function On(){var t=this.opacity;return t=isNaN(t)?1:Math.max(0,Math.min(1,t)),(t===1?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(t===1?")":", "+t+")")}function Re(t){return t=Math.max(0,Math.min(255,Math.round(t)||0)),(t<16?"0":"")+t.toString(16)}function Ln(t,e,n,i){return i<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new vt(t,e,n,i)}function Bi(t){if(t instanceof vt)return new vt(t.h,t.s,t.l,t.opacity);if(t instanceof Gt||(t=ne(t)),!t)return new vt;if(t instanceof vt)return t;t=t.rgb();var e=t.r/255,n=t.g/255,i=t.b/255,r=Math.min(e,n,i),s=Math.max(e,n,i),u=NaN,o=s-r,a=(s+r)/2;return o?(e===s?u=(n-i)/o+(n<i)*6:n===s?u=(i-e)/o+2:u=(e-n)/o+4,o/=a<.5?s+r:2-s-r,u*=60):o=a>0&&a<1?0:u,new vt(u,o,a,t.opacity)}function Qs(t,e,n,i){return arguments.length===1?Bi(t):new vt(t,e,n,i??1)}function vt(t,e,n,i){this.h=+t,this.s=+e,this.l=+n,this.opacity=+i}$e(vt,Qs,vn(Gt,{brighter:function(t){return t=t==null?qt:Math.pow(qt,t),new vt(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=t==null?Nt:Math.pow(Nt,t),new vt(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,i=n+(n<.5?n:1-n)*e,r=2*n-i;return new st(ke(t>=240?t-240:t+120,r,i),ke(t,r,i),ke(t<120?t+240:t-120,r,i),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var t=this.opacity;return t=isNaN(t)?1:Math.max(0,Math.min(1,t)),(t===1?"hsl(":"hsla(")+(this.h||0)+", "+(this.s||0)*100+"%, "+(this.l||0)*100+"%"+(t===1?")":", "+t+")")}}));function ke(t,e,n){return(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)*255}const tu=Math.PI/180,eu=180/Math.PI;var Ii=-.14861,Dn=1.78277,mn=-.29227,Se=-.90649,ie=1.97294,Pn=ie*Se,Vn=ie*Dn,zn=Dn*mn-Se*Ii;function nu(t){if(t instanceof kt)return new kt(t.h,t.s,t.l,t.opacity);t instanceof st||(t=Fi(t));var e=t.r/255,n=t.g/255,i=t.b/255,r=(zn*i+Pn*e-Vn*n)/(zn+Pn-Vn),s=i-r,u=(ie*(n-r)-mn*s)/Se,o=Math.sqrt(u*u+s*s)/(ie*r*(1-r)),a=o?Math.atan2(u,s)*eu-120:NaN;return new kt(a<0?a+360:a,o,r,t.opacity)}function Bt(t,e,n,i){return arguments.length===1?nu(t):new kt(t,e,n,i??1)}function kt(t,e,n,i){this.h=+t,this.s=+e,this.l=+n,this.opacity=+i}$e(kt,Bt,vn(Gt,{brighter:function(t){return t=t==null?qt:Math.pow(qt,t),new kt(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=t==null?Nt:Math.pow(Nt,t),new kt(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=isNaN(this.h)?0:(this.h+120)*tu,e=+this.l,n=isNaN(this.s)?0:this.s*e*(1-e),i=Math.cos(t),r=Math.sin(t);return new st(255*(e+n*(Ii*i+Dn*r)),255*(e+n*(mn*i+Se*r)),255*(e+n*(ie*i)),this.opacity)}}));const gn=t=>()=>t;function $i(t,e){return function(n){return t+n*e}}function iu(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(i){return Math.pow(t+i*e,n)}}function ru(t,e){var n=e-t;return n?$i(t,n>180||n<-180?n-360*Math.round(n/360):n):gn(isNaN(t)?e:t)}function su(t){return(t=+t)==1?zt:function(e,n){return n-e?iu(e,n,t):gn(isNaN(e)?n:e)}}function zt(t,e){var n=e-t;return n?$i(t,n):gn(isNaN(t)?e:t)}const jn=function t(e){var n=su(e);function i(r,s){var u=n((r=He(r)).r,(s=He(s)).r),o=n(r.g,s.g),a=n(r.b,s.b),h=zt(r.opacity,s.opacity);return function(l){return r.r=u(l),r.g=o(l),r.b=a(l),r.opacity=h(l),r+""}}return i.gamma=t,i}(1);function bt(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}var Ue=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Ne=new RegExp(Ue.source,"g");function uu(t){return function(){return t}}function ou(t){return function(e){return t(e)+""}}function au(t,e){var n=Ue.lastIndex=Ne.lastIndex=0,i,r,s,u=-1,o=[],a=[];for(t=t+"",e=e+"";(i=Ue.exec(t))&&(r=Ne.exec(e));)(s=r.index)>n&&(s=e.slice(n,s),o[u]?o[u]+=s:o[++u]=s),(i=i[0])===(r=r[0])?o[u]?o[u]+=r:o[++u]=r:(o[++u]=null,a.push({i:u,x:bt(i,r)})),n=Ne.lastIndex;return n<e.length&&(s=e.slice(n),o[u]?o[u]+=s:o[++u]=s),o.length<2?a[0]?ou(a[0].x):uu(e):(e=a.length,function(h){for(var l=0,c;l<e;++l)o[(c=a[l]).i]=c.x(h);return o.join("")})}var qn=180/Math.PI,We={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Si(t,e,n,i,r,s){var u,o,a;return(u=Math.sqrt(t*t+e*e))&&(t/=u,e/=u),(a=t*n+e*i)&&(n-=t*a,i-=e*a),(o=Math.sqrt(n*n+i*i))&&(n/=o,i/=o,a/=o),t*i<e*n&&(t=-t,e=-e,a=-a,u=-u),{translateX:r,translateY:s,rotate:Math.atan2(e,t)*qn,skewX:Math.atan(a)*qn,scaleX:u,scaleY:o}}var ae;function lu(t){const e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?We:Si(e.a,e.b,e.c,e.d,e.e,e.f)}function hu(t){return t==null||(ae||(ae=document.createElementNS("http://www.w3.org/2000/svg","g")),ae.setAttribute("transform",t),!(t=ae.transform.baseVal.consolidate()))?We:(t=t.matrix,Si(t.a,t.b,t.c,t.d,t.e,t.f))}function Mi(t,e,n,i){function r(h){return h.length?h.pop()+" ":""}function s(h,l,c,f,d,g){if(h!==c||l!==f){var v=d.push("translate(",null,e,null,n);g.push({i:v-4,x:bt(h,c)},{i:v-2,x:bt(l,f)})}else(c||f)&&d.push("translate("+c+e+f+n)}function u(h,l,c,f){h!==l?(h-l>180?l+=360:l-h>180&&(h+=360),f.push({i:c.push(r(c)+"rotate(",null,i)-2,x:bt(h,l)})):l&&c.push(r(c)+"rotate("+l+i)}function o(h,l,c,f){h!==l?f.push({i:c.push(r(c)+"skewX(",null,i)-2,x:bt(h,l)}):l&&c.push(r(c)+"skewX("+l+i)}function a(h,l,c,f,d,g){if(h!==c||l!==f){var v=d.push(r(d)+"scale(",null,",",null,")");g.push({i:v-4,x:bt(h,c)},{i:v-2,x:bt(l,f)})}else(c!==1||f!==1)&&d.push(r(d)+"scale("+c+","+f+")")}return function(h,l){var c=[],f=[];return h=t(h),l=t(l),s(h.translateX,h.translateY,l.translateX,l.translateY,c,f),u(h.rotate,l.rotate,c,f),o(h.skewX,l.skewX,c,f),a(h.scaleX,h.scaleY,l.scaleX,l.scaleY,c,f),h=l=null,function(d){for(var g=-1,v=f.length,E;++g<v;)c[(E=f[g]).i]=E.x(d);return c.join("")}}}var cu=Mi(lu,"px, ","px)","deg)"),fu=Mi(hu,", ",")",")"),du=1e-12;function Jn(t){return((t=Math.exp(t))+1/t)/2}function pu(t){return((t=Math.exp(t))-1/t)/2}function vu(t){return((t=Math.exp(2*t))-1)/(t+1)}const Du=function t(e,n,i){function r(s,u){var o=s[0],a=s[1],h=s[2],l=u[0],c=u[1],f=u[2],d=l-o,g=c-a,v=d*d+g*g,E,m;if(v<du)m=Math.log(f/h)/e,E=function(S){return[o+S*d,a+S*g,h*Math.exp(e*S*m)]};else{var B=Math.sqrt(v),b=(f*f-h*h+i*v)/(2*h*n*B),C=(f*f-h*h-i*v)/(2*f*n*B),A=Math.log(Math.sqrt(b*b+1)-b),x=Math.log(Math.sqrt(C*C+1)-C);m=(x-A)/e,E=function(S){var _=S*m,w=Jn(A),$=h/(n*B)*(w*vu(e*_+A)-pu(A));return[o+$*d,a+$*g,h*w/Jn(e*_+A)]}}return E.duration=m*1e3*e/Math.SQRT2,E}return r.rho=function(s){var u=Math.max(.001,+s),o=u*u,a=o*o;return t(u,o,a)},r}(Math.SQRT2,2,4);function Ti(t){return function e(n){n=+n;function i(r,s){var u=t((r=Bt(r)).h,(s=Bt(s)).h),o=zt(r.s,s.s),a=zt(r.l,s.l),h=zt(r.opacity,s.opacity);return function(l){return r.h=u(l),r.s=o(l),r.l=a(Math.pow(l,n)),r.opacity=h(l),r+""}}return i.gamma=e,i}(1)}Ti(ru);var Ri=Ti(zt),Jt=0,Yt=0,Ut=0,ki=1e3,Ee,Kt,Ce=0,Ot=0,Me=0,re=typeof performance=="object"&&performance.now?performance:Date,Ni=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function yn(){return Ot||(Ni(mu),Ot=re.now()+Me)}function mu(){Ot=0}function Ae(){this._call=this._time=this._next=null}Ae.prototype=Oi.prototype={constructor:Ae,restart:function(t,e,n){if(typeof t!="function")throw new TypeError("callback is not a function");n=(n==null?yn():+n)+(e==null?0:+e),!this._next&&Kt!==this&&(Kt?Kt._next=this:Ee=this,Kt=this),this._call=t,this._time=n,Xe()},stop:function(){this._call&&(this._call=null,this._time=1/0,Xe())}};function Oi(t,e,n){var i=new Ae;return i.restart(t,e,n),i}function gu(){yn(),++Jt;for(var t=Ee,e;t;)(e=Ot-t._time)>=0&&t._call.call(null,e),t=t._next;--Jt}function Gn(){Ot=(Ce=re.now())+Me,Jt=Yt=0;try{gu()}finally{Jt=0,_u(),Ot=0}}function yu(){var t=re.now(),e=t-Ce;e>ki&&(Me-=e,Ce=t)}function _u(){for(var t,e=Ee,n,i=1/0;e;)e._call?(i>e._time&&(i=e._time),t=e,e=e._next):(n=e._next,e._next=null,e=t?t._next=n:Ee=n);Kt=t,Xe(i)}function Xe(t){if(!Jt){Yt&&(Yt=clearTimeout(Yt));var e=t-Ot;e>24?(t<1/0&&(Yt=setTimeout(Gn,t-re.now()-Me)),Ut&&(Ut=clearInterval(Ut))):(Ut||(Ce=re.now(),Ut=setInterval(yu,ki)),Jt=1,Ni(Gn))}}function Hn(t,e,n){var i=new Ae;return e=e==null?0:+e,i.restart(r=>{i.stop(),t(r+e)},e,n),i}var Eu=hn("start","end","cancel","interrupt"),Cu=[],Li=0,Un=1,Ye=2,pe=3,Wn=4,Ke=5,ve=6;function Te(t,e,n,i,r,s){var u=t.__transition;if(!u)t.__transition={};else if(n in u)return;Au(t,n,{name:e,index:i,group:r,on:Eu,tween:Cu,time:s.time,delay:s.delay,duration:s.duration,ease:s.ease,timer:null,state:Li})}function _n(t,e){var n=dt(t,e);if(n.state>Li)throw new Error("too late; already scheduled");return n}function mt(t,e){var n=dt(t,e);if(n.state>pe)throw new Error("too late; already running");return n}function dt(t,e){var n=t.__transition;if(!n||!(n=n[e]))throw new Error("transition not found");return n}function Au(t,e,n){var i=t.__transition,r;i[e]=n,n.timer=Oi(s,0,n.time);function s(h){n.state=Un,n.timer.restart(u,n.delay,n.time),n.delay<=h&&u(h-n.delay)}function u(h){var l,c,f,d;if(n.state!==Un)return a();for(l in i)if(d=i[l],d.name===n.name){if(d.state===pe)return Hn(u);d.state===Wn?(d.state=ve,d.timer.stop(),d.on.call("interrupt",t,t.__data__,d.index,d.group),delete i[l]):+l<e&&(d.state=ve,d.timer.stop(),d.on.call("cancel",t,t.__data__,d.index,d.group),delete i[l])}if(Hn(function(){n.state===pe&&(n.state=Wn,n.timer.restart(o,n.delay,n.time),o(h))}),n.state=Ye,n.on.call("start",t,t.__data__,n.index,n.group),n.state===Ye){for(n.state=pe,r=new Array(f=n.tween.length),l=0,c=-1;l<f;++l)(d=n.tween[l].value.call(t,t.__data__,n.index,n.group))&&(r[++c]=d);r.length=c+1}}function o(h){for(var l=h<n.duration?n.ease.call(null,h/n.duration):(n.timer.restart(a),n.state=Ke,1),c=-1,f=r.length;++c<f;)r[c].call(t,l);n.state===Ke&&(n.on.call("end",t,t.__data__,n.index,n.group),a())}function a(){n.state=ve,n.timer.stop(),delete i[e];for(var h in i)return;delete t.__transition}}function De(t,e){var n=t.__transition,i,r,s=!0,u;if(n){e=e==null?null:e+"";for(u in n){if((i=n[u]).name!==e){s=!1;continue}r=i.state>Ye&&i.state<Ke,i.state=ve,i.timer.stop(),i.on.call(r?"interrupt":"cancel",t,t.__data__,i.index,i.group),delete n[u]}s&&delete t.__transition}}function xu(t){return this.each(function(){De(this,t)})}function wu(t,e){var n,i;return function(){var r=mt(this,t),s=r.tween;if(s!==n){i=n=s;for(var u=0,o=i.length;u<o;++u)if(i[u].name===e){i=i.slice(),i.splice(u,1);break}}r.tween=i}}function bu(t,e,n){var i,r;if(typeof n!="function")throw new Error;return function(){var s=mt(this,t),u=s.tween;if(u!==i){r=(i=u).slice();for(var o={name:e,value:n},a=0,h=r.length;a<h;++a)if(r[a].name===e){r[a]=o;break}a===h&&r.push(o)}s.tween=r}}function Fu(t,e){var n=this._id;if(t+="",arguments.length<2){for(var i=dt(this.node(),n).tween,r=0,s=i.length,u;r<s;++r)if((u=i[r]).name===t)return u.value;return null}return this.each((e==null?wu:bu)(n,t,e))}function En(t,e,n){var i=t._id;return t.each(function(){var r=mt(this,i);(r.value||(r.value={}))[e]=n.apply(this,arguments)}),function(r){return dt(r,i).value[e]}}function Pi(t,e){var n;return(typeof e=="number"?bt:e instanceof ne?jn:(n=ne(e))?(e=n,jn):au)(t,e)}function Bu(t){return function(){this.removeAttribute(t)}}function Iu(t){return function(){this.removeAttributeNS(t.space,t.local)}}function $u(t,e,n){var i,r=n+"",s;return function(){var u=this.getAttribute(t);return u===r?null:u===i?s:s=e(i=u,n)}}function Su(t,e,n){var i,r=n+"",s;return function(){var u=this.getAttributeNS(t.space,t.local);return u===r?null:u===i?s:s=e(i=u,n)}}function Mu(t,e,n){var i,r,s;return function(){var u,o=n(this),a;return o==null?void this.removeAttribute(t):(u=this.getAttribute(t),a=o+"",u===a?null:u===i&&a===r?s:(r=a,s=e(i=u,o)))}}function Tu(t,e,n){var i,r,s;return function(){var u,o=n(this),a;return o==null?void this.removeAttributeNS(t.space,t.local):(u=this.getAttributeNS(t.space,t.local),a=o+"",u===a?null:u===i&&a===r?s:(r=a,s=e(i=u,o)))}}function Ru(t,e){var n=Ie(t),i=n==="transform"?fu:Pi;return this.attrTween(t,typeof e=="function"?(n.local?Tu:Mu)(n,i,En(this,"attr."+t,e)):e==null?(n.local?Iu:Bu)(n):(n.local?Su:$u)(n,i,e))}function ku(t,e){return function(n){this.setAttribute(t,e.call(this,n))}}function Nu(t,e){return function(n){this.setAttributeNS(t.space,t.local,e.call(this,n))}}function Ou(t,e){var n,i;function r(){var s=e.apply(this,arguments);return s!==i&&(n=(i=s)&&Nu(t,s)),n}return r._value=e,r}function Lu(t,e){var n,i;function r(){var s=e.apply(this,arguments);return s!==i&&(n=(i=s)&&ku(t,s)),n}return r._value=e,r}function Pu(t,e){var n="attr."+t;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(e==null)return this.tween(n,null);if(typeof e!="function")throw new Error;var i=Ie(t);return this.tween(n,(i.local?Ou:Lu)(i,e))}function Vu(t,e){return function(){_n(this,t).delay=+e.apply(this,arguments)}}function zu(t,e){return e=+e,function(){_n(this,t).delay=e}}function ju(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?Vu:zu)(e,t)):dt(this.node(),e).delay}function qu(t,e){return function(){mt(this,t).duration=+e.apply(this,arguments)}}function Ju(t,e){return e=+e,function(){mt(this,t).duration=e}}function Gu(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?qu:Ju)(e,t)):dt(this.node(),e).duration}function Hu(t,e){if(typeof e!="function")throw new Error;return function(){mt(this,t).ease=e}}function Uu(t){var e=this._id;return arguments.length?this.each(Hu(e,t)):dt(this.node(),e).ease}function Wu(t,e){return function(){var n=e.apply(this,arguments);if(typeof n!="function")throw new Error;mt(this,t).ease=n}}function Xu(t){if(typeof t!="function")throw new Error;return this.each(Wu(this._id,t))}function Yu(t){typeof t!="function"&&(t=gi(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var s=e[r],u=s.length,o=i[r]=[],a,h=0;h<u;++h)(a=s[h])&&t.call(a,a.__data__,h,s)&&o.push(a);return new At(i,this._parents,this._name,this._id)}function Ku(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,n=t._groups,i=e.length,r=n.length,s=Math.min(i,r),u=new Array(i),o=0;o<s;++o)for(var a=e[o],h=n[o],l=a.length,c=u[o]=new Array(l),f,d=0;d<l;++d)(f=a[d]||h[d])&&(c[d]=f);for(;o<i;++o)u[o]=e[o];return new At(u,this._parents,this._name,this._id)}function Zu(t){return(t+"").trim().split(/^|\s+/).every(function(e){var n=e.indexOf(".");return n>=0&&(e=e.slice(0,n)),!e||e==="start"})}function Qu(t,e,n){var i,r,s=Zu(e)?_n:mt;return function(){var u=s(this,t),o=u.on;o!==i&&(r=(i=o).copy()).on(e,n),u.on=r}}function to(t,e){var n=this._id;return arguments.length<2?dt(this.node(),n).on.on(t):this.each(Qu(n,t,e))}function eo(t){return function(){var e=this.parentNode;for(var n in this.__transition)if(+n!==t)return;e&&e.removeChild(this)}}function no(){return this.on("end.remove",eo(this._id))}function io(t){var e=this._name,n=this._id;typeof t!="function"&&(t=cn(t));for(var i=this._groups,r=i.length,s=new Array(r),u=0;u<r;++u)for(var o=i[u],a=o.length,h=s[u]=new Array(a),l,c,f=0;f<a;++f)(l=o[f])&&(c=t.call(l,l.__data__,f,o))&&("__data__"in l&&(c.__data__=l.__data__),h[f]=c,Te(h[f],e,n,f,h,dt(l,n)));return new At(s,this._parents,e,n)}function ro(t){var e=this._name,n=this._id;typeof t!="function"&&(t=mi(t));for(var i=this._groups,r=i.length,s=[],u=[],o=0;o<r;++o)for(var a=i[o],h=a.length,l,c=0;c<h;++c)if(l=a[c]){for(var f=t.call(l,l.__data__,c,a),d,g=dt(l,n),v=0,E=f.length;v<E;++v)(d=f[v])&&Te(d,e,n,v,f,g);s.push(f),u.push(l)}return new At(s,u,e,n)}var so=se.prototype.constructor;function uo(){return new so(this._groups,this._parents)}function oo(t,e){var n,i,r;return function(){var s=jt(this,t),u=(this.style.removeProperty(t),jt(this,t));return s===u?null:s===n&&u===i?r:r=e(n=s,i=u)}}function Vi(t){return function(){this.style.removeProperty(t)}}function ao(t,e,n){var i,r=n+"",s;return function(){var u=jt(this,t);return u===r?null:u===i?s:s=e(i=u,n)}}function lo(t,e,n){var i,r,s;return function(){var u=jt(this,t),o=n(this),a=o+"";return o==null&&(a=o=(this.style.removeProperty(t),jt(this,t))),u===a?null:u===i&&a===r?s:(r=a,s=e(i=u,o))}}function ho(t,e){var n,i,r,s="style."+e,u="end."+s,o;return function(){var a=mt(this,t),h=a.on,l=a.value[s]==null?o||(o=Vi(e)):void 0;(h!==n||r!==l)&&(i=(n=h).copy()).on(u,r=l),a.on=i}}function co(t,e,n){var i=(t+="")=="transform"?cu:Pi;return e==null?this.styleTween(t,oo(t,i)).on("end.style."+t,Vi(t)):typeof e=="function"?this.styleTween(t,lo(t,i,En(this,"style."+t,e))).each(ho(this._id,t)):this.styleTween(t,ao(t,i,e),n).on("end.style."+t,null)}function fo(t,e,n){return function(i){this.style.setProperty(t,e.call(this,i),n)}}function po(t,e,n){var i,r;function s(){var u=e.apply(this,arguments);return u!==r&&(i=(r=u)&&fo(t,u,n)),i}return s._value=e,s}function vo(t,e,n){var i="style."+(t+="");if(arguments.length<2)return(i=this.tween(i))&&i._value;if(e==null)return this.tween(i,null);if(typeof e!="function")throw new Error;return this.tween(i,po(t,e,n??""))}function Do(t){return function(){this.textContent=t}}function mo(t){return function(){var e=t(this);this.textContent=e??""}}function go(t){return this.tween("text",typeof t=="function"?mo(En(this,"text",t)):Do(t==null?"":t+""))}function yo(t){return function(e){this.textContent=t.call(this,e)}}function _o(t){var e,n;function i(){var r=t.apply(this,arguments);return r!==n&&(e=(n=r)&&yo(r)),e}return i._value=t,i}function Eo(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(t==null)return this.tween(e,null);if(typeof t!="function")throw new Error;return this.tween(e,_o(t))}function Co(){for(var t=this._name,e=this._id,n=zi(),i=this._groups,r=i.length,s=0;s<r;++s)for(var u=i[s],o=u.length,a,h=0;h<o;++h)if(a=u[h]){var l=dt(a,e);Te(a,t,n,h,u,{time:l.time+l.delay+l.duration,delay:0,duration:l.duration,ease:l.ease})}return new At(i,this._parents,t,n)}function Ao(){var t,e,n=this,i=n._id,r=n.size();return new Promise(function(s,u){var o={value:u},a={value:function(){--r===0&&s()}};n.each(function(){var h=mt(this,i),l=h.on;l!==t&&(e=(t=l).copy(),e._.cancel.push(o),e._.interrupt.push(o),e._.end.push(a)),h.on=e}),r===0&&s()})}var xo=0;function At(t,e,n,i){this._groups=t,this._parents=e,this._name=n,this._id=i}function zi(){return++xo}var St=se.prototype;At.prototype={constructor:At,select:io,selectAll:ro,filter:Yu,merge:Ku,selection:uo,transition:Co,call:St.call,nodes:St.nodes,node:St.node,size:St.size,empty:St.empty,each:St.each,on:to,attr:Ru,attrTween:Pu,style:co,styleTween:vo,text:go,textTween:Eo,remove:no,tween:Fu,delay:ju,duration:Gu,ease:Uu,easeVarying:Xu,end:Ao,[Symbol.iterator]:St[Symbol.iterator]};function wo(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}var bo={time:null,delay:0,duration:250,ease:wo};function Fo(t,e){for(var n;!(n=t.__transition)||!(n=n[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return n}function Bo(t){var e,n;t instanceof At?(e=t._id,t=t._name):(e=zi(),(n=bo).time=yn(),t=t==null?null:t+"");for(var i=this._groups,r=i.length,s=0;s<r;++s)for(var u=i[s],o=u.length,a,h=0;h<o;++h)(a=u[h])&&Te(a,t,e,h,u,n||Fo(a,e));return new At(i,this._parents,t,e)}se.prototype.interrupt=xu;se.prototype.transition=Bo;const Ze=Math.PI,Qe=2*Ze,Rt=1e-6,Io=Qe-Rt;function tn(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function xe(){return new tn}tn.prototype=xe.prototype={constructor:tn,moveTo:function(t,e){this._+="M"+(this._x0=this._x1=+t)+","+(this._y0=this._y1=+e)},closePath:function(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(t,e){this._+="L"+(this._x1=+t)+","+(this._y1=+e)},quadraticCurveTo:function(t,e,n,i){this._+="Q"+ +t+","+ +e+","+(this._x1=+n)+","+(this._y1=+i)},bezierCurveTo:function(t,e,n,i,r,s){this._+="C"+ +t+","+ +e+","+ +n+","+ +i+","+(this._x1=+r)+","+(this._y1=+s)},arcTo:function(t,e,n,i,r){t=+t,e=+e,n=+n,i=+i,r=+r;var s=this._x1,u=this._y1,o=n-t,a=i-e,h=s-t,l=u-e,c=h*h+l*l;if(r<0)throw new Error("negative radius: "+r);if(this._x1===null)this._+="M"+(this._x1=t)+","+(this._y1=e);else if(c>Rt)if(!(Math.abs(l*o-a*h)>Rt)||!r)this._+="L"+(this._x1=t)+","+(this._y1=e);else{var f=n-s,d=i-u,g=o*o+a*a,v=f*f+d*d,E=Math.sqrt(g),m=Math.sqrt(c),B=r*Math.tan((Ze-Math.acos((g+c-v)/(2*E*m)))/2),b=B/m,C=B/E;Math.abs(b-1)>Rt&&(this._+="L"+(t+b*h)+","+(e+b*l)),this._+="A"+r+","+r+",0,0,"+ +(l*f>h*d)+","+(this._x1=t+C*o)+","+(this._y1=e+C*a)}},arc:function(t,e,n,i,r,s){t=+t,e=+e,n=+n,s=!!s;var u=n*Math.cos(i),o=n*Math.sin(i),a=t+u,h=e+o,l=1^s,c=s?i-r:r-i;if(n<0)throw new Error("negative radius: "+n);this._x1===null?this._+="M"+a+","+h:(Math.abs(this._x1-a)>Rt||Math.abs(this._y1-h)>Rt)&&(this._+="L"+a+","+h),n&&(c<0&&(c=c%Qe+Qe),c>Io?this._+="A"+n+","+n+",0,1,"+l+","+(t-u)+","+(e-o)+"A"+n+","+n+",0,1,"+l+","+(this._x1=a)+","+(this._y1=h):c>Rt&&(this._+="A"+n+","+n+",0,"+ +(c>=Ze)+","+l+","+(this._x1=t+n*Math.cos(r))+","+(this._y1=e+n*Math.sin(r))))},rect:function(t,e,n,i){this._+="M"+(this._x0=this._x1=+t)+","+(this._y0=this._y1=+e)+"h"+ +n+"v"+ +i+"h"+-n+"Z"},toString:function(){return this._}};Ri(Bt(-100,.75,.35),Bt(80,1.5,.8));Ri(Bt(260,.75,.35),Bt(80,1.5,.8));var le=Bt();function $o(t){(t<0||t>1)&&(t-=Math.floor(t));var e=Math.abs(t-.5);return le.h=360*t-100,le.s=1.5-1.5*e,le.l=.8-.9*e,le+""}function Pt(t){return function(){return t}}var Xn=1e-12;function So(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function ji(t){this._context=t}ji.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;default:this._context.lineTo(t,e);break}}};function Mo(t){return new ji(t)}function To(t){return t[0]}function Ro(t){return t[1]}function ko(t,e){var n=Pt(!0),i=null,r=Mo,s=null;t=typeof t=="function"?t:t===void 0?To:Pt(t),e=typeof e=="function"?e:e===void 0?Ro:Pt(e);function u(o){var a,h=(o=So(o)).length,l,c=!1,f;for(i==null&&(s=r(f=xe())),a=0;a<=h;++a)!(a<h&&n(l=o[a],a,o))===c&&((c=!c)?s.lineStart():s.lineEnd()),c&&s.point(+t(l,a,o),+e(l,a,o));if(f)return s=null,f+""||null}return u.x=function(o){return arguments.length?(t=typeof o=="function"?o:Pt(+o),u):t},u.y=function(o){return arguments.length?(e=typeof o=="function"?o:Pt(+o),u):e},u.defined=function(o){return arguments.length?(n=typeof o=="function"?o:Pt(!!o),u):n},u.curve=function(o){return arguments.length?(r=o,i!=null&&(s=r(i)),u):r},u.context=function(o){return arguments.length?(o==null?i=s=null:s=r(i=o),u):i},u}function Yn(t,e,n){t._context.bezierCurveTo(t._x1+t._k*(t._x2-t._x0),t._y1+t._k*(t._y2-t._y0),t._x2+t._k*(t._x1-e),t._y2+t._k*(t._y1-n),t._x2,t._y2)}function Cn(t,e){this._context=t,this._k=(1-e)/6}Cn.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:Yn(this,this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2,this._x1=t,this._y1=e;break;case 2:this._point=3;default:Yn(this,t,e);break}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};(function t(e){function n(i){return new Cn(i,e)}return n.tension=function(i){return t(+i)},n})(0);function No(t,e,n){var i=t._x1,r=t._y1,s=t._x2,u=t._y2;if(t._l01_a>Xn){var o=2*t._l01_2a+3*t._l01_a*t._l12_a+t._l12_2a,a=3*t._l01_a*(t._l01_a+t._l12_a);i=(i*o-t._x0*t._l12_2a+t._x2*t._l01_2a)/a,r=(r*o-t._y0*t._l12_2a+t._y2*t._l01_2a)/a}if(t._l23_a>Xn){var h=2*t._l23_2a+3*t._l23_a*t._l12_a+t._l12_2a,l=3*t._l23_a*(t._l23_a+t._l12_a);s=(s*h+t._x1*t._l23_2a-e*t._l12_2a)/l,u=(u*h+t._y1*t._l23_2a-n*t._l12_2a)/l}t._context.bezierCurveTo(i,r,s,u,t._x2,t._y2)}function qi(t,e){this._context=t,this._alpha=e}qi.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:this.point(this._x2,this._y2);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){if(t=+t,e=+e,this._point){var n=this._x2-t,i=this._y2-e;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+i*i,this._alpha))}switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3;default:No(this,t,e);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};const Oo=function t(e){function n(i){return e?new qi(i,e):new Cn(i,0)}return n.alpha=function(i){return t(+i)},n}(.5),he=t=>()=>t;function Lo(t,{sourceEvent:e,target:n,transform:i,dispatch:r}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:i,enumerable:!0,configurable:!0},_:{value:r}})}function Et(t,e,n){this.k=t,this.x=e,this.y=n}Et.prototype={constructor:Et,scale:function(t){return t===1?this:new Et(this.k*t,this.x,this.y)},translate:function(t,e){return t===0&e===0?this:new Et(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var An=new Et(1,0,0);Et.prototype;function Oe(t){t.stopImmediatePropagation()}function Wt(t){t.preventDefault(),t.stopImmediatePropagation()}function Po(t){return(!t.ctrlKey||t.type==="wheel")&&!t.button}function Vo(){var t=this;return t instanceof SVGElement?(t=t.ownerSVGElement||t,t.hasAttribute("viewBox")?(t=t.viewBox.baseVal,[[t.x,t.y],[t.x+t.width,t.y+t.height]]):[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]):[[0,0],[t.clientWidth,t.clientHeight]]}function Kn(){return this.__zoom||An}function zo(t){return-t.deltaY*(t.deltaMode===1?.05:t.deltaMode?1:.002)*(t.ctrlKey?10:1)}function jo(){return navigator.maxTouchPoints||"ontouchstart"in this}function qo(t,e,n){var i=t.invertX(e[0][0])-n[0][0],r=t.invertX(e[1][0])-n[1][0],s=t.invertY(e[0][1])-n[0][1],u=t.invertY(e[1][1])-n[1][1];return t.translate(r>i?(i+r)/2:Math.min(0,i)||Math.max(0,r),u>s?(s+u)/2:Math.min(0,s)||Math.max(0,u))}function Jo(){var t=Po,e=Vo,n=qo,i=zo,r=jo,s=[0,1/0],u=[[-1/0,-1/0],[1/0,1/0]],o=250,a=Du,h=hn("start","zoom","end"),l,c,f,d=500,g=150,v=0,E=10;function m(p){p.property("__zoom",Kn).on("wheel.zoom",_).on("mousedown.zoom",w).on("dblclick.zoom",$).filter(r).on("touchstart.zoom",N).on("touchmove.zoom",L).on("touchend.zoom touchcancel.zoom",j).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}m.transform=function(p,I,y,M){var k=p.selection?p.selection():p;k.property("__zoom",Kn),p!==k?A(p,I,y,M):k.interrupt().each(function(){x(this,arguments).event(M).start().zoom(null,typeof I=="function"?I.apply(this,arguments):I).end()})},m.scaleBy=function(p,I,y,M){m.scaleTo(p,function(){var k=this.__zoom.k,O=typeof I=="function"?I.apply(this,arguments):I;return k*O},y,M)},m.scaleTo=function(p,I,y,M){m.transform(p,function(){var k=e.apply(this,arguments),O=this.__zoom,T=y==null?C(k):typeof y=="function"?y.apply(this,arguments):y,z=O.invert(T),J=typeof I=="function"?I.apply(this,arguments):I;return n(b(B(O,J),T,z),k,u)},y,M)},m.translateBy=function(p,I,y,M){m.transform(p,function(){return n(this.__zoom.translate(typeof I=="function"?I.apply(this,arguments):I,typeof y=="function"?y.apply(this,arguments):y),e.apply(this,arguments),u)},null,M)},m.translateTo=function(p,I,y,M,k){m.transform(p,function(){var O=e.apply(this,arguments),T=this.__zoom,z=M==null?C(O):typeof M=="function"?M.apply(this,arguments):M;return n(An.translate(z[0],z[1]).scale(T.k).translate(typeof I=="function"?-I.apply(this,arguments):-I,typeof y=="function"?-y.apply(this,arguments):-y),O,u)},M,k)};function B(p,I){return I=Math.max(s[0],Math.min(s[1],I)),I===p.k?p:new Et(I,p.x,p.y)}function b(p,I,y){var M=I[0]-y[0]*p.k,k=I[1]-y[1]*p.k;return M===p.x&&k===p.y?p:new Et(p.k,M,k)}function C(p){return[(+p[0][0]+ +p[1][0])/2,(+p[0][1]+ +p[1][1])/2]}function A(p,I,y,M){p.on("start.zoom",function(){x(this,arguments).event(M).start()}).on("interrupt.zoom end.zoom",function(){x(this,arguments).event(M).end()}).tween("zoom",function(){var k=this,O=arguments,T=x(k,O).event(M),z=e.apply(k,O),J=y==null?C(z):typeof y=="function"?y.apply(k,O):y,nt=Math.max(z[1][0]-z[0][0],z[1][1]-z[0][1]),Y=k.__zoom,ut=typeof I=="function"?I.apply(k,O):I,ct=a(Y.invert(J).concat(nt/Y.k),ut.invert(J).concat(nt/ut.k));return function(ot){if(ot===1)ot=ut;else{var ht=ct(ot),D=nt/ht[2];ot=new Et(D,J[0]-ht[0]*D,J[1]-ht[1]*D)}T.zoom(null,ot)}})}function x(p,I,y){return!y&&p.__zooming||new S(p,I)}function S(p,I){this.that=p,this.args=I,this.active=0,this.sourceEvent=null,this.extent=e.apply(p,I),this.taps=0}S.prototype={event:function(p){return p&&(this.sourceEvent=p),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(p,I){return this.mouse&&p!=="mouse"&&(this.mouse[1]=I.invert(this.mouse[0])),this.touch0&&p!=="touch"&&(this.touch0[1]=I.invert(this.touch0[0])),this.touch1&&p!=="touch"&&(this.touch1[1]=I.invert(this.touch1[0])),this.that.__zoom=I,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(p){var I=et(this.that).datum();h.call(p,this.that,new Lo(p,{sourceEvent:this.sourceEvent,target:m,type:p,transform:this.that.__zoom,dispatch:h}),I)}};function _(p,...I){if(!t.apply(this,arguments))return;var y=x(this,I).event(p),M=this.__zoom,k=Math.max(s[0],Math.min(s[1],M.k*Math.pow(2,i.apply(this,arguments)))),O=$t(p);if(y.wheel)(y.mouse[0][0]!==O[0]||y.mouse[0][1]!==O[1])&&(y.mouse[1]=M.invert(y.mouse[0]=O)),clearTimeout(y.wheel);else{if(M.k===k)return;y.mouse=[O,M.invert(O)],De(this),y.start()}Wt(p),y.wheel=setTimeout(T,g),y.zoom("mouse",n(b(B(M,k),y.mouse[0],y.mouse[1]),y.extent,u));function T(){y.wheel=null,y.end()}}function w(p,...I){if(f||!t.apply(this,arguments))return;var y=x(this,I,!0).event(p),M=et(p.view).on("mousemove.zoom",J,!0).on("mouseup.zoom",nt,!0),k=$t(p,O),O=p.currentTarget,T=p.clientX,z=p.clientY;qs(p.view),Oe(p),y.mouse=[k,this.__zoom.invert(k)],De(this),y.start();function J(Y){if(Wt(Y),!y.moved){var ut=Y.clientX-T,ct=Y.clientY-z;y.moved=ut*ut+ct*ct>v}y.event(Y).zoom("mouse",n(b(y.that.__zoom,y.mouse[0]=$t(Y,O),y.mouse[1]),y.extent,u))}function nt(Y){M.on("mousemove.zoom mouseup.zoom",null),Js(Y.view,y.moved),Wt(Y),y.event(Y).end()}}function $(p,...I){if(t.apply(this,arguments)){var y=this.__zoom,M=$t(p.changedTouches?p.changedTouches[0]:p,this),k=y.invert(M),O=y.k*(p.shiftKey?.5:2),T=n(b(B(y,O),M,k),e.apply(this,I),u);Wt(p),o>0?et(this).transition().duration(o).call(A,T,M,p):et(this).call(m.transform,T,M,p)}}function N(p,...I){if(t.apply(this,arguments)){var y=p.touches,M=y.length,k=x(this,I,p.changedTouches.length===M).event(p),O,T,z,J;for(Oe(p),T=0;T<M;++T)z=y[T],J=$t(z,this),J=[J,this.__zoom.invert(J),z.identifier],k.touch0?!k.touch1&&k.touch0[2]!==J[2]&&(k.touch1=J,k.taps=0):(k.touch0=J,O=!0,k.taps=1+!!l);l&&(l=clearTimeout(l)),O&&(k.taps<2&&(c=J[0],l=setTimeout(function(){l=null},d)),De(this),k.start())}}function L(p,...I){if(this.__zooming){var y=x(this,I).event(p),M=p.changedTouches,k=M.length,O,T,z,J;for(Wt(p),O=0;O<k;++O)T=M[O],z=$t(T,this),y.touch0&&y.touch0[2]===T.identifier?y.touch0[0]=z:y.touch1&&y.touch1[2]===T.identifier&&(y.touch1[0]=z);if(T=y.that.__zoom,y.touch1){var nt=y.touch0[0],Y=y.touch0[1],ut=y.touch1[0],ct=y.touch1[1],ot=(ot=ut[0]-nt[0])*ot+(ot=ut[1]-nt[1])*ot,ht=(ht=ct[0]-Y[0])*ht+(ht=ct[1]-Y[1])*ht;T=B(T,Math.sqrt(ot/ht)),z=[(nt[0]+ut[0])/2,(nt[1]+ut[1])/2],J=[(Y[0]+ct[0])/2,(Y[1]+ct[1])/2]}else if(y.touch0)z=y.touch0[0],J=y.touch0[1];else return;y.zoom("touch",n(b(T,z,J),y.extent,u))}}function j(p,...I){if(this.__zooming){var y=x(this,I).event(p),M=p.changedTouches,k=M.length,O,T;for(Oe(p),f&&clearTimeout(f),f=setTimeout(function(){f=null},d),O=0;O<k;++O)T=M[O],y.touch0&&y.touch0[2]===T.identifier?delete y.touch0:y.touch1&&y.touch1[2]===T.identifier&&delete y.touch1;if(y.touch1&&!y.touch0&&(y.touch0=y.touch1,delete y.touch1),y.touch0)y.touch0[1]=this.__zoom.invert(y.touch0[0]);else if(y.end(),y.taps===2&&(T=$t(T,this),Math.hypot(c[0]-T[0],c[1]-T[1])<E)){var z=et(this).on("dblclick.zoom");z&&z.apply(this,arguments)}}}return m.wheelDelta=function(p){return arguments.length?(i=typeof p=="function"?p:he(+p),m):i},m.filter=function(p){return arguments.length?(t=typeof p=="function"?p:he(!!p),m):t},m.touchable=function(p){return arguments.length?(r=typeof p=="function"?p:he(!!p),m):r},m.extent=function(p){return arguments.length?(e=typeof p=="function"?p:he([[+p[0][0],+p[0][1]],[+p[1][0],+p[1][1]]]),m):e},m.scaleExtent=function(p){return arguments.length?(s[0]=+p[0],s[1]=+p[1],m):[s[0],s[1]]},m.translateExtent=function(p){return arguments.length?(u[0][0]=+p[0][0],u[1][0]=+p[1][0],u[0][1]=+p[0][1],u[1][1]=+p[1][1],m):[[u[0][0],u[0][1]],[u[1][0],u[1][1]]]},m.constrain=function(p){return arguments.length?(n=p,m):n},m.duration=function(p){return arguments.length?(o=+p,m):o},m.interpolate=function(p){return arguments.length?(a=p,m):a},m.on=function(){var p=h.on.apply(h,arguments);return p===h?m:p},m.clickDistance=function(p){return arguments.length?(v=(p=+p)*p,m):Math.sqrt(v)},m.tapDistance=function(p){return arguments.length?(E=+p,m):E},m}class Zn{constructor(e){this.base=e}[Symbol.iterator](){return this.base[Symbol.iterator]()}concat(...e){return Q(function*(n){for(const i of n)yield*i}([this,...e.map(Q)]))}entries(){return Q(function*(e){let n=0;for(const i of e)yield[n++,i]}(this))}every(e){return!this.some((n,i)=>!e(n,i))}fill(e){return this.map(()=>e)}filter(e){return Q(function*(n){for(const[i,r]of n)e(r,i)&&(yield r)}(this.entries()))}find(e){for(const[n,i]of this.entries())if(e(i,n))return i}findIndex(e){for(const[n,i]of this.entries())if(e(i,n))return n;return-1}flatMap(e){return Q(function*(n){for(const[i,r]of n)yield*Q(e(r,i))}(this.entries()))}forEach(e){for(const[n,i]of this.entries())e(i,n)}includes(e,n=0){return this.indexOf(e,n)>=0}indexOf(e,n=0){if(n<0)throw new Error("fromIndex doesn't support negative numbers because generator length isn't known");for(const[i,r]of this.entries())if(i>=n&&r===e)return i;return-1}join(e=","){return[...this].join(e)}keys(){return Q(function*(e){let n=0;for(const i of e)yield n++}(this))}lastIndexOf(e,n=1/0){if(n<0)throw new Error("fromIndex doesn't support negative numbers because generator length isn't known");let i=-1;for(const[r,s]of this.entries())r<=n&&s===e&&(i=r);return i}get length(){return this.reduce(e=>e+1,0)}map(e){return Q(function*(n){for(const[i,r]of n)yield e(r,i)}(this.entries()))}reduce(e,n){if(n===void 0){const i=e;let r=!0,s;for(const[u,o]of this.entries())r?(s=o,r=!1):s=i(s,o,u);if(r)throw new TypeError("Reduce of empty iterable with no initial value");return s}else{const i=e;let r=n;for(const[s,u]of this.entries())r=i(r,u,s);return r}}reverse(){return Q([...this].reverse())}slice(e=0,n=1/0){return Q(function*(i){for(const[r,s]of i)if(!(r<e))if(r<n)yield s;else break}(this.entries()))}some(e){for(const[n,i]of this.entries())if(e(i,n))return!0;return!1}sort(e){return Q([...this].sort(e))}splice(e,n=0,...i){return Q(function*(r){for(const[s,u]of r)s===e&&(yield*i),(s<e||s>=e+n)&&(yield u)}(this.entries()))}values(){return this}}function Ho(t){return typeof t[Symbol.iterator]=="function"}function Q(t){return Ho(t)?new Zn(t):new Zn({[Symbol.iterator]:()=>t})}function en(t){if(t!==void 0)return t;throw new Error("got unexpected undefined value")}function Ji(t,e){e.size<t.size&&([e,t]=[t,e]);for(const n of t)if(e.has(n))return!0;return!1}class lt extends Map{getThrow(e){const n=this.get(e);if(n===void 0)throw new Error(`map doesn't contain key: ${e}`);return n}getDefault(e,n){const i=this.get(e);return i===void 0?n:i}setIfAbsent(e,n){const i=this.get(e);return i===void 0?(this.set(e,n),n):i}}class me{constructor(e,n,i=[]){this.child=e,this.data=n,this.points=i}}class Uo{constructor(e,n,i,r){this.source=e,this.target=n,this.data=i,this.points=r}}class Gi{constructor(e,n){this.id=e,this.data=n,this.dataChildren=[]}iroots(){return Q([this])}roots(){return[this]}*iterChildren(){for(const{child:e}of this.dataChildren)yield e}ichildren(){return Q(this.iterChildren())}children(){return[...this.ichildren()]}*iterChildLinks(){for(const{child:e,data:n,points:i}of this.dataChildren)yield new Uo(this,e,n,i)}ichildLinks(){return Q(this.iterChildLinks())}childLinks(){return[...this.ichildLinks()]}[Symbol.iterator](){return new at([this])[Symbol.iterator]()}idescendants(e="depth"){return new at([this]).idescendants(e)}descendants(e="depth"){return[...this.idescendants(e)]}ilinks(){return new at([this]).ilinks()}links(){return[...this.ilinks()]}size(){return new at([this]).size()}sum(e){return new at([this]).sum(e),this}count(){return new at([this]).count(),this}height(){return new at([this]).height(),this}depth(){return new at([this]).depth(),this}split(){return[this]}connected(){return!0}}class at{constructor(e){this.dagRoots=e}[Symbol.iterator](){return this.idepth()}iroots(){return Q(this.dagRoots)}roots(){return this.dagRoots.slice()}*idepth(){const e=this.roots(),n=new Set;let i;for(;i=e.pop();)n.has(i.id)||(n.add(i.id),yield i,e.push(...i.ichildren()))}*ibreadth(){const e=new Set;let n=this.roots(),i=[];do{i=n.reverse(),n=[];let r;for(;r=i.pop();)e.has(r.id)||(e.add(r.id),yield r,n.push(...r.ichildren()))}while(n.length)}*ibefore(){const e=new lt;for(const r of this)for(const s of r.ichildren())e.set(s.id,e.getDefault(s.id,0)+1);const n=this.roots();let i;for(;i=n.pop();){yield i;for(const r of i.ichildren()){const s=e.getThrow(r.id);s>1?e.set(r.id,s-1):n.push(r)}}}*iafter(){const e=this.roots(),n=new Set;let i;for(;i=e.pop();)n.has(i.id)||(i.ichildren().every(r=>n.has(r.id))?(n.add(i.id),yield i):(e.push(i),e.push(...i.ichildren())))}idescendants(e="depth"){if(e==="depth")return Q(this.idepth());if(e==="breadth")return Q(this.ibreadth());if(e==="before")return Q(this.ibefore());if(e==="after")return Q(this.iafter());throw new Error(`unknown iteration style: ${e}`)}descendants(e="depth"){return[...this.idescendants(e)]}ilinks(){return this.idescendants().flatMap(e=>e.ichildLinks())}links(){return[...this.ilinks()]}size(){return this.idescendants().reduce(e=>e+1,0)}sum(e){const n=new lt;for(const[i,r]of this.idescendants("after").entries()){const s=e(r,i),u=new lt;u.set(r.id,s);for(const o of r.ichildren()){const a=n.getThrow(o.id);for(const[h,l]of a.entries())u.set(h,l)}r.value=Q(u.entries()).map(([,o])=>o).reduce((o,a)=>o+a),n.set(r.id,u)}return this}count(){const e=new lt;for(const n of this.idescendants("after"))if(n.ichildren()[Symbol.iterator]().next().done)e.set(n.id,new Set([n.id])),n.value=1;else{const i=new Set;for(const r of n.ichildren()){const s=e.getThrow(r.id);for(const u of s)i.add(u)}e.set(n.id,i),n.value=i.size}return this}height(){for(const e of this.idescendants("after"))e.value=Math.max(0,...e.ichildren().map(n=>{if(n.value===void 0)throw new Error("`after` iteration didn't iterate in after order");return n.value+1}));return this}depth(){const e=new lt;for(const n of this)for(const i of n.ichildren())e.setIfAbsent(i.id,[]).push(n);for(const n of this.idescendants("before"))n.value=Math.max(0,...e.getDefault(n.id,[]).map(i=>{if(i.value===void 0)throw new Error("`before` iteration didn't iterate in before order");return i.value+1}));return this}split(){const e=new lt,n=new lt;for(const s of this.iroots())e.set(s.id,[]),n.set(s.id,new Set(s.idescendants().map(u=>u.id)));for(const[s,u]of this.iroots().entries()){const o=n.getThrow(u.id);for(const a of this.iroots().slice(s+1)){const h=n.getThrow(a.id);Ji(o,h)&&(e.getThrow(u.id).push(a),e.getThrow(a.id).push(u))}}const i=[],r=new Set;for(const s of this.iroots())if(!r.has(s.id)){r.add(s.id);const u=[s];i.push(u);const o=e.getThrow(s.id).slice();let a;for(;a=o.pop();)r.has(a.id)||(r.add(a.id),u.push(a),o.push(...e.getThrow(a.id)))}return i.map(s=>s.length>1?new at(s):s[0])}connected(){return this.split().length===1}}function Wo(t){if(typeof t!="string")throw new Error(`id is supposed to be string but got type ${typeof t}`);if(t.indexOf("\0")>=0)throw new Error(`node id ${t} contained null character`);return t}function Xo(t){if(!t.length)throw new Error("dag contained no roots");const e=new Set,n=new Set;let i=null;function r(s){if(e.has(s.id))return[];if(n.has(s.id))return i=s.id,[s.id];{n.add(s.id);let u=[];for(const o of s.ichildren())if(u=r(o),u.length)break;return n.delete(s.id),e.add(s.id),u.length&&i!==null&&u.push(s.id),i===s.id&&(i=null),u}}for(const s of t){const u=r(s);if(u.length)throw new Error("dag contained a cycle: "+u.reverse().join(" -> "))}for(const s of new at(t))if(new Set(s.ichildren().map(o=>o.id)).size!==s.dataChildren.length)throw new Error(`node '${s.id}' contained duplicate children`)}function ge(t,e,n){function i(o){if(!o.length)throw new Error("can't stratify empty data");const a=o.map((c,f)=>new Gi(Wo(t(c,f)),c)),h=new Map;a.forEach(c=>{if(h.has(c.id))throw new Error(`found a duplicate id: ${c.id}`);h.set(c.id,c)});const l=[];return a.forEach((c,f)=>{const d=n(c.data,f)||[];d.forEach(([g,v])=>{const E=h.get(g);if(!E)throw new Error(`missing id: ${g}`);return E.dataChildren.push(new me(c,v)),E}),d.length||l.push(c)}),Xo(l),l.length>1?new at(l):l[0]}function r(o){return o===void 0?t:ge(o,e,n)}i.id=r;function s(o){return o===void 0?n:ge(t,Yo(o),o)}i.parentData=s;function u(o){return o===void 0?e:ge(t,o,Hi(o))}return i.parentIds=u,i}function Hi(t){function e(n,i){return(t(n,i)||[]).map(r=>[r,void 0])}return e.wrapped=t,e}function Yo(t){function e(n,i){return(t(n,i)||[]).map(([r])=>r)}return e.wrapped=t,e}function Ko(t){try{return typeof t.id=="string"}catch{return!1}}function Zo(t){if(Ko(t))return t.id;throw new Error(`default id function expected datum to have an id field but got: ${t}`)}function Qo(t){try{const e=t.parentIds;return e===void 0||e instanceof Array&&e.every(n=>typeof n=="string")}catch{return!1}}function Qn(t){if(Qo(t))return t.parentIds;throw new Error(`default parentIds function expected datum to have a parentIds field but got: ${t}`)}function ta(...t){if(t.length)throw Error(`got arguments to dagStratify(${t}), but constructor takes no aruguments. These were probably meant as data which should be called as dagStratify()(...)`);return ge(Zo,Qn,Hi(Qn))}let Zt=1e-60,ti,ei;do Zt+=Zt,ti=1+.1*Zt,ei=1+.2*Zt;while(ti<=1||ei<=1);var Le=Zt;function ea(t,e,n){let i,r;for(let s=1;s<=n;s+=1){t[s][s]=1/t[s][s],r=-t[s][s];for(let u=1;u<s;u+=1)t[u][s]*=r;if(i=s+1,n<i)break;for(let u=i;u<=n;u+=1){r=t[s][u],t[s][u]=0;for(let o=1;o<=s;o+=1)t[o][u]+=r*t[o][s]}}}var na=ea;function ia(t,e,n,i){let r,s;for(r=1;r<=n;r+=1){s=0;for(let u=1;u<r;u+=1)s+=t[u][r]*i[u];i[r]=(i[r]-s)/t[r][r]}for(let u=1;u<=n;u+=1){r=n+1-u,i[r]/=t[r][r],s=-i[r];for(let o=1;o<r;o+=1)i[o]+=s*t[o][r]}}var ra=ia;function sa(t,e,n,i){let r,s,u;for(let o=1;o<=n;o+=1){if(i[1]=o,u=0,r=o-1,r<1){if(u=t[o][o]-u,u<=0)break;t[o][o]=Math.sqrt(u)}else{for(let a=1;a<=r;a+=1){s=t[a][o];for(let h=1;h<a;h+=1)s-=t[h][o]*t[h][a];s/=t[a][a],t[a][o]=s,u+=s*s}if(u=t[o][o]-u,u<=0)break;t[o][o]=Math.sqrt(u)}i[1]=0}}var ua=sa;function oa(t,e,n,i,r,s,u,o,a,h,l,c,f,d=0,g,v,E){let m,B,b,C,A,x,S,_,w,$,N,L,j,p;const I=Math.min(i,l);let y=2*i+I*(I+5)/2+2*l+1;for(let D=1;D<=i;D+=1)v[D]=e[D];for(let D=i+1;D<=y;D+=1)v[D]=0;for(let D=1;D<=l;D+=1)f[D]=0,s[D]=0;const M=[];if(E[1]===0){if(ua(t,n,i,M),M[1]!==0){E[1]=2;return}ra(t,n,i,e),na(t,n,i)}else{for(let D=1;D<=i;D+=1){r[D]=0;for(let R=1;R<=D;R+=1)r[D]+=t[R][D]*e[R]}for(let D=1;D<=i;D+=1){e[D]=0;for(let R=D;R<=i;R+=1)e[D]+=t[D][R]*r[R]}}u[1]=0;for(let D=1;D<=i;D+=1){r[D]=e[D],u[1]+=v[D]*r[D],v[D]=0;for(let R=D+1;R<=i;R+=1)t[R][D]=0}u[1]=-u[1]/2,E[1]=0;const k=i,O=k+i,T=O+I,z=T+I+1,J=z+I*(I+1)/2,nt=J+l;for(let D=1;D<=l;D+=1){x=0;for(let R=1;R<=i;R+=1)x+=o[R][D]*o[R][D];v[nt+D]=Math.sqrt(x)}C=d,g[1]=0,g[2]=0;function Y(){g[1]+=1,y=J;for(let D=1;D<=l;D+=1){y+=1,x=-a[D];for(let R=1;R<=i;R+=1)x+=o[R][D]*r[R];if(Math.abs(x)<Le&&(x=0),D>c)v[y]=x;else if(v[y]=-Math.abs(x),x>0){for(let R=1;R<=i;R+=1)o[R][D]=-o[R][D];a[D]=-a[D]}}for(let D=1;D<=C;D+=1)v[J+f[D]]=0;b=0,A=0;for(let D=1;D<=l;D+=1)v[J+D]<A*v[nt+D]&&(b=D,A=v[J+D]/v[nt+D]);if(b===0){for(let D=1;D<=C;D+=1)s[f[D]]=v[T+D];return 999}return 0}function ut(){for(let D=1;D<=i;D+=1){x=0;for(let R=1;R<=i;R+=1)x+=t[R][D]*o[R][b];v[D]=x}m=k;for(let D=1;D<=i;D+=1)v[m+D]=0;for(let D=C+1;D<=i;D+=1)for(let R=1;R<=i;R+=1)v[m+R]=v[m+R]+t[R][D]*v[D];L=!0;for(let D=C;D>=1;D-=1){x=v[D],y=z+D*(D+3)/2,m=y-D;for(let R=D+1;R<=C;R+=1)x-=v[y]*v[O+R],y+=R;x/=v[m],v[O+D]=x,!(f[D]<=c)&&(x<=0||(L=!1,B=D))}if(!L){S=v[T+B]/v[O+B];for(let D=1;D<=C;D+=1)f[D]<=c||v[O+D]<=0||(A=v[T+D]/v[O+D],A<S&&(S=A,B=D))}x=0;for(let D=k+1;D<=k+i;D+=1)x+=v[D]*v[D];if(Math.abs(x)<=Le){if(L)return E[1]=1,999;for(let D=1;D<=C;D+=1)v[T+D]=v[T+D]-S*v[O+D];return v[T+C+1]=v[T+C+1]+S,700}x=0;for(let D=1;D<=i;D+=1)x+=v[k+D]*o[D][b];_=-v[J+b]/x,j=!0,L||S<_&&(_=S,j=!1);for(let D=1;D<=i;D+=1)r[D]+=_*v[k+D],Math.abs(r[D])<Le&&(r[D]=0);u[1]+=_*x*(_/2+v[T+C+1]);for(let D=1;D<=C;D+=1)v[T+D]=v[T+D]-_*v[O+D];if(v[T+C+1]=v[T+C+1]+_,j){C+=1,f[C]=b,y=z+(C-1)*C/2+1;for(let D=1;D<=C-1;D+=1)v[y]=v[D],y+=1;if(C===i)v[y]=v[i];else{for(let D=i;D>=C+1;D-=1)if(v[D]!==0&&(w=Math.max(Math.abs(v[D-1]),Math.abs(v[D])),$=Math.min(Math.abs(v[D-1]),Math.abs(v[D])),v[D-1]>=0?A=Math.abs(w*Math.sqrt(1+$*$/(w*w))):A=-Math.abs(w*Math.sqrt(1+$*$/(w*w))),w=v[D-1]/A,$=v[D]/A,w!==1))if(w===0){v[D-1]=$*A;for(let R=1;R<=i;R+=1)A=t[R][D-1],t[R][D-1]=t[R][D],t[R][D]=A}else{v[D-1]=A,N=$/(1+w);for(let R=1;R<=i;R+=1)A=w*t[R][D-1]+$*t[R][D],t[R][D]=N*(t[R][D-1]+A)-t[R][D],t[R][D-1]=A}v[y]=v[C]}}else{x=-a[b];for(let D=1;D<=i;D+=1)x+=r[D]*o[D][b];if(b>c)v[J+b]=x;else if(v[J+b]=-Math.abs(x),x>0){for(let D=1;D<=i;D+=1)o[D][b]=-o[D][b];a[b]=-a[b]}return 700}return 0}function ct(){if(y=z+B*(B+1)/2+1,m=y+B,v[m]===0||(w=Math.max(Math.abs(v[m-1]),Math.abs(v[m])),$=Math.min(Math.abs(v[m-1]),Math.abs(v[m])),v[m-1]>=0?A=Math.abs(w*Math.sqrt(1+$*$/(w*w))):A=-Math.abs(w*Math.sqrt(1+$*$/(w*w))),w=v[m-1]/A,$=v[m]/A,w===1))return 798;if(w===0){for(let D=B+1;D<=C;D+=1)A=v[m-1],v[m-1]=v[m],v[m]=A,m+=D;for(let D=1;D<=i;D+=1)A=t[D][B],t[D][B]=t[D][B+1],t[D][B+1]=A}else{N=$/(1+w);for(let D=B+1;D<=C;D+=1)A=w*v[m-1]+$*v[m],v[m]=N*(v[m-1]+A)-v[m],v[m-1]=A,m+=D;for(let D=1;D<=i;D+=1)A=w*t[D][B]+$*t[D][B+1],t[D][B+1]=N*(t[D][B]+A)-t[D][B+1],t[D][B]=A}return 0}function ot(){m=y-B;for(let D=1;D<=B;D+=1)v[m]=v[y],y+=1,m+=1;return v[T+B]=v[T+B+1],f[B]=f[B+1],B+=1,B<C?797:0}function ht(){return v[T+C]=v[T+C+1],v[T+C+1]=0,f[C]=0,C-=1,g[2]+=1,0}for(p=0;;){if(p=Y(),p===999)return;for(;p=ut(),p!==0;){if(p===999)return;if(p===700)if(B===C)ht();else{for(;ct(),p=ot(),p===797;);ht()}}}}var aa=oa;function la(t,e,n,i=[],r=0,s=[0,0]){const u=[],o=[],a=[],h=[],l=[],c=[];let f="";const d=t.length-1,g=n[1].length-1;if(!i)for(let m=1;m<=g;m+=1)i[m]=0;if(d!==t[1].length-1&&(f="Dmat is not symmetric!"),d!==e.length-1&&(f="Dmat and dvec are incompatible!"),d!==n.length-1&&(f="Amat and dvec are incompatible!"),g!==i.length-1&&(f="Amat and bvec are incompatible!"),(r>g||r<0)&&(f="Value of meq is invalid!"),f!=="")return{message:f};for(let m=1;m<=g;m+=1)o[m]=0,h[m]=0;const v=0,E=Math.min(d,g);for(let m=1;m<=d;m+=1)a[m]=0;u[1]=0;for(let m=1;m<=2*d+E*(E+5)/2+2*g+1;m+=1)l[m]=0;for(let m=1;m<=2;m+=1)c[m]=0;return aa(t,e,d,d,a,h,u,n,i,d,g,r,o,v,c,l,s),s[1]===1&&(f="constraints are inconsistent, no solution!"),s[1]===2&&(f="matrix D in quadratic function is not positive definite!"),{solution:a,Lagrangian:h,value:u,unconstrained_solution:e,iterations:c,iact:o,message:f}}var ha=la,ca={solveQP:ha},fa=ca;function Ui(t,e){let[n,...i]=t,r=n.x=0;for(const s of i)r=s.x=r+e(n,s),n=s;if(r>0)for(const s of t)s.x/=r;else for(const s of t)s.x=.5}function da(t,e,n,i,r){const s=[[0]],u=[0],o=[[0]],a=[0];for(const c of t){const f=[0];f.push(...c),s.push(f)}u.push(...e),o.push(...e.map(()=>[0]));for(const c of n)for(const[f,d]of c.entries())o[f+1].push(-d);a.push(...i.map(c=>-c));const{solution:h,message:l}=fa.solveQP(s,u,o,a,r);if(l.length)throw new Error(`quadprog failed with: ${l}`);return h.shift(),h}function pa(t,e,n,i,r=0){e.pop(),t.pop(),t.forEach(u=>u.pop()),n.forEach(u=>u.pop());const s=da(t,e,n,i,r);return s.push(0),s}function va(t){const e=new lt;let n=0;for(const i of t)for(const r of i)e.set(r.id,n++);return e}function Da(t,e,n){const i=1+Math.max(...e.values()),r=[],s=[];for(const a of t){let[h,...l]=a;for(const c of l){const f=e.getThrow(h.id),d=e.getThrow(c.id),g=new Array(i).fill(0);g[f]=1,g[d]=-1,r.push(g),s.push(-n(h,c)),h=c}}const u=new Array(i).fill(0);return[new Array(i).fill(null).map(()=>new Array(i).fill(0)),u,r,s]}function ni(t,e,n,i){t[n][n]+=i,t[n][e]-=i,t[e][n]-=i,t[e][e]+=i}function ma(t,e,n,i,r){t[i][i]+=r,t[i][n]-=2*r,t[i][e]+=r,t[n][i]-=2*r,t[n][n]+=4*r,t[n][e]-=2*r,t[e][i]+=r,t[e][n]-=2*r,t[e][e]+=r}function ga(t,e,n){const i=Math.min(...n),r=Math.max(...n)-i;if(r>0)for(const s of t)for(const u of s){const o=e.getThrow(u.id);u.x=(n[o]-i)/r}else for(const s of t)for(const u of s)u.x=.5}class Ft extends Gi{constructor(e){super(e,void 0)}}function ya(t){const e=new lt;for(const r of t.slice().reverse())for(const s of r){for(const u of s.ichildren())e.delete(u.id);e.set(s.id,s)}const n=new at([...e.values()]).split(),i=new lt;for(const[r,s]of n.entries())for(const u of s)i.set(u.id,r);return i}function _a(t,e){const n=[];let i=[],r=new Set;for(const s of t){const u=new Set(s.map(o=>e.getThrow(o.id)));Ji(r,u)||n.push(i=[]),i.push(s),r=u}return n}function ye(t,e,n,i,r){function s(l,c,f){const d=va(l),[g,v,E,m]=Da(l,d,c);for(const b of l)for(const C of b){const A=d.getThrow(C.id),x=C instanceof Ft?e:t;for(const S of C.ichildren()){const _=d.getThrow(S.id),w=S instanceof Ft?e:t,$=S instanceof Ft?i:n;ni(g,A,_,x+w);for(const N of S.ichildren()){const L=d.getThrow(N.id);ma(g,A,_,L,$)}}}for(let[b,...C]of l)for(const A of C)f.getThrow(b.id)!==f.getThrow(A.id)&&ni(g,d.getThrow(b.id),d.getThrow(A.id),r),b=A;const B=pa(g,v,E,m);ga(l,d,B)}function u(l,c){if(t===0&&n===0)throw new Error("node vertical weight or node curve weight needs to be positive");if(e===0&&i===0)throw new Error("dummy vertical weight or dummy curve weight needs to be positive");const f=ya(l);for(const d of _a(l,f))if(d.every(g=>g.length===1))for(const[g]of d)g.x=.5;else if(d.length===1){const[g]=d;Ui(g,c)}else s(d,c,f)}function o(l){if(l===void 0)return[t,e];const[c,f]=l;if(c<0||f<0)throw new Error(`weights must be non-negative, but were ${c} and ${f}`);return ye(c,f,n,i,r)}u.vertical=o;function a(l){if(l===void 0)return[n,i];const[c,f]=l;if(c<0||f<0)throw new Error(`weights must be non-negative, but were ${c} and ${f}`);return ye(t,e,c,f,r)}u.curve=a;function h(l){if(l===void 0)return r;if(l<=0)throw new Error(`weight must be positive, but was ${l}`);return ye(t,e,n,i,l)}return u.component=h,u}function Ea(...t){if(t.length)throw new Error(`got arguments to quad(${t}), but constructor takes no aruguments.`);return ye(1,0,0,1,1)}/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function Ca(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(n[i[r]]=t[i[r]]);return n}function Wi(t,e,n,i){this.feasible=n,this.evaluation=e,this.bounded=i,this._tableau=t}var xn=Wi;Wi.prototype.generateSolutionSet=function(){for(var t={},e=this._tableau,n=e.varIndexByRow,i=e.variablesPerIndex,r=e.matrix,s=e.rhsColumn,u=e.height-1,o=Math.round(1/e.precision),a=1;a<=u;a+=1){var h=n[a],l=i[h];if(!(l===void 0||l.isSlack===!0)){var c=r[a][s];t[l.id]=Math.round((Number.EPSILON+c)*o)/o}}return t};function we(t,e,n,i,r){xn.call(this,t,e,n,i),this.iter=r}var Aa=we;we.prototype=Object.create(xn.prototype);we.constructor=we;function gt(t){this.model=null,this.matrix=null,this.width=0,this.height=0,this.costRowIndex=0,this.rhsColumn=0,this.variablesPerIndex=[],this.unrestrictedVars=null,this.feasible=!0,this.evaluation=0,this.simplexIters=0,this.varIndexByRow=null,this.varIndexByCol=null,this.rowByVarIndex=null,this.colByVarIndex=null,this.precision=t||1e-8,this.optionalObjectives=[],this.objectivesByPriority={},this.savedState=null,this.availableIndexes=[],this.lastElementIndex=0,this.variables=null,this.nVars=0,this.bounded=!0,this.unboundedVarIndex=null,this.branchAndCutIterations=0}var H=gt;gt.prototype.solve=function(){return this.model.getNumberOfIntegerVariables()>0?this.branchAndCut():this.simplex(),this.updateVariableValues(),this.getSolution()};function nn(t,e){this.priority=t,this.reducedCosts=new Array(e);for(var n=0;n<e;n+=1)this.reducedCosts[n]=0}nn.prototype.copy=function(){var t=new nn(this.priority,this.reducedCosts.length);return t.reducedCosts=this.reducedCosts.slice(),t};gt.prototype.setOptionalObjective=function(t,e,n){var i=this.objectivesByPriority[t];if(i===void 0){var r=Math.max(this.width,e+1);i=new nn(t,r),this.objectivesByPriority[t]=i,this.optionalObjectives.push(i),this.optionalObjectives.sort(function(s,u){return s.priority-u.priority})}i.reducedCosts[e]=n};gt.prototype.initialize=function(t,e,n,i){this.variables=n,this.unrestrictedVars=i,this.width=t,this.height=e;for(var r=new Array(t),s=0;s<t;s++)r[s]=0;this.matrix=new Array(e);for(var u=0;u<e;u++)this.matrix[u]=r.slice();this.varIndexByRow=new Array(this.height),this.varIndexByCol=new Array(this.width),this.varIndexByRow[0]=-1,this.varIndexByCol[0]=-1,this.nVars=t+e-2,this.rowByVarIndex=new Array(this.nVars),this.colByVarIndex=new Array(this.nVars),this.lastElementIndex=this.nVars};gt.prototype._resetMatrix=function(){var t=this.model.variables,e=this.model.constraints,n=t.length,i=e.length,r,s,u=this.matrix[0],o=this.model.isMinimization===!0?-1:1;for(r=0;r<n;r+=1){var a=t[r],h=a.priority,l=o*a.cost;h===0?u[r+1]=l:this.setOptionalObjective(h,r+1,l),s=t[r].index,this.rowByVarIndex[s]=-1,this.colByVarIndex[s]=r+1,this.varIndexByCol[r+1]=s}for(var c=1,f=0;f<i;f+=1){var d=e[f],g=d.index;this.rowByVarIndex[g]=c,this.colByVarIndex[g]=-1,this.varIndexByRow[c]=g;var v,E,m,B=d.terms,b=B.length,C=this.matrix[c++];if(d.isUpperBound){for(v=0;v<b;v+=1)E=B[v],m=this.colByVarIndex[E.variable.index],C[m]=E.coefficient;C[0]=d.rhs}else{for(v=0;v<b;v+=1)E=B[v],m=this.colByVarIndex[E.variable.index],C[m]=-E.coefficient;C[0]=-d.rhs}}};gt.prototype.setModel=function(t){this.model=t;var e=t.nVariables+1,n=t.nConstraints+1;return this.initialize(e,n,t.variables,t.unrestrictedVariables),this._resetMatrix(),this};gt.prototype.getNewElementIndex=function(){if(this.availableIndexes.length>0)return this.availableIndexes.pop();var t=this.lastElementIndex;return this.lastElementIndex+=1,t};gt.prototype.density=function(){for(var t=0,e=this.matrix,n=0;n<this.height;n++)for(var i=e[n],r=0;r<this.width;r++)i[r]!==0&&(t+=1);return t/(this.height*this.width)};gt.prototype.setEvaluation=function(){var t=Math.round(1/this.precision),e=this.matrix[this.costRowIndex][this.rhsColumn],n=Math.round((Number.EPSILON+e)*t)/t;this.evaluation=n,this.simplexIters===0&&(this.bestPossibleEval=n)};gt.prototype.getSolution=function(){var t=this.model.isMinimization===!0?this.evaluation:-this.evaluation;return this.model.getNumberOfIntegerVariables()>0?new Aa(this,t,this.feasible,this.bounded,this.branchAndCutIterations):new xn(this,t,this.feasible,this.bounded)};H.prototype.simplex=function(){return this.bounded=!0,this.phase1(),this.feasible===!0&&this.phase2(),this};H.prototype.phase1=function(){for(var t=this.model.checkForCycles,e=[],n=this.matrix,i=this.rhsColumn,r=this.width-1,s=this.height-1,u,o=0;;){for(var a=0,h=-this.precision,l=1;l<=s;l++){u=this.unrestrictedVars[this.varIndexByRow[l]]===!0;var c=n[l][i];c<h&&(h=c,a=l)}if(a===0)return this.feasible=!0,o;for(var f=0,d=-1/0,g=n[0],v=n[a],E=1;E<=r;E++){var m=v[E];if(u=this.unrestrictedVars[this.varIndexByCol[E]]===!0,u||m<-this.precision){var B=-g[E]/m;d<B&&(d=B,f=E)}}if(f===0)return this.feasible=!1,o;if(t){e.push([this.varIndexByRow[a],this.varIndexByCol[f]]);var b=this.checkForCycles(e);if(b.length>0)return this.model.messages.push("Cycle in phase 1"),this.model.messages.push("Start :"+b[0]),this.model.messages.push("Length :"+b[1]),this.feasible=!1,o}this.pivot(a,f),o+=1}};H.prototype.phase2=function(){for(var t=this.model.checkForCycles,e=[],n=this.matrix,i=this.rhsColumn,r=this.width-1,s=this.height-1,u=this.precision,o=this.optionalObjectives.length,a=null,h=0,l,c;;){var f=n[this.costRowIndex];o>0&&(a=[]);for(var d=0,g=u,v=!1,E=1;E<=r;E++){if(l=f[E],c=this.unrestrictedVars[this.varIndexByCol[E]]===!0,o>0&&-u<l&&l<u){a.push(E);continue}if(c&&l<0){-l>g&&(g=-l,d=E,v=!0);continue}l>g&&(g=l,d=E,v=!1)}if(o>0)for(var m=0;d===0&&a.length>0&&m<o;){var B=[],b=this.optionalObjectives[m].reducedCosts;g=u;for(var C=0;C<a.length;C++){if(E=a[C],l=b[E],c=this.unrestrictedVars[this.varIndexByCol[E]]===!0,-u<l&&l<u){B.push(E);continue}if(c&&l<0){-l>g&&(g=-l,d=E,v=!0);continue}l>g&&(g=l,d=E,v=!1)}a=B,m+=1}if(d===0)return this.setEvaluation(),this.simplexIters+=1,h;var A=0,x=1/0;this.varIndexByRow;for(var S=1;S<=s;S++){var _=n[S],w=_[i],$=_[d];if(!(-u<$&&$<u)){if($>0&&u>w&&w>-u){x=0,A=S;break}var N=v?-w/$:w/$;N>u&&x>N&&(x=N,A=S)}}if(x===1/0)return this.evaluation=-1/0,this.bounded=!1,this.unboundedVarIndex=this.varIndexByCol[d],h;if(t){e.push([this.varIndexByRow[A],this.varIndexByCol[d]]);var L=this.checkForCycles(e);if(L.length>0)return this.model.messages.push("Cycle in phase 2"),this.model.messages.push("Start :"+L[0]),this.model.messages.push("Length :"+L[1]),this.feasible=!1,h}this.pivot(A,d,!0),h+=1}};var Pe=[];H.prototype.pivot=function(t,e){var n=this.matrix,i=n[t][e],r=this.height-1,s=this.width-1,u=this.varIndexByRow[t],o=this.varIndexByCol[e];this.varIndexByRow[t]=o,this.varIndexByCol[e]=u,this.rowByVarIndex[o]=t,this.rowByVarIndex[u]=-1,this.colByVarIndex[o]=-1,this.colByVarIndex[u]=e;for(var a=n[t],h=0,l=0;l<=s;l++)a[l]>=-1e-16&&a[l]<=1e-16?a[l]=0:(a[l]/=i,Pe[h]=l,h+=1);a[e]=1/i;var c,f,d;this.precision;for(var g=0;g<=r;g++)if(g!==t&&!(n[g][e]>=-1e-16&&n[g][e]<=1e-16)){var v=n[g];if(c=v[e],c>=-1e-16&&c<=1e-16)c!==0&&(v[e]=0);else{for(f=0;f<h;f++)l=Pe[f],d=a[l],d>=-1e-16&&d<=1e-16?d!==0&&(a[l]=0):v[l]=v[l]-c*d;v[e]=-c/i}}var E=this.optionalObjectives.length;if(E>0)for(var m=0;m<E;m+=1){var B=this.optionalObjectives[m].reducedCosts;if(c=B[e],c!==0){for(f=0;f<h;f++)l=Pe[f],d=a[l],d!==0&&(B[l]=B[l]-c*d);B[e]=-c/i}}};H.prototype.checkForCycles=function(t){for(var e=0;e<t.length-1;e++)for(var n=e+1;n<t.length;n++){var i=t[e],r=t[n];if(i[0]===r[0]&&i[1]===r[1]){if(n-e>t.length-n)break;for(var s=!0,u=1;u<n-e;u++){var o=t[e+u],a=t[n+u];if(o[0]!==a[0]||o[1]!==a[1]){s=!1;break}}if(s)return[e,n-e]}}return[]};function wn(t,e,n,i){this.id=t,this.cost=e,this.index=n,this.value=0,this.priority=i}function Xi(t,e,n,i){wn.call(this,t,e,n,i)}Xi.prototype.isInteger=!0;function bn(t,e){wn.call(this,t,0,e,0)}bn.prototype.isSlack=!0;function Yi(t,e){this.variable=t,this.coefficient=e}function Ki(t,e,n){return n===0||n==="required"?null:(e=e||1,n=n||1,t.isMinimization===!1&&(e=-e),t.addVariable(e,"r"+t.relaxationIndex++,!1,!1,n))}function Lt(t,e,n,i){this.slack=new bn("s"+n,n),this.index=n,this.model=i,this.rhs=t,this.isUpperBound=e,this.terms=[],this.termsByVarIndex={},this.relaxation=null}Lt.prototype.addTerm=function(t,e){var n=e.index,i=this.termsByVarIndex[n];if(i===void 0)i=new Yi(e,t),this.termsByVarIndex[n]=i,this.terms.push(i),this.isUpperBound===!0&&(t=-t),this.model.updateConstraintCoefficient(this,e,t);else{var r=i.coefficient+t;this.setVariableCoefficient(r,e)}return this};Lt.prototype.removeTerm=function(t){return this};Lt.prototype.setRightHandSide=function(t){if(t!==this.rhs){var e=t-this.rhs;this.isUpperBound===!0&&(e=-e),this.rhs=t,this.model.updateRightHandSide(this,e)}return this};Lt.prototype.setVariableCoefficient=function(t,e){var n=e.index;if(n===-1){console.warn("[Constraint.setVariableCoefficient] Trying to change coefficient of inexistant variable.");return}var i=this.termsByVarIndex[n];if(i===void 0)this.addTerm(t,e);else if(t!==i.coefficient){var r=t-i.coefficient;this.isUpperBound===!0&&(r=-r),i.coefficient=t,this.model.updateConstraintCoefficient(this,e,r)}return this};Lt.prototype.relax=function(t,e){this.relaxation=Ki(this.model,t,e),this._relax(this.relaxation)};Lt.prototype._relax=function(t){t!==null&&(this.isUpperBound?this.setVariableCoefficient(-1,t):this.setVariableCoefficient(1,t))};function Ht(t,e){this.upperBound=t,this.lowerBound=e,this.model=t.model,this.rhs=t.rhs,this.relaxation=null}Ht.prototype.isEquality=!0;Ht.prototype.addTerm=function(t,e){return this.upperBound.addTerm(t,e),this.lowerBound.addTerm(t,e),this};Ht.prototype.removeTerm=function(t){return this.upperBound.removeTerm(t),this.lowerBound.removeTerm(t),this};Ht.prototype.setRightHandSide=function(t){this.upperBound.setRightHandSide(t),this.lowerBound.setRightHandSide(t),this.rhs=t};Ht.prototype.relax=function(t,e){this.relaxation=Ki(this.model,t,e),this.upperBound.relaxation=this.relaxation,this.upperBound._relax(this.relaxation),this.lowerBound.relaxation=this.relaxation,this.lowerBound._relax(this.relaxation)};var xt={Constraint:Lt,Variable:wn,IntegerVariable:Xi,SlackVariable:bn,Equality:Ht,Term:Yi},Fn=xt.SlackVariable;H.prototype.addCutConstraints=function(t){for(var e=t.length,n=this.height,i=n+e,r=n;r<i;r+=1)this.matrix[r]===void 0&&(this.matrix[r]=this.matrix[r-1].slice());this.height=i,this.nVars=this.width+this.height-2;for(var s,u=this.width-1,o=0;o<e;o+=1){var a=t[o],h=n+o,l=a.type==="min"?-1:1,c=a.varIndex,f=this.rowByVarIndex[c],d=this.matrix[h];if(f===-1){for(d[this.rhsColumn]=l*a.value,s=1;s<=u;s+=1)d[s]=0;d[this.colByVarIndex[c]]=l}else{var g=this.matrix[f],v=g[this.rhsColumn];for(d[this.rhsColumn]=l*(a.value-v),s=1;s<=u;s+=1)d[s]=-l*g[s]}var E=this.getNewElementIndex();this.varIndexByRow[h]=E,this.rowByVarIndex[E]=h,this.colByVarIndex[E]=-1,this.variablesPerIndex[E]=new Fn("s"+E,E),this.nVars+=1}};H.prototype._addLowerBoundMIRCut=function(t){if(t===this.costRowIndex)return!1;this.model;var e=this.matrix,n=this.variablesPerIndex[this.varIndexByRow[t]];if(!n.isInteger)return!1;var i=e[t][this.rhsColumn],r=i-Math.floor(i);if(r<this.precision||1-this.precision<r)return!1;var s=this.height;e[s]=e[s-1].slice(),this.height+=1,this.nVars+=1;var u=this.getNewElementIndex();this.varIndexByRow[s]=u,this.rowByVarIndex[u]=s,this.colByVarIndex[u]=-1,this.variablesPerIndex[u]=new Fn("s"+u,u),e[s][this.rhsColumn]=Math.floor(i);for(var o=1;o<this.varIndexByCol.length;o+=1){var a=this.variablesPerIndex[this.varIndexByCol[o]];if(!a.isInteger)e[s][o]=Math.min(0,e[t][o]/(1-r));else{var h=e[t][o],l=Math.floor(h)+Math.max(0,h-Math.floor(h)-r)/(1-r);e[s][o]=l}}for(var c=0;c<this.width;c+=1)e[s][c]-=e[t][c];return!0};H.prototype._addUpperBoundMIRCut=function(t){if(t===this.costRowIndex)return!1;this.model;var e=this.matrix,n=this.variablesPerIndex[this.varIndexByRow[t]];if(!n.isInteger)return!1;var i=e[t][this.rhsColumn],r=i-Math.floor(i);if(r<this.precision||1-this.precision<r)return!1;var s=this.height;e[s]=e[s-1].slice(),this.height+=1,this.nVars+=1;var u=this.getNewElementIndex();this.varIndexByRow[s]=u,this.rowByVarIndex[u]=s,this.colByVarIndex[u]=-1,this.variablesPerIndex[u]=new Fn("s"+u,u),e[s][this.rhsColumn]=-r;for(var o=1;o<this.varIndexByCol.length;o+=1){var a=this.variablesPerIndex[this.varIndexByCol[o]],h=e[t][o],l=h-Math.floor(h);a.isInteger?l<=r?e[s][o]=-l:e[s][o]=-(1-l)*r/l:h>=0?e[s][o]=-h:e[s][o]=h*r/(1-r)}return!0};H.prototype.applyMIRCuts=function(){};H.prototype._putInBase=function(t){var e=this.rowByVarIndex[t];if(e===-1){for(var n=this.colByVarIndex[t],i=1;i<this.height;i+=1){var r=this.matrix[i][n];if(r<-this.precision||this.precision<r){e=i;break}}this.pivot(e,n)}return e};H.prototype._takeOutOfBase=function(t){var e=this.colByVarIndex[t];if(e===-1){for(var n=this.rowByVarIndex[t],i=this.matrix[n],r=1;r<this.height;r+=1){var s=i[r];if(s<-this.precision||this.precision<s){e=r;break}}this.pivot(n,e)}return e};H.prototype.updateVariableValues=function(){for(var t=this.variables.length,e=Math.round(1/this.precision),n=0;n<t;n+=1){var i=this.variables[n],r=i.index,s=this.rowByVarIndex[r];if(s===-1)i.value=0;else{var u=this.matrix[s][this.rhsColumn];i.value=Math.round((u+Number.EPSILON)*e)/e}}};H.prototype.updateRightHandSide=function(t,e){var n=this.height-1,i=this.rowByVarIndex[t.index];if(i===-1){for(var r=this.colByVarIndex[t.index],s=0;s<=n;s+=1){var u=this.matrix[s];u[this.rhsColumn]-=e*u[r]}var o=this.optionalObjectives.length;if(o>0)for(var a=0;a<o;a+=1){var h=this.optionalObjectives[a].reducedCosts;h[this.rhsColumn]-=e*h[r]}}else this.matrix[i][this.rhsColumn]-=e};H.prototype.updateConstraintCoefficient=function(t,e,n){if(t.index===e.index)throw new Error("[Tableau.updateConstraintCoefficient] constraint index should not be equal to variable index !");var i=this._putInBase(t.index),r=this.colByVarIndex[e.index];if(r===-1)for(var s=this.rowByVarIndex[e.index],u=0;u<this.width;u+=1)this.matrix[i][u]+=n*this.matrix[s][u];else this.matrix[i][r]-=n};H.prototype.updateCost=function(t,e){var n=t.index,i=this.width-1,r=this.colByVarIndex[n];if(r===-1){var s=this.matrix[this.rowByVarIndex[n]],u;if(t.priority===0){var o=this.matrix[0];for(u=0;u<=i;u+=1)o[u]+=e*s[u]}else{var a=this.objectivesByPriority[t.priority].reducedCosts;for(u=0;u<=i;u+=1)a[u]+=e*s[u]}}else this.matrix[0][r]-=e};H.prototype.addConstraint=function(t){var e=t.isUpperBound?1:-1,n=this.height,i=this.matrix[n];i===void 0&&(i=this.matrix[0].slice(),this.matrix[n]=i);for(var r=this.width-1,s=0;s<=r;s+=1)i[s]=0;i[this.rhsColumn]=e*t.rhs;for(var u=t.terms,o=u.length,a=0;a<o;a+=1){var h=u[a],l=h.coefficient,c=h.variable.index,f=this.rowByVarIndex[c];if(f===-1)i[this.colByVarIndex[c]]+=e*l;else{var d=this.matrix[f];for(d[this.rhsColumn],s=0;s<=r;s+=1)i[s]-=e*l*d[s]}}var g=t.index;this.varIndexByRow[n]=g,this.rowByVarIndex[g]=n,this.colByVarIndex[g]=-1,this.height+=1};H.prototype.removeConstraint=function(t){var e=t.index,n=this.height-1,i=this._putInBase(e),r=this.matrix[n];this.matrix[n]=this.matrix[i],this.matrix[i]=r,this.varIndexByRow[i]=this.varIndexByRow[n],this.varIndexByRow[n]=-1,this.rowByVarIndex[e]=-1,this.availableIndexes[this.availableIndexes.length]=e,t.slack.index=-1,this.height-=1};H.prototype.addVariable=function(t){var e=this.height-1,n=this.width,i=this.model.isMinimization===!0?-t.cost:t.cost,r=t.priority,s=this.optionalObjectives.length;if(s>0)for(var u=0;u<s;u+=1)this.optionalObjectives[u].reducedCosts[n]=0;r===0?this.matrix[0][n]=i:(this.setOptionalObjective(r,n,i),this.matrix[0][n]=0);for(var o=1;o<=e;o+=1)this.matrix[o][n]=0;var a=t.index;this.varIndexByCol[n]=a,this.rowByVarIndex[a]=-1,this.colByVarIndex[a]=n,this.width+=1};H.prototype.removeVariable=function(t){var e=t.index,n=this._takeOutOfBase(e),i=this.width-1;if(n!==i){for(var r=this.height-1,s=0;s<=r;s+=1){var u=this.matrix[s];u[n]=u[i]}var o=this.optionalObjectives.length;if(o>0)for(var a=0;a<o;a+=1){var h=this.optionalObjectives[a].reducedCosts;h[n]=h[i]}var l=this.varIndexByCol[i];this.varIndexByCol[n]=l,this.colByVarIndex[l]=n}this.varIndexByCol[i]=-1,this.colByVarIndex[e]=-1,this.availableIndexes[this.availableIndexes.length]=e,t.index=-1,this.width-=1};H.prototype.log=function(t,e){console.log("****",t,"****"),console.log("Nb Variables",this.width-1),console.log("Nb Constraints",this.height-1),console.log("Basic Indexes",this.varIndexByRow),console.log("Non Basic Indexes",this.varIndexByCol),console.log("Rows",this.rowByVarIndex),console.log("Cols",this.colByVarIndex);var n=5,i="",r=[" "],s,u,o,a,h,l,c,f,d,g,v;for(u=1;u<this.width;u+=1)h=this.varIndexByCol[u],a=this.variablesPerIndex[h],a===void 0?l="c"+h:l=a.id,c=l.length,f=" ",d="	",c>5?f+=" ":d+="	",r[u]=f,i+=d+l;console.log(i);var E,m=this.matrix[this.costRowIndex],B="	";for(s=1;s<this.width;s+=1)E="	",B+=E,B+=r[s],B+=m[s].toFixed(n);for(E="	",B+=E+r[0]+m[0].toFixed(n),console.log(B+"	Z"),o=1;o<this.height;o+=1){for(g=this.matrix[o],v="	",u=1;u<this.width;u+=1)E="	",v+=E+r[u]+g[u].toFixed(n);E="	",v+=E+r[0]+g[0].toFixed(n),h=this.varIndexByRow[o],a=this.variablesPerIndex[h],a===void 0?l="c"+h:l=a.id,console.log(v+"	"+l)}console.log("");var b=this.optionalObjectives.length;if(b>0){console.log("    Optional objectives:");for(var C=0;C<b;C+=1){var A=this.optionalObjectives[C].reducedCosts,x="";for(s=1;s<this.width;s+=1)E=A[s]<0?"":" ",x+=E,x+=r[s],x+=A[s].toFixed(n);E=A[0]<0?"":" ",x+=E+r[0]+A[0].toFixed(n),console.log(x+" z"+C)}}return console.log("Feasible?",this.feasible),console.log("evaluation",this.evaluation),this};H.prototype.copy=function(){var t=new H(this.precision);t.width=this.width,t.height=this.height,t.nVars=this.nVars,t.model=this.model,t.variables=this.variables,t.variablesPerIndex=this.variablesPerIndex,t.unrestrictedVars=this.unrestrictedVars,t.lastElementIndex=this.lastElementIndex,t.varIndexByRow=this.varIndexByRow.slice(),t.varIndexByCol=this.varIndexByCol.slice(),t.rowByVarIndex=this.rowByVarIndex.slice(),t.colByVarIndex=this.colByVarIndex.slice(),t.availableIndexes=this.availableIndexes.slice();for(var e=[],n=0;n<this.optionalObjectives.length;n++)e[n]=this.optionalObjectives[n].copy();t.optionalObjectives=e;for(var i=this.matrix,r=new Array(this.height),s=0;s<this.height;s++)r[s]=i[s].slice();return t.matrix=r,t};H.prototype.save=function(){this.savedState=this.copy()};H.prototype.restore=function(){if(this.savedState!==null){var t=this.savedState,e=t.matrix;this.nVars=t.nVars,this.model=t.model,this.variables=t.variables,this.variablesPerIndex=t.variablesPerIndex,this.unrestrictedVars=t.unrestrictedVars,this.lastElementIndex=t.lastElementIndex,this.width=t.width,this.height=t.height;var n,i;for(n=0;n<this.height;n+=1){var r=e[n],s=this.matrix[n];for(i=0;i<this.width;i+=1)s[i]=r[i]}var u=t.varIndexByRow;for(i=0;i<this.height;i+=1)this.varIndexByRow[i]=u[i];for(;this.varIndexByRow.length>this.height;)this.varIndexByRow.pop();var o=t.varIndexByCol;for(n=0;n<this.width;n+=1)this.varIndexByCol[n]=o[n];for(;this.varIndexByCol.length>this.width;)this.varIndexByCol.pop();for(var a=t.rowByVarIndex,h=t.colByVarIndex,l=0;l<this.nVars;l+=1)this.rowByVarIndex[l]=a[l],this.colByVarIndex[l]=h[l];if(t.optionalObjectives.length>0&&this.optionalObjectives.length>0){this.optionalObjectives=[],this.optionalObjectivePerPriority={};for(var c=0;c<t.optionalObjectives.length;c++){var f=t.optionalObjectives[c].copy();this.optionalObjectives[c]=f,this.optionalObjectivePerPriority[f.priority]=f}}}};function Zi(t,e){this.index=t,this.value=e}H.prototype.getMostFractionalVar=function(){for(var t=0,e=null,n=null,i=this.model.integerVariables,r=i.length,s=0;s<r;s++){var u=i[s].index,o=this.rowByVarIndex[u];if(o!==-1){var a=this.matrix[o][this.rhsColumn],h=Math.abs(a-Math.round(a));t<h&&(t=h,e=u,n=a)}}return new Zi(e,n)};H.prototype.getFractionalVarWithLowestCost=function(){for(var t=1/0,e=null,n=null,i=this.model.integerVariables,r=i.length,s=0;s<r;s++){var u=i[s],o=u.index,a=this.rowByVarIndex[o];if(a!==-1){var h=this.matrix[a][this.rhsColumn];if(Math.abs(h-Math.round(h))>this.precision){var l=u.cost;t>l&&(t=l,e=o,n=h)}}}return new Zi(e,n)};H.prototype.countIntegerValues=function(){for(var t=0,e=1;e<this.height;e+=1)if(this.variablesPerIndex[this.varIndexByRow[e]].isInteger){var n=this.matrix[e][this.rhsColumn];n=n-Math.floor(n),n<this.precision&&-n<this.precision&&(t+=1)}return t};H.prototype.isIntegral=function(){for(var t=this.model.integerVariables,e=t.length,n=0;n<e;n++){var i=this.rowByVarIndex[t[n].index];if(i!==-1){var r=this.matrix[i][this.rhsColumn];if(Math.abs(r-Math.round(r))>this.precision)return!1}}return!0};H.prototype.computeFractionalVolume=function(t){for(var e=-1,n=1;n<this.height;n+=1)if(this.variablesPerIndex[this.varIndexByRow[n]].isInteger){var i=this.matrix[n][this.rhsColumn];i=Math.abs(i);var r=Math.min(i-Math.floor(i),Math.floor(i+1));if(r<this.precision){if(!t)return 0}else e===-1?e=i:e*=i}return e===-1?0:e};var xa=H;function ii(t,e,n){this.type=t,this.varIndex=e,this.value=n}function Ve(t,e){this.relaxedEvaluation=t,this.cuts=e}function wa(t,e){return e.relaxedEvaluation-t.relaxedEvaluation}H.prototype.applyCuts=function(t){if(this.restore(),this.addCutConstraints(t),this.simplex(),this.model.useMIRCuts)for(var e=!0;e;){var n=this.computeFractionalVolume(!0);this.applyMIRCuts(),this.simplex();var i=this.computeFractionalVolume(!0);i>=.9*n&&(e=!1)}};H.prototype.branchAndCut=function(){var t=[],e=0,n=this.model.tolerance,i=!0,r=1e99;this.model.timeout&&(r=Date.now()+this.model.timeout);for(var s=1/0,u=null,o=[],a=0;a<this.optionalObjectives.length;a+=1)o.push(1/0);var h=new Ve(-1/0,[]),l;for(t.push(h);t.length>0&&i===!0&&Date.now()<r;)if(this.model.isMinimization?l=this.bestPossibleEval*(1+n):l=this.bestPossibleEval*(1-n),n>0&&s<l&&(i=!1),h=t.pop(),!(h.relaxedEvaluation>s)){var c=h.cuts;if(this.applyCuts(c),e++,this.feasible!==!1){var f=this.evaluation;if(!(f>s)){if(f===s){for(var d=!0,g=0;g<this.optionalObjectives.length&&!(this.optionalObjectives[g].reducedCosts[0]>o[g]);g+=1)if(this.optionalObjectives[g].reducedCosts[0]<o[g]){d=!1;break}if(d)continue}if(this.isIntegral()===!0){if(this.__isIntegral=!0,e===1){this.branchAndCutIterations=e;return}u=h,s=f;for(var v=0;v<this.optionalObjectives.length;v+=1)o[v]=this.optionalObjectives[v].reducedCosts[0]}else{e===1&&this.save();for(var E=this.getMostFractionalVar(),m=E.index,B=[],b=[],C=c.length,A=0;A<C;A+=1){var x=c[A];x.varIndex===m?x.type==="min"?b.push(x):B.push(x):(B.push(x),b.push(x))}var S=Math.ceil(E.value),_=Math.floor(E.value),w=new ii("min",m,S);B.push(w);var $=new ii("max",m,_);b.push($),t.push(new Ve(f,B)),t.push(new Ve(f,b)),t.sort(wa)}}}}u!==null&&this.applyCuts(u.cuts),this.branchAndCutIterations=e};var ba={},be=xt.Constraint,Qi=xt.Equality,Fa=xt.Variable,Ba=xt.IntegerVariable;function X(t,e){this.tableau=new H(t),this.name=e,this.variables=[],this.integerVariables=[],this.unrestrictedVariables={},this.constraints=[],this.nConstraints=0,this.nVariables=0,this.isMinimization=!0,this.tableauInitialized=!1,this.relaxationIndex=1,this.useMIRCuts=!1,this.checkForCycles=!0,this.messages=[]}var ze=X;X.prototype.minimize=function(){return this.isMinimization=!0,this};X.prototype.maximize=function(){return this.isMinimization=!1,this};X.prototype._getNewElementIndex=function(){if(this.availableIndexes.length>0)return this.availableIndexes.pop();var t=this.lastElementIndex;return this.lastElementIndex+=1,t};X.prototype._addConstraint=function(t){var e=t.slack;this.tableau.variablesPerIndex[e.index]=e,this.constraints.push(t),this.nConstraints+=1,this.tableauInitialized===!0&&this.tableau.addConstraint(t)};X.prototype.smallerThan=function(t){var e=new be(t,!0,this.tableau.getNewElementIndex(),this);return this._addConstraint(e),e};X.prototype.greaterThan=function(t){var e=new be(t,!1,this.tableau.getNewElementIndex(),this);return this._addConstraint(e),e};X.prototype.equal=function(t){var e=new be(t,!0,this.tableau.getNewElementIndex(),this);this._addConstraint(e);var n=new be(t,!1,this.tableau.getNewElementIndex(),this);return this._addConstraint(n),new Qi(e,n)};X.prototype.addVariable=function(t,e,n,i,r){if(typeof r=="string")switch(r){case"required":r=0;break;case"strong":r=1;break;case"medium":r=2;break;case"weak":r=3;break;default:r=0;break}var s=this.tableau.getNewElementIndex();e==null&&(e="v"+s),t==null&&(t=0),r==null&&(r=0);var u;return n?(u=new Ba(e,t,s,r),this.integerVariables.push(u)):u=new Fa(e,t,s,r),this.variables.push(u),this.tableau.variablesPerIndex[s]=u,i&&(this.unrestrictedVariables[s]=!0),this.nVariables+=1,this.tableauInitialized===!0&&this.tableau.addVariable(u),u};X.prototype._removeConstraint=function(t){var e=this.constraints.indexOf(t);if(e===-1){console.warn("[Model.removeConstraint] Constraint not present in model");return}this.constraints.splice(e,1),this.nConstraints-=1,this.tableauInitialized===!0&&this.tableau.removeConstraint(t),t.relaxation&&this.removeVariable(t.relaxation)};X.prototype.removeConstraint=function(t){return t.isEquality?(this._removeConstraint(t.upperBound),this._removeConstraint(t.lowerBound)):this._removeConstraint(t),this};X.prototype.removeVariable=function(t){var e=this.variables.indexOf(t);if(e===-1){console.warn("[Model.removeVariable] Variable not present in model");return}return this.variables.splice(e,1),this.tableauInitialized===!0&&this.tableau.removeVariable(t),this};X.prototype.updateRightHandSide=function(t,e){return this.tableauInitialized===!0&&this.tableau.updateRightHandSide(t,e),this};X.prototype.updateConstraintCoefficient=function(t,e,n){return this.tableauInitialized===!0&&this.tableau.updateConstraintCoefficient(t,e,n),this};X.prototype.setCost=function(t,e){var n=t-e.cost;return this.isMinimization===!1&&(n=-n),e.cost=t,this.tableau.updateCost(e,n),this};X.prototype.loadJson=function(t){this.isMinimization=t.opType!=="max";for(var e=t.variables,n=t.constraints,i={},r={},s=Object.keys(n),u=s.length,o=0;o<u;o+=1){var a=s[o],h=n[a],l=h.equal,c=h.weight,f=h.priority,d=c!==void 0||f!==void 0,g,v;if(l===void 0){var E=h.min;E!==void 0&&(g=this.greaterThan(E),i[a]=g,d&&g.relax(c,f));var m=h.max;m!==void 0&&(v=this.smallerThan(m),r[a]=v,d&&v.relax(c,f))}else{g=this.greaterThan(l),i[a]=g,v=this.smallerThan(l),r[a]=v;var B=new Qi(g,v);d&&B.relax(c,f)}}var b=Object.keys(e),C=b.length;this.tolerance=t.tolerance||0,t.timeout&&(this.timeout=t.timeout),t.options&&(t.options.timeout&&(this.timeout=t.options.timeout),this.tolerance===0&&(this.tolerance=t.options.tolerance||0),t.options.useMIRCuts&&(this.useMIRCuts=t.options.useMIRCuts),typeof t.options.exitOnCycles>"u"?this.checkForCycles=!0:this.checkForCycles=t.options.exitOnCycles);for(var A=t.ints||{},x=t.binaries||{},S=t.unrestricted||{},_=t.optimize,w=0;w<C;w+=1){var $=b[w],N=e[$],L=N[_]||0,j=!!x[$],p=!!A[$]||j,I=!!S[$],y=this.addVariable(L,$,p,I);j&&this.smallerThan(1).addTerm(1,y);var M=Object.keys(N);for(o=0;o<M.length;o+=1){var k=M[o];if(k!==_){var O=N[k],T=i[k];T!==void 0&&T.addTerm(O,y);var z=r[k];z!==void 0&&z.addTerm(O,y)}}}return this};X.prototype.getNumberOfIntegerVariables=function(){return this.integerVariables.length};X.prototype.solve=function(){return this.tableauInitialized===!1&&(this.tableau.setModel(this),this.tableauInitialized=!0),this.tableau.solve()};X.prototype.isFeasible=function(){return this.tableau.feasible};X.prototype.save=function(){return this.tableau.save()};X.prototype.restore=function(){return this.tableau.restore()};X.prototype.activateMIRCuts=function(t){this.useMIRCuts=t};X.prototype.debug=function(t){this.checkForCycles=t};X.prototype.log=function(t){return this.tableau.log(t)};var Ia=function(t){var e,n,i;if(typeof t.optimize=="string")if(t.constraints[t.optimize]){e=Math.random();for(n in t.variables)t.variables[n][t.optimize]&&(t.variables[n][e]=t.variables[n][t.optimize]);return t.constraints[e]=t.constraints[t.optimize],delete t.constraints[t.optimize],t}else return t;else{for(i in t.optimize)if(t.constraints[i])if(t.constraints[i]==="equal")delete t.optimize[i];else{e=Math.random();for(n in t.variables)t.variables[n][i]&&(t.variables[n][e]=t.variables[n][i]);t.constraints[e]=t.constraints[i],delete t.constraints[i]}return t}},ri={CleanObjectiveAttributes:Ia};function $a(t){var e={is_blank:/^\W{0,}$/,is_objective:/(max|min)(imize){0,}\:/i,is_int:/^(?!\/\*)\W{0,}int/i,is_bin:/^(?!\/\*)\W{0,}bin/i,is_constraint:/(\>|\<){0,}\=/i,is_unrestricted:/^\S{0,}unrestricted/i,parse_lhs:/(\-|\+){0,1}\s{0,1}\d{0,}\.{0,}\d{0,}\s{0,}[A-Za-z]\S{0,}/gi,parse_rhs:/(\-|\+){0,1}\d{1,}\.{0,}\d{0,}\W{0,}\;{0,1}$/i,parse_dir:/(\>|\<){0,}\=/gi,parse_int:/[^\s|^\,]+/gi,parse_bin:/[^\s|^\,]+/gi,get_num:/(\-|\+){0,1}(\W|^)\d+\.{0,1}\d{0,}/g,get_word:/[A-Za-z].*/},n={opType:"",optimize:"_obj",constraints:{},variables:{}},i={">=":"min","<=":"max","=":"equal"},r="",s=null,u="",o="",a="",h=0;typeof t=="string"&&(t=t.split(`
`));for(var l=0;l<t.length;l++)if(a="__"+l,r=t[l],s=null,e.is_objective.test(r))n.opType=r.match(/(max|min)/gi)[0],s=r.match(e.parse_lhs).map(function(d){return d.replace(/\s+/,"")}).slice(1),s.forEach(function(d){u=d.match(e.get_num),u===null?d.substr(0,1)==="-"?u=-1:u=1:u=u[0],u=parseFloat(u),o=d.match(e.get_word)[0].replace(/\;$/,""),n.variables[o]=n.variables[o]||{},n.variables[o]._obj=u});else if(e.is_int.test(r))s=r.match(e.parse_int).slice(1),n.ints=n.ints||{},s.forEach(function(d){d=d.replace(";",""),n.ints[d]=1});else if(e.is_bin.test(r))s=r.match(e.parse_bin).slice(1),n.binaries=n.binaries||{},s.forEach(function(d){d=d.replace(";",""),n.binaries[d]=1});else if(e.is_constraint.test(r)){var c=r.indexOf(":"),f=c===-1?r:r.slice(c+1);s=f.match(e.parse_lhs).map(function(d){return d.replace(/\s+/,"")}),s.forEach(function(d){u=d.match(e.get_num),u===null?d.substr(0,1)==="-"?u=-1:u=1:u=u[0],u=parseFloat(u),o=d.match(e.get_word)[0],n.variables[o]=n.variables[o]||{},n.variables[o][a]=u}),h=parseFloat(r.match(e.parse_rhs)[0]),r=i[r.match(e.parse_dir)[0]],n.constraints[a]=n.constraints[a]||{},n.constraints[a][r]=h}else e.is_unrestricted.test(r)&&(s=r.match(e.parse_int).slice(1),n.unrestricted=n.unrestricted||{},s.forEach(function(d){d=d.replace(";",""),n.unrestricted[d]=1}));return n}function Sa(t){if(!t)throw new Error("Solver requires a model to operate on");var e="",n={max:"<=",min:">=",equal:"="},i=new RegExp("[^A-Za-z0-9_[{}/.&#$%~'@^]","gi");if(t.opType){e+=t.opType+":";for(var r in t.variables)t.variables[r][r]=t.variables[r][r]?t.variables[r][r]:1,t.variables[r][t.optimize]&&(e+=" "+t.variables[r][t.optimize]+" "+r.replace(i,"_"))}else e+="max:";e+=`;

`;for(var s in t.constraints)for(var u in t.constraints[s])if(typeof n[u]<"u"){for(var o in t.variables)typeof t.variables[o][s]<"u"&&(e+=" "+t.variables[o][s]+" "+o.replace(i,"_"));e+=" "+n[u]+" "+t.constraints[s][u],e+=`;
`}if(t.ints){e+=`

`;for(var a in t.ints)e+="int "+a.replace(i,"_")+`;
`}if(t.unrestricted){e+=`

`;for(var h in t.unrestricted)e+="unrestricted "+h.replace(i,"_")+`;
`}return e}var Bn=function(t){return t.length?$a(t):Sa(t)},Ma={},Ta=Object.freeze({__proto__:null,default:Ma});function Ra(t){if(t.__esModule)return t;var e=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(t).forEach(function(n){var i=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,i.get?i:{enumerable:!0,get:function(){return t[n]}})}),e}var si=Ra(Ta),ka=Bn;function ui(t){return t=t.replace("\\r\\n",`\r
`),t=t.split(`\r
`),t=t.filter(function(e){var n;return n=new RegExp(" 0$","gi"),!(n.test(e)===!0||(n=new RegExp("\\d$","gi"),n.test(e)===!1))}).map(function(e){return e.split(/\:{0,1} +(?=\d)/)}).reduce(function(e,n,i){return e[n[0]]=n[1],e},{}),t}var Na=function(t){return new Promise(function(e,n){typeof window<"u"&&n("Function Not Available in Browser");var i=Bn(t);t.external||n("Data for this function must be contained in the 'external' attribute. Not seeing anything there."),t.external.binPath||n("No Executable | Binary path provided in arguments as 'binPath'"),t.external.args||n("No arguments array for cli | bash provided on 'args' attribute"),t.external.tempName||n("No 'tempName' given. This is necessary to produce a staging file for the solver to operate on");var r=si;r.writeFile(t.external.tempName,i,function(s,u){if(s)n(s);else{var o=si.execFile;t.external.args.push(t.external.tempName),o(t.external.binPath,t.external.args,function(a,h){if(a)if(a.code===1)e(ui(h));else{var l={"-2":"Out of Memory",1:"SUBOPTIMAL",2:"INFEASIBLE",3:"UNBOUNDED",4:"DEGENERATE",5:"NUMFAILURE",6:"USER-ABORT",7:"TIMEOUT",9:"PRESOLVED",25:"ACCURACY ERROR",255:"FILE-ERROR"},c={code:a.code,meaning:l[a.code],data:h};n(c)}else e(ui(h))})}})})},Oa={reformat:ka,solve:Na},ce={lpsolve:Oa},oi=function(t,e){var n=e.optimize,i=JSON.parse(JSON.stringify(e.optimize)),r=Object.keys(e.optimize),s,u=0,o={},a="",h={},l=[],c,f,d,g;for(delete e.optimize,c=0;c<r.length;c++)i[r[c]]=0;for(c=0;c<r.length;c++){e.optimize=r[c],e.opType=n[r[c]],s=t.Solve(e,void 0,void 0,!0);for(g in r)if(!e.variables[r[g]]){s[r[g]]=s[r[g]]?s[r[g]]:0;for(d in e.variables)e.variables[d][r[g]]&&s[d]&&(s[r[g]]+=s[d]*e.variables[d][r[g]])}for(a="base",f=0;f<r.length;f++)s[r[f]]?a+="-"+(s[r[f]]*1e3|0)/1e3:a+="-0";if(!o[a]){for(o[a]=1,u++,f=0;f<r.length;f++)s[r[f]]&&(i[r[f]]+=s[r[f]]);delete s.feasible,delete s.result,l.push(s)}}for(c=0;c<r.length;c++)e.constraints[r[c]]={equal:i[r[c]]/u};e.optimize="cheater-"+Math.random(),e.opType="max";for(c in e.variables)e.variables[c].cheater=1;for(c in l)for(d in l[c])h[d]=h[d]||{min:1e99,max:-1e99};for(c in h)for(d in l)l[d][c]?(l[d][c]>h[c].max&&(h[c].max=l[d][c]),l[d][c]<h[c].min&&(h[c].min=l[d][c])):(l[d][c]=0,h[c].min=0);return s=t.Solve(e,void 0,void 0,!0),{midpoint:s,vertices:l,ranges:h}},La=xt.Constraint,Pa=xt.Variable,Va=xt.Numeral,za=xt.Term,rn=function(){this.Model=ze,this.branchAndCut=ba,this.Constraint=La,this.Variable=Pa,this.Numeral=Va,this.Term=za,this.Tableau=xa,this.lastSolvedModel=null,this.External=ce,this.Solve=function(t,e,n,i){if(i)for(var r in ri)t=ri[r](t);if(!t)throw new Error("Solver requires a model to operate on");if(typeof t.optimize=="object"&&Object.keys(t.optimize>1))return oi(this,t);if(t.external){var s=Object.keys(ce);if(s=JSON.stringify(s),!t.external.solver)throw new Error("The model you provided has an 'external' object that doesn't have a solver attribute. Use one of the following:"+s);if(!ce[t.external.solver])throw new Error("No support (yet) for "+t.external.solver+". Please use one of these instead:"+s);return ce[t.external.solver].solve(t)}else{t instanceof ze||(t=new ze(e).loadJson(t));var u=t.solve();if(this.lastSolvedModel=t,u.solutionSet=u.generateSolutionSet(),n)return u;var o={};return o.feasible=u.feasible,o.result=u.evaluation,o.bounded=u.bounded,u._tableau.__isIntegral&&(o.isIntegral=!0),Object.keys(u.solutionSet).forEach(function(a){u.solutionSet[a]!==0&&(o[a]=u.solutionSet[a])}),o}},this.ReformatLP=Bn,this.MultiObjective=function(t){return oi(this,t)}};typeof window=="object"?window.solver=new rn:typeof self=="object"&&(self.solver=new rn);var ja=new rn;function sn(t,e){const n=e?"":"\0",i=e?"rank: ":"\0",r=e?" -> ":"\0";function s(c){return`${n}${c.id}`}function u(c){return`${c.source.id}${r}${c.target.id}`}function o(c,f){return`${i}${c.id}${r}${f.id}`}function a(c){const f=Object.create(null),d=Object.create(null),g=Object.create(null),v=[];for(const A of c){const x=s(A);d[x]=1,f[x]={opt:A.children.length};const S=t(A);S!==void 0&&v.push([S,A])}for(const A of c.ilinks()){const x=f[s(A.source)],S=f[s(A.target)],_=u(A);g[_]={min:1},x[_]=-1,x.opt++,S[_]=1,S.opt--}let[E,...m]=v.sort(([A],[x])=>A-x);for(const A of m){const[x,S]=E,[_,w]=A,$=f[s(S)],N=f[s(w)],L=o(S,w);if(x<_)g[L]={min:1},$[L]=-1,N[L]=1;else{const j=o(w,S);g[L]={min:0},g[j]={min:0},$[L]=-1,$[j]=1,N[L]=1,N[j]=-1}E=A}const B=ja.Solve({optimize:"opt",opType:"max",constraints:g,variables:f,ints:d}),{feasible:b}=B,C=Ca(B,["feasible"]);if(!b)throw v.length?new Error("could not find a feasbile simplex layout, check that rank accessors are not ill-defined"):new Error("could not find feasbile simplex layout, this should not happen");for(const A of c)A.layer=C[s(A)]||0}function h(c){return c===void 0?t:sn(c,e)}a.rank=h;function l(c){return c===void 0?e:sn(t,c)}return a.debug=l,a}function qa(){}function Ja(...t){if(t.length)throw new Error(`got arguments to simplex(${t}), but constructor takes no aruguments.`);return sn(qa,!1)}function Ga(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function*Ha(t,e){for(let n of t)n!=null&&(n=+n)>=n&&(yield n)}function ai(t,e){let n;for(const i of t)i!=null&&(n<i||n===void 0&&i>=i)&&(n=i);return n}function li(t,e){let n;for(const i of t)i!=null&&(n>i||n===void 0&&i>=i)&&(n=i);return n}function tr(t,e,n=0,i=t.length-1,r=Ga){for(;i>n;){if(i-n>600){const a=i-n+1,h=e-n+1,l=Math.log(a),c=.5*Math.exp(2*l/3),f=.5*Math.sqrt(l*c*(a-c)/a)*(h-a/2<0?-1:1),d=Math.max(n,Math.floor(e-h*c/a+f)),g=Math.min(i,Math.floor(e+(a-h)*c/a+f));tr(t,e,d,g,r)}const s=t[e];let u=n,o=i;for(Xt(t,n,e),r(t[i],s)>0&&Xt(t,n,i);u<o;){for(Xt(t,u,o),++u,--o;r(t[u],s)<0;)++u;for(;r(t[o],s)>0;)--o}r(t[n],s)===0?Xt(t,n,o):(++o,Xt(t,o,i)),o<=e&&(n=o+1),e<=o&&(i=o-1)}return t}function Xt(t,e,n){const i=t[e];t[e]=t[n],t[n]=i}function Ua(t,e,n){if(t=Float64Array.from(Ha(t)),!!(i=t.length)){if((e=+e)<=0||i<2)return li(t);if(e>=1)return ai(t);var i,r=(i-1)*e,s=Math.floor(r),u=ai(tr(t,s).subarray(0,s+1)),o=li(t.subarray(s+1));return u+(o-u)*(r-s)}}function Wa(t,e){return Ua(t,.5)}function Xa(...t){if(t.length)throw new Error(`got arguments to median(${t}), but constructor takes no aruguments.`);function e(n,i){const r=new lt;for(const[o,a]of n.entries())for(const h of a.ichildren())r.setIfAbsent(h.id,[]).push(o);const s=new lt;let u=-1;for(const o of i){const a=Wa(r.getDefault(o.id,[]));a===void 0?(s.set(o.id,u),u=+!((u+1)/(n.length+1))*(n.length+1)-1):s.set(o.id,a)}i.sort((o,a)=>s.getThrow(o.id)-s.getThrow(a.id))}return e}function er(t){function e(i){i.slice(0,i.length-1).forEach((r,s)=>t(r,i[s+1]))}function n(i){return i===void 0?t:er(i)}return e.order=n,e}function Ya(...t){if(t.length)throw new Error(`got arguments to twoLayer(${t}), but constructor takes no aruguments.`);return er(Xa())}function wt(t,e,n,i,r,s,u){const[o,a]=r;function h(b){const C=[];for(const A of b.descendants()){const x=A.layer;(C[x]||(C[x]=[])).push(A),A.dataChildren=A.dataChildren.map(_=>{const w=_.child.layer;if(w<=x)throw new Error(`layering left child node "${_.child.id}" (${w}) with a greater or equal layer to parent node "${A.id}" (${x})`);let $=_.child;for(let N=w-1;N>x;N--){let L;u?L=`${A.id}->${_.child.id} (${N})`:L=`${A.id}\0${_.child.id}\0${N}`;const j=new Ft(L);j.dataChildren.push(new me($,void 0)),(C[N]||(C[N]=[])).push(j),$=j}return new me($,_.data)})}return C}function l(b){for(const C of b)C instanceof Ft||(C.dataChildren=C.dataChildren.map(A=>{let x=A.child;const S=[{x:C.x,y:C.y}];for(;x instanceof Ft;)S.push({x:x.x,y:x.y}),[x]=x.ichildren();return S.push({x:x.x,y:x.y}),new me(x,A.data,S)}))}function c(b){t(b);for(const x of b){const S=x.layer;if(S===void 0)throw new Error(`layering did not assign layer to node '${x.id}'`);if(S<0)throw new Error(`layering assigned a negative layer (${S}) to node '${x.id}'`)}const C=h(b);if(C.length===1){const[x]=C;for(const S of x)S.y=a/2}else{const x=i?a:a/(C.length-1);for(const[S,_]of C.entries())for(const w of _)w.y=x*S}if(C.every(x=>x.length===1))for(const[x]of C)x.x=o/2;else if(C.length===1){const[x]=C;Ui(x,s);const S=x,_=i?S.length-1:1;for(const w of S)w.x*=o*_}else{e(C),n(C,s);for(const _ of C)for(const w of _)if(w.x===void 0)throw new Error(`coord didn't assign an x to node '${w.id}'`);const x=C,S=i?Math.max(...C.map(_=>_.length))-1:1;for(const _ of x)for(const w of _)w.x*=o*S}const A=b;return l(A),A}function f(b){return b===void 0?t:wt(b,e,n,i,r,s,u)}c.layering=f;function d(b){return b===void 0?e:wt(t,b,n,i,r,s,u)}c.decross=d;function g(b){return b===void 0?n:wt(t,e,b,i,r,s,u)}c.coord=g;function v(b){return b!==void 0?wt(t,e,n,!1,b,s,u):i?null:r}c.size=v;function E(b){return b!==void 0?wt(t,e,n,!0,b,s,u):i?r:null}c.nodeSize=E;function m(b){return b===void 0?s:wt(t,e,n,i,r,b,u)}c.separation=m;function B(b){return b===void 0?u:wt(t,e,n,i,r,s,b)}return c.debug=B,c}function Ka(t,e){return+!(t instanceof Ft)+ +!(e instanceof Ft)}function Za(...t){if(t.length)throw new Error(`got arguments to sugiyama(${t}), but constructor takes no aruguments.`);return wt(Ja(),Ya(),Ea(),!1,[1,1],Ka,!1)}var Qa=function(t,e){return t<e};function K(t){if(!(this instanceof K))return new K(t);this.array=[],this.size=0,this.compare=t||Qa}K.prototype.clone=function(){var t=new K(this.compare);t.size=this.size;for(var e=0;e<this.size;e++)t.array.push(this.array[e]);return t};K.prototype.add=function(t){var e=this.size;this.array[this.size]=t,this.size+=1;for(var n,i;e>0&&(n=e-1>>1,i=this.array[n],!!this.compare(t,i));)this.array[e]=i,e=n;this.array[e]=t};K.prototype.heapify=function(t){this.array=t,this.size=t.length;var e;for(e=this.size>>1;e>=0;e--)this._percolateDown(e)};K.prototype._percolateUp=function(t,e){for(var n=this.array[t],i,r;t>0&&(i=t-1>>1,r=this.array[i],!(!e&&!this.compare(n,r)));)this.array[t]=r,t=i;this.array[t]=n};K.prototype._percolateDown=function(t){for(var e=this.size,n=this.size>>>1,i=this.array[t],r,s,u;t<n&&(r=(t<<1)+1,s=r+1,u=this.array[r],s<e&&this.compare(this.array[s],u)&&(r=s,u=this.array[s]),!!this.compare(u,i));)this.array[t]=u,t=r;this.array[t]=i};K.prototype._removeAt=function(t){if(!(t>this.size-1||t<0))return this._percolateUp(t,!0),this.poll()};K.prototype.remove=function(t){for(var e=0;e<this.size;e++)if(!this.compare(this.array[e],t)&&!this.compare(t,this.array[e]))return this._removeAt(e),!0;return!1};K.prototype._batchRemove=function(t,e){var n=new Array(e||this.size),i=0;if(typeof t=="function"&&this.size)for(var r=0;r<this.size&&i<n.length;)t(this.array[r])?(n[i]=this._removeAt(r),i++,r=r>>1):r++;return n.length=i,n};K.prototype.removeOne=function(t){var e=this._batchRemove(t,1);return e.length>0?e[0]:void 0};K.prototype.removeMany=function(t,e){return this._batchRemove(t,e)};K.prototype.peek=function(){if(this.size!=0)return this.array[0]};K.prototype.poll=function(){if(this.size!=0){var t=this.array[0];return this.size>1?(this.array[0]=this.array[--this.size],this._percolateDown(0)):this.size-=1,t}};K.prototype.replaceTop=function(t){if(this.size!=0){var e=this.array[0];return this.array[0]=t,this._percolateDown(0),e}};K.prototype.trim=function(){this.array=this.array.slice(0,this.size)};K.prototype.isEmpty=function(){return this.size===0};K.prototype.forEach=function(t){if(!(this.isEmpty()||typeof t!="function"))for(var e=0,n=this.clone();!n.isEmpty();)t(n.poll(),e++)};K.prototype.kSmallest=function(t){if(this.size==0)return[];var e=this.compare,n=this.array,i=new K(function(h,l){return e(n[h],n[l])});t=Math.min(this.size,t);var r=new Array(t),s=0;for(i.add(0);s<t;){var u=i.poll();r[s++]=this.array[u];var o=(u<<1)+1,a=o+1;o<this.size&&i.add(o),a<this.size&&i.add(a)}return r};var tl=K;class el{constructor(){this.before=[],this.parents=[]}}function nr(t){function e(i){const r=t||Math.floor(Math.sqrt(i.size()+.5)),s=new lt(i.idescendants().map(f=>[f.id,new el]));for(const f of i)for(const d of f.ichildren())s.getThrow(d.id).parents.push(f);function u(f,d){const g=s.getThrow(f.id).before,v=s.getThrow(d.id).before;for(const[E,m]of g.entries()){const B=v[E];if(B===void 0)return!1;if(m<B)return!0;if(B<m)return!1}return!0}const o=new tl(u);for(const f of i.iroots())o.add(f);let a=0,h=0,l=0,c;for(;c=o.poll();){l<r&&s.getThrow(c.id).parents.every(f=>en(f.layer)<h)?(c.layer=h,l++):(c.layer=++h,l=1);for(const f of c.ichildren()){const{before:d,parents:g}=s.getThrow(f.id);d.push(a),d.length===g.length&&(d.sort((v,E)=>E-v),o.add(f))}a++}}function n(i){if(i===void 0)return t;if(i<0)throw new Error(`width must be non-negative: ${i}`);return nr(i)}return e.width=n,e}function nl(...t){if(t.length)throw new Error(`got arguments to coffmanGraham(${t}), but constructor takes no aruguments.`);return nr(0)}function il(...t){if(t.length)throw new Error(`got arguments to center(${t}), but constructor takes no aruguments.`);function e(n,i){const r=Math.max(...n.map(s=>{let[u,...o]=s,a=u.x=0;for(const h of o)a=h.x=a+i(u,h),u=h;return a}));if(r>0)for(const s of n){const u=en(s[s.length-1].x)/2;for(const o of s)o.x=(en(o.x)-u)/r+.5}else for(const s of n)for(const u of s)u.x=.5}return e}class ir{constructor(){this.stateAtEvent=new rl,this.eventCache=new sl}}class rl{constructor(){this.state={}}setState(e,n){this.state[e]=n,console.log(`StateAtEvent ${e} is`,n)}getStateAsEventIds(e){return this.state[e]?new Set(Object.values(this.state[e])):new Set}getState(e){return this.state[e]?JSON.parse(JSON.stringify(this.state[e])):{}}}class sl{constructor(){this.cache=new Map}store(e){this.cache.set(e.event_id,e)}get(e){return this.cache.get(e)}}class ul{constructor(e){this.scenario=e,this.index=e.events.length-1,this.eventIdOrdering=e.events.map(n=>n.event_id),this.currentEventId=this.eventIdOrdering[this.index]}next(){this.index++,this.index>=this.eventIdOrdering.length&&(this.index=this.eventIdOrdering.length-1),this.currentEventId=this.eventIdOrdering[this.index]}previous(){this.index--,this.index<0&&(this.index=0),this.currentEventId=this.eventIdOrdering[this.index]}goTo(e){for(let n=0;n<this.eventIdOrdering.length;n++)if(this.eventIdOrdering[n]===e){this.index=n,this.currentEventId=this.eventIdOrdering[this.index];break}}current(){return this.currentEventId}eventsUpToCurrent(){const e=[];for(let n=0;n<=this.index;n++)e.push(this.eventIdOrdering[n]);return e}async resolve(e,n){for(const i of this.eventsUpToCurrent())await this.resolveEvent(i,e,n)}async resolveEvent(e,n,i){if(n.stateAtEvent.getStateAsEventIds(e).size>0)return;const r=n.eventCache.get(e);let s={};switch(r.prev_events.length){case 0:break;case 1:{const u=r.prev_events[0],o=n.stateAtEvent.getState(u);Object.keys(o).length===0&&console.error(`WARN: we do not know the state at ${u} yet, so the state calculation for ${e} may be wrong!`),s=o;break}default:{const u=[];for(const o of r.prev_events){const a=n.stateAtEvent.getState(o);Object.keys(a).length===0&&console.error(`WARN: we do not know the state at ${o} yet, so the state calculation for ${e} may be wrong!`),u.push(a)}console.log("performing state resolution for prev_events:",r.prev_events),s=await i(r.room_id,this.scenario.roomVersion,u)}}r.state_key!=null&&(s[JSON.stringify([r.type,r.state_key])]=e),n.stateAtEvent.setState(e,s)}}class ol{constructor(e,n){this.container=e,this.template=n}clear(){this.container.innerHTML=""}onEventClick(e){this.positionListener=e}onEventJsonClick(e){this.jsonListener=e}onCellClick(e){this.onClick(e,this.positionListener)}onJsonClick(e){this.onClick(e,this.jsonListener)}onClick(e,n){var s;const i=(s=e.target)==null?void 0:s.parentElement;if(!i)return;const r=i.getAttribute("id");r&&n&&n(r)}appendEvent(e,n){const i=this.template.content.firstElementChild.cloneNode(!0);i.setAttribute("id",n.event_id);const r=i.getElementsByClassName("eventlistrowprefix")[0];r.textContent=String(e),i.addEventListener("click",this.onCellClick.bind(this)),i.getElementsByClassName("eventlistrowjson")[0].addEventListener("click",this.onJsonClick.bind(this)),i.getElementsByClassName("eventlistrowbody")[0].textContent=this.textRepresentation(n),i.getElementsByClassName("eventlistroweventid")[0].textContent=n.event_id.substr(0,5),n.state_key!=null&&(i.style.fontWeight="600"),this.container.appendChild(i)}textRepresentation(e){var r;let n="",i="";if(e.state_key!=null)switch(e.type){case"m.room.create":n=`by ${e.content.creator}`;break;case"m.room.member":n=`${e.state_key}=${e.content.membership}`;break;case"m.room.join_rules":n=`(${e.content.join_rule})`;break;case"m.room.history_visibility":n=`(${e.content.history_visibility})`;break;case"m.room.name":n=`(${e.content.name})`;break;case"m.room.topic":n=`(${e.content.topic})`;break;default:e.state_key!==""&&(n=e.state_key)}else switch(e.type){case"m.reaction":i=(r=e.content["m.relates_to"])==null?void 0:r.key;break;case"m.room.message":i=e.content.body;break}return`${e.type} ${n}${i}`}highlight(e){if(this.highlightedEventId){const n=document.getElementById(this.highlightedEventId);n&&(n.style.backgroundColor="")}document.getElementById(e).style.backgroundColor="#6f8ea9",this.highlightedEventId=e}}const al=(t,e)=>{var x,S;e=JSON.parse(JSON.stringify(e));const n=e,i=new Map;for(let _=0;_<n.length;_++)n[_].streamPosition=_,i.set(n[_].event_id,n[_]);for(const _ of n.slice()){_.prev_events.sort((w,$)=>{var N,L;return(((N=i.get(w))==null?void 0:N.streamPosition)||0)-(((L=i.get($))==null?void 0:L.streamPosition)||0)});for(const w of _.prev_events){if(!i.get(w)){const N={event_id:w,type:"dangling",prev_events:[],next_events:[],content:{},sender:"dangling",auth_events:[],room_id:"",origin_server_ts:0};i.set(w,N);const L=n.findIndex(j=>j.event_id===_.event_id);console.log("inserting placeholder prev_event at ",L),n.splice(L,0,N)}const $=i.get(w);$.next_events||($.next_events=[]),$.next_events.push(_.event_id)}}const r=[],s=[];function u(_=null){{const w=_==null?0:_+1;if(w>=r.length)return w;for(let $=w;$<r.length;$++)if(!r[$])return $;return r.length}}let o=0;n[0].x=0;for(let _=0;_<n.length;_++){const w=n[_];w.y=o,o++;let $=!1;for(const L of w.prev_events){const j=i.get(L);r.findIndex(p=>p===j.event_id)!==-1&&(w.x=j.x,$=!0);break}if(!$&&(w.x=u(),w.prev_events&&i.get(w.prev_events[0]))){const L=i.get(w.prev_events[0]).y;for(;s[w.x]!==void 0&&L<s[w.x];)w.x=u(w.x)}let N=!1;if(w.next_events){for(const L of w.next_events)if(i.get(L).prev_events[0]===w.event_id){N=!0;break}}N?r[w.x]=w.event_id:(delete r[w.x],s[w.x]=o)}const a=[];n[0].laneWidth=0;for(let _=1;_<n.length;_++){const w=n[_-1],$=n[_];for(;a.length>0&&_>((x=a.at(-1))==null?void 0:x.y);)a.pop();w.next_events&&a.push({x:i.get(w.next_events.at(-1)).x,y:i.get(w.next_events.at(-1)).y}),a.sort((N,L)=>N.x-L.x),$.laneWidth=(S=a.at(-1))==null?void 0:S.x,$.laneWidth%2&&($.x-=.5,$.laneWidth-=.5)}const h={top:20,right:20,bottom:30,left:230},l=40,c=25,f=5,d=2,g=3,v="#f00",E="#0a0",m="#00f";et(t).html(null);const B=r.length*l+1e3,b=n.length*c,A=et(t).append("svg").attr("width",B+h.left+h.right).attr("height",b+h.top+h.bottom).append("g").attr("transform",`translate(${[h.left,h.top]})`).selectAll("g").data(n).enter().append("g").attr("class",_=>`node-${_.event_id.slice(1,5)}`).on("mouseover",function(_,w){et(this).attr("fill",E).attr("font-weight","bold"),ue(`.child-${w.event_id.slice(1,5)}`).raise().attr("stroke",m).attr("stroke-width",g),ue(`.parent-${w.event_id.slice(1,5)}`).raise().attr("stroke",v).attr("stroke-width",g);for(const N of w.next_events||[])et(`.node-${N.slice(1,5)}`).attr("fill",m);for(const N of w.prev_events)et(`.node-${N.slice(1,5)}`).attr("fill",v)}).on("mouseout",function(_,w){et(this).attr("fill",null).attr("font-weight",null);for(const $ of w.next_events||[])et(`.node-${$.slice(1,5)}`).attr("fill",null);for(const $ of w.prev_events)et(`.node-${$.slice(1,5)}`).attr("fill",null);ue(`.child-${w.event_id.slice(1,5)}`).attr("stroke","black").attr("stroke-width",d),ue(`.parent-${w.event_id.slice(1,5)}`).attr("stroke","black").attr("stroke-width",d)});A.append("circle").attr("cx",_=>_.x*l).attr("cy",_=>_.y*c).attr("r",f).style("fill",_=>_.state_key?"#4300ff":"#ff3e00").style("fill-opacity","0.5").style("stroke",_=>_.state_key?"#4300ff":"#ff3e00"),A.append("path").attr("d",_=>{const w=xe();if(_.next_events)for(const $ of _.next_events){const N=i.get($);w.moveTo(_.x*l,_.y*c+f),w.arcTo(_.x*l,(_.y+.5)*c,N.x*l,(_.y+.5)*c,f),w.arcTo(N.x*l,(_.y+.5)*c,N.x*l,N.y*c-f,f),w.lineTo(N.x*l,N.y*c-f)}return w}).attr("stroke","white").attr("stroke-width",d+2).attr("fill","none"),A.each((_,w,$)=>{const N=et($[w]);if(_.next_events)for(const L of _.next_events){const j=i.get(L);if(!j)continue;const p=xe();let I=0;p.moveTo(_.x*l,_.y*c+f+0),p.arcTo(_.x*l,(_.y+.5)*c,j.x*l,(_.y+.5)*c,f),p.arcTo(j.x*l,(_.y+.5)*c,j.x*l,j.y*c-f,f),p.lineTo(j.x*l+I,j.y*c-f),p.moveTo(_.x*l-f/3,_.y*c+f+f/2),p.lineTo(_.x*l,_.y*c+f),p.lineTo(_.x*l+f/3,_.y*c+f+f/2),p.lineTo(_.x*l-f/3,_.y*c+f+f/2),p.lineTo(_.x*l,_.y*c+f),N.append("path").attr("d",p.toString()).attr("class",M=>`child-${M.event_id.slice(1,5)} parent-${j==null?void 0:j.event_id.slice(1,5)}`).attr("stroke","black").attr("stroke-width",d).attr("fill","none")}}),A.append("text").text(_=>`${_.y} ${_.event_id.slice(0,5)} ${_.sender} ${_.type} ${_.content.body??""}`).attr("x",_=>_.laneWidth*l+25).attr("y",_=>_.y*c+4),A.append("text").text(_=>_.origin_server_ts?new Date(_.origin_server_ts).toLocaleString():"").attr("x",-h.left).attr("y",_=>_.y*c+4)},rr={calculate_event_ids:!0,on_load_at_start:!0,events:[{type:"m.room.create",state_key:"",sender:"@creator:tardis",auth_events:[],prev_events:[],content:{creator:"@creator:tardis"},event_id:"$CREATE"},{type:"m.room.member",state_key:"@creator:tardis",sender:"@creator:tardis",auth_events:["$CREATE"],prev_events:["$CREATE"],content:{membership:"join"},event_id:"$JOIN"},{type:"m.room.message",sender:"@creator:tardis",auth_events:["$CREATE","$JOIN"],prev_events:["$JOIN"],content:{body:"A wild fork appears!"},event_id:"$FORK1"},{type:"m.room.message",sender:"@creator:tardis",auth_events:["$CREATE","$JOIN"],prev_events:["$JOIN"],content:{body:"Another wild fork appears!"},event_id:"$FORK2"},{type:"m.room.message",sender:"@creator:tardis",auth_events:["$CREATE","$JOIN"],prev_events:["$FORK1","$FORK2"],content:{body:"Merged!"},event_id:"$MERGE"},{type:"m.room.message",sender:"@creator:tardis",auth_events:["$CREATE","$JOIN"],prev_events:["$MERGE"],content:{body:"This event has precalculated state"},event_id:"$PRESTATE"},{type:"m.room.name",state_key:"",sender:"@creator:tardis",auth_events:["$CREATE","$JOIN"],prev_events:["$PRESTATE"],content:{name:"State events are bigger than messages"},event_id:"$MSG"},{type:"m.room.message",sender:"@creator:tardis",auth_events:["$CREATE","$JOIN"],prev_events:["$MSG"],content:{body:"Boring long chains..."},event_id:"$MSG2"},{type:"m.room.message",sender:"@creator:tardis",auth_events:["$CREATE","$JOIN"],prev_events:["$MSG2"],content:{body:"...can be collapsed..."},event_id:"$MSG3"},{type:"m.room.message",sender:"@creator:tardis",auth_events:["$CREATE","$JOIN"],prev_events:["$MSG3"],content:{body:"...by checking the collapse checkbox."},event_id:"$MSG4"}],room_id:"!quickstart:tardis",room_version:"10",tardis_version:1,annotations:{title:["Welcome to TARDIS!","(click, drag, zoom to navigate the DAG)","Press the  button to continue."].join(`
`),titles:{$FORK1:["The current event is highlighted in blue.","Message events are smaller than state events."].join(`
`),$FORK2:["The DAG can fork, which indicates","some events were sent at the same time."].join(`
`),$MERGE:["The DAG can merge, which merges","state from each fork together."].join(`
`),$PRESTATE:["Green events indicate the","state at this event.","Message events will never be green."].join(`
`),$MSG:["Check the 'Auth Chain' box to show","the `auth_events` for each event."].join(`
`),$MSG2:["Press the 'Resolve State' button to","calculate which events are part of","the current room state."].join(`
`),$MSG3:["As state resolution is iterative,","it will resolve state for all earlier","events as well. Click on an earlier","event in the list to jump to that event."].join(`
`),$MSG4:["Now load a file or use one of the","pre-loaded files to experiment with","state resolution in Matrix!"].join(`
`)},events:{$MSG:"Bigger nodes like this one are state events.",$MSG2:"Boring long chains...",$MSG3:"...can be collapsed...",$MSG4:"...by checking the collapse checkbox.",$PRESTATE:"This event has pre-calculated state (in green) after this event"}},precalculated_state_after:{$PRESTATE:["$CREATE","$JOIN"]}},ll={calculate_event_ids:!0,on_load_at_start:!0,events:[{type:"m.room.create",state_key:"",sender:"@alice:tardis",auth_events:[],prev_events:[],content:{creator:"@alice:tardis"},event_id:"$CREATE"},{type:"m.room.member",state_key:"@alice:tardis",sender:"@alice:tardis",auth_events:["$CREATE"],prev_events:["$CREATE"],content:{membership:"join"},event_id:"$ALICE"},{type:"m.room.power_levels",state_key:"",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE"],prev_events:["$ALICE"],content:{users:{"@alice:tardis":100},events:{"m.room.name":50},users_default:50},event_id:"$PL"},{type:"m.room.join_rules",state_key:"",sender:"@creator:tardis",auth_events:["$CREATE","$ALICE","$PL"],prev_events:["$PL"],content:{join_rule:"public"},event_id:"$JR"},{type:"m.room.member",state_key:"@bob:tardis",sender:"@bob:tardis",auth_events:["$CREATE","$JR","$PL"],prev_events:["$JR"],content:{membership:"join"},event_id:"$BOB"},{type:"m.room.name",state_key:"",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE","$PL"],prev_events:["$BOB"],content:{name:"Alice Room"},event_id:"$ALICE_NAME"},{type:"m.room.name",state_key:"",sender:"@bob:tardis",auth_events:["$CREATE","$BOB","$PL"],prev_events:["$BOB"],content:{name:"Bob Room"},event_id:"$BOB_NAME"},{type:"m.room.message",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE","$PL"],prev_events:["$ALICE_NAME","$BOB_NAME"],content:{body:"Bob wins."},event_id:"$MERGE1"},{type:"m.room.name",state_key:"",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE","$PL"],prev_events:["$MERGE1"],content:{name:"Alice Room 2"},origin_server_ts:1704067291337,event_id:"$ALICE_NAME2"},{type:"m.room.name",state_key:"",sender:"@bob:tardis",auth_events:["$CREATE","$BOB","$PL"],prev_events:["$MERGE1"],content:{name:"Bob Room 2"},origin_server_ts:1704067291337,event_id:"$BOB_NAME2"},{type:"m.room.message",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE","$PL"],prev_events:["$ALICE_NAME2","$BOB_NAME2"],content:{body:"Alice wins."},event_id:"$MERGE2"},{type:"m.room.name",state_key:"",sender:"@bob:tardis",auth_events:["$CREATE","$BOB","$PL"],prev_events:["$MERGE2"],content:{name:"Bob Room 3"},origin_server_ts:1704077300300,event_id:"$BOB_NAME3"},{type:"m.room.power_levels",state_key:"",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE"],prev_events:["$MERGE2"],content:{users:{"@alice:tardis":100},events:{"m.room.name":50},users_default:50},event_id:"$PL2"},{type:"m.room.name",state_key:"",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE","$PL2"],prev_events:["$PL2"],content:{name:"Alice Room 3"},origin_server_ts:1704077299300,event_id:"$ALICE_NAME3"},{type:"m.room.message",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE","$PL2"],prev_events:["$ALICE_NAME3","$BOB_NAME3"],content:{body:"Alice wins."},event_id:"$MERGE3"}],room_id:"!mainline-fork:tardis",room_version:"10",tardis_version:1,annotations:{title:["The winner follows this priority:","Mainline depth THEN","origin_server_ts THEN","event ID"].join(`
`),titles:{$ALICE:["Mainline Ordering:","The conflicting state events in this example","are all room name changes and hence do not","restrict anyone's permissions. This makes it","easier to explain. All of the merges in this","example are due to 'mainline ordering'.","NOTE: You need a shim server running to run this,","otherwise you won't see which events win state","resolution!"].join(`
`),$MERGE1:["Bob wins because his event has a higher origin_server_ts.","Both events have the same mainline depth."].join(`
`),$MERGE2:["Both events have the same timestamp.","Alice wins with a higher event ID (A < Z < a < z)."].join(`
`),$MERGE3:["Bob's event has a higher timestamp but","Alice wins because her event","happened AFTER a change to the power levels.","This gives her event a higher 'mainline position'","which is considered before the timestamp or event ID."].join(`
`)},events:{}}},hl={calculate_event_ids:!0,on_load_at_start:!0,events:[{type:"m.room.create",state_key:"",sender:"@alice:tardis",auth_events:[],prev_events:[],content:{creator:"@alice:tardis"},event_id:"$CREATE"},{type:"m.room.member",state_key:"@alice:tardis",sender:"@alice:tardis",auth_events:["$CREATE"],prev_events:["$CREATE"],content:{membership:"join"},event_id:"$ALICE"},{type:"m.room.power_levels",state_key:"",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE"],prev_events:["$ALICE"],content:{users:{"@alice:tardis":100},events:{"m.room.join_rules":50},users_default:50},event_id:"$PL"},{type:"m.room.join_rules",state_key:"",sender:"@creator:tardis",auth_events:["$CREATE","$ALICE","$PL"],prev_events:["$PL"],content:{join_rule:"public"},event_id:"$JR"},{type:"m.room.member",state_key:"@bob:tardis",sender:"@bob:tardis",auth_events:["$CREATE","$JR","$PL"],prev_events:["$JR"],content:{membership:"join"},event_id:"$BOB"},{type:"m.room.member",state_key:"@charlie:tardis",sender:"@charlie:tardis",auth_events:["$CREATE","$JR","$PL"],prev_events:["$BOB"],content:{membership:"join"},event_id:"$CHARLIE"},{type:"m.room.join_rules",state_key:"",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE","$PL"],prev_events:["$CHARLIE"],content:{join_rule:"invite"},event_id:"$ALICE_JR"},{type:"m.room.join_rules",state_key:"",sender:"@bob:tardis",auth_events:["$CREATE","$BOB","$PL"],prev_events:["$CHARLIE"],content:{join_rule:"knock"},event_id:"$BOB_JR"},{type:"m.room.message",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE","$PL"],prev_events:["$ALICE_JR","$BOB_JR"],content:{body:"Bob wins."},event_id:"$MERGE1"},{type:"m.room.join_rules",state_key:"",sender:"@bob:tardis",auth_events:["$CREATE","$BOB","$PL"],prev_events:["$MERGE1"],content:{join_rule:"knock"},event_id:"$BOB_JR2"},{type:"m.room.join_rules",state_key:"",sender:"@charlie:tardis",auth_events:["$CREATE","$CHARLIE","$PL"],prev_events:["$MERGE1"],content:{join_rule:"public"},event_id:"$CHARLIE_JR"},{type:"m.room.message",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE","$PL"],prev_events:["$BOB_JR2","$CHARLIE_JR"],content:{body:"Charlie wins."},event_id:"$MERGE2"},{type:"m.room.join_rules",state_key:"",sender:"@bob:tardis",auth_events:["$CREATE","$BOB","$PL"],prev_events:["$MERGE2"],content:{join_rule:"knock"},origin_server_ts:1704077299300,event_id:"$BOB_JR3"},{type:"m.room.join_rules",state_key:"",sender:"@charlie:tardis",auth_events:["$CREATE","$CHARLIE","$PL"],prev_events:["$MERGE2"],content:{join_rule:"invite"},origin_server_ts:1704077299300,event_id:"$CHARLIE_JR2"},{type:"m.room.message",sender:"@alice:tardis",auth_events:["$CREATE","$ALICE","$PL"],prev_events:["$CHARLIE_JR2","$BOB_JR3"],content:{body:"Bob wins."},event_id:"$MERGE3"}],room_id:"!power-ordering:tardis",room_version:"10",tardis_version:1,annotations:{title:["The winner follows this priority:","Sender Power Level THEN","origin_server_ts THEN","event ID"].join(`
`),titles:{$PL:"Join rules can be modified by ANYONE",$ALICE:["Reverse Topological Power Ordering:","The conflicting state events in this example","potentially restrict permissions because they","are join rules. All of the merges in this","example are due to this ordering.","NOTE: You need a shim server running to run this,","otherwise you won't see which events win state","resolution!"].join(`
`),$MERGE1:["Bob's 'knock' wins because he has a lower PL (50 vs 100).","This seems undesirable at first,","but this can be worded another way:","Alice's 'invite' is APPLIED FIRST, and then","Bob's. This order ensures if Alice revokes","Bob's permissions, Alice wins."].join(`
`),$MERGE2:["Both Bob and Charlie have the same PL (50).","Charlie's 'public' wins because his event has a","higher origin_server_ts"].join(`
`),$MERGE3:["Both events have the same timestamp.","Bob's 'knock' wins because his event ID is greater than Charlie's","(A < Z < a < z)"].join(`
`)},events:{}}};var cl=/[\u1680\u2000-\u200A\u202F\u205F\u3000]/,fl=/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08BD\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312E\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FEA\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC03-\uDC37\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDF00-\uDF19]|\uD806[\uDCA0-\uDCDF\uDCFF\uDE00\uDE0B-\uDE32\uDE3A\uDE50\uDE5C-\uDE83\uDE86-\uDE89\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD46]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50\uDF93-\uDF9F\uDFE0\uDFE1]|\uD821[\uDC00-\uDFEC]|\uD822[\uDC00-\uDEF2]|\uD82C[\uDC00-\uDD1E\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]/,dl=/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05F0-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u082D\u0840-\u085B\u0860-\u086A\u08A0-\u08B4\u08B6-\u08BD\u08D4-\u08E1\u08E3-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u09FC\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0AF9-\u0AFF\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58-\u0C5A\u0C60-\u0C63\u0C66-\u0C6F\u0C80-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D00-\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D54-\u0D57\u0D5F-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1877\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19D9\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1C80-\u1C88\u1CD0-\u1CD2\u1CD4-\u1CF9\u1D00-\u1DF9\u1DFB-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u2E2F\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099\u309A\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312E\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FEA\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA827\uA840-\uA873\uA880-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD\uA900-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDDFD\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF7A\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00-\uDE03\uDE05\uDE06\uDE0C-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE38-\uDE3A\uDE3F\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE6\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC00-\uDC46\uDC66-\uDC6F\uDC7F-\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD00-\uDD34\uDD36-\uDD3F\uDD50-\uDD73\uDD76\uDD80-\uDDC4\uDDCA-\uDDCC\uDDD0-\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE37\uDE3E\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEEA\uDEF0-\uDEF9\uDF00-\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3C-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF50\uDF57\uDF5D-\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC00-\uDC4A\uDC50-\uDC59\uDC80-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDB5\uDDB8-\uDDC0\uDDD8-\uDDDD\uDE00-\uDE40\uDE44\uDE50-\uDE59\uDE80-\uDEB7\uDEC0-\uDEC9\uDF00-\uDF19\uDF1D-\uDF2B\uDF30-\uDF39]|\uD806[\uDCA0-\uDCE9\uDCFF\uDE00-\uDE3E\uDE47\uDE50-\uDE83\uDE86-\uDE99\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC36\uDC38-\uDC40\uDC50-\uDC59\uDC72-\uDC8F\uDC92-\uDCA7\uDCA9-\uDCB6\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD36\uDD3A\uDD3C\uDD3D\uDD3F-\uDD47\uDD50-\uDD59]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50-\uDF7E\uDF8F-\uDF9F\uDFE0\uDFE1]|\uD821[\uDC00-\uDFEC]|\uD822[\uDC00-\uDEF2]|\uD82C[\uDC00-\uDD1E\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9D\uDC9E]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD838[\uDC00-\uDC06\uDC08-\uDC18\uDC1B-\uDC21\uDC23\uDC24\uDC26-\uDC2A]|\uD83A[\uDC00-\uDCC4\uDCD0-\uDCD6\uDD00-\uDD4A\uDD50-\uDD59]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uDB40[\uDD00-\uDDEF]/,je={Space_Separator:cl,ID_Start:fl,ID_Continue:dl},Z={isSpaceSeparator(t){return typeof t=="string"&&je.Space_Separator.test(t)},isIdStartChar(t){return typeof t=="string"&&(t>="a"&&t<="z"||t>="A"&&t<="Z"||t==="$"||t==="_"||je.ID_Start.test(t))},isIdContinueChar(t){return typeof t=="string"&&(t>="a"&&t<="z"||t>="A"&&t<="Z"||t>="0"&&t<="9"||t==="$"||t==="_"||t===""||t===""||je.ID_Continue.test(t))},isDigit(t){return typeof t=="string"&&/[0-9]/.test(t)},isHexDigit(t){return typeof t=="string"&&/[0-9A-Fa-f]/.test(t)}};let un,rt,_t,Fe,It,ft,tt,In,te;var pl=function(e,n){un=String(e),rt="start",_t=[],Fe=0,It=1,ft=0,tt=void 0,In=void 0,te=void 0;do tt=vl(),gl[rt]();while(tt.type!=="eof");return typeof n=="function"?on({"":te},"",n):te};function on(t,e,n){const i=t[e];if(i!=null&&typeof i=="object")if(Array.isArray(i))for(let r=0;r<i.length;r++){const s=String(r),u=on(i,s,n);u===void 0?delete i[s]:Object.defineProperty(i,s,{value:u,writable:!0,enumerable:!0,configurable:!0})}else for(const r in i){const s=on(i,r,n);s===void 0?delete i[r]:Object.defineProperty(i,r,{value:s,writable:!0,enumerable:!0,configurable:!0})}return n.call(t,e,i)}let V,P,Qt,yt,q;function vl(){for(V="default",P="",Qt=!1,yt=1;;){q=Ct();const t=sr[V]();if(t)return t}}function Ct(){if(un[Fe])return String.fromCodePoint(un.codePointAt(Fe))}function F(){const t=Ct();return t===`
`?(It++,ft=0):t?ft+=t.length:ft++,t&&(Fe+=t.length),t}const sr={default(){switch(q){case"	":case"\v":case"\f":case" ":case"":case"\uFEFF":case`
`:case"\r":case"\u2028":case"\u2029":F();return;case"/":F(),V="comment";return;case void 0:return F(),U("eof")}if(Z.isSpaceSeparator(q)){F();return}return sr[rt]()},comment(){switch(q){case"*":F(),V="multiLineComment";return;case"/":F(),V="singleLineComment";return}throw W(F())},multiLineComment(){switch(q){case"*":F(),V="multiLineCommentAsterisk";return;case void 0:throw W(F())}F()},multiLineCommentAsterisk(){switch(q){case"*":F();return;case"/":F(),V="default";return;case void 0:throw W(F())}F(),V="multiLineComment"},singleLineComment(){switch(q){case`
`:case"\r":case"\u2028":case"\u2029":F(),V="default";return;case void 0:return F(),U("eof")}F()},value(){switch(q){case"{":case"[":return U("punctuator",F());case"n":return F(),Mt("ull"),U("null",null);case"t":return F(),Mt("rue"),U("boolean",!0);case"f":return F(),Mt("alse"),U("boolean",!1);case"-":case"+":F()==="-"&&(yt=-1),V="sign";return;case".":P=F(),V="decimalPointLeading";return;case"0":P=F(),V="zero";return;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":P=F(),V="decimalInteger";return;case"I":return F(),Mt("nfinity"),U("numeric",1/0);case"N":return F(),Mt("aN"),U("numeric",NaN);case'"':case"'":Qt=F()==='"',P="",V="string";return}throw W(F())},identifierNameStartEscape(){if(q!=="u")throw W(F());F();const t=an();switch(t){case"$":case"_":break;default:if(!Z.isIdStartChar(t))throw hi();break}P+=t,V="identifierName"},identifierName(){switch(q){case"$":case"_":case"":case"":P+=F();return;case"\\":F(),V="identifierNameEscape";return}if(Z.isIdContinueChar(q)){P+=F();return}return U("identifier",P)},identifierNameEscape(){if(q!=="u")throw W(F());F();const t=an();switch(t){case"$":case"_":case"":case"":break;default:if(!Z.isIdContinueChar(t))throw hi();break}P+=t,V="identifierName"},sign(){switch(q){case".":P=F(),V="decimalPointLeading";return;case"0":P=F(),V="zero";return;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":P=F(),V="decimalInteger";return;case"I":return F(),Mt("nfinity"),U("numeric",yt*(1/0));case"N":return F(),Mt("aN"),U("numeric",NaN)}throw W(F())},zero(){switch(q){case".":P+=F(),V="decimalPoint";return;case"e":case"E":P+=F(),V="decimalExponent";return;case"x":case"X":P+=F(),V="hexadecimal";return}return U("numeric",yt*0)},decimalInteger(){switch(q){case".":P+=F(),V="decimalPoint";return;case"e":case"E":P+=F(),V="decimalExponent";return}if(Z.isDigit(q)){P+=F();return}return U("numeric",yt*Number(P))},decimalPointLeading(){if(Z.isDigit(q)){P+=F(),V="decimalFraction";return}throw W(F())},decimalPoint(){switch(q){case"e":case"E":P+=F(),V="decimalExponent";return}if(Z.isDigit(q)){P+=F(),V="decimalFraction";return}return U("numeric",yt*Number(P))},decimalFraction(){switch(q){case"e":case"E":P+=F(),V="decimalExponent";return}if(Z.isDigit(q)){P+=F();return}return U("numeric",yt*Number(P))},decimalExponent(){switch(q){case"+":case"-":P+=F(),V="decimalExponentSign";return}if(Z.isDigit(q)){P+=F(),V="decimalExponentInteger";return}throw W(F())},decimalExponentSign(){if(Z.isDigit(q)){P+=F(),V="decimalExponentInteger";return}throw W(F())},decimalExponentInteger(){if(Z.isDigit(q)){P+=F();return}return U("numeric",yt*Number(P))},hexadecimal(){if(Z.isHexDigit(q)){P+=F(),V="hexadecimalInteger";return}throw W(F())},hexadecimalInteger(){if(Z.isHexDigit(q)){P+=F();return}return U("numeric",yt*Number(P))},string(){switch(q){case"\\":F(),P+=Dl();return;case'"':if(Qt)return F(),U("string",P);P+=F();return;case"'":if(!Qt)return F(),U("string",P);P+=F();return;case`
`:case"\r":throw W(F());case"\u2028":case"\u2029":yl(q);break;case void 0:throw W(F())}P+=F()},start(){switch(q){case"{":case"[":return U("punctuator",F())}V="value"},beforePropertyName(){switch(q){case"$":case"_":P=F(),V="identifierName";return;case"\\":F(),V="identifierNameStartEscape";return;case"}":return U("punctuator",F());case'"':case"'":Qt=F()==='"',V="string";return}if(Z.isIdStartChar(q)){P+=F(),V="identifierName";return}throw W(F())},afterPropertyName(){if(q===":")return U("punctuator",F());throw W(F())},beforePropertyValue(){V="value"},afterPropertyValue(){switch(q){case",":case"}":return U("punctuator",F())}throw W(F())},beforeArrayValue(){if(q==="]")return U("punctuator",F());V="value"},afterArrayValue(){switch(q){case",":case"]":return U("punctuator",F())}throw W(F())},end(){throw W(F())}};function U(t,e){return{type:t,value:e,line:It,column:ft}}function Mt(t){for(const e of t){if(Ct()!==e)throw W(F());F()}}function Dl(){switch(Ct()){case"b":return F(),"\b";case"f":return F(),"\f";case"n":return F(),`
`;case"r":return F(),"\r";case"t":return F(),"	";case"v":return F(),"\v";case"0":if(F(),Z.isDigit(Ct()))throw W(F());return"\0";case"x":return F(),ml();case"u":return F(),an();case`
`:case"\u2028":case"\u2029":return F(),"";case"\r":return F(),Ct()===`
`&&F(),"";case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":throw W(F());case void 0:throw W(F())}return F()}function ml(){let t="",e=Ct();if(!Z.isHexDigit(e)||(t+=F(),e=Ct(),!Z.isHexDigit(e)))throw W(F());return t+=F(),String.fromCodePoint(parseInt(t,16))}function an(){let t="",e=4;for(;e-- >0;){const n=Ct();if(!Z.isHexDigit(n))throw W(F());t+=F()}return String.fromCodePoint(parseInt(t,16))}const gl={start(){if(tt.type==="eof")throw Tt();qe()},beforePropertyName(){switch(tt.type){case"identifier":case"string":In=tt.value,rt="afterPropertyName";return;case"punctuator":fe();return;case"eof":throw Tt()}},afterPropertyName(){if(tt.type==="eof")throw Tt();rt="beforePropertyValue"},beforePropertyValue(){if(tt.type==="eof")throw Tt();qe()},beforeArrayValue(){if(tt.type==="eof")throw Tt();if(tt.type==="punctuator"&&tt.value==="]"){fe();return}qe()},afterPropertyValue(){if(tt.type==="eof")throw Tt();switch(tt.value){case",":rt="beforePropertyName";return;case"}":fe()}},afterArrayValue(){if(tt.type==="eof")throw Tt();switch(tt.value){case",":rt="beforeArrayValue";return;case"]":fe()}},end(){}};function qe(){let t;switch(tt.type){case"punctuator":switch(tt.value){case"{":t={};break;case"[":t=[];break}break;case"null":case"boolean":case"numeric":case"string":t=tt.value;break}if(te===void 0)te=t;else{const e=_t[_t.length-1];Array.isArray(e)?e.push(t):Object.defineProperty(e,In,{value:t,writable:!0,enumerable:!0,configurable:!0})}if(t!==null&&typeof t=="object")_t.push(t),Array.isArray(t)?rt="beforeArrayValue":rt="beforePropertyName";else{const e=_t[_t.length-1];e==null?rt="end":Array.isArray(e)?rt="afterArrayValue":rt="afterPropertyValue"}}function fe(){_t.pop();const t=_t[_t.length-1];t==null?rt="end":Array.isArray(t)?rt="afterArrayValue":rt="afterPropertyValue"}function W(t){return Be(t===void 0?`JSON5: invalid end of input at ${It}:${ft}`:`JSON5: invalid character '${ur(t)}' at ${It}:${ft}`)}function Tt(){return Be(`JSON5: invalid end of input at ${It}:${ft}`)}function hi(){return ft-=5,Be(`JSON5: invalid identifier character at ${It}:${ft}`)}function yl(t){console.warn(`JSON5: '${ur(t)}' in strings is not valid ECMAScript; consider escaping`)}function ur(t){const e={"'":"\\'",'"':'\\"',"\\":"\\\\","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t","\v":"\\v","\0":"\\0","\u2028":"\\u2028","\u2029":"\\u2029"};if(e[t])return e[t];if(t<" "){const n=t.charCodeAt(0).toString(16);return"\\x"+("00"+n).substring(n.length)}return t}function Be(t){const e=new SyntaxError(t);return e.lineNumber=It,e.columnNumber=ft,e}var _l=function(e,n,i){const r=[];let s="",u,o,a="",h;if(n!=null&&typeof n=="object"&&!Array.isArray(n)&&(i=n.space,h=n.quote,n=n.replacer),typeof n=="function")o=n;else if(Array.isArray(n)){u=[];for(const v of n){let E;typeof v=="string"?E=v:(typeof v=="number"||v instanceof String||v instanceof Number)&&(E=String(v)),E!==void 0&&u.indexOf(E)<0&&u.push(E)}}return i instanceof Number?i=Number(i):i instanceof String&&(i=String(i)),typeof i=="number"?i>0&&(i=Math.min(10,Math.floor(i)),a="          ".substr(0,i)):typeof i=="string"&&(a=i.substr(0,10)),l("",{"":e});function l(v,E){let m=E[v];switch(m!=null&&(typeof m.toJSON5=="function"?m=m.toJSON5(v):typeof m.toJSON=="function"&&(m=m.toJSON(v))),o&&(m=o.call(E,v,m)),m instanceof Number?m=Number(m):m instanceof String?m=String(m):m instanceof Boolean&&(m=m.valueOf()),m){case null:return"null";case!0:return"true";case!1:return"false"}if(typeof m=="string")return c(m);if(typeof m=="number")return String(m);if(typeof m=="object")return Array.isArray(m)?g(m):f(m)}function c(v){const E={"'":.1,'"':.2},m={"'":"\\'",'"':'\\"',"\\":"\\\\","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t","\v":"\\v","\0":"\\0","\u2028":"\\u2028","\u2029":"\\u2029"};let B="";for(let C=0;C<v.length;C++){const A=v[C];switch(A){case"'":case'"':E[A]++,B+=A;continue;case"\0":if(Z.isDigit(v[C+1])){B+="\\x00";continue}}if(m[A]){B+=m[A];continue}if(A<" "){let x=A.charCodeAt(0).toString(16);B+="\\x"+("00"+x).substring(x.length);continue}B+=A}const b=h||Object.keys(E).reduce((C,A)=>E[C]<E[A]?C:A);return B=B.replace(new RegExp(b,"g"),m[b]),b+B+b}function f(v){if(r.indexOf(v)>=0)throw TypeError("Converting circular structure to JSON5");r.push(v);let E=s;s=s+a;let m=u||Object.keys(v),B=[];for(const C of m){const A=l(C,v);if(A!==void 0){let x=d(C)+":";a!==""&&(x+=" "),x+=A,B.push(x)}}let b;if(B.length===0)b="{}";else{let C;if(a==="")C=B.join(","),b="{"+C+"}";else{let A=`,
`+s;C=B.join(A),b=`{
`+s+C+`,
`+E+"}"}}return r.pop(),s=E,b}function d(v){if(v.length===0)return c(v);const E=String.fromCodePoint(v.codePointAt(0));if(!Z.isIdStartChar(E))return c(v);for(let m=E.length;m<v.length;m++)if(!Z.isIdContinueChar(String.fromCodePoint(v.codePointAt(m))))return c(v);return v}function g(v){if(r.indexOf(v)>=0)throw TypeError("Converting circular structure to JSON5");r.push(v);let E=s;s=s+a;let m=[];for(let b=0;b<v.length;b++){const C=l(String(b),v);m.push(C!==void 0?C:"null")}let B;if(m.length===0)B="[]";else if(a==="")B="["+m.join(",")+"]";else{let b=`,
`+s,C=m.join(b);B=`[
`+s+C+`,
`+E+"]"}return r.pop(),s=E,B}};const El={parse:pl,stringify:_l};var Cl=El;const ci="10";async function Al(t){const e=await new Promise((i,r)=>{const s=new FileReader;s.onload=u=>{if(!u.target||!u.target.result)return;if(t.name.endsWith(".json5")){const a=Cl.parse(u.target.result);a.on_load_at_start==null&&(a.on_load_at_start=!1),a.calculate_event_ids==null&&(a.calculate_event_ids=!1),a.room_version==null&&(a.room_version=ci),i(a);return}const o=u.target.result.split(`
`).filter(a=>a.trim().length>0).map(a=>JSON.parse(a));i(o)},s.readAsText(t)});let n;return Array.isArray(e)?n={tardis_version:1,room_version:ci,room_id:e[0].room_id,calculate_event_ids:!1,on_load_at_start:!1,events:e}:n=e,or(n)}function or(t){var r,s,u,o;const e={events:[],roomVersion:t.room_version,annotations:t.annotations,precalculatedStateAfter:t.precalculated_state_after,onLoadAtStart:t.on_load_at_start},n=new Map;let i=new Date(2024,0,1).getTime();for(const a of t.events){if(!a)throw new Error("missing event");if(!a.event_id)throw new Error(`event is missing 'event_id', got ${JSON.stringify(a)}`);if(!a.type)throw new Error(`event is missing 'type' field, got ${JSON.stringify(a)}`);if(a.origin_server_ts?i=a.origin_server_ts+1e3:(a.origin_server_ts=i,i+=1e3),!a.room_id&&t.room_id&&(a.room_id=t.room_id),t.calculate_event_ids){const h=a.event_id;for(const c of["prev_events","auth_events"]){const f=[];for(const d of a[c]){const g=n.get(d);g?f.push(g):f.push(d)}a[c]=f}const l=globalThis.gmslEventIDForEvent(JSON.stringify(a),t.room_version);n.set(h,l),a.event_id=l,(s=(r=e.annotations)==null?void 0:r.events)!=null&&s[h]&&(e.annotations.events[l]=e.annotations.events[h]),(o=(u=e.annotations)==null?void 0:u.titles)!=null&&o[h]&&(e.annotations.titles[l]=e.annotations.titles[h])}e.events.push(a)}if(e.precalculatedStateAfter)for(const a in e.precalculatedStateAfter){const h=n.get(a);if(!h){console.error(`precalculated_state_after references ${a} but this does not exist in the events array. Skipping.`);continue}const l=[];for(const c of e.precalculatedStateAfter[a]){const f=n.get(c);f?l.push(f):console.error(`precalculated_state_after for ${a} references ${c} but this does not exist in the events array. Skipping.`)}e.precalculatedStateAfter[h]=l,delete e.precalculatedStateAfter[a]}return console.log(e),e}class xl{constructor(e,n){this.sender=e,this.getEvent=n,this.inflightRequests=new Map}onGetEventRequest(e){const n=this.getEvent(e);return n||console.error(`WS: asked for event ${e.event_id} but didn't find it.`),n}onResolveStateResponse(e,n){const i=this.inflightRequests.get(e);if(!i){console.error(`onResolveStateResponse: no request id for response! id=${e}`);return}i(n),this.inflightRequests.delete(e)}async resolveState(e,n,i){console.log("resolveState",i);const r=globalThis.crypto.randomUUID();return new Promise((u,o)=>{this.inflightRequests.set(r,a=>{if(!a.result){console.error("State resolved to the empty set"),u({state:{}});return}u({state:a.result})}),this.sender.sendResolveState(r,{state:i,room_id:e,room_version:n})})}}class wl{async sendResolveState(e,n){this.sendWs({id:e,type:"resolve_state",data:n})}async connect(e,n){return this.receiver=n,this.ws=new WebSocket(e),new Promise(i=>{this.ws.addEventListener("open",()=>{console.log("WS open"),i()}),this.ws.addEventListener("error",this.onWsError.bind(this)),this.ws.addEventListener("close",this.onWsClose.bind(this)),this.ws.addEventListener("message",this.onWsMessage.bind(this))})}close(){this.ws.close()}sendWs(e){console.log("send",e),this.ws.send(JSON.stringify(e))}onWsClose(e){}onWsError(e){}onWsMessage(e){const n=JSON.parse(e.data);switch(console.log("recv",n),n.type){case"get_event":{const i=n.data,r=this.receiver.onGetEventRequest(i);i.event=r,n.data=i,this.sendWs(n);break}case"resolve_state":{const i=n.data;this.receiver.onResolveStateResponse(n.id,i);break}}}}const fi={"Quick Start":rr,"Mainline Ordering":ll,"Reverse Topological Power Ordering":hl},pt=new ol(document.getElementById("eventlist"),document.getElementById("eventlisttemplate"));class ar{constructor(e){this.cache=e,this.createEventId=null,this.showAuthChain=!1,this.showPrevEvents=!0,this.showOutliers=!1,this.showTimestamps=!1,this.collapse=!1,this.experimentalLayout=!1,this.renderEvents={}}setShimUrl(e){this.shimUrl=e,console.log("setShimUrl",e)}async loadFile(e){const n=await Al(e);this.loadScenario(n)}loadScenario(e){for(const n of e.events)this.cache.eventCache.store(n),n.type==="m.room.create"&&n.state_key===""&&(this.createEventId=n.event_id);if(e.precalculatedStateAfter)for(const n in e.precalculatedStateAfter){const i={};for(const r of e.precalculatedStateAfter[n]){const s=this.cache.eventCache.get(r);if(!s||s.state_key==null){console.log(`precalculated_state_after for ${n} includes ${r} but it isn't a state event we know about. Skipping.`);continue}i[JSON.stringify([s.type,s.state_key])]=s.event_id}this.cache.stateAtEvent.setState(n,i)}this.scenario=e,this.debugger=new ul(e),e.onLoadAtStart&&e.events.length>=2&&this.debugger.goTo(e.events[1].event_id),pt.clear(),e.events.forEach((n,i)=>{pt.appendEvent(i,n)}),pt.highlight(this.debugger.current()),pt.onEventClick(n=>{this.debugger.goTo(n),this.refresh(),pt.highlight(G.debugger.current())}),pt.onEventJsonClick(n=>{document.getElementById("eventdetails").textContent=JSON.stringify(this.cache.eventCache.get(n),null,2),document.getElementById("infocontainer").style.display="block"}),this.refresh()}setShowAuthChain(e){this.showAuthChain=e}setShowPrevEvents(e){this.showPrevEvents=e}setShowOutliers(e){this.showOutliers=e}setCollapse(e){this.collapse=e}setTimestamps(e){this.showTimestamps=e}setExperimentalLayout(e){var n,i;this.experimentalLayout=e,this.experimentalLayout?(n=document.getElementById("svgcontainer"))==null||n.classList.add("monospace"):(i=document.getElementById("svgcontainer"))==null||i.classList.remove("monospace")}async refresh(){let e=await this.recalculate();if(this.experimentalLayout){const n=[];for(const i in e)n.push(e[i]);al(document.getElementById("svgcontainer"),n);return}this.collapse&&(e=this.collapsifier(e)),this.renderEvents=e,await this.render(this.eventsToCompleteDag(e))}async recalculate(){const e=Object.create(null);for(const n of this.debugger.eventsUpToCurrent())e[n]=this.cache.eventCache.get(n);return e}eventsToCompleteDag(e){for(const n in e){const i=e[n],r=["auth_events","prev_events"];for(const s of r)for(const u of i[s])e[u]||(this.cache.eventCache.get(u)?e[u]={event_id:u,prev_events:[],auth_events:[],state_key:"...",type:"...",content:{},sender:"",room_id:"!"}:e[u]={event_id:u,prev_events:[],auth_events:[],state_key:"missing",type:"missing",content:{},sender:"",room_id:"!"})}return e}findForwardExtremities(e){const n=new Set;for(const i in e)n.add(i);for(const i in e){const r=e[i];for(const s of r.prev_events)n.delete(s);for(const s of r.auth_events)n.delete(s)}return n}collapsifier(e){const n=JSON.parse(JSON.stringify(e)),i=this.findForwardExtremities(n),r=new Set;for(const h of i)r.add(h);const s=Object.create(null);for(const h in n){const l=n[h];for(const c of l.prev_events){const f=s[c]||0;s[c]=f+1}l.prev_events.length!==1&&r.add(l.event_id)}for(const h in s)s[h]>1&&r.add(h);const u=new Set;for(const h in n){if(r.has(h)){u.add(h);continue}const l=n[h];if(r.has(l.prev_events[0])){u.add(h);continue}for(const c of r){const f=n[c];if(!f)continue;let d=!1;for(const g of f.prev_events)if(g===h){u.add(h),d=!0;break}if(d)break}}const o=[],a=new Set;for(const h of i)o.push({id:h,from:h});for(;o.length>0;){const h=o.pop();if(!h)break;const l=h.id,c=n[l];if(a.has(l)||(a.add(l),!c))continue;for(const g of c.prev_events)o.push({id:g,from:h.id});if(u.has(l))continue;delete n[l];const f=n[h.from],d=[c.prev_events[0]];for(const g in f.prev_events)u.has(g)&&d.push(g);f.prev_events=d,f._collapse=f._collapse||0,f._collapse+=1,n[h.from]=f;for(const g of o)g.from===l&&(g.from=f.event_id)}return console.log("collapsifier complete"),n}async render(e){var w,$,N,L,j;const n=!this.showOutliers,i=document.getElementById("svgcontainer");i.innerHTML="";const r=i.offsetWidth,s=window.innerHeight;if(console.log(e),Object.keys(e).length<=1)return;let u=ta().id(p=>p.event_id).parentIds(p=>this.showAuthChain?p.prev_events.concat(p.auth_events.filter(I=>I!==this.createEventId)):p.prev_events).parentData(p=>{const I=[],y=this.showAuthChain?p.prev_events.concat(p.auth_events):p.prev_events;for(const M of new Set(y))e[M]&&I.push([M,{auth:p.auth_events.includes(M)&&!p.prev_events.includes(M)}]);return I})(Object.values(e));const o=u.split();if(n){const p=o.filter(I=>I.descendants().length>1);p.length>1&&console.error(`hideOrphans: ${p.length} roots with children, this should not be possible unless there are 2 DAG chunks in this file`),u=p[0]}console.log("dag:",u);const a=10,h=a*4,l=document.createElementNS("http://www.w3.org/2000/svg","svg");l.setAttribute("width",String(r)),l.setAttribute("height",String(s)),l.setAttribute("viewBox",`${-h} ${-h} ${r+10*h} ${s+2*h}`);const c=et(l),f=c.append("text").attr("x",r/3).attr("y",-40).style("font-size","24px");let d=(N=($=(w=this.scenario)==null?void 0:w.annotations)==null?void 0:$.titles)==null?void 0:N[this.debugger.current()];d||(d=((j=(L=this.scenario)==null?void 0:L.annotations)==null?void 0:j.title)||"");for(const p of d.split(`
`))f.append("tspan").attr("x",r/2).attr("dy","1.2em").text(p);const g=c.append("defs");Za().layering(nl().width(2)).coord(il()).size([r,s])(u);const v=u.size(),E=$o,m={};u.idescendants("after").forEach((p,I)=>{m[p.id]=E(I/v)});const B=ko().curve(Oo).x(p=>p.x).y(p=>p.y),b=c.append("g").selectAll("path").data(u.links()).enter().append("path").attr("d",({points:p})=>B(p)).attr("fill","none").attr("stroke-width",p=>{const I=p.target;return I.data._collapse?I.data._collapse<5?5:10:3}).text("test").attr("stroke",p=>{const I=p.source,y=p.target,M=`${I.id}-${y.id}`,k=g.append("linearGradient").attr("id",M).attr("gradientUnits","userSpaceOnUse").attr("x1",I.x).attr("x2",y.x).attr("y1",I.y).attr("y2",y.y);return k.append("stop").attr("offset","0%").attr("stop-color",p.data.auth?m[I.id]:"#000"),k.append("stop").attr("offset","100%").attr("stop-color",p.data.auth?m[y.id]:"#000"),`url(#${M})`}),C=c.append("g").selectAll("g").data(u.descendants()).enter().append("g").attr("transform",({x:p,y:I})=>`translate(${p}, ${I})`),A=this.cache.stateAtEvent.getStateAsEventIds(this.debugger.current());C.append("circle").attr("r",p=>{const I=this.cache.eventCache.get(p.id);return I&&I.state_key!=null?a*1.5:a}).attr("fill",p=>p.id===this.debugger.current()?"blue":A.has(p.id)?"green":"black");const x=p=>{var T,z,J,nt,Y;const I=p.data.event_id,y=I.substr(0,5);if((J=(z=(T=this.scenario)==null?void 0:T.annotations)==null?void 0:z.events)!=null&&J[I])return`${y} ${(Y=(nt=this.scenario)==null?void 0:nt.annotations)==null?void 0:Y.events[I]}`;const M=pt.textRepresentation(p.data),k=p.data.depth?`(${p.data.depth})`:"";let O=p.data._collapse?`+${p.data._collapse} more`:"";return O===""&&p.data.origin!==void 0&&(O=p.data.origin),`${y} ${k} ${M} ${O}`};C.append("text").text(p=>x(p)).attr("transform",`translate(${a+10}, 0)`).attr("font-family","sans-serif").attr("text-anchor","left").attr("alignment-baseline","middle").attr("fill","white").attr("opacity",.8).attr("stroke","white"),C.append("text").text(p=>x(p)).attr("cursor","pointer").on("click",async(p,I)=>{this.debugger.goTo(I.data.event_id),pt.highlight(I.data.event_id),this.refresh()}).attr("transform",`translate(${a+10}, 0)`).attr("font-family","sans-serif").attr("text-anchor","left").attr("alignment-baseline","middle").attr("fill",p=>"black"),this.showTimestamps&&C.append("text").text(p=>new Date(p.data.origin_server_ts||0).toLocaleString()).attr("transform",`translate(${a+10}, ${a+10})`).attr("font-family","sans-serif").attr("text-anchor","left").attr("alignment-baseline","middle").attr("fill",p=>"grey");function S({transform:p}){C.attr("transform",I=>`translate(${p.applyX(I.x)}, ${p.applyY(I.y)})`),b.attr("d",({points:I})=>B(I.map(y=>({x:p.applyX(y.x),y:p.applyY(y.y)})))),f.attr("transform",()=>`translate(${p.applyX(f.attr("x"))}, ${p.applyY(f.attr("y"))})`)}const _=Jo().scaleExtent([.1,10]).on("zoom",S);c.call(_).call(_.transform,An),et("#svgcontainer").append(()=>l)}}let G=new ar(new ir);G.setShimUrl(document.getElementById("shimurl").value);const ln=new wl,di=new xl(ln,t=>G.cache.eventCache.get(t.event_id));document.getElementById("showauthevents").addEventListener("change",t=>{G.setShowAuthChain(t.target.checked),G.refresh()});document.getElementById("showauthevents").checked=G.showAuthChain;document.getElementById("showoutliers").addEventListener("change",t=>{G.setShowOutliers(t.target.checked),G.refresh()});document.getElementById("showoutliers").checked=G.showOutliers;document.getElementById("collapse").addEventListener("change",t=>{G.setCollapse(t.target.checked),G.refresh()});document.getElementById("timestamps").checked=G.showTimestamps;document.getElementById("timestamps").addEventListener("change",t=>{G.setTimestamps(t.target.checked),G.refresh()});document.getElementById("explayout").addEventListener("change",t=>{G.setExperimentalLayout(t.target.checked),G.refresh()});document.getElementById("collapse").checked=G.collapse;document.getElementById("jsonfile").addEventListener("change",async t=>{const e=document.getElementById("jsonfile").files;e&&(G=new ar(new ir),G.setShimUrl(document.getElementById("shimurl").value),await G.loadFile(e[0]))},!1);document.getElementById("closeinfocontainer").addEventListener("click",t=>{document.getElementById("infocontainer").style.display="none"});document.getElementById("infocontainer").style.display="none";document.getElementById("stepfwd").addEventListener("click",async t=>{G.debugger.next(),G.refresh(),pt.highlight(G.debugger.current())});document.getElementById("stepbwd").addEventListener("click",async t=>{G.debugger.previous(),G.refresh(),pt.highlight(G.debugger.current())});document.getElementById("shimurl").addEventListener("change",t=>{const e=t.target.value;G.setShimUrl(e),globalThis.localStorage.setItem("shim_url",e)});const pi=globalThis.localStorage.getItem("shim_url");pi&&(console.log("setting shim url from local storage"),document.getElementById("shimurl").value=pi);document.getElementById("resolve").addEventListener("click",async t=>{await G.debugger.resolve(G.cache,async(e,n,i)=>{if(!G.shimUrl)return console.error("you need to set a shim url to resolve state!"),{};try{return await ln.connect(G.shimUrl,di),(await di.resolveState(e,n,i)).state}catch(r){console.error("failed to setup WS connection:",r)}finally{ln.close()}return{}}),G.refresh()});const vi=new Go;WebAssembly.instantiateStreaming(fetch("gmsl.wasm"),vi.importObject).then(t=>{globalThis.wasm=t.instance,vi.run(globalThis.wasm);const e=i=>{const r=or(i);G.loadScenario(r)},n=document.getElementById("file-select");n&&(n.innerHTML="",Object.keys(fi).forEach((i,r)=>{n[r]=new Option(i)}),n.addEventListener("change",i=>{var s;const r=fi[(s=i==null?void 0:i.target)==null?void 0:s.value];e(r)})),e(rr)});
